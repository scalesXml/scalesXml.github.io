<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scales\xml\parser\sax\XmlParser.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scales.xml.parser.sax

<span class="keyword">import</span> org.xml.sax.<span class="delimiter">{</span>InputSource, XMLReader<span class="delimiter">}</span>
<span class="keyword">import</span> javax.xml.parsers.SAXParser
<span class="keyword">import</span> scales.utils._
<span class="keyword">import</span> scales.utils.resources._
<span class="keyword">import</span> java.io._
<span class="keyword">import</span> scales.xml._
<span class="keyword">import</span> parser.strategies._
<span class="keyword">import</span> scales.xml.impl._

<span class="keyword">trait</span> <a title="trait XmlParserImplicits extends java.lang.Object with ScalaObject" id="10155">XmlParserImplicits</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.parser.sax.XmlParserImplicits.streamToSource : (source: java.io.InputStream)org.xml.sax.InputSource" id="42921">streamToSource</a><span class="delimiter">(</span> <a title="java.io.InputStream" id="47846">source</a> : <span title="java.io.InputStream">InputStream</span> <span class="delimiter">)</span> = <span title="(x$1: java.io.InputStream)org.xml.sax.InputSource" class="keyword">new</span> org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span><span class="delimiter">(</span><a href="#47846" title="java.io.InputStream">source</a><span class="delimiter">)</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.parser.sax.XmlParserImplicits.readerToSource : (source: java.io.Reader)org.xml.sax.InputSource" id="42922">readerToSource</a><span class="delimiter">(</span> <a title="java.io.Reader" id="47839">source</a> : <span title="java.io.Reader">Reader</span> <span class="delimiter">)</span> = <span title="(x$1: java.io.Reader)org.xml.sax.InputSource" class="keyword">new</span> org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span><span class="delimiter">(</span><a href="#47839" title="java.io.Reader">source</a><span class="delimiter">)</span>
  <span class="comment">/**
   * will call openStream.
   */</span> 
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.parser.sax.XmlParserImplicits.urlToSource : (url: java.net.URL)org.xml.sax.InputSource" id="42923">urlToSource</a><span class="delimiter">(</span> <a title="java.net.URL" id="47639">url</a> : java.net.<span title="java.net.URL">URL</span> <span class="delimiter">)</span> = <span title="(x$1: java.io.InputStream)org.xml.sax.InputSource" class="keyword">new</span> org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span><span class="delimiter">(</span><a href="#47639" title="java.net.URL">url</a>.<span title="()java.io.InputStream">openStream</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Whilst Saxon, Xerces and nu.validator support certain combinations, this is an abstraction over those needed by the readXml function
 */</span> 
<span class="keyword">trait</span> <a title="trait SaxSupport extends java.lang.Object" id="10143">SaxSupport</a> <span title="java.lang.Object" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[T &lt;: scales.xml.parser.strategies.OptimisationToken](reader: org.xml.sax.XMLReader, handler: scales.xml.parser.sax.Handler[T])Unit" id="104859">setLexicalHandler</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.parser.strategies.OptimisationToken" id="104861">T</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span> <a title="org.xml.sax.XMLReader" id="109642">reader</a> : <span title="org.xml.sax.XMLReader">XMLReader</span>, <a title="scales.xml.parser.sax.Handler[T]" id="109643">handler</a> : <a href="Handler.scala.html#10140" title="scales.xml.parser.sax.Handler[T]">Handler</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">)</span> : <span title="Unit">Unit</span>
  <span class="keyword">def</span> <a title="(reader: org.xml.sax.XMLReader)AnyRef" id="104862">getXmlVersion</a><span class="delimiter">(</span> <a title="org.xml.sax.XMLReader" id="104927">reader</a> : <span title="org.xml.sax.XMLReader">XMLReader</span> <span class="delimiter">)</span> : <span title="AnyRef">AnyRef</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Assumes lexical-handler and document-xml-version are supported
 */</span> 
<span class="keyword">trait</span> <a title="trait DefaultSaxSupport extends java.lang.Object with scales.xml.parser.sax.SaxSupport with ScalaObject" id="10131">DefaultSaxSupport</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10143" title="scales.xml.parser.sax.SaxSupport">SaxSupport</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="[T &lt;: scales.xml.parser.strategies.OptimisationToken](reader: org.xml.sax.XMLReader, handler: scales.xml.parser.sax.Handler[T])Unit" id="104864">setLexicalHandler</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.parser.strategies.OptimisationToken" id="104866">T</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span> <a title="org.xml.sax.XMLReader" id="109648">reader</a> : <span title="org.xml.sax.XMLReader">XMLReader</span>, <a title="scales.xml.parser.sax.Handler[T]" id="109649">handler</a> : <a href="Handler.scala.html#10140" title="scales.xml.parser.sax.Handler[T]">Handler</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">)</span> : <span title="Unit">Unit</span> =
    <a href="#109648" title="org.xml.sax.XMLReader">reader</a>.<span title="(x$1: java.lang.String, x$2: Any)Unit">setProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;http://xml.org/sax/properties/lexical-handler&quot;)" class="string">&quot;http://xml.org/sax/properties/lexical-handler&quot;</span>, <a href="#109649" title="scales.xml.parser.sax.Handler[T]">handler</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(reader: org.xml.sax.XMLReader)AnyRef" id="104867">getXmlVersion</a><span class="delimiter">(</span> <a title="org.xml.sax.XMLReader" id="104925">reader</a> : <span title="org.xml.sax.XMLReader">XMLReader</span> <span class="delimiter">)</span> : <span title="AnyRef">AnyRef</span> =
    <a href="#104925" title="org.xml.sax.XMLReader">reader</a>.<span title="(x$1: java.lang.String)java.lang.Object">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;http://xml.org/sax/properties/document-xml-version&quot;)" class="string">&quot;http://xml.org/sax/properties/document-xml-version&quot;</span><span class="delimiter">)</span>
  
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait XmlParser extends java.lang.Object with ScalaObject" id="10152">XmlParser</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="comment">/**
   * Use a custom parserPool to control the sax factory features 
   */</span> 
  <span class="keyword">def</span> <a title="[Token &lt;: scales.xml.parser.strategies.OptimisationToken](source: org.xml.sax.InputSource, strategy: scales.xml.parser.strategies.PathOptimisationStrategy[Token], parsers: scales.utils.resources.Loaner[javax.xml.parsers.SAXParser] with scales.xml.parser.sax.SaxSupport)(implicit xmlVer: scales.xml.XmlVersion)scales.xml.Doc" id="15627">loadXml</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.parser.strategies.OptimisationToken" id="109666">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="org.xml.sax.InputSource" id="109659">source</a>: <span title="org.xml.sax.InputSource">InputSource</span>, <a title="scales.xml.parser.strategies.PathOptimisationStrategy[Token]" id="109664">strategy</a> : <a href="../strategies/OptimisingStrategies.scala.html#14748" title="scales.xml.parser.strategies.PathOptimisationStrategy[Token]">PathOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> = <a href="../../package.scala.html#15568" title="=&gt; scales.xml.parser.strategies.PathOptimisationStrategy[scales.xml.parser.strategies.QNameToken]">defaultPathOptimisation</a>, <a title="XmlParser extends scales.utils.resources.Loaner[javax.xml.parsers.SAXParser] with scales.xml.parser.sax.SaxSupport" id="109667">parsers</a> : <a href="#109670" title="XmlParser extends scales.utils.resources.Loaner[javax.xml.parsers.SAXParser] with scales.xml.parser.sax.SaxSupport">Loaner</a><span class="delimiter">[</span>SAXParser<span class="delimiter">]</span> <span class="keyword">with</span> SaxSupport= <a href="../../impl/XmlFactories.scala.html#9930" title="object scales.xml.impl.DefaultSAXParserFactoryPool">DefaultSAXParserFactoryPool</a>.<a href="../../impl/XmlFactories.scala.html#104806" title="=&gt; java.lang.Object with scales.utils.resources.Loaner[javax.xml.parsers.SAXParser] with scales.xml.parser.sax.DefaultSaxSupport">parsers</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="109662">xmlVer</a> : <a href="../../Namespaces.scala.html#9702" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <a href="../../XmlTypes.scala.html#9489" title="scales.xml.Doc">Doc</a> =
    <a href="#109667" title="XmlParser extends scales.utils.resources.Loaner[javax.xml.parsers.SAXParser] with scales.xml.parser.sax.SaxSupport">parsers</a>.<a href="../../../utils/resource/Resources.scala.html#58943" title="(tThunk: javax.xml.parsers.SAXParser =&gt; scales.xml.Doc)scales.xml.Doc">loan</a> <span class="delimiter">{</span>
      <a title="javax.xml.parsers.SAXParser" id="109678">parser</a> =&gt;
	<a href="#15630" title="(source: org.xml.sax.InputSource, strategy: scales.xml.parser.strategies.PathOptimisationStrategy[Token], reader: org.xml.sax.XMLReader, saxSupport: scales.xml.parser.sax.SaxSupport)(implicit xmlVer: scales.xml.XmlVersion)scales.xml.Doc">readXml</a><a href="#109662" title="scales.xml.XmlVersion" class="delimiter">(</a><a href="#109659" title="org.xml.sax.InputSource">source</a>, <a href="#109664" title="scales.xml.parser.strategies.PathOptimisationStrategy[Token]">strategy</a>, <a href="#109678" title="javax.xml.parsers.SAXParser">parser</a>.<span title="()org.xml.sax.XMLReader">getXMLReader</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#109667" title="XmlParser extends scales.utils.resources.Loaner[javax.xml.parsers.SAXParser] with scales.xml.parser.sax.SaxSupport">parsers</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[Token &lt;: scales.xml.parser.strategies.OptimisationToken](source: org.xml.sax.InputSource, strategy: scales.xml.parser.strategies.PathOptimisationStrategy[Token], reader: org.xml.sax.XMLReader, saxSupport: scales.xml.parser.sax.SaxSupport)(implicit xmlVer: scales.xml.XmlVersion)scales.xml.Doc" id="15630">readXml</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.parser.strategies.OptimisationToken" id="15632">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="org.xml.sax.InputSource" id="109679">source</a>: <span title="org.xml.sax.InputSource">InputSource</span>, <a title="scales.xml.parser.strategies.PathOptimisationStrategy[Token]" id="109680">strategy</a> : <a href="../strategies/OptimisingStrategies.scala.html#14748" title="scales.xml.parser.strategies.PathOptimisationStrategy[Token]">PathOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span>, <a title="org.xml.sax.XMLReader" id="109681">reader</a> : <span title="org.xml.sax.XMLReader">XMLReader</span>, <a title="scales.xml.parser.sax.SaxSupport" id="109682">saxSupport</a> : <a href="#10143" title="scales.xml.parser.sax.SaxSupport">SaxSupport</a> <span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="109683">xmlVer</a> : <a href="../../Namespaces.scala.html#9702" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <a href="../../XmlTypes.scala.html#9489" title="scales.xml.Doc">Doc</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="scales.xml.parser.sax.Handler[Token]" id="109701">handler</a> = <a href="#109683" title="scales.xml.parser.sax.Handler[Token]" class="keyword">new</a> <a href="Handler.scala.html#10140" title="scales.xml.parser.sax.Handler[Token]">Handler</a><span class="delimiter">[</span>Token<span class="delimiter">]</span><span class="delimiter">(</span><a href="#109680" title="scales.xml.parser.strategies.PathOptimisationStrategy[Token]">strategy</a><span class="delimiter">)</span>
    <a href="#109682" title="scales.xml.parser.sax.SaxSupport">saxSupport</a>.<a href="#104859" title="[T &lt;: scales.xml.parser.strategies.OptimisationToken](reader: org.xml.sax.XMLReader, handler: scales.xml.parser.sax.Handler[T])Unit">setLexicalHandler</a><span title="(reader: org.xml.sax.XMLReader, handler: scales.xml.parser.sax.Handler[Token])Unit" class="delimiter">[</span><a href="#15632" title="Token">Token</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#109681" title="org.xml.sax.XMLReader">reader</a>, <a href="#109701" title="scales.xml.parser.sax.Handler[Token]">handler</a><span class="delimiter">)</span>
    
    <a href="#109681" title="org.xml.sax.XMLReader">reader</a>.<span title="(x$1: org.xml.sax.ContentHandler)Unit">setContentHandler</span><span class="delimiter">(</span><a href="#109701" title="scales.xml.parser.sax.Handler[Token]">handler</a><span class="delimiter">)</span>
    <a href="#109681" title="org.xml.sax.XMLReader">reader</a>.<span title="(x$1: org.xml.sax.InputSource)Unit">parse</span><span class="delimiter">(</span><a href="#109679" title="org.xml.sax.InputSource">source</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="&lt;none&gt; extends Product with Serializable with scales.xml.XmlVersion" id="109702">docVersion</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="AnyRef" id="109710">f</a> = <a href="#109682" title="scales.xml.parser.sax.SaxSupport">saxSupport</a>.<a href="#104862" title="(reader: org.xml.sax.XMLReader)AnyRef">getXmlVersion</a><span class="delimiter">(</span><a href="#109681" title="org.xml.sax.XMLReader">reader</a><span class="delimiter">)</span>

      <span title="&lt;none&gt; extends Product with Serializable with scales.xml.XmlVersion" class="keyword">if</span> <span class="delimiter">(</span><a href="#109710" title="AnyRef">f</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../../Namespaces.scala.html#9688" title="object scales.xml.Xml10">Xml10</a>
      <span class="keyword">else</span> <span class="delimiter">{</span>
	<span class="keyword">val</span> <a title="java.lang.String" id="109711">v</a> = <a href="#109710" title="AnyRef">f</a>.<span title="()java.lang.String">toString</span>
	<span title="&lt;none&gt; extends Product with Serializable with scales.xml.XmlVersion" class="keyword">if</span> <span class="delimiter">(</span><a href="#109711" title="java.lang.String">v</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;1.1&quot;)" class="string">&quot;1.1&quot;</span><span class="delimiter">)</span> 
	  <a href="../../Namespaces.scala.html#9694" title="object scales.xml.Xml11">Xml11</a>
	<span class="keyword">else</span>
	  <a href="../../Namespaces.scala.html#9688" title="object scales.xml.Xml10">Xml10</a>	  
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="../../XmlTypes.scala.html#94317" title="(rootElem: scales.xml.package.XmlTree, prolog: scales.xml.Prolog, end: scales.xml.EndMisc)scales.xml.Doc">Doc</a><span class="delimiter">(</span><a href="#109701" title="scales.xml.parser.sax.Handler[Token]">handler</a>.<a href="Handler.scala.html#109065" title="=&gt; scales.xml.impl.TreeProxies">getBuf</a>.<a href="../../impl/TreeProxies.scala.html#103167" title="=&gt; scales.xml.package.XmlTree">tree</a>, <a href="#109701" title="scales.xml.parser.sax.Handler[Token]">handler</a>.<a href="Handler.scala.html#109070" title="scales.xml.Prolog" id="109732">getProlog</a>.<a href="../../XmlTypes.scala.html#43575" title="scales.xml.package.Miscs" id="109739">copy</a><span class="delimiter">(</span> 
      decl = <a href="#109701" title="scales.xml.parser.sax.Handler[Token]">handler</a>.<a href="Handler.scala.html#109070" title="=&gt; scales.xml.Prolog">getProlog</a>.<a href="../../XmlTypes.scala.html#33170" title="scales.xml.Declaration" id="109733">decl</a>.<a href="../../XmlTypes.scala.html#93978" title="java.nio.charset.Charset" id="109736">copy</a><a title="scales.xml.Declaration" id="109737" class="delimiter">(</a>version = <a href="#109702" title="&lt;none&gt; extends Product with Serializable with scales.xml.XmlVersion" id="109734">docVersion</a><span class="delimiter">)</span><span class="delimiter">)</span>,
	<a href="#109701" title="scales.xml.parser.sax.Handler[Token]">handler</a>.<a href="Handler.scala.html#109071" title="=&gt; scales.xml.EndMisc">getEnd</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>   
  
  <span class="comment">/**
   * Use a custom parserPool to control the sax factory features 
   */</span> 
  <span class="keyword">def</span> <a title="[Token &lt;: scales.xml.parser.strategies.OptimisationToken](source: org.xml.sax.InputSource, strategy: scales.xml.parser.strategies.PathOptimisationStrategy[Token], parsers: scales.utils.resources.Loaner[org.xml.sax.XMLReader] with scales.xml.parser.sax.SaxSupport)(implicit xmlVer: scales.xml.XmlVersion)scales.xml.Doc" id="15633">loadXmlReader</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.parser.strategies.OptimisationToken" id="106297">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="org.xml.sax.InputSource" id="106290">source</a>: <span title="org.xml.sax.InputSource">InputSource</span>, <a title="scales.xml.parser.strategies.PathOptimisationStrategy[Token]" id="106295">strategy</a> : <a href="../strategies/OptimisingStrategies.scala.html#14748" title="scales.xml.parser.strategies.PathOptimisationStrategy[Token]">PathOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> = <a href="../../package.scala.html#15568" title="=&gt; scales.xml.parser.strategies.PathOptimisationStrategy[scales.xml.parser.strategies.QNameToken]">defaultPathOptimisation</a>, <a title="XmlParser extends scales.utils.resources.Loaner[org.xml.sax.XMLReader] with scales.xml.parser.sax.SaxSupport" id="106298">parsers</a> : <a href="#106301" title="XmlParser extends scales.utils.resources.Loaner[org.xml.sax.XMLReader] with scales.xml.parser.sax.SaxSupport">Loaner</a><span class="delimiter">[</span>XMLReader<span class="delimiter">]</span> <span class="keyword">with</span> SaxSupport = <a href="../../impl/XmlFactories.scala.html#9942" title="object scales.xml.impl.DefaultXMLReaderFactoryPool">DefaultXMLReaderFactoryPool</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="106293">xmlVer</a> : <a href="../../Namespaces.scala.html#9702" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <a href="../../XmlTypes.scala.html#9489" title="scales.xml.Doc">Doc</a> =
    <a href="#106298" title="XmlParser extends scales.utils.resources.Loaner[org.xml.sax.XMLReader] with scales.xml.parser.sax.SaxSupport">parsers</a>.<a href="../../../utils/resource/Resources.scala.html#58943" title="(tThunk: org.xml.sax.XMLReader =&gt; scales.xml.Doc)scales.xml.Doc">loan</a> <span class="delimiter">{</span>
      <a title="org.xml.sax.XMLReader" id="109744">parser</a> =&gt;
	<a href="#15630" title="(source: org.xml.sax.InputSource, strategy: scales.xml.parser.strategies.PathOptimisationStrategy[Token], reader: org.xml.sax.XMLReader, saxSupport: scales.xml.parser.sax.SaxSupport)(implicit xmlVer: scales.xml.XmlVersion)scales.xml.Doc">readXml</a><a href="#106293" title="scales.xml.XmlVersion" class="delimiter">(</a><a href="#106290" title="org.xml.sax.InputSource">source</a>, <a href="#106295" title="scales.xml.parser.strategies.PathOptimisationStrategy[Token]">strategy</a>, <a href="#109744" title="org.xml.sax.XMLReader">parser</a>, <a href="#106298" title="XmlParser extends scales.utils.resources.Loaner[org.xml.sax.XMLReader] with scales.xml.parser.sax.SaxSupport">parsers</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>