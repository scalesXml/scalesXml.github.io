<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scales\xml\serializers\LSSerializer.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scales.xml.serializers

<span class="keyword">import</span> java.io.Writer

<span class="keyword">import</span> java.nio.charset.Charset

<span class="keyword">import</span> scales.xml._
<span class="keyword">import</span> impl._

<span class="keyword">import</span> scales.utils._
<span class="keyword">import</span> resources._

<span class="keyword">import</span> javax.xml.parsers._

<span class="comment">/**
 * Base implementation for a correct serializer using LSSerializer to provide escape character references.
 *
 * Developers can override this directly implementing encF, or choose to override createSerializer to further change serialization behaviour
 */</span> 
<span class="keyword">trait</span> <a title="trait LSSerializerFactoryBase extends java.lang.Object with scales.xml.serializers.SerializerFactory with ScalaObject" id="10646">LSSerializerFactoryBase</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Serializers.scala.html#10706" title="scales.xml.serializers.SerializerFactory">SerializerFactory</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> org.w3c.dom._
  <span class="keyword">import</span> ls._

  <span class="keyword">type</span> <a title="scales.xml.serializers.LSSerializer" id="111186">ExactSerializer</a> = serializers.<a href="#10610" title="scales.xml.serializers.LSSerializer">LSSerializer</a>

  <span class="comment">/**
   * Override to create the serialazer
   */</span> 
  <span class="keyword">def</span> <a title="(sdata: scales.xml.serializers.SerializerData, dbf: javax.xml.parsers.DocumentBuilderFactory)scales.xml.serializers.LSSerializer" id="111187">createSerializer</a><span class="delimiter">(</span> <a title="scales.xml.serializers.SerializerData" id="111230">sdata</a>: <a href="Serializers.scala.html#10703" title="scales.xml.serializers.SerializerData">SerializerData</a>, <a title="javax.xml.parsers.DocumentBuilderFactory" id="111231">dbf</a> : <span title="javax.xml.parsers.DocumentBuilderFactory">DocumentBuilderFactory</span><span class="delimiter">)</span> : serializers.<a href="#10610" title="scales.xml.serializers.LSSerializer">LSSerializer</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="javax.xml.parsers.DocumentBuilder" id="111244">db</a> = <a href="#111231" title="javax.xml.parsers.DocumentBuilderFactory">dbf</a>.<span title="()javax.xml.parsers.DocumentBuilder">newDocumentBuilder</span>
    <span class="keyword">val</span> <a title="org.w3c.dom.Document" id="111245">ndoc</a> = <a href="#111244" title="javax.xml.parsers.DocumentBuilder">db</a>.<span title="()org.w3c.dom.Document">newDocument</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#111245" title="org.w3c.dom.Document">ndoc</a>.<span title="(x$1: java.lang.String)Unit">setXmlVersion</span><span class="delimiter">(</span><a href="#111230" title="scales.xml.serializers.SerializerData">sdata</a>.<a href="Serializers.scala.html#111238" title="=&gt; scales.xml.XmlVersion">version</a>.<a href="../Namespaces.scala.html#32810" title="=&gt; String">version</a><span class="delimiter">)</span>

    <a href="#111382" title="java.lang.Object with scales.xml.serializers.LSSerializer{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.serializers.LSSerializer" id="111382">serializers</a>.<a href="#10610" title="scales.xml.serializers.LSSerializer">LSSerializer</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="javax.xml.parsers.DocumentBuilderFactory" id="111423">docBuilderF</a> = <a href="#111231" title="javax.xml.parsers.DocumentBuilderFactory">dbf</a>
      <span class="keyword">val</span> <a title="scales.xml.serializers.SerializerData" id="111425">data</a> = <a href="#111230" title="scales.xml.serializers.SerializerData">sdata</a>
      <span class="keyword">val</span> <a title="String =&gt; Option[Throwable]" id="111427">encMap</a> = <a href="#111188" title="(v1: java.nio.charset.Charset)String =&gt; Option[Throwable]">encF</a><span class="delimiter">(</span><a href="#111230" title="scales.xml.serializers.SerializerData">sdata</a>.<a href="Serializers.scala.html#111240" title="=&gt; java.nio.charset.Charset">encoding</a><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.Document" id="111430">doc</a> = <a href="#111245" title="org.w3c.dom.Document">ndoc</a>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.DOMImplementationLS" id="111432">impl</a> = <a href="#111429" title="=&gt; org.w3c.dom.Document">doc</a>.<span title="()org.w3c.dom.DOMImplementation">getImplementation</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.w3c.dom.ls.DOMImplementationLS" class="delimiter">[</span><span title="org.w3c.dom.ls.DOMImplementationLS">DOMImplementationLS</span><span class="delimiter">]</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSOutput" id="111434">lsout</a> = <a href="#111431" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSOutput">createLSOutput</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSOutput" id="111436">lsaout</a> = <a href="#111431" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSOutput">createLSOutput</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSSerializer" id="111438">lss</a> = <a href="#111431" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSSerializer">createLSSerializer</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Can the content be encoded in a given charset
   */</span>
  <span class="keyword">val</span> <a title="=&gt; java.nio.charset.Charset =&gt; (String =&gt; Option[Throwable])" id="111188">encF</a>: Charset =&gt; String =&gt; Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(sdata: scales.xml.serializers.SerializerData)LSSerializerFactoryBase.this.ExactSerializer" id="111189">borrow</a><span class="delimiter">(</span> <a title="scales.xml.serializers.SerializerData" id="111491">sdata</a> : <a href="Serializers.scala.html#10703" title="scales.xml.serializers.SerializerData">SerializerData</a> <span class="delimiter">)</span> : <a href="#10610" title="LSSerializerFactoryBase.this.ExactSerializer">ExactSerializer</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="javax.xml.parsers.DocumentBuilderFactory" id="111494">dbf</a> = <a href="../impl/XmlFactories.scala.html#9912" title="object scales.xml.impl.DefaultDOMFactoryPool">DefaultDOMFactoryPool</a>.<a href="../../utils/resource/Resources.scala.html#58932" title="=&gt; javax.xml.parsers.DocumentBuilderFactory">grab</a>

    <span class="keyword">val</span> <a title="scales.xml.serializers.LSSerializer" id="111495">s</a> = <a href="#111187" title="(sdata: scales.xml.serializers.SerializerData, dbf: javax.xml.parsers.DocumentBuilderFactory)scales.xml.serializers.LSSerializer">createSerializer</a><span class="delimiter">(</span><a href="#111491" title="scales.xml.serializers.SerializerData">sdata</a>, <a href="#111494" title="javax.xml.parsers.DocumentBuilderFactory">dbf</a><span class="delimiter">)</span>
    <a href="#111495" title="scales.xml.serializers.LSSerializer">s</a>.<a href="#111211" title="=&gt; org.w3c.dom.ls.LSOutput">lsout</a>.<span title="(x$1: java.lang.String)Unit">setEncoding</span><span class="delimiter">(</span><a href="#111491" title="scales.xml.serializers.SerializerData">sdata</a>.<a href="Serializers.scala.html#111240" title="=&gt; java.nio.charset.Charset">encoding</a>.<span title="()java.lang.String">displayName</span><span class="delimiter">)</span>
    <a href="#111495" title="scales.xml.serializers.LSSerializer">s</a>.<a href="#111211" title="=&gt; org.w3c.dom.ls.LSOutput">lsout</a>.<span title="(x$1: java.io.Writer)Unit">setCharacterStream</span><span class="delimiter">(</span><a href="#111491" title="scales.xml.serializers.SerializerData">sdata</a>.<a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a><span class="delimiter">)</span>
    <a href="#111495" title="scales.xml.serializers.LSSerializer">s</a>.<a href="#111213" title="=&gt; org.w3c.dom.ls.LSOutput">lsaout</a>.<span title="(x$1: java.lang.String)Unit">setEncoding</span><span class="delimiter">(</span><a href="#111491" title="scales.xml.serializers.SerializerData">sdata</a>.<a href="Serializers.scala.html#111240" title="=&gt; java.nio.charset.Charset">encoding</a>.<span title="()java.lang.String">displayName</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="org.w3c.dom.DOMConfiguration" id="111496">dc</a> = <a href="#111495" title="scales.xml.serializers.LSSerializer">s</a>.<a href="#111212" title="=&gt; org.w3c.dom.ls.LSSerializer">lss</a>.<span title="()org.w3c.dom.DOMConfiguration">getDomConfig</span> <span class="comment">// got to be the lss, as the xalan impl is unrelated </span>
    <span class="comment">//println(&quot;Configured with LSSerializer &quot; + s.lss.getClass.getName)</span>
    <span class="comment">//val xs = new org.apache.xml.serializer.dom3.LSSerializerImpl</span>
    <span class="comment">// if the user wants to add a cdata then we shouldn't split it, but &quot;throw&quot;</span>
    <span class="comment">// NOTE that no implementation does this for ä and only for ]]&gt;</span>
    <a href="#111496" title="org.w3c.dom.DOMConfiguration">dc</a>.<span title="(x$1: java.lang.String, x$2: Any)Unit">setParameter</span><span class="delimiter">(</span><span title="java.lang.String(&quot;split-cdata-sections&quot;)" class="string">&quot;split-cdata-sections&quot;</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <a href="#111496" title="org.w3c.dom.DOMConfiguration">dc</a>.<span title="(x$1: java.lang.String, x$2: Any)Unit">setParameter</span><span class="delimiter">(</span><span title="java.lang.String(&quot;well-formed&quot;)" class="string">&quot;well-formed&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <a href="#111496" title="org.w3c.dom.DOMConfiguration">dc</a>.<span title="(x$1: java.lang.String, x$2: Any)Unit">setParameter</span><span class="delimiter">(</span><span title="java.lang.String(&quot;xml-declaration&quot;)" class="string">&quot;xml-declaration&quot;</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

    <a href="#111495" title="scales.xml.serializers.LSSerializer">s</a>    
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(serializer: LSSerializerFactoryBase.this.ExactSerializer)Unit" id="111190">giveBack</a><span class="delimiter">(</span> <a title="LSSerializerFactoryBase.this.ExactSerializer" id="111510">serializer</a> : <a href="#10610" title="LSSerializerFactoryBase.this.ExactSerializer">ExactSerializer</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../impl/XmlFactories.scala.html#9912" title="object scales.xml.impl.DefaultDOMFactoryPool">DefaultDOMFactoryPool</a>.<a href="../../utils/resource/Resources.scala.html#58933" title="(t: javax.xml.parsers.DocumentBuilderFactory)Unit">giveBack</a><span class="delimiter">(</span> <a href="#111510" title="LSSerializerFactoryBase.this.ExactSerializer">serializer</a>.<a href="#111208" title="=&gt; javax.xml.parsers.DocumentBuilderFactory">docBuilderF</a> <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[R](thunk: scales.xml.serializers.Serializer =&gt; R)(sdata: scales.xml.serializers.SerializerData)R" id="111191">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="111193">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.serializers.Serializer =&gt; R" id="111516">thunk</a>: Serializer =&gt; R<span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.serializers.SerializerData" id="111517">sdata</a>: <a href="Serializers.scala.html#10703" title="scales.xml.serializers.SerializerData">SerializerData</a><span class="delimiter">)</span>: <a href="#111193" title="R">R</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="LSSerializerFactoryBase.this.ExactSerializer" id="111525">s</a> = <a href="#111189" title="(sdata: scales.xml.serializers.SerializerData)LSSerializerFactoryBase.this.ExactSerializer">borrow</a><span class="delimiter">(</span><a href="#111517" title="scales.xml.serializers.SerializerData">sdata</a><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#111516" title="(v1: scales.xml.serializers.Serializer)R">thunk</a><span class="delimiter">(</span><a href="#111525" title="LSSerializerFactoryBase.this.ExactSerializer">s</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#111190" title="(serializer: LSSerializerFactoryBase.this.ExactSerializer)Unit">giveBack</a><span class="delimiter">(</span><a href="#111525" title="LSSerializerFactoryBase.this.ExactSerializer">s</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * XHTML serialization extra touches
 */</span> 
<span class="keyword">object</span> <a title="object scales.xml.serializers.LSSerializerFactoryXHTML" id="10653">LSSerializerFactoryXHTML</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10634" title="scales.xml.serializers.LSSerializerConcurrentCacheFactoryXHTML">LSSerializerConcurrentCacheFactoryXHTML</a> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="111539">xhtmlNS</a> = <span title="java.lang.String(&quot;http://www.w3.org/1999/xhtml&quot;)" class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>

  <span class="comment">/**
   * Local names of all 10 xhtml elements that can be empty, issue #6
   */</span> 
  <span class="keyword">val</span> <a title="scala.collection.immutable.Set[java.lang.String]" id="111541">canBeEmpty</a> = <span title="(elems: java.lang.String*)scala.collection.immutable.Set[java.lang.String]">Set</span><span class="delimiter">(</span> <span title="java.lang.String(&quot;area&quot;)" class="string">&quot;area&quot;</span>, <span title="java.lang.String(&quot;base&quot;)" class="string">&quot;base&quot;</span>, <span title="java.lang.String(&quot;br&quot;)" class="string">&quot;br&quot;</span>, <span title="java.lang.String(&quot;col&quot;)" class="string">&quot;col&quot;</span>, <span title="java.lang.String(&quot;hr&quot;)" class="string">&quot;hr&quot;</span>,
		       <span title="java.lang.String(&quot;img&quot;)" class="string">&quot;img&quot;</span>, <span title="java.lang.String(&quot;input&quot;)" class="string">&quot;input&quot;</span>, <span title="java.lang.String(&quot;link&quot;)" class="string">&quot;link&quot;</span>, <span title="java.lang.String(&quot;meta&quot;)" class="string">&quot;meta&quot;</span>, <span title="java.lang.String(&quot;param&quot;)" class="string">&quot;param&quot;</span> <span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait LSSerializerConcurrentCacheFactoryXHTML extends java.lang.Object with scales.xml.serializers.LSSerializerConcurrentCacheFactory with ScalaObject" id="10634">LSSerializerConcurrentCacheFactoryXHTML</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10628" title="scales.xml.serializers.LSSerializerConcurrentCacheFactory">LSSerializerConcurrentCacheFactory</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> org.w3c.dom._
  <span class="keyword">import</span> ls._

  <span class="comment">/**
   * Override to create the serialazer
   */</span> 
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(sdata: scales.xml.serializers.SerializerData, dbf: javax.xml.parsers.DocumentBuilderFactory)scales.xml.serializers.LSSerializer" id="111537">createSerializer</a><span class="delimiter">(</span> <a title="scales.xml.serializers.SerializerData" id="111578">sdata</a>: <a href="Serializers.scala.html#10703" title="scales.xml.serializers.SerializerData">SerializerData</a>, <a title="javax.xml.parsers.DocumentBuilderFactory" id="111579">dbf</a> : <span title="javax.xml.parsers.DocumentBuilderFactory">DocumentBuilderFactory</span><span class="delimiter">)</span> : serializers.<a href="#10610" title="scales.xml.serializers.LSSerializer">LSSerializer</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="javax.xml.parsers.DocumentBuilder" id="111581">db</a> = <a href="#111579" title="javax.xml.parsers.DocumentBuilderFactory">dbf</a>.<span title="()javax.xml.parsers.DocumentBuilder">newDocumentBuilder</span>
    <span class="keyword">val</span> <a title="org.w3c.dom.Document" id="111582">ndoc</a> = <a href="#111581" title="javax.xml.parsers.DocumentBuilder">db</a>.<span title="()org.w3c.dom.Document">newDocument</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#111582" title="org.w3c.dom.Document">ndoc</a>.<span title="(x$1: java.lang.String)Unit">setXmlVersion</span><span class="delimiter">(</span><a href="#111578" title="scales.xml.serializers.SerializerData">sdata</a>.<a href="Serializers.scala.html#111238" title="=&gt; scales.xml.XmlVersion">version</a>.<a href="../Namespaces.scala.html#32810" title="=&gt; String">version</a><span class="delimiter">)</span>

    <a href="#111583" title="java.lang.Object with scales.xml.serializers.XHTMLLSSerializer{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.serializers.XHTMLLSSerializer" id="111583">serializers</a>.<a href="#10877" title="scales.xml.serializers.XHTMLLSSerializer">XHTMLLSSerializer</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="javax.xml.parsers.DocumentBuilderFactory" id="111590">docBuilderF</a> = <a href="#111579" title="javax.xml.parsers.DocumentBuilderFactory">dbf</a>
      <span class="keyword">val</span> <a title="scales.xml.serializers.SerializerData" id="111592">data</a> = <a href="#111578" title="scales.xml.serializers.SerializerData">sdata</a>
      <span class="keyword">val</span> <a title="String =&gt; Option[Throwable]" id="111594">encMap</a> = <a href="#111532" title="(v1: java.nio.charset.Charset)String =&gt; Option[Throwable]">encF</a><span class="delimiter">(</span><a href="#111578" title="scales.xml.serializers.SerializerData">sdata</a>.<a href="Serializers.scala.html#111240" title="=&gt; java.nio.charset.Charset">encoding</a><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.Document" id="111597">doc</a> = <a href="#111582" title="org.w3c.dom.Document">ndoc</a>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.DOMImplementationLS" id="111599">impl</a> = <a href="#111596" title="=&gt; org.w3c.dom.Document">doc</a>.<span title="()org.w3c.dom.DOMImplementation">getImplementation</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.w3c.dom.ls.DOMImplementationLS" class="delimiter">[</span><span title="org.w3c.dom.ls.DOMImplementationLS">DOMImplementationLS</span><span class="delimiter">]</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSOutput" id="111601">lsout</a> = <a href="#111598" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSOutput">createLSOutput</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSOutput" id="111603">lsaout</a> = <a href="#111598" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSOutput">createLSOutput</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSSerializer" id="111605">lss</a> = <a href="#111598" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSSerializer">createLSSerializer</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


<span class="comment">/**
 * Default implmementation of serialization
 */</span> 
<span class="keyword">object</span> <a title="object scales.xml.serializers.LSSerializerFactory" id="10641">LSSerializerFactory</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10628" title="scales.xml.serializers.LSSerializerConcurrentCacheFactory">LSSerializerConcurrentCacheFactory</a> <span class="delimiter">{</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait LSSerializerConcurrentCacheFactory extends java.lang.Object with scales.xml.serializers.LSSerializerFactoryBase with ScalaObject" id="10628">LSSerializerConcurrentCacheFactory</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10646" title="scales.xml.serializers.LSSerializerFactoryBase">LSSerializerFactoryBase</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap
  <span class="keyword">import</span> scales.utils.collection.Once

  <span class="comment">/**
   * On the assumption that a given apps qname population is larger than that of its possible encodings.
   */</span>
  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]]]" id="111530">globalEncMap</a> = <span title="()java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]]]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]]]">ConcurrentHashMap</span><span class="delimiter">[</span>String, ConcurrentHashMap<span class="delimiter">[</span>Charset, Once<span class="delimiter">[</span>Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>

  <span class="keyword">val</span> <a title="java.nio.charset.Charset =&gt; (String =&gt; Option[Throwable])" id="111532">encF</a> = <span class="delimiter">{</span> encoding: <span title="java.nio.charset.Charset">Charset</span> =&gt;
    <span class="keyword">val</span> <a title="java.nio.charset.CharsetEncoder" id="111608">encoder</a> = <a href="#111607" title="java.nio.charset.Charset">encoding</a>.<span title="()java.nio.charset.CharsetEncoder">newEncoder</span>

    <span class="comment">/**
     * Perhaps silly optimisation given a bug about it but worth trying
     *
     * If the charset contains utf8 then its able to support all unicode characters that utf8 can.  Wierdly I would also have expected utf8 to contain32 as it contains utf16 - must verify.
     */</span>
    <span title="String =&gt; Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111607" title="java.nio.charset.Charset">encoding</a>.<span title="(x$1: java.nio.charset.Charset)Boolean">contains</span><span class="delimiter">(</span><a href="../../utils/package.scala.html#15191" title="=&gt; java.nio.charset.Charset">defaultCharset</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt; <span title="object None">None</span> <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt;

      <a href="../../utils/collection/ConcurrentMapUtils.scala.html#15548" title="(key: java.nio.charset.Charset, map: java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]])(calc: =&gt; Option[Throwable])Option[Throwable]">calcOnce</a><span class="delimiter">(</span><a href="#111607" title="java.nio.charset.Charset">encoding</a>, <a href="../../utils/collection/ConcurrentMapUtils.scala.html#15553" title="(key: String, map: java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]]])(newT: =&gt; java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]])java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]]">valueOf</a><span class="delimiter">(</span><a href="#111662" title="String">s</a>, <a href="#111530" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]]]">globalEncMap</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="()java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.collection.Once[Option[Throwable]]]">ConcurrentHashMap</span><span class="delimiter">[</span>Charset, Once<span class="delimiter">[</span>Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111608" title="java.nio.charset.CharsetEncoder">encoder</a>.<span title="(x$1: java.lang.CharSequence)Boolean">canEncode</span><span class="delimiter">(</span><a href="#111662" title="String">s</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="object None">None</span> <span class="comment">// it can do it</span>
        <span class="keyword">else</span>
          <span title="(x: scales.xml.serializers.InvalidCharacterInMarkup)Some[scales.xml.serializers.InvalidCharacterInMarkup]">Some</span><span class="delimiter">(</span><a href="Exceptions.scala.html#110824" title="(what: String)scales.xml.serializers.InvalidCharacterInMarkup">InvalidCharacterInMarkup</a><span class="delimiter">(</span><a href="#111662" title="String">s</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object scales.xml.serializers.LSSerializerNoCacheFactory" id="10659">LSSerializerNoCacheFactory</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10670" title="scales.xml.serializers.LSSerializerNoCacheFactoryT">LSSerializerNoCacheFactoryT</a> <span class="delimiter">{</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * This variety does not use a thread safe global cache, use when your data
 * is progressivly radically different for each run.
 *
 * If you don't like this scheme either simply implement LSSerializerFactoryBase with your own caching needs.
 */</span>
<span class="keyword">trait</span> <a title="trait LSSerializerNoCacheFactoryT extends java.lang.Object with scales.xml.serializers.LSSerializerFactoryBase with ScalaObject" id="10670">LSSerializerNoCacheFactoryT</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10646" title="scales.xml.serializers.LSSerializerFactoryBase">LSSerializerFactoryBase</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> java.util.HashMap

  <span class="keyword">val</span> <a title="java.nio.charset.Charset =&gt; (String =&gt; Option[Throwable])" id="111907">encF</a> = <span class="delimiter">{</span> encoding: <span title="java.nio.charset.Charset">Charset</span> =&gt;
    <span class="keyword">val</span> <a title="java.nio.charset.CharsetEncoder" id="111914">encoder</a> = <a href="#111913" title="java.nio.charset.Charset">encoding</a>.<span title="()java.nio.charset.CharsetEncoder">newEncoder</span>
    <span class="keyword">val</span> <a title="java.util.HashMap[String,Option[Throwable]]" id="111915">map</a> = <span title="()java.util.HashMap[String,Option[Throwable]]" class="keyword">new</span> <span title="java.util.HashMap[String,Option[Throwable]]">HashMap</span><span class="delimiter">[</span>String, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">]</span>

    <span class="comment">/**
     * See the above explanation for this
     */</span>
    <span title="String =&gt; Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111913" title="java.nio.charset.Charset">encoding</a>.<span title="(x$1: java.nio.charset.Charset)Boolean">contains</span><span class="delimiter">(</span><a href="../../utils/package.scala.html#15191" title="=&gt; java.nio.charset.Charset">defaultCharset</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt; <span title="object None">None</span> <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt;

      <span class="keyword">var</span> <a title="Option[Throwable]" id="112142">r</a> = <a href="#111915" title="java.util.HashMap[String,Option[Throwable]]">map</a>.<span title="(x$1: Any)Option[Throwable]">get</span><span class="delimiter">(</span><a href="#112141" title="String">s</a><span class="delimiter">)</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#112142" title="Option[Throwable]">r</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#112142" title="Option[Throwable]">r</a> = <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111914" title="java.nio.charset.CharsetEncoder">encoder</a>.<span title="(x$1: java.lang.CharSequence)Boolean">canEncode</span><span class="delimiter">(</span><a href="#112141" title="String">s</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="object None">None</span> <span class="comment">// it can do it</span>
        <span class="keyword">else</span>
          <span title="(x: scales.xml.serializers.InvalidCharacterInMarkup)Some[scales.xml.serializers.InvalidCharacterInMarkup]">Some</span><span class="delimiter">(</span><a href="Exceptions.scala.html#110824" title="(what: String)scales.xml.serializers.InvalidCharacterInMarkup">InvalidCharacterInMarkup</a><span class="delimiter">(</span><a href="#112141" title="String">s</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#111915" title="java.util.HashMap[String,Option[Throwable]]">map</a>.<span title="(x$1: String, x$2: Option[Throwable])Option[Throwable]">put</span><span class="delimiter">(</span><a href="#112141" title="String">s</a>, <a href="#112142" title="Option[Throwable]">r</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#112142" title="Option[Throwable]">r</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Adds an extra space after an empty element
 */</span> 
<span class="keyword">trait</span> <a title="trait XHTMLLSSerializer extends java.lang.Object with scales.xml.serializers.LSSerializer with ScalaObject" id="10877">XHTMLLSSerializer</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10610" title="scales.xml.serializers.LSSerializer">LSSerializer</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#111206" title="=&gt; scales.xml.serializers.SerializerData">data</a>._

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="111588">emptyElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="112169">qName</a>: <a href="../QName.scala.html#9657" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="112170">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="Map[String,String]" id="112171">namespaces</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="112172">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="112173">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> =
    <a href="#111225" title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: Map[String,String], declareDefaultNS: Option[String])Option[Throwable]">doElem</a><span class="delimiter">(</span><a href="#112169" title="scales.xml.QName">qName</a>, <a href="#112170" title="Traversable[scales.xml.Attribute]">attributes</a>, <a href="#112171" title="Map[String,String]">namespaces</a>, <a href="#112172" title="Option[String]">declareDefaultNS</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>
      <span class="comment">// #6 </span>
      <span class="keyword">val</span> <a title="Boolean" id="112184">canBeEmpty</a> = 
	<span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#112169" title="scales.xml.QName">qName</a>.<a href="../QName.scala.html#42828" title="=&gt; scales.xml.UnderlyingNamespace">namespace</a>.<a href="../Namespaces.scala.html#48029" title="=&gt; String">uri</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#10653" title="object scales.xml.serializers.LSSerializerFactoryXHTML">LSSerializerFactoryXHTML</a>.<a href="#111539" title="=&gt; java.lang.String">xhtmlNS</a><span class="delimiter">)</span>
	  <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#10653" title="object scales.xml.serializers.LSSerializerFactoryXHTML">LSSerializerFactoryXHTML</a>.<a href="#111541" title="(elem: java.lang.String)Boolean">canBeEmpty</a><span class="delimiter">(</span><a href="#112169" title="scales.xml.QName">qName</a>.<a href="../QName.scala.html#42827" title="=&gt; String">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
	    <span title="Boolean(true)" class="keyword">true</span>
	  <span class="keyword">else</span>
	    <span title="Boolean(false)" class="keyword">false</span> <span class="comment">// all others must be &lt;&gt;&lt;/&gt;</span>
	<span class="keyword">else</span>
	  <span title="Boolean(true)" class="keyword">true</span>
      
      <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#112184" title="Boolean">canBeEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
	<a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot; /&gt;&quot;)" class="string">&quot; /&gt;&quot;</span><span class="delimiter">)</span>
	<span title="object None">None</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
	<a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span><span class="delimiter">)</span>
	<a href="#111228" title="(qName: scales.xml.QName, path: List[scales.xml.QName])Option[Throwable]">endElement</a><span class="delimiter">(</span><a href="#112169" title="scales.xml.QName">qName</a>, <a href="#112173" title="List[scales.xml.QName]">path</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Default serializer, correctness first.  Uses the LSSerializer present in each DOM L3 impl.  XmlItems are always serialized with the LS, elements and attributes are however for speed reasons, verified for encoding once per QName; the attribute values themselves are written via Text nodes and LS.
 */</span>
<span class="keyword">trait</span> <a title="trait LSSerializer extends java.lang.Object with scales.xml.serializers.Serializer with ScalaObject" id="10610">LSSerializer</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Serializers.scala.html#10697" title="scales.xml.serializers.Serializer">Serializer</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> javax.xml.parsers._
  <span class="keyword">import</span> org.w3c.dom._
  <span class="keyword">import</span> ls._
  <span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap

  <span class="keyword">val</span> <a title="=&gt; scales.xml.serializers.SerializerData" id="111206">data</a>: <a href="Serializers.scala.html#10703" title="scales.xml.serializers.SerializerData">SerializerData</a>
  <span class="keyword">import</span> <a href="#111206" title="=&gt; scales.xml.serializers.SerializerData">data</a>._

  <span class="keyword">val</span> <a title="=&gt; javax.xml.parsers.DocumentBuilderFactory" id="111208">docBuilderF</a>: <span title="javax.xml.parsers.DocumentBuilderFactory">DocumentBuilderFactory</span>
  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.Document" id="111209">doc</a>: <span title="org.w3c.dom.Document">Document</span>
  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.ls.DOMImplementationLS" id="111210">impl</a>: <span title="org.w3c.dom.ls.DOMImplementationLS">DOMImplementationLS</span>
  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.ls.LSOutput" id="111211">lsout</a>: <span title="org.w3c.dom.ls.LSOutput">LSOutput</span>
  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.ls.LSSerializer" id="111212">lss</a>: ls.<span title="org.w3c.dom.ls.LSSerializer">LSSerializer</span>

  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.ls.LSOutput" id="111213">lsaout</a>: <span title="org.w3c.dom.ls.LSOutput">LSOutput</span>

  <span class="comment">/**
   * Can the ncName be mapped for a given encoding
   */</span>
  <span class="keyword">val</span> <a title="=&gt; String =&gt; Option[Throwable]" id="111214">encMap</a>: String =&gt; Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.Text" id="111216">textNode</a> = <a href="#111209" title="=&gt; org.w3c.dom.Document">doc</a>.<span title="(x$1: java.lang.String)org.w3c.dom.Text">createTextNode</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.nio.charset.CharsetEncoder" id="111218">encoder</a> = <a href="Serializers.scala.html#111240" title="=&gt; java.nio.charset.Charset">encoding</a>.<span title="()java.nio.charset.CharsetEncoder">newEncoder</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   * See default SF for logic on this, however faulty :-)
   */</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String =&gt; Boolean" id="111220">canEncode</a> =
    <span title="String =&gt; Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="Serializers.scala.html#111240" title="=&gt; java.nio.charset.Charset">encoding</a>.<span title="(x$1: java.nio.charset.Charset)Boolean">contains</span><span class="delimiter">(</span><a href="../../utils/package.scala.html#15191" title="=&gt; java.nio.charset.Charset">defaultCharset</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt; <span title="Boolean(true)" class="keyword">true</span> <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt; <a href="#111217" title="=&gt; java.nio.charset.CharsetEncoder">encoder</a>.<span title="(x$1: java.lang.CharSequence)Boolean">canEncode</span><span class="delimiter">(</span><a href="#112453" title="String">s</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(t: =&gt; Boolean, s: =&gt; String)Option[Throwable]" id="111221">ct</a><span class="delimiter">(</span><a title="=&gt; Boolean" id="112458">t</a>: =&gt; Boolean, <a title="=&gt; String" id="112459">s</a>: =&gt; String<span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#112458" title="=&gt; Boolean">t</a><span class="delimiter">)</span>
        <span title="object None">None</span>
      <span class="keyword">else</span>
        <span title="(x: scales.xml.serializers.CannotSerialize)Some[scales.xml.serializers.CannotSerialize]">Some</span><span class="delimiter">(</span><a href="Exceptions.scala.html#111028" title="(what: String)scales.xml.serializers.CannotSerialize">CannotSerialize</a><span class="delimiter">(</span><a href="#112459" title="=&gt; String">s</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Some[java.lang.Throwable]" id="112465">t</a>: <span title="Throwable">Throwable</span> =&gt; <span title="(x: java.lang.Throwable)Some[java.lang.Throwable]">Some</span><span class="delimiter">(</span><a href="#112465" title="java.lang.Throwable">t</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Performs the actual write for Comments/CData/PI, due to LSSerializer issues this function is seperated for easy overriding, should anyone really trust their DOM/JAXP versions.
   *
   * For this method to be called the encoding has already been verified.
   */</span>
  <span class="keyword">def</span> <a title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]" id="111222">writeNonText</a><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="112469">item</a>: <a href="../XmlTypes.scala.html#9699" title="scales.xml.XmlItem">XmlItem</a>, <a title="List[scales.xml.QName]" id="112470">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> =
    <a href="Serializers.scala.html#10713" title="object scales.xml.serializers.SerializerHelpers">SerializerHelpers</a>.<a href="Serializers.scala.html#112474" title="(out: java.io.Writer, item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">item</a><span class="delimiter">(</span><a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>, <a href="#112469" title="scales.xml.XmlItem">item</a>, <a href="#112470" title="List[scales.xml.QName]">path</a><span class="delimiter">)</span>

  <span class="comment">/**
   * LSSerializer in 6_24 is garbage, but the xalan one isn't much better.  jre uses hex, xalan numberic character refs.  And jre is totally useless for cdata, writing no end part, both ignore the split-cdata-sections option when escaping, choosing to split, I assume this is only being done for character refs but follows the DOMConfiguration (instead of the load and save spec) for end sequence splitting.
   *
   * As such there only seems to be one safe way to handle this:
   *   # Use the encoder to check if a CData or Comment can be written without splitting, throw if it can't.
   *   # Write the start and end CData directly
   */</span>
  <span class="keyword">def</span> <a title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]" id="111223">item</a><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="111418">item</a>: <a href="../XmlTypes.scala.html#9699" title="scales.xml.XmlItem">XmlItem</a>, <a title="List[scales.xml.QName]" id="111419">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[Throwable]" id="112479">canEncodeI</a>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <a href="#111418" title="scales.xml.XmlItem">item</a> <span title="Option[Throwable]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="None.type" id="112480">x</a>: scales.xml.<a href="../XmlTypes.scala.html#9669" title="scales.xml.Text">Text</a> =&gt;
        <span title="object None">None</span> <span class="comment">// never a problem</span>
      <span class="keyword">case</span> <a title="Option[Throwable]" id="112481">x</a>: <a href="../XmlTypes.scala.html#9465" title="scales.xml.CData">CData</a> =&gt;
        <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111219" title="(v1: String)Boolean">canEncode</a><span class="delimiter">(</span><a href="#111418" title="scales.xml.XmlItem">item</a>.<a href="../XmlTypes.scala.html#45588" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="object None">None</span>
        <span class="keyword">else</span>
          <span title="(x: scales.xml.serializers.CDataCannotBeEncoded)Some[scales.xml.serializers.CDataCannotBeEncoded]">Some</span><span class="delimiter">(</span><a href="Exceptions.scala.html#110875" title="(what: String)scales.xml.serializers.CDataCannotBeEncoded">CDataCannotBeEncoded</a><span class="delimiter">(</span><a href="#111418" title="scales.xml.XmlItem">item</a>.<a href="../XmlTypes.scala.html#45588" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Option[Throwable]" id="112487">x</a>: scales.xml.<a href="../XmlTypes.scala.html#9477" title="scales.xml.Comment">Comment</a> =&gt;
        <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111219" title="(v1: String)Boolean">canEncode</a><span class="delimiter">(</span><a href="#111418" title="scales.xml.XmlItem">item</a>.<a href="../XmlTypes.scala.html#45588" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="object None">None</span>
        <span class="keyword">else</span>
          <span title="(x: scales.xml.serializers.CommentCannotBeEncoded)Some[scales.xml.serializers.CommentCannotBeEncoded]">Some</span><span class="delimiter">(</span><a href="Exceptions.scala.html#110926" title="(what: String)scales.xml.serializers.CommentCannotBeEncoded">CommentCannotBeEncoded</a><span class="delimiter">(</span><a href="#111418" title="scales.xml.XmlItem">item</a>.<a href="../XmlTypes.scala.html#45588" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Option[Throwable]" id="112493">x</a>: scales.xml.<a href="../XmlTypes.scala.html#9618" title="scales.xml.PI">PI</a> =&gt;
        <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111219" title="(v1: String)Boolean">canEncode</a><span class="delimiter">(</span><a href="#112493" title="scales.xml.PI">x</a>.<a href="../XmlTypes.scala.html#45588" title="=&gt; String">value</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#111219" title="(v1: String)Boolean">canEncode</a><span class="delimiter">(</span><a href="#112493" title="scales.xml.PI">x</a>.<a href="../XmlTypes.scala.html#45734" title="=&gt; String">target</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="object None">None</span>
        <span class="keyword">else</span>
          <span title="(x: scales.xml.serializers.PICannotBeEncoded)Some[scales.xml.serializers.PICannotBeEncoded]">Some</span><span class="delimiter">(</span><a href="Exceptions.scala.html#110977" title="(what: String)scales.xml.serializers.PICannotBeEncoded">PICannotBeEncoded</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Target: &quot;)" class="string">&quot;Target: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#112493" title="scales.xml.PI">x</a>.<a href="../XmlTypes.scala.html#45734" title="=&gt; String">target</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; value: &quot;)" class="string">&quot; value: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#112493" title="scales.xml.PI">x</a>.<a href="../XmlTypes.scala.html#45588" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#112479" title="Option[Throwable]">canEncodeI</a> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span> <span class="comment">// its serializeable, without cdata breaks</span>

      <a href="#111418" title="scales.xml.XmlItem">item</a> <span title="Option[Throwable]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Option[Throwable]" id="112503">x</a>: scales.xml.<a href="../XmlTypes.scala.html#9669" title="scales.xml.Text">Text</a> =&gt;
          <a href="#111215" title="=&gt; org.w3c.dom.Text">textNode</a>.<span title="(x$1: java.lang.String)Unit">setNodeValue</span><span class="delimiter">(</span><a href="#111418" title="scales.xml.XmlItem">item</a>.<a href="../XmlTypes.scala.html#45588" title="=&gt; String">value</a><span class="delimiter">)</span> <span class="comment">// twice for pi's but I'm not going to work around them</span>
          <a href="#111221" title="(t: =&gt; Boolean, s: =&gt; String)Option[Throwable]">ct</a><span class="delimiter">(</span><a href="#111212" title="=&gt; org.w3c.dom.ls.LSSerializer">lss</a>.<span title="(x$1: org.w3c.dom.Node, x$2: org.w3c.dom.ls.LSOutput)Boolean">write</span><span class="delimiter">(</span><a href="#111215" title="=&gt; org.w3c.dom.Text">textNode</a>, <a href="#111211" title="=&gt; org.w3c.dom.ls.LSOutput">lsout</a><span class="delimiter">)</span>,
            <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="java.io.StringWriter" id="112523">str</a> = <span title="java.io.StringWriter" class="keyword">new</span> java.io.<span title="java.io.StringWriter">StringWriter</span><span class="delimiter">(</span><span class="delimiter">)</span>;
              <a href="Serializers.scala.html#10713" title="object scales.xml.serializers.SerializerHelpers">SerializerHelpers</a>.<a href="Serializers.scala.html#112474" title="(out: java.io.Writer, item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">item</a><span class="delimiter">(</span><a href="#112523" title="java.io.StringWriter">str</a>, <a href="#111418" title="scales.xml.XmlItem">item</a>, <a href="#111419" title="List[scales.xml.QName]">path</a><span class="delimiter">)</span>
              <a href="#112523" title="java.io.StringWriter">str</a>.<span title="()java.lang.String">toString</span>
            <span class="delimiter">}</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Option[Throwable]">_</span> =&gt;
          <a href="#111222" title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">writeNonText</a><span class="delimiter">(</span><a href="#111418" title="scales.xml.XmlItem">item</a>, <a href="#111419" title="List[scales.xml.QName]">path</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(before: =&gt; String, toCt: =&gt; String, after: =&gt; String)Option[Throwable]" id="111224">writeAttr</a><span class="delimiter">(</span><a title="=&gt; String" id="112529">before</a>: =&gt; String, <a title="=&gt; String" id="112530">toCt</a>: =&gt; String, <a title="=&gt; String" id="112531">after</a>: =&gt; String<span class="delimiter">)</span> =
    <a href="#111221" title="(t: =&gt; Boolean, s: =&gt; String)Option[Throwable]">ct</a><span class="delimiter">(</span><span class="delimiter">{</span>
      <a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><a href="#112529" title="=&gt; String">before</a><span class="delimiter">)</span>
      <span class="comment">// every other escape takes place</span>
      <span class="comment">// </span>
      <a href="#111215" title="=&gt; org.w3c.dom.Text">textNode</a>.<span title="(x$1: java.lang.String)Unit">setNodeValue</span><span class="delimiter">(</span><a href="#112530" title="=&gt; String">toCt</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.StringWriter" id="112534">str</a> = <span title="java.io.StringWriter" class="keyword">new</span> java.io.<span title="java.io.StringWriter">StringWriter</span><span class="delimiter">(</span><span class="delimiter">)</span>;
      <a href="#111213" title="=&gt; org.w3c.dom.ls.LSOutput">lsaout</a>.<span title="(x$1: java.io.Writer)Unit">setCharacterStream</span><span class="delimiter">(</span><a href="#112534" title="java.io.StringWriter">str</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Boolean" id="112535">r</a> = <a href="#111212" title="=&gt; org.w3c.dom.ls.LSSerializer">lss</a>.<span title="(x$1: org.w3c.dom.Node, x$2: org.w3c.dom.ls.LSOutput)Boolean">write</span><span class="delimiter">(</span><a href="#111215" title="=&gt; org.w3c.dom.Text">textNode</a>, <a href="#111213" title="=&gt; org.w3c.dom.ls.LSOutput">lsaout</a><span class="delimiter">)</span>
      <a href="#111213" title="=&gt; org.w3c.dom.ls.LSOutput">lsaout</a>.<span title="(x$1: java.io.Writer)Unit">setCharacterStream</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="comment">// let it be collected</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#112535" title="Boolean">r</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><a href="#112534" title="java.io.StringWriter">str</a>.<span title="()java.lang.String">toString</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">replaceAll</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span>, <span title="java.lang.String(&quot;&amp;quot;&quot;)" class="string">&quot;&amp;quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><a href="#112531" title="=&gt; String">after</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#112535" title="Boolean">r</a>
    <span class="delimiter">}</span>, <a href="#112529" title="=&gt; String">before</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#112530" title="=&gt; String">toCt</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#112531" title="=&gt; String">after</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Override this to order the attributes.
   */</span>
  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: Map[String,String], declareDefaultNS: Option[String])Option[Throwable]" id="111225">doElem</a><span class="delimiter">(</span><a title="scales.xml.QName" id="112175">qName</a>: <a href="../QName.scala.html#9657" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="112176">attribs</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="Map[String,String]" id="112177">ns</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="112178">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <span class="delimiter">{</span>
      <span title="Option[scales.xml.serializers.IncompatibleQNameVersions]" class="keyword">if</span> <span class="delimiter">(</span><a href="#112175" title="scales.xml.QName">qName</a>.<a href="../QName.scala.html#42830" title="=&gt; scales.xml.XmlVersion">qNameVersion</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../Namespaces.scala.html#9694" title="object scales.xml.Xml11">Xml11</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="Serializers.scala.html#111238" title="=&gt; scales.xml.XmlVersion">version</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../Namespaces.scala.html#9688" title="object scales.xml.Xml10">Xml10</a><span class="delimiter">)</span>
        <span title="(x: scales.xml.serializers.IncompatibleQNameVersions)Some[scales.xml.serializers.IncompatibleQNameVersions]">Some</span><span class="delimiter">(</span><a href="Exceptions.scala.html#111079" title="(what: String)scales.xml.serializers.IncompatibleQNameVersions">IncompatibleQNameVersions</a><span class="delimiter">(</span><a href="#112175" title="scales.xml.QName">qName</a>.<a href="../QName.scala.html#42832" title="=&gt; java.lang.String">qName</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <span title="object None">None</span>
    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>
      <span class="comment">// we don't have to encode it, just check it can be encoded, the writer will do the rest for markup</span>
      <a href="#111214" title="(v1: String)Option[Throwable]">encMap</a><span class="delimiter">(</span><a href="#112175" title="scales.xml.QName">qName</a>.<a href="../QName.scala.html#42832" title="=&gt; java.lang.String">qName</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>

      <a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;&quot;)" class="string">&quot;&lt;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#112175" title="scales.xml.QName">qName</a>.<a href="../QName.scala.html#42832" title="=&gt; java.lang.String">qName</a><span class="delimiter">)</span>
      <span title="object None">None</span>

    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>

      <a href="#112178" title="Option[String]">declareDefaultNS</a>.<span title="(f: String =&gt; Option[Throwable])Option[Throwable]">flatMap</span> <span class="delimiter">{</span> <a title="String" id="112603">dns</a> =&gt;
        <a href="#111224" title="(before: =&gt; String, toCt: =&gt; String, after: =&gt; String)Option[Throwable]">writeAttr</a><span class="delimiter">(</span><span title="java.lang.String(&quot; xmlns=\&quot;&quot;)" class="string">&quot; xmlns=\&quot;&quot;</span>, <a href="#112603" title="String">dns</a>, <span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>

      <a href="#112177" title="Map[String,String]">ns</a>.<span title="(z: Option[Throwable])(op: (Option[Throwable], (String, String)) =&gt; Option[Throwable])Option[Throwable]">foldLeft</span><span class="delimiter">(</span><span title="object None">None</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Option[Throwable]" id="112620">r</a>, <a title="(String, String)" id="112621">x</a><span title="(String, String)" class="delimiter">)</span> =&gt;
        <a href="#112620" title="Option[Throwable]">r</a> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>
          <span class="comment">// check the prefix is valid</span>
          <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="../impl/NamespaceExtras.scala.html#10050" title="object scales.xml.impl.QNameCharUtils">QNameCharUtils</a>.<a href="../impl/NamespaceExtras.scala.html#48019" title="(prefix: String)(implicit ver: scales.xml.XmlVersion)Boolean">validXmlPrefix</a><span class="delimiter">(</span><a href="#112621" title="(String, String)">x</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="Serializers.scala.html#111238" title="=&gt; scales.xml.XmlVersion">version</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
	    <a href="../impl/NamespaceExtras.scala.html#10050" title="object scales.xml.impl.QNameCharUtils">QNameCharUtils</a>.<a href="../impl/NamespaceExtras.scala.html#48020" title="(namespace: String)(implicit ver: scales.xml.XmlVersion)Boolean">validXmlNamespace</a><span class="delimiter">(</span><a href="#112621" title="(String, String)">x</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="Serializers.scala.html#111238" title="=&gt; scales.xml.XmlVersion">version</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot; xmlns:&quot;)" class="string">&quot; xmlns:&quot;</span><span class="delimiter">)</span>
            <a href="#111214" title="(v1: String)Option[Throwable]">encMap</a><span class="delimiter">(</span><a href="#112621" title="(String, String)">x</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span>
              <a href="#111224" title="(before: =&gt; String, toCt: =&gt; String, after: =&gt; String)Option[Throwable]">writeAttr</a><span class="delimiter">(</span><a href="#112621" title="(String, String)">x</a>.<span title="=&gt; String">_1</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=\&quot;&quot;)" class="string">&quot;=\&quot;&quot;</span>, <a href="#112621" title="(String, String)">x</a>.<span title="=&gt; String">_2</span>, <span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <span title="(x: scales.xml.serializers.IncompatibleQNameVersions)Some[scales.xml.serializers.IncompatibleQNameVersions]">Some</span><span class="delimiter">(</span><a href="Exceptions.scala.html#111079" title="(what: String)scales.xml.serializers.IncompatibleQNameVersions">IncompatibleQNameVersions</a><span class="delimiter">(</span><span title="java.lang.String(&quot;NS:&quot;)" class="string">&quot;NS:&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#112621" title="(String, String)">x</a>.<span title="=&gt; String">_1</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;-&gt;&quot;)" class="string">&quot;-&gt;&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#112621" title="(String, String)">x</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>

      <span class="keyword">import</span> <a href="../ScalesXml.scala.html#9664" title="object scales.xml.ScalesXml">ScalesXml</a>._

      <a href="#112176" title="Traversable[scales.xml.Attribute]">attribs</a>.<span title="(z: Option[Throwable])(op: (Option[Throwable], scales.xml.Attribute) =&gt; Option[Throwable])Option[Throwable]">foldLeft</span><span class="delimiter">(</span><span title="object None">None</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Option[Throwable]" id="112656">r</a>, <a title="scales.xml.Attribute" id="112657">x</a><a href="../XmlTypes.scala.html#9450" title="scales.xml.Attribute" class="delimiter">)</a> =&gt;
        <a href="#112656" title="Option[Throwable]">r</a> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>
	  <span class="keyword">val</span> <a title="scales.xml.package.AttributeQName" id="112662">name</a> = <a href="#112657" title="scales.xml.Attribute">x</a>.<a href="../XmlTypes.scala.html#47990" title="=&gt; scales.xml.package.AttributeQName">name</a>
          <span class="comment">// is the name valid</span>
          <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="../impl/XmlTypesImplicits.scala.html#42881" title="implicit scales.xml.impl.XmlTypesImplicits.toQName : (attribQName: scales.xml.package.AttributeQName)scales.xml.QName">name</a>.<a href="../QName.scala.html#42830" title="=&gt; scales.xml.XmlVersion">qNameVersion</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../Namespaces.scala.html#9694" title="object scales.xml.Xml11">Xml11</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="Serializers.scala.html#111238" title="=&gt; scales.xml.XmlVersion">version</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../Namespaces.scala.html#9688" title="object scales.xml.Xml10">Xml10</a><span class="delimiter">)</span>
            <span title="(x: scales.xml.serializers.IncompatibleQNameVersions)Some[scales.xml.serializers.IncompatibleQNameVersions]">Some</span><span class="delimiter">(</span><a href="Exceptions.scala.html#111079" title="(what: String)scales.xml.serializers.IncompatibleQNameVersions">IncompatibleQNameVersions</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Attr:&quot;)" class="string">&quot;Attr:&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="../impl/XmlTypesImplicits.scala.html#42881" title="implicit scales.xml.impl.XmlTypesImplicits.toQName : (attribQName: scales.xml.package.AttributeQName)scales.xml.QName">name</a>.<a href="../QName.scala.html#42832" title="=&gt; java.lang.String">qName</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="java.lang.String" id="112707">n</a> = <a href="../impl/XmlTypesImplicits.scala.html#42881" title="implicit scales.xml.impl.XmlTypesImplicits.toQName : (attribQName: scales.xml.package.AttributeQName)scales.xml.QName">name</a>.<a href="../QName.scala.html#42832" title="=&gt; java.lang.String">qName</a>
            <a href="#111214" title="(v1: String)Option[Throwable]">encMap</a><span class="delimiter">(</span><a href="#112707" title="java.lang.String">n</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span>
              <a href="#111224" title="(before: =&gt; String, toCt: =&gt; String, after: =&gt; String)Option[Throwable]">writeAttr</a><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#112707" title="java.lang.String">n</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=\&quot;&quot;)" class="string">&quot;=\&quot;&quot;</span>, <a href="#112657" title="scales.xml.Attribute">x</a>.<a href="../XmlTypes.scala.html#47992" title="=&gt; String">value</a>, <span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="111226">emptyElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="111410">qName</a>: <a href="../QName.scala.html#9657" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="111411">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="Map[String,String]" id="111412">namespaces</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="111413">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="111414">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> =
    <a href="#111225" title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: Map[String,String], declareDefaultNS: Option[String])Option[Throwable]">doElem</a><span class="delimiter">(</span><a href="#111410" title="scales.xml.QName">qName</a>, <a href="#111411" title="Traversable[scales.xml.Attribute]">attributes</a>, <a href="#111412" title="Map[String,String]">namespaces</a>, <a href="#111413" title="Option[String]">declareDefaultNS</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>
      <a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&gt;&quot;)" class="string">&quot;/&gt;&quot;</span><span class="delimiter">)</span>
      <span title="object None">None</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="111227">startElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="111399">qName</a>: <a href="../QName.scala.html#9657" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="111400">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="Map[String,String]" id="111401">namespaces</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="111402">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="111403">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> =
    <a href="#111225" title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: Map[String,String], declareDefaultNS: Option[String])Option[Throwable]">doElem</a><span class="delimiter">(</span><a href="#111399" title="scales.xml.QName">qName</a>, <a href="#111400" title="Traversable[scales.xml.Attribute]">attributes</a>, <a href="#111401" title="Map[String,String]">namespaces</a>, <a href="#111402" title="Option[String]">declareDefaultNS</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span>
      <a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span><span class="delimiter">)</span>
      <span title="object None">None</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, path: List[scales.xml.QName])Option[Throwable]" id="111228">endElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="111391">qName</a>: <a href="../QName.scala.html#9657" title="scales.xml.QName">QName</a>, <a title="List[scales.xml.QName]" id="111392">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;/&quot;)" class="string">&quot;&lt;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#111391" title="scales.xml.QName">qName</a>.<a href="../QName.scala.html#42832" title="=&gt; java.lang.String">qName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span><span class="delimiter">)</span> <span class="comment">// to get here it must be valid</span>
    <span title="object None">None</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(encoding: java.nio.charset.Charset, version: scales.xml.XmlVersion)Option[Throwable]" id="111229">xmlDeclaration</a><span class="delimiter">(</span><a title="java.nio.charset.Charset" id="111386">encoding</a>: <span title="java.nio.charset.Charset">Charset</span>, <a title="scales.xml.XmlVersion" id="111387">version</a>: <a href="../Namespaces.scala.html#9702" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <a href="Serializers.scala.html#10713" title="object scales.xml.serializers.SerializerHelpers">SerializerHelpers</a>.<a href="Serializers.scala.html#112473" title="(out: java.io.Writer, encoding: java.nio.charset.Charset, version: scales.xml.XmlVersion)Option[Throwable]">xmlDecl</a><span class="delimiter">(</span><a href="Serializers.scala.html#111236" title="=&gt; java.io.Writer">out</a>, <a href="#111386" title="java.nio.charset.Charset">encoding</a>, <a href="#111387" title="scales.xml.XmlVersion">version</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>