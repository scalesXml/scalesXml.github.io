<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scales\xml\parser\strategies\OptimisingStrategies.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scales.xml.parser.strategies

<span class="keyword">import</span> scales.utils._
<span class="keyword">import</span> scales.xml._

<span class="keyword">import</span> scales.xml.impl.<span class="delimiter">{</span>NotFromParser, FromParser<span class="delimiter">}</span>

<span class="keyword">import</span> scales.xml.impl.TreeProxies

<span class="keyword">trait</span> <a title="trait OptimisingStrategiesImplicits extends AnyRef" id="scales.xml.parser.strategies;OptimisingStrategiesImplicits">OptimisingStrategiesImplicits</a> <span class="delimiter">{</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Simple marker for per parse optimisation oppurtunties
 */</span>
<span title="AnyRef" class="keyword">trait</span> <a title="trait OptimisationToken extends AnyRef" id="scales.xml.parser.strategies;OptimisationToken">OptimisationToken</a> <span title="Unit" class="delimiter">{</span>
  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="=&gt; scales.xml.XmlVersion" id="scales.xml.parser.strategies;OptimisationToken.ver">ver</a> : <a href="../../Namespaces.scala.html#scales.xml;XmlVersion" title="scales.xml.XmlVersion">XmlVersion</a>
  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="=&gt; scales.xml.impl.FromParser" id="scales.xml.parser.strategies;OptimisationToken.fromParser">fromParser</a> : <a href="../../impl/FromParser.scala.html#scales.xml.impl;FromParser" title="scales.xml.impl.FromParser">FromParser</a>

  <span class="comment">/**
   * cached attribute array
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>strategies<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Array[scales.xml.Attribute]" id="scales.xml.parser.strategies;OptimisationToken.attrs_=">attrs</a>: <span title="Array[scales.xml.Attribute]">Array</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span> = <span title="Array.type">Array</span>.<span title="(n1: Int)(implicit evidence$3: scala.reflect.ClassTag[scales.xml.Attribute])Array[scales.xml.Attribute]">ofDim</span><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[scales.xml.Attribute]" class="delimiter">(</span><span title="Int(20)" class="int">20</span><span class="delimiter">)</span>  

  <span class="comment">/**
   * resizes the cached attribute array by 50% if needed
   */</span> 
  <span class="keyword">private</span><span class="delimiter">[</span>strategies<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(size: Int)Unit" id="scales.xml.parser.strategies;OptimisationToken.resizeAttrs">resizeAttrs</a><span class="delimiter">(</span><a title="Int" id="scales.xml.parser.strategies;OptimisationToken.resizeAttrs.size">size</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#scales.xml.parser.strategies;OptimisationToken.resizeAttrs.size" title="Int">size</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#scales.xml.parser.strategies;OptimisationToken.attrs_=" title="=&gt; Array[scales.xml.Attribute]">attrs</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#scales.xml.parser.strategies;OptimisationToken.attrs_=" title="(x$1: Array[scales.xml.Attribute])Unit">attrs</a> = <span title="Array.type">Array</span>.<span title="(n1: Int)(implicit evidence$3: scala.reflect.ClassTag[scales.xml.Attribute])Array[scales.xml.Attribute]">ofDim</span><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[scales.xml.Attribute]" class="delimiter">(</span><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;OptimisationToken.resizeAttrs.size" title="Int">size</a> <span title="(x: Double)Double">*</span> <span title="Double(1.5)" class="double">1.5</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">class</span> <a title="class BaseToken extends AnyRef with scales.xml.parser.strategies.OptimisationToken" id="scales.xml.parser.strategies;BaseToken">BaseToken</a><a href="#scales.xml.parser.strategies;BaseToken" title="scales.xml.parser.strategies.BaseToken" class="delimiter">(</a><span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.XmlVersion" id="scales.xml.parser.strategies;BaseToken.ver">ver</a> : <a href="../../Namespaces.scala.html#scales.xml;XmlVersion" title="scales.xml.XmlVersion">XmlVersion</a>, <span class="keyword">val</span> <a title="scales.xml.impl.FromParser" id="scales.xml.parser.strategies;BaseToken.fromParser">fromParser</a> : <a href="../../impl/FromParser.scala.html#scales.xml.impl;FromParser" title="scales.xml.impl.FromParser">FromParser</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#scales.xml.parser.strategies;OptimisationToken" title="scales.xml.parser.strategies.OptimisationToken">OptimisationToken</a>

<span class="comment">/**
 * Memory usage in DOMs is often dominated by repeated elements.  Xerces and co use string tables to optimise memory usage, with DTM a key example.
 *
 * Performing lookups is expensive so the strategies can have selective levels of lookup.  Developers may therefore choose appropriate levels that best fit their trade-off between space and time.
 *
 * There will, of course, be temporary garbage created for such a scheme but it should pay off for larger messages.
 *
 */</span> 
<span class="keyword">trait</span> <a title="trait MemoryOptimisationStrategy[Token &lt;: scales.xml.parser.strategies.OptimisationToken] extends AnyRef" id="scales.xml.parser.strategies;MemoryOptimisationStrategy">MemoryOptimisationStrategy</a><span class="delimiter">[</span><a title=" &lt;: scales.xml.parser.strategies.OptimisationToken" id="scales.xml.parser.strategies;MemoryOptimisationStrategy;Token">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span> <span title="Unit" class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)Token" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.createToken">createToken</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.createToken.ver">ver</a> : <a href="../../Namespaces.scala.html#scales.xml;XmlVersion" title="scales.xml.XmlVersion">XmlVersion</a>, <a title="scales.xml.impl.FromParser" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.createToken.fromParser">fromParser</a> : <a href="../../impl/FromParser.scala.html#scales.xml.impl;FromParser" title="scales.xml.impl.FromParser">FromParser</a><span class="delimiter">)</span> : <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy;Token" title="Token">Token</a>

  <span class="comment">/**
   * During parsing provides a backing array for attribute storage.  The expected new size 
   * must be passed in, failure to give a size large enough will lead to OOB exceptions.
   *
   * Implementations are advised to use the array for parsing performance reasons.
   *
   * The default implementataion expands the size by 50% of the backed array.  The array ownership should remain with the strategy instance
   */</span>
  <span class="keyword">def</span> <a title="(newSize: Int, token: Token)Array[scales.xml.Attribute]" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.attributeArray">attributeArray</a><span class="delimiter">(</span><a title="Int" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.attributeArray.newSize">newSize</a>: <span title="Int">Int</span>, <a title="Token" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.attributeArray.token">token</a>: <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy;Token" title="Token">Token</a><span class="delimiter">)</span>: <span title="Array[scales.xml.Attribute]">Array</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.attributeArray.token" title="Token">token</a>.<a href="#scales.xml.parser.strategies;OptimisationToken.resizeAttrs" title="(size: Int)Unit">resizeAttrs</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.attributeArray.newSize" title="Int">newSize</a><span class="delimiter">)</span>
    <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.attributeArray.token" title="Token">token</a>.<a href="#scales.xml.parser.strategies;OptimisationToken.attrs_=" title="=&gt; Array[scales.xml.Attribute]">attrs</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * It is expected that certain attributes have fixed values, ie. booleans or based on schema enums etc, this function allows such optimisations.
   *
   * The qname will have been obtained via a call to either noNamespaceQName, unprefixedQName or prefixedQName, so any optimisations provided by them can be leveraged.
   *
   */</span> 
  <span class="keyword">def</span> <a title="(qname: scales.xml.AttributeQName, value: String, token: Token)scales.xml.Attribute" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.attribute">attribute</a><span class="delimiter">(</span> <a title="scales.xml.AttributeQName" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.attribute.qname">qname</a> : <a href="../../../utils/EitherLike.scala.html#scales.utils;EitherLike" title="scales.xml.AttributeQName">AttributeQName</a>, <a title="String" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.attribute.value">value</a> : <span title="String">String</span>, <a title="Token" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.attribute.token">token</a> : <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy;Token" title="Token">Token</a><span class="delimiter">)</span> : <a href="../../XmlTypes.scala.html#scales.xml;Attribute" title="scales.xml.Attribute">Attribute</a> = <a href="../../XmlTypes.scala.html#scales.xml;Attribute" title="(name: scales.xml.AttributeQName, value: String)scales.xml.Attribute">Attribute</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.attribute.qname" title="scales.xml.AttributeQName">qname</a>,<a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.attribute.value" title="String">value</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(local: String, token: Token)scales.xml.NoNamespaceQName" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.noNamespaceQName">noNamespaceQName</a><span class="delimiter">(</span> <a title="String" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.noNamespaceQName.local">local</a> : <span title="String">String</span>, <a title="Token" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.noNamespaceQName.token">token</a> : <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy;Token" title="Token">Token</a><span class="delimiter">)</span> : <a href="../../QName.scala.html#scales.xml;NoNamespaceQName" title="scales.xml.NoNamespaceQName">NoNamespaceQName</a> = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.noNamespaceQName.token" title="Token">token</a>._
    <a href="../../QName.scala.html#scales.xml.NoNamespaceQName.apply" title="(locali: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.NoNamespaceQName">NoNamespaceQName</a><a href="#scales.xml.parser.strategies;OptimisationToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.noNamespaceQName.local" title="String">local</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(local: String, uri: String, token: Token)scales.xml.UnprefixedQName" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.unprefixedQName">unprefixedQName</a><span class="delimiter">(</span> <a title="String" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.unprefixedQName.local">local</a> : <span title="String">String</span>, <a title="String" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.unprefixedQName.uri">uri</a> : <span title="String">String</span>, <a title="Token" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.unprefixedQName.token">token</a> : <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy;Token" title="Token">Token</a><span class="delimiter">)</span> : <a href="../../QName.scala.html#scales.xml;UnprefixedQName" title="scales.xml.UnprefixedQName">UnprefixedQName</a> =  <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.unprefixedQName.token" title="Token">token</a>._
    <a href="../../QName.scala.html#scales.xml.UnprefixedQName.apply" title="(locali: String, namespacei: scales.xml.Namespace)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.UnprefixedQName">UnprefixedQName</a><a href="#scales.xml.parser.strategies;OptimisationToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.unprefixedQName.local" title="String">local</a>, <a href="../../Namespaces.scala.html#scales.xml.Namespace.apply" title="(validUri: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.Namespace">Namespace</a><a href="#scales.xml.parser.strategies;OptimisationToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.unprefixedQName.uri" title="String">uri</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(local: String, uri: String, prefix: String, token: Token)scales.xml.PrefixedQName" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.prefixedQName">prefixedQName</a><span class="delimiter">(</span> <a title="String" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.prefixedQName.local">local</a> : <span title="String">String</span>, <a title="String" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.prefixedQName.uri">uri</a> : <span title="String">String</span>, <a title="String" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.prefixedQName.prefix">prefix</a> : <span title="String">String</span>, <a title="Token" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.prefixedQName.token">token</a> : <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy;Token" title="Token">Token</a><span class="delimiter">)</span> : <a href="../../QName.scala.html#scales.xml;PrefixedQName" title="scales.xml.PrefixedQName">PrefixedQName</a> =  <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.prefixedQName.token" title="Token">token</a>._
    <a href="../../QName.scala.html#scales.xml.PrefixedQName.apply" title="(locali: String, prefixedNamespace: scales.xml.PrefixedNamespace)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.PrefixedQName{final val prefix: Some[String]}">PrefixedQName</a><a href="#scales.xml.parser.strategies;OptimisationToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.prefixedQName.local" title="String">local</a>, <a href="../../Namespaces.scala.html#scales.xml.Namespace.apply" title="(validUri: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.Namespace">Namespace</a><a href="#scales.xml.parser.strategies;OptimisationToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.prefixedQName.uri" title="String">uri</a><span class="delimiter">)</span>.<a href="../../Namespaces.scala.html#scales.xml;Namespace.prefixed(5c526c81a0)" title="(prefix: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.PrefixedNamespace">prefixed</a><a href="#scales.xml.parser.strategies;OptimisationToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.prefixedQName.prefix" title="String">prefix</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * For files without large (and varied) attribute counts per repeated element it may represent significant space savings to optimise against the entire Elem itself.
   *
   * The Elements QName is garaunteed to be the last QName evaluated via the QName functions (i.e. Attributes are done first then the Elems QName)  
   */</span> 
  <span class="keyword">def</span> <a title="(name: scales.xml.QName, attributes: scales.xml.Attributes, namespaces: Map[String,String], token: Token)scales.xml.Elem" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.elem">elem</a><span class="delimiter">(</span> <a title="scales.xml.QName" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.elem.name">name</a> : <a href="../../QName.scala.html#scales.xml;QName" title="scales.xml.QName">QName</a>, <a title="scales.xml.Attributes" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.elem.attributes">attributes</a> : <a href="../../../utils/collection/ArraySet.scala.html#scales.utils.collection;ArraySet" title="scales.xml.Attributes">Attributes</a>, <a title="Map[String,String]" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.elem.namespaces">namespaces</a> : <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Token" id="scales.xml.parser.strategies;MemoryOptimisationStrategy.elem.token">token</a> : <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy;Token" title="Token">Token</a><span class="delimiter">)</span> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a> =  <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.elem.token" title="Token">token</a>._
    <a href="../../XmlTypes.scala.html#scales.xml.Elem.apply(298a8ae74b)" title="(namei: scales.xml.QName, attributesi: scales.xml.Attributes, namespacesi: scala.collection.immutable.Map[String,String])(implicit fromParser: scales.xml.impl.FromParser)scales.xml.Elem">Elem</a><a href="#scales.xml.parser.strategies;OptimisationToken.fromParser" title="=&gt; scales.xml.impl.FromParser" class="delimiter">(</a><a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.elem.name" title="scales.xml.QName">name</a>, <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.elem.attributes" title="scales.xml.Attributes">attributes</a>, <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy.elem.namespaces" title="Map[String,String]">namespaces</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">trait</span> <a title="trait BaseTokenF extends AnyRef" id="scales.xml.parser.strategies;BaseTokenF">BaseTokenF</a> <span title="Unit" class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.parser.strategies.BaseToken" id="scales.xml.parser.strategies;BaseTokenF.createToken">createToken</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="scales.xml.parser.strategies;BaseTokenF.createToken.ver">ver</a> : <a href="../../Namespaces.scala.html#scales.xml;XmlVersion" title="scales.xml.XmlVersion">XmlVersion</a>, <a title="scales.xml.impl.FromParser" id="scales.xml.parser.strategies;BaseTokenF.createToken.fromParser">fromParser</a> : <a href="../../impl/FromParser.scala.html#scales.xml.impl;FromParser" title="scales.xml.impl.FromParser">FromParser</a><span class="delimiter">)</span> : <a href="#scales.xml.parser.strategies;BaseToken" title="scales.xml.parser.strategies.BaseToken">BaseToken</a> = <a href="#scales.xml.parser.strategies;BaseTokenF.createToken.ver" title="scales.xml.parser.strategies.BaseToken" class="keyword">new</a> <a href="#scales.xml.parser.strategies;BaseToken" title="scales.xml.parser.strategies.BaseToken">BaseToken</a><span class="delimiter">(</span><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Performs no optimisation at all
 */</span> 
<span title="AnyRef" class="keyword">object</span> <a title="scales.xml.parser.strategies.NoOptimisation.type" id="scales.xml.parser.strategies.NoOptimisation">NoOptimisation</a> <a href="#scales.xml.parser.strategies.NoOptimisation" title="scales.xml.parser.strategies.NoOptimisation.type" class="keyword">extends</a> <a href="#scales.xml.parser.strategies;PathOptimisationStrategy" title="scales.xml.parser.strategies.PathOptimisationStrategy[scales.xml.parser.strategies.BaseToken]">PathOptimisationStrategy</a><span class="delimiter">[</span>BaseToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#scales.xml.parser.strategies;BaseTokenF" title="scales.xml.parser.strategies.BaseTokenF">BaseTokenF</a>

<span class="comment">/**
 * Certain paths may be repeated (based on QNames of parents etc) and known to be by the developer, its also possible that the developer simply is not interested in this path.
 *
 * Developers may also customise the creation of paths, for example adding starting children, replacing the XmlChildren implementation or replacing entire subtrees.
 */</span>
<span class="keyword">trait</span> <a title="trait PathOptimisationStrategy[Token &lt;: scales.xml.parser.strategies.OptimisationToken] extends AnyRef with scales.xml.parser.strategies.MemoryOptimisationStrategy[Token]" id="scales.xml.parser.strategies;PathOptimisationStrategy">PathOptimisationStrategy</a><span class="delimiter">[</span><a title=" &lt;: scales.xml.parser.strategies.OptimisationToken" id="scales.xml.parser.strategies;PathOptimisationStrategy;Token">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span> <span title="Unit" class="keyword">extends</span> <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy" title="scales.xml.parser.strategies.MemoryOptimisationStrategy[Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> <span class="delimiter">{</span>
  
  <span class="comment">/**
   * By default calls TreeProxies.elementEnd.  Replacing entire subtrees can be performed here.
   */</span> 
  <span class="keyword">def</span> <a title="(xml: scales.xml.impl.TreeProxies, token: Token)Unit" id="scales.xml.parser.strategies;PathOptimisationStrategy.elementEnd">elementEnd</a><span class="delimiter">(</span> <a title="scales.xml.impl.TreeProxies" id="scales.xml.parser.strategies;PathOptimisationStrategy.elementEnd.xml">xml</a> : <a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies" title="scales.xml.impl.TreeProxies">TreeProxies</a>, <a title="Token" id="scales.xml.parser.strategies;PathOptimisationStrategy.elementEnd.token">token</a> : <a href="#scales.xml.parser.strategies;PathOptimisationStrategy;Token" title="Token">Token</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#scales.xml.parser.strategies;PathOptimisationStrategy.elementEnd.xml" title="scales.xml.impl.TreeProxies">xml</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies.elementEnd" title="()Unit">elementEnd</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Start a new &quot;tree&quot;, pushing the elem to TreeProxies
   */</span> 
  <span class="keyword">def</span> <a title="(stack: scales.xml.impl.TreeProxies, elem: scales.xml.Elem, token: Token)Unit" id="scales.xml.parser.strategies;PathOptimisationStrategy.beginSubTree">beginSubTree</a><span class="delimiter">(</span> <a title="scales.xml.impl.TreeProxies" id="scales.xml.parser.strategies;PathOptimisationStrategy.beginSubTree.stack">stack</a> : <a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies" title="scales.xml.impl.TreeProxies">TreeProxies</a>, <a title="scales.xml.Elem" id="scales.xml.parser.strategies;PathOptimisationStrategy.beginSubTree.elem">elem</a> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a>, <a title="Token" id="scales.xml.parser.strategies;PathOptimisationStrategy.beginSubTree.token">token</a> : <a href="#scales.xml.parser.strategies;PathOptimisationStrategy;Token" title="Token">Token</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#scales.xml.parser.strategies;PathOptimisationStrategy.beginSubTree.stack" title="scales.xml.impl.TreeProxies">stack</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies.beginSub" title="(elem: scales.xml.Elem, builder: =&gt; scales.xml.XmlBuilder)Unit">beginSub</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;PathOptimisationStrategy.beginSubTree.elem" title="scales.xml.Elem">elem</a>, <a href="../../impl/XmlTypesDefaults.scala.html#scales.xml.impl;XmlTypes.XmlBuilder" title="()scales.xml.XmlBuilder">XmlBuilder</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">import</span> scales.xml.impl.FullEqualQNameKey

<span class="keyword">class</span> <a title="class QNameToken extends AnyRef with scales.xml.parser.strategies.OptimisationToken" id="scales.xml.parser.strategies;QNameToken">QNameToken</a><a href="#scales.xml.parser.strategies;QNameToken" title="scales.xml.parser.strategies.QNameToken" class="delimiter">(</a><span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.XmlVersion" id="scales.xml.parser.strategies;QNameToken.ver">ver</a> : <a href="../../Namespaces.scala.html#scales.xml;XmlVersion" title="scales.xml.XmlVersion">XmlVersion</a>, <span class="keyword">val</span> <a title="scales.xml.impl.FromParser" id="scales.xml.parser.strategies;QNameToken.fromParser">fromParser</a> : <a href="../../impl/FromParser.scala.html#scales.xml.impl;FromParser" title="scales.xml.impl.FromParser">FromParser</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#scales.xml.parser.strategies;OptimisationToken" title="scales.xml.parser.strategies.OptimisationToken">OptimisationToken</a> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="scales.xml.impl.FullEqualQNameKey" id="scales.xml.parser.strategies;QNameToken.qkey">qkey</a> = <span title="scales.xml.impl.FullEqualQNameKey" class="keyword">new</span> <a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey" title="scales.xml.impl.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">// the following reduce init costs was 6% of garbage and 3% of runtime on avg</span>

  <span class="keyword">val</span> <a title="scales.xml.impl.FullEqualQNameKey =&gt; scales.xml.NoNamespaceQName" id="scales.xml.parser.strategies;QNameToken.noNsQ">noNsQ</a> = <span class="delimiter">(</span>k : <a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey" title="scales.xml.impl.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">)</span> =&gt; <a href="../../QName.scala.html#scales.xml.NoNamespaceQName.apply" title="(locali: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.NoNamespaceQName">NoNamespaceQName</a><a href="#scales.xml.parser.strategies;QNameToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;QNameToken.noNsQ.$anonfun.k" title="scales.xml.impl.FullEqualQNameKey">k</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.local" title="=&gt; String">local</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="scales.xml.impl.FullEqualQNameKey =&gt; scales.xml.UnprefixedQName" id="scales.xml.parser.strategies;QNameToken.unQ">unQ</a> = <span class="delimiter">(</span>k : <a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey" title="scales.xml.impl.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">)</span> =&gt; <a href="../../QName.scala.html#scales.xml.UnprefixedQName.apply" title="(locali: String, namespacei: scales.xml.Namespace)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.UnprefixedQName">UnprefixedQName</a><a href="#scales.xml.parser.strategies;QNameToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;QNameToken.unQ.$anonfun.k" title="scales.xml.impl.FullEqualQNameKey">k</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.local" title="=&gt; String">local</a>, <a href="../../Namespaces.scala.html#scales.xml.Namespace.apply" title="(validUri: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.Namespace">Namespace</a><a href="#scales.xml.parser.strategies;QNameToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;QNameToken.unQ.$anonfun.k" title="scales.xml.impl.FullEqualQNameKey">k</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.namespace" title="=&gt; String">namespace</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="scales.xml.impl.FullEqualQNameKey =&gt; scales.xml.PrefixedQName{final val prefix: Some[String]}" id="scales.xml.parser.strategies;QNameToken.pQ">pQ</a> = <span class="delimiter">(</span>k : <a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey" title="scales.xml.impl.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">)</span> =&gt; <a href="../../QName.scala.html#scales.xml.PrefixedQName.apply" title="(locali: String, prefixedNamespace: scales.xml.PrefixedNamespace)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.PrefixedQName{final val prefix: Some[String]}">PrefixedQName</a><a href="#scales.xml.parser.strategies;QNameToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;QNameToken.pQ.$anonfun.k" title="scales.xml.impl.FullEqualQNameKey">k</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.local" title="=&gt; String">local</a>, <a href="../../Namespaces.scala.html#scales.xml.Namespace.apply" title="(validUri: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.Namespace">Namespace</a><a href="#scales.xml.parser.strategies;QNameToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;QNameToken.pQ.$anonfun.k" title="scales.xml.impl.FullEqualQNameKey">k</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.namespace" title="=&gt; String">namespace</a><span class="delimiter">)</span>.<a href="../../Namespaces.scala.html#scales.xml;Namespace.prefixed(5c526c81a0)" title="(prefix: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.PrefixedNamespace">prefixed</a><a href="#scales.xml.parser.strategies;QNameToken.ver" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#scales.xml.parser.strategies;QNameToken.pQ.$anonfun.k" title="scales.xml.impl.FullEqualQNameKey">k</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.prefix" title="=&gt; String">prefix</a><span class="delimiter">)</span><span class="delimiter">)</span>
  
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait QNameTokenF extends AnyRef" id="scales.xml.parser.strategies;QNameTokenF">QNameTokenF</a> <span title="Unit" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.impl.FromParser)scales.xml.parser.strategies.QNameToken" id="scales.xml.parser.strategies;QNameTokenF.createToken">createToken</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="scales.xml.parser.strategies;QNameTokenF.createToken.ver">ver</a> : <a href="../../Namespaces.scala.html#scales.xml;XmlVersion" title="scales.xml.XmlVersion">XmlVersion</a>, <a title="scales.xml.impl.FromParser" id="scales.xml.parser.strategies;QNameTokenF.createToken.fromParser">fromParser</a> : <a href="../../impl/FromParser.scala.html#scales.xml.impl;FromParser" title="scales.xml.impl.FromParser">FromParser</a><span class="delimiter">)</span> = <a href="#scales.xml.parser.strategies;QNameTokenF.createToken.ver" title="scales.xml.parser.strategies.QNameToken" class="keyword">new</a> <a href="#scales.xml.parser.strategies;QNameToken" title="scales.xml.parser.strategies.QNameToken">QNameToken</a><span class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Threadsafe global cache, assumption is most applications would benefit from this 
 */</span>
<span title="AnyRef" class="keyword">trait</span> <a title="trait QNameOptimisationT[Token &lt;: scales.xml.parser.strategies.QNameToken] extends AnyRef with scales.xml.parser.strategies.MemoryOptimisationStrategy[Token]" id="scales.xml.parser.strategies;QNameOptimisationT">QNameOptimisationT</a><span class="delimiter">[</span><a title=" &lt;: scales.xml.parser.strategies.QNameToken" id="scales.xml.parser.strategies;QNameOptimisationT;Token">Token</a> &lt;: QNameToken<span class="delimiter">]</span> <span title="Unit" class="keyword">extends</span> <a href="#scales.xml.parser.strategies;MemoryOptimisationStrategy" title="scales.xml.parser.strategies.MemoryOptimisationStrategy[Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap

  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[scales.xml.impl.FullEqualQNameKey,scales.xml.QName]" id="scales.xml.parser.strategies;QNameOptimisationT.qNameCache">qNameCache</a> = <span title="()java.util.concurrent.ConcurrentHashMap[scales.xml.impl.FullEqualQNameKey,scales.xml.QName]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[scales.xml.impl.FullEqualQNameKey,scales.xml.QName]">ConcurrentHashMap</span><span class="delimiter">[</span> FullEqualQNameKey, QName <span class="delimiter">]</span>
  
  <span class="comment">/**
   * The creation costs can also be reduced
   */</span> 
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(local: String, token: Token)scales.xml.NoNamespaceQName" id="scales.xml.parser.strategies;QNameOptimisationT.noNamespaceQName">noNamespaceQName</a><span class="delimiter">(</span> <a title="String" id="scales.xml.parser.strategies;QNameOptimisationT.noNamespaceQName.local">local</a> : <span title="String">String</span>, <a title="Token" id="scales.xml.parser.strategies;QNameOptimisationT.noNamespaceQName.token">token</a> : <a href="#scales.xml.parser.strategies;QNameOptimisationT;Token" title="Token">Token</a><span class="delimiter">)</span> : <a href="../../QName.scala.html#scales.xml;NoNamespaceQName" title="scales.xml.NoNamespaceQName">NoNamespaceQName</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Token" id="scales.xml.parser.strategies;QNameOptimisationT.noNamespaceQName.qt">qt</a> = <a href="#scales.xml.parser.strategies;QNameOptimisationT.noNamespaceQName.token" title="Token">token</a>
    <span class="keyword">import</span> <a href="#scales.xml.parser.strategies;QNameOptimisationT.noNamespaceQName.qt" title="Token">qt</a>._
    <a href="#scales.xml.parser.strategies;QNameOptimisationT.value" title="(key: scales.xml.impl.FullEqualQNameKey)(newT: scales.xml.impl.FullEqualQNameKey =&gt; scales.xml.NoNamespaceQName)scales.xml.NoNamespaceQName">value</a><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies;QNameToken.qkey" title="=&gt; scales.xml.impl.FullEqualQNameKey">qkey</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.setNoNamespaceQName" title="(nlocal: String)scales.xml.impl.FullEqualQNameKey">setNoNamespaceQName</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;QNameOptimisationT.noNamespaceQName.local" title="String">local</a><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies;QNameToken.noNsQ" title="=&gt; scales.xml.impl.FullEqualQNameKey =&gt; scales.xml.NoNamespaceQName">noNsQ</a> <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(local: String, uri: String, token: Token)scales.xml.UnprefixedQName" id="scales.xml.parser.strategies;QNameOptimisationT.unprefixedQName">unprefixedQName</a><span class="delimiter">(</span> <a title="String" id="scales.xml.parser.strategies;QNameOptimisationT.unprefixedQName.local">local</a> : <span title="String">String</span>, <a title="String" id="scales.xml.parser.strategies;QNameOptimisationT.unprefixedQName.uri">uri</a> : <span title="String">String</span>, <a title="Token" id="scales.xml.parser.strategies;QNameOptimisationT.unprefixedQName.token">token</a> : <a href="#scales.xml.parser.strategies;QNameOptimisationT;Token" title="Token">Token</a><span class="delimiter">)</span> : <a href="../../QName.scala.html#scales.xml;UnprefixedQName" title="scales.xml.UnprefixedQName">UnprefixedQName</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Token" id="scales.xml.parser.strategies;QNameOptimisationT.unprefixedQName.qt">qt</a> = <a href="#scales.xml.parser.strategies;QNameOptimisationT.unprefixedQName.token" title="Token">token</a>
    <span class="keyword">import</span> <a href="#scales.xml.parser.strategies;QNameOptimisationT.unprefixedQName.qt" title="Token">qt</a>._
    <a href="#scales.xml.parser.strategies;QNameOptimisationT.value" title="(key: scales.xml.impl.FullEqualQNameKey)(newT: scales.xml.impl.FullEqualQNameKey =&gt; scales.xml.UnprefixedQName)scales.xml.UnprefixedQName">value</a><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies;QNameToken.qkey" title="=&gt; scales.xml.impl.FullEqualQNameKey">qkey</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.setUnprefixedQName" title="(nlocal: String, nnamespace: String)scales.xml.impl.FullEqualQNameKey">setUnprefixedQName</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;QNameOptimisationT.unprefixedQName.local" title="String">local</a>, <a href="#scales.xml.parser.strategies;QNameOptimisationT.unprefixedQName.uri" title="String">uri</a><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies;QNameToken.unQ" title="=&gt; scales.xml.impl.FullEqualQNameKey =&gt; scales.xml.UnprefixedQName">unQ</a> <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(local: String, uri: String, prefix: String, token: Token)scales.xml.PrefixedQName" id="scales.xml.parser.strategies;QNameOptimisationT.prefixedQName">prefixedQName</a><span class="delimiter">(</span> <a title="String" id="scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.local">local</a> : <span title="String">String</span>, <a title="String" id="scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.uri">uri</a> : <span title="String">String</span>, <a title="String" id="scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.prefix">prefix</a> : <span title="String">String</span>, <a title="Token" id="scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.token">token</a> : <a href="#scales.xml.parser.strategies;QNameOptimisationT;Token" title="Token">Token</a><span class="delimiter">)</span> : <a href="../../QName.scala.html#scales.xml;PrefixedQName" title="scales.xml.PrefixedQName">PrefixedQName</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Token" id="scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.qt">qt</a> = <a href="#scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.token" title="Token">token</a>
    <span class="keyword">import</span> <a href="#scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.qt" title="Token">qt</a>._
    <a href="#scales.xml.parser.strategies;QNameOptimisationT.value" title="(key: scales.xml.impl.FullEqualQNameKey)(newT: scales.xml.impl.FullEqualQNameKey =&gt; scales.xml.PrefixedQName{final val prefix: Some[String]})scales.xml.PrefixedQName{final val prefix: Some[String]}">value</a><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies;QNameToken.qkey" title="=&gt; scales.xml.impl.FullEqualQNameKey">qkey</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.setPrefixedQName" title="(nlocal: String, nnamespace: String, nprefix: String)scales.xml.impl.FullEqualQNameKey">setPrefixedQName</a><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.local" title="String">local</a>, <a href="#scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.uri" title="String">uri</a>, <a href="#scales.xml.parser.strategies;QNameOptimisationT.prefixedQName.prefix" title="String">prefix</a><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies;QNameToken.pQ" title="=&gt; scales.xml.impl.FullEqualQNameKey =&gt; scales.xml.PrefixedQName{final val prefix: Some[String]}">pQ</a> <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[T &lt;: scales.xml.QName](key: scales.xml.impl.FullEqualQNameKey)(newT: scales.xml.impl.FullEqualQNameKey =&gt; T)T" id="scales.xml.parser.strategies;QNameOptimisationT.value">value</a><span class="delimiter">[</span><a title=" &lt;: scales.xml.QName" id="scales.xml.parser.strategies;QNameOptimisationT.value;T">T</a> &lt;: QName<span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.impl.FullEqualQNameKey" id="scales.xml.parser.strategies;QNameOptimisationT.value.key">key</a> : <a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey" title="scales.xml.impl.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">)</span><span class="delimiter">(</span> <a title="scales.xml.impl.FullEqualQNameKey =&gt; T" id="scales.xml.parser.strategies;QNameOptimisationT.value.newT">newT</a> : FullEqualQNameKey =&gt; T <span class="delimiter">)</span> : <a href="#scales.xml.parser.strategies;QNameOptimisationT.value;T" title="T">T</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="scales.xml.QName" id="scales.xml.parser.strategies;QNameOptimisationT.value.value">value</a> = <a href="#scales.xml.parser.strategies;QNameOptimisationT.qNameCache" title="=&gt; java.util.concurrent.ConcurrentHashMap[scales.xml.impl.FullEqualQNameKey,scales.xml.QName]">qNameCache</a>.<span title="(x$1: Any)scales.xml.QName">get</span><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;QNameOptimisationT.value.key" title="scales.xml.impl.FullEqualQNameKey">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#scales.xml.parser.strategies;QNameOptimisationT.value.value" title="scales.xml.QName">value</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#scales.xml.parser.strategies;QNameOptimisationT.value.value" title="scales.xml.QName">value</a> = <a href="#scales.xml.parser.strategies;QNameOptimisationT.value.newT" title="(v1: scales.xml.impl.FullEqualQNameKey)T">newT</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;QNameOptimisationT.value.key" title="scales.xml.impl.FullEqualQNameKey">key</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scales.xml.QName" id="scales.xml.parser.strategies;QNameOptimisationT.value.res">res</a> = <a href="#scales.xml.parser.strategies;QNameOptimisationT.qNameCache" title="=&gt; java.util.concurrent.ConcurrentHashMap[scales.xml.impl.FullEqualQNameKey,scales.xml.QName]">qNameCache</a>.<span title="(x$1: scales.xml.impl.FullEqualQNameKey, x$2: scales.xml.QName)scales.xml.QName">putIfAbsent</span><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;QNameOptimisationT.value.key" title="scales.xml.impl.FullEqualQNameKey">key</a>.<a href="../../impl/Keys.scala.html#scales.xml.impl;FullEqualQNameKey.copy" title="=&gt; scales.xml.impl.FullEqualQNameKey">copy</a>, <a href="#scales.xml.parser.strategies;QNameOptimisationT.value.value" title="scales.xml.QName">value</a><span class="delimiter">)</span><span class="comment">// copy because now it needs to be frozen</span>
      <a href="#scales.xml.parser.strategies;QNameOptimisationT.value.value" title="scales.xml.QName">value</a> = <span title="scales.xml.QName" class="keyword">if</span> <span class="delimiter">(</span><a href="#scales.xml.parser.strategies;QNameOptimisationT.value.res" title="scales.xml.QName">res</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#scales.xml.parser.strategies;QNameOptimisationT.value.value" title="scales.xml.QName">value</a> <span class="keyword">else</span> <a href="#scales.xml.parser.strategies;QNameOptimisationT.value.res" title="scales.xml.QName">res</a>
    <span class="delimiter">}</span>
    <a href="#scales.xml.parser.strategies;QNameOptimisationT.value.value" title="scales.xml.QName">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#scales.xml.parser.strategies;QNameOptimisationT.value;T" title="T">T</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * The default as it will equal or better Scala Xml memory consumption at a performance gain.
 *
 * For the lowest memory consumption possible, for example where memory is more important than raw performance, see QNameElemTreeOptimisation
 *
 * @see scales.xml.strategies.QNameElemTreeOptimisation
 */</span>
<span class="keyword">object</span> <a title="scales.xml.parser.strategies.QNameMemoryOptimisation.type" id="scales.xml.parser.strategies.QNameMemoryOptimisation">QNameMemoryOptimisation</a> <a href="#scales.xml.parser.strategies.QNameMemoryOptimisation" title="scales.xml.parser.strategies.QNameMemoryOptimisation.type" class="keyword">extends</a> <a href="#scales.xml.parser.strategies;PathOptimisationStrategy" title="scales.xml.parser.strategies.PathOptimisationStrategy[scales.xml.parser.strategies.QNameToken]">PathOptimisationStrategy</a><span class="delimiter">[</span>QNameToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#scales.xml.parser.strategies;QNameOptimisationT" title="scales.xml.parser.strategies.QNameOptimisationT[scales.xml.parser.strategies.QNameToken]">QNameOptimisationT</a><span class="delimiter">[</span>QNameToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#scales.xml.parser.strategies;QNameTokenF" title="scales.xml.parser.strategies.QNameTokenF">QNameTokenF</a>

        </pre>
    </body>
</html>
