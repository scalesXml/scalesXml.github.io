<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scales\xml\parser\strategies\TreeOptimisations.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scales.xml.parser.strategies

<span class="keyword">import</span> scales.xml._
<span class="keyword">import</span> scales.utils.collection.<span class="delimiter">{</span>Tree, ImmutableArrayProxy<span class="delimiter">}</span>

<span class="keyword">import</span> scales.xml.impl.<span class="delimiter">{</span>NotFromParser, IsFromParser, FromParser<span class="delimiter">}</span>

<span class="keyword">import</span> <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection.ImmutableArrayProxy" title="scales.utils.collection.ImmutableArrayProxy.type">ImmutableArrayProxy</a>.one

<span class="keyword">import</span> impl.TreeProxies

<span class="comment">/**
 * Allows replacing a tree for memory optimisations
 */</span> 
<span class="keyword">trait</span> <a title="trait TreeOptimisation[TOKEN &lt;: scales.xml.parser.strategies.OptimisationToken] extends AnyRef with scales.xml.parser.strategies.PathOptimisationStrategy[TOKEN]" id="scales.xml.parser.strategies;TreeOptimisation">TreeOptimisation</a><span class="delimiter">[</span><a title=" &lt;: scales.xml.parser.strategies.OptimisationToken" id="scales.xml.parser.strategies;TreeOptimisation;TOKEN">TOKEN</a> &lt;: OptimisationToken<span class="delimiter">]</span> <span title="Unit" class="keyword">extends</span> <a href="OptimisingStrategies.scala.html#scales.xml.parser.strategies;PathOptimisationStrategy" title="scales.xml.parser.strategies.PathOptimisationStrategy[TOKEN]">PathOptimisationStrategy</a><span class="delimiter">[</span>TOKEN<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(elem: scales.xml.Elem, children: scales.xml.XmlChildren, token: TOKEN)scales.xml.XmlTree" id="scales.xml.parser.strategies;TreeOptimisation.newTree">newTree</a><span class="delimiter">(</span> <a title="scales.xml.Elem" id="scales.xml.parser.strategies;TreeOptimisation.newTree.elem">elem</a> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a>, <a title="scales.xml.XmlChildren" id="scales.xml.parser.strategies;TreeOptimisation.newTree.children">children</a> : <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection;ImmutableArrayProxy" title="scales.xml.XmlChildren">XmlChildren</a>, <a title="TOKEN" id="scales.xml.parser.strategies;TreeOptimisation.newTree.token">token</a> : <a href="#scales.xml.parser.strategies;TreeOptimisation;TOKEN" title="TOKEN">TOKEN</a> <span class="delimiter">)</span> : <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection;Tree" title="scales.xml.XmlTree">XmlTree</a>

  <span class="keyword">final</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="(xml: scales.xml.impl.TreeProxies, token: TOKEN)Unit" id="scales.xml.parser.strategies;TreeOptimisation.elementEnd">elementEnd</a><span class="delimiter">(</span> <a title="scales.xml.impl.TreeProxies" id="scales.xml.parser.strategies;TreeOptimisation.elementEnd.xml">xml</a> : <a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies" title="scales.xml.impl.TreeProxies">TreeProxies</a>, <a title="TOKEN" id="scales.xml.parser.strategies;TreeOptimisation.elementEnd.token">token</a> : <a href="#scales.xml.parser.strategies;TreeOptimisation;TOKEN" title="TOKEN">TOKEN</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="../../ScalesXml.scala.html#scales.xml.ScalesXml" title="scales.xml.ScalesXml.type">ScalesXml</a>.xmlCBF

    <span class="keyword">val</span> <a title="scales.xml.impl.TreeProxy" id="scales.xml.parser.strategies;TreeOptimisation.elementEnd.l">l</a> = <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.xml" title="scales.xml.impl.TreeProxies">xml</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies.current" title="=&gt; scales.xml.impl.TreeProxy">current</a>
    <span class="keyword">val</span> <a title="scales.xml.XmlTree" id="scales.xml.parser.strategies;TreeOptimisation.elementEnd.nt">nt</a> = <a href="#scales.xml.parser.strategies;TreeOptimisation.newTree" title="(elem: scales.xml.Elem, children: scales.xml.XmlChildren, token: TOKEN)scales.xml.XmlTree">newTree</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.l" title="scales.xml.impl.TreeProxy">l</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxy.elem" title="=&gt; scales.xml.Elem">elem</a>, <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.l" title="scales.xml.impl.TreeProxy">l</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxy.builder" title="=&gt; scales.xml.XmlBuilder">builder</a>.<span title="()scales.xml.XmlChildren">result</span>, <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.token" title="TOKEN">token</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="scales.xml.parser.strategies;TreeOptimisation.elementEnd.d">d</a> = <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.xml" title="scales.xml.impl.TreeProxies">xml</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies.depth" title="=&gt; Int">depth</a>
    <span class="keyword">val</span> <a title="Int" id="scales.xml.parser.strategies;TreeOptimisation.elementEnd.nd">nd</a> = <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.d" title="Int">d</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.d" title="Int">d</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.xml" title="scales.xml.impl.TreeProxies">xml</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies.depth_=" title="(newDepth: Int)Unit">depth</a> = <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.nd" title="Int">nd</a>
      <span class="keyword">val</span> <a title="scales.xml.impl.TreeProxy" id="scales.xml.parser.strategies;TreeOptimisation.elementEnd.c">c</a> = <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.xml" title="scales.xml.impl.TreeProxies">xml</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies.proxy" title="(depth: Int)scales.xml.impl.TreeProxy">proxy</a><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.nd" title="Int">nd</a> <span class="delimiter">)</span>
      <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.xml" title="scales.xml.impl.TreeProxies">xml</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies.current_=" title="(tp: scales.xml.impl.TreeProxy)Unit">current</a> = <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.c" title="scales.xml.impl.TreeProxy">c</a>
      <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.c" title="scales.xml.impl.TreeProxy">c</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxy.builder" title="=&gt; scales.xml.XmlBuilder">builder</a>.<span title="(elem: scales.utils.EitherLike[scales.xml.XmlItem,scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,[T]scales.utils.collection.ImmutableArrayProxy[T]]])scala.collection.mutable.Builder[scales.xml.ItemOrElem,scales.xml.XmlChildren]">+=</span><span title="Unit" class="delimiter">(</span><a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.nt" title="scales.xml.XmlTree">nt</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.xml" title="scales.xml.impl.TreeProxies">xml</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies.rootTree_=" title="(x$1: scales.xml.XmlTree)Unit">rootTree</a> = <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.nt" title="scales.xml.XmlTree">nt</a> 
      <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.xml" title="scales.xml.impl.TreeProxies">xml</a>.<a href="../../impl/TreeProxies.scala.html#scales.xml.impl;TreeProxies.depth_=" title="(newDepth: Int)Unit">depth</a> = <a href="#scales.xml.parser.strategies;TreeOptimisation.elementEnd.nd" title="Int">nd</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * An elem with no attributes, namespaces and only one text value.
 *
 */</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class NameValue extends AnyRef with scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]" id="scales.xml.parser.strategies;NameValue">NameValue</a><a href="#scales.xml.parser.strategies;NameValue" title="scales.xml.parser.strategies.NameValue" class="delimiter">(</a><span class="keyword">val</span> <a title="scales.xml.QName" id="scales.xml.parser.strategies;NameValue.name">name</a> : <a href="../../QName.scala.html#scales.xml;QName" title="scales.xml.QName">QName</a>, <span class="keyword">val</span> <a title="String" id="scales.xml.parser.strategies;NameValue.text">text</a> : <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection;Tree" title="scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]">Tree</a><span class="delimiter">[</span>XmlItem, Elem, XCC<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="=&gt; scales.xml.Elem" id="scales.xml.parser.strategies;NameValue.section">section</a> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a>
  <span class="keyword">def</span> <a title="=&gt; scales.xml.XmlChildren" id="scales.xml.parser.strategies;NameValue.children">children</a> : <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection;ImmutableArrayProxy" title="scales.xml.XmlChildren">XmlChildren</a> = <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection.ImmutableArrayProxy.one" title="(a: scales.xml.Text)scales.utils.collection.ImmutableArrayProxy[scales.xml.Text]">one</a><span class="delimiter">(</span><a href="../../XmlTypes.scala.html#scales.xml;Text" title="(value: String)scales.xml.Text">Text</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;NameValue.text" title="=&gt; String">text</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(section: scales.xml.Elem, children: scales.xml.XmlChildren)scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]" id="scales.xml.parser.strategies;NameValue.copy">copy</a><span class="delimiter">(</span> <a title="scales.xml.Elem" id="scales.xml.parser.strategies;NameValue.copy$default$1">section</a> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a> = <a href="#scales.xml.parser.strategies;NameValue.copy$default$1" title="scales.xml.Elem">section</a>, <a title="scales.xml.XmlChildren" id="scales.xml.parser.strategies;NameValue.copy$default$2">children</a> : <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection;ImmutableArrayProxy" title="scales.xml.XmlChildren">XmlChildren</a> = <a href="#scales.xml.parser.strategies;NameValue.copy$default$2" title="scales.xml.XmlChildren">children</a><span class="delimiter">)</span> : <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection;Tree" title="scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]">Tree</a><span class="delimiter">[</span>XmlItem, Elem, XCC<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// if we are copying we are no longer in a parse</span>
    <span class="keyword">import</span> <a href="../../ScalesXml.scala.html#scales.xml.ScalesXml" title="scales.xml.ScalesXml.type">ScalesXml</a>.fromParserDefault
    <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply" title="(section: scales.xml.Elem, children: scales.xml.XmlChildren)(implicit fromParser: scales.xml.impl.FromParser)scales.xml.XmlTree">LazyOptimisedTree</a><a href="../../impl/XmlTypesImplicits.scala.html#scales.xml.impl;XmlTypesImplicits.fromParserDefault" title="=&gt; scales.xml.impl.FromParser" class="delimiter">(</a><a href="#scales.xml.parser.strategies;NameValue.copy$default$1" title="scales.xml.Elem">section</a>, <a href="#scales.xml.parser.strategies;NameValue.copy$default$2" title="scales.xml.XmlChildren">children</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * An elem with attributes or namespaces and only one text value.
 *
 */</span>
<span class="keyword">class</span> <a title="class ElemValue extends AnyRef with scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]" id="scales.xml.parser.strategies;ElemValue">ElemValue</a><a href="#scales.xml.parser.strategies;ElemValue" title="scales.xml.parser.strategies.ElemValue" class="delimiter">(</a><span class="keyword">val</span> <a title="scales.xml.Elem" id="scales.xml.parser.strategies;ElemValue.section">section</a> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a>, <span class="keyword">val</span> <a title="String" id="scales.xml.parser.strategies;ElemValue.text">text</a> : <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection;Tree" title="scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]">Tree</a><span class="delimiter">[</span>XmlItem, Elem, XCC<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="=&gt; scales.xml.XmlChildren" id="scales.xml.parser.strategies;ElemValue.children">children</a> : <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection;ImmutableArrayProxy" title="scales.xml.XmlChildren">XmlChildren</a> = <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection.ImmutableArrayProxy.one" title="(a: scales.xml.Text)scales.utils.collection.ImmutableArrayProxy[scales.xml.Text]">one</a><span class="delimiter">(</span><a href="../../XmlTypes.scala.html#scales.xml;Text" title="(value: String)scales.xml.Text">Text</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;ElemValue.text" title="=&gt; String">text</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(section: scales.xml.Elem, children: scales.xml.XmlChildren)scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]" id="scales.xml.parser.strategies;ElemValue.copy">copy</a><span class="delimiter">(</span> <a title="scales.xml.Elem" id="scales.xml.parser.strategies;ElemValue.copy$default$1">section</a> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a> = <a href="#scales.xml.parser.strategies;ElemValue.copy$default$1" title="scales.xml.Elem">section</a>, <a title="scales.xml.XmlChildren" id="scales.xml.parser.strategies;ElemValue.copy$default$2">children</a> : <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection;ImmutableArrayProxy" title="scales.xml.XmlChildren">XmlChildren</a> = <a href="#scales.xml.parser.strategies;ElemValue.copy$default$2" title="scales.xml.XmlChildren">children</a><span class="delimiter">)</span> : <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection;Tree" title="scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]">Tree</a><span class="delimiter">[</span>XmlItem, Elem, XCC<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// if we are copying we are no longer in a parse</span>
    <span class="keyword">import</span> <a href="../../ScalesXml.scala.html#scales.xml.ScalesXml" title="scales.xml.ScalesXml.type">ScalesXml</a>.fromParserDefault
    <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply" title="(section: scales.xml.Elem, children: scales.xml.XmlChildren)(implicit fromParser: scales.xml.impl.FromParser)scales.xml.XmlTree">LazyOptimisedTree</a><a href="../../impl/XmlTypesImplicits.scala.html#scales.xml.impl;XmlTypesImplicits.fromParserDefault" title="=&gt; scales.xml.impl.FromParser" class="delimiter">(</a><a href="#scales.xml.parser.strategies;ElemValue.copy$default$1" title="scales.xml.Elem">section</a>, <a href="#scales.xml.parser.strategies;ElemValue.copy$default$2" title="scales.xml.XmlChildren">children</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


<span class="comment">/**
 * Collection of optimisations that reduce memory significantly at the cost of parsing performance, and later non-lazy creation of correct objects for accessing the tree.
 *
 * This can have confusing runtime evaluation of XPaths etc.  These optimisations are appropriate for trees that are seldom read, repeated reads may generate too much garbage.
 */</span> 
<span class="keyword">object</span> <a title="scales.xml.parser.strategies.LazyOptimisedTree.type" id="scales.xml.parser.strategies.LazyOptimisedTree">LazyOptimisedTree</a> <a href="#scales.xml.parser.strategies.LazyOptimisedTree" title="scales.xml.parser.strategies.LazyOptimisedTree.type" class="delimiter">{</a>

  <span class="comment">/**
   * Returns an optimised Tree if Possible
   */</span> 
  <span class="keyword">def</span> <a title="(section: scales.xml.Elem, children: scales.xml.XmlChildren)(implicit fromParser: scales.xml.impl.FromParser)scales.xml.XmlTree" id="scales.xml.parser.strategies.LazyOptimisedTree.apply">apply</a><span class="delimiter">(</span> <a title="scales.xml.Elem" id="scales.xml.parser.strategies.LazyOptimisedTree.apply.section">section</a> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a>, <a title="scales.xml.XmlChildren" id="scales.xml.parser.strategies.LazyOptimisedTree.apply.children">children</a> : <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection;ImmutableArrayProxy" title="scales.xml.XmlChildren">XmlChildren</a> <span class="delimiter">)</span> <span class="delimiter">(</span> <span class="keyword">implicit</span> <a title="scales.xml.impl.FromParser" id="scales.xml.parser.strategies.LazyOptimisedTree.apply.fromParser">fromParser</a> : <a href="../../impl/FromParser.scala.html#scales.xml.impl;FromParser" title="scales.xml.impl.FromParser">FromParser</a> <span class="delimiter">)</span> : <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection;Tree" title="scales.xml.XmlTree">XmlTree</a> = 
    <span title="scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]" class="keyword">if</span> <span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.children" title="scales.xml.XmlChildren">children</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
      <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection.Tree.apply" title="(isection: scales.xml.Elem, ichildren: scales.xml.XCC[scales.utils.ItemOrTree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]])scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]">Tree</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.section" title="scales.xml.Elem">section</a>, <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.children" title="scales.xml.XmlChildren">children</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scales.xml.ItemOrElem" id="scales.xml.parser.strategies.LazyOptimisedTree.apply.head">head</a> = <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.children" title="scales.xml.XmlChildren">children</a>.<span title="=&gt; scales.xml.ItemOrElem">head</span>
      <span title="scales.xml.XmlTree" class="keyword">if</span> <span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.head" title="scales.xml.ItemOrElem">head</a>.<a href="../../../utils/EitherLike.scala.html#scales.utils;EitherLike.isLeft" title="=&gt; Boolean">isLeft</a><span class="delimiter">)</span> <span class="delimiter">{</span>
	<span class="keyword">val</span> <a title="scales.xml.XmlItem" id="scales.xml.parser.strategies.LazyOptimisedTree.apply.left">left</a> = <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.head" title="scales.xml.ItemOrElem">head</a>.<a href="../../../utils/EitherLike.scala.html#scales.utils;EitherLike.getLeft" title="=&gt; scales.xml.XmlItem">getLeft</a>
	<span title="scales.xml.XmlTree" class="keyword">if</span> <span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.left" title="scales.xml.XmlItem">left</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../XmlTypes.scala.html#scales.xml;Text" title="scales.xml.Text">Text</a><span class="delimiter">]</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.children" title="scales.xml.XmlChildren">children</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
	  <span title="scales.xml.XmlTree" class="keyword">if</span> <span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.section" title="scales.xml.Elem">section</a>.<a href="../../XmlTypes.scala.html#scales.xml;Elem.attributes" title="=&gt; scales.xml.Attributes">attributes</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.section" title="scales.xml.Elem">section</a>.<a href="../../XmlTypes.scala.html#scales.xml;Elem.namespaces" title="=&gt; scala.collection.immutable.Map[String,String]">namespaces</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
	    <a href="#scales.xml.parser.strategies.LazyOptimisedTree.newNameValue" title="(iname: scales.xml.QName, itext: String)(implicit fromParser: scales.xml.impl.FromParser)scales.xml.parser.strategies.NameValue">newNameValue</a><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.fromParser" title="scales.xml.impl.FromParser" class="delimiter">(</a><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.section" title="scales.xml.Elem">section</a>.<a href="../../XmlTypes.scala.html#scales.xml;Elem.name" title="=&gt; scales.xml.QName">name</a>, <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.left" title="scales.xml.XmlItem">left</a>.<a href="../../XmlTypes.scala.html#scales.xml;XmlItem.value" title="=&gt; String">value</a><span class="delimiter">)</span>
	  <span class="keyword">else</span>
	    <span title="scales.xml.parser.strategies.ElemValue" class="keyword">new</span> <a href="#scales.xml.parser.strategies;ElemValue" title="scales.xml.parser.strategies.ElemValue">ElemValue</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.section" title="scales.xml.Elem">section</a>, <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.left" title="scales.xml.XmlItem">left</a>.<a href="../../XmlTypes.scala.html#scales.xml;XmlItem.value" title="=&gt; String">value</a><span class="delimiter">)</span>
	<span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection.Tree.apply" title="(isection: scales.xml.Elem, ichildren: scales.xml.XCC[scales.utils.ItemOrTree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]])scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]">Tree</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.section" title="scales.xml.Elem">section</a>, <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.children" title="scales.xml.XmlChildren">children</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection.Tree.apply" title="(isection: scales.xml.Elem, ichildren: scales.xml.XCC[scales.utils.ItemOrTree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]])scales.utils.collection.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.XCC]">Tree</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.section" title="scales.xml.Elem">section</a>, <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply.children" title="scales.xml.XmlChildren">children</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  

  <span class="keyword">def</span> <a title="(iname: scales.xml.QName, itext: String)(implicit fromParser: scales.xml.impl.FromParser)scales.xml.parser.strategies.NameValue" id="scales.xml.parser.strategies.LazyOptimisedTree.newNameValue">newNameValue</a><span class="delimiter">(</span> <a title="scales.xml.QName" id="scales.xml.parser.strategies.LazyOptimisedTree.newNameValue.iname">iname</a> : <a href="../../QName.scala.html#scales.xml;QName" title="scales.xml.QName">QName</a>, <a title="String" id="scales.xml.parser.strategies.LazyOptimisedTree.newNameValue.itext">itext</a> : <span title="String">String</span> <span class="delimiter">)</span> <span class="delimiter">(</span> <span class="keyword">implicit</span> <a title="scales.xml.impl.FromParser" id="scales.xml.parser.strategies.LazyOptimisedTree.newNameValue.fromParser">fromParser</a> : <a href="../../impl/FromParser.scala.html#scales.xml.impl;FromParser" title="scales.xml.impl.FromParser">FromParser</a> <span class="delimiter">)</span> : <a href="#scales.xml.parser.strategies;NameValue" title="scales.xml.parser.strategies.NameValue">NameValue</a> = 
    <span title="scales.xml.parser.strategies.NameValue" class="keyword">if</span> <span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.newNameValue.fromParser" title="scales.xml.impl.FromParser">fromParser</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../impl/FromParser.scala.html#scales.xml.impl.NotFromParser" title="scales.xml.impl.NotFromParser.type">NotFromParser</a><span class="delimiter">)</span>
      <span title="scales.xml.parser.strategies.NameValue" class="keyword">new</span> <a href="#scales.xml.parser.strategies;NameValue" title="anonymous class $anon extends scales.xml.parser.strategies.NameValue">NameValue</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.newNameValue.iname" title="scales.xml.QName">iname</a>, <a href="#scales.xml.parser.strategies.LazyOptimisedTree.newNameValue.itext" title="String">itext</a><span class="delimiter">)</span> <span class="delimiter">{</span>
	
	<span class="keyword">def</span> <span title="=&gt; scales.xml.Elem">section</span> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a> = <a href="../../XmlTypes.scala.html#scales.xml.Elem.apply(298a8ae74b)" title="(namei: scales.xml.QName, attributesi: scales.xml.Attributes, namespacesi: scala.collection.immutable.Map[String,String])(implicit fromParser: scales.xml.impl.FromParser)scales.xml.Elem">Elem</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;NameValue.name" title="=&gt; scales.xml.QName">name</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../impl/FromParser.scala.html#scales.xml.impl.NotFromParser" title="scales.xml.impl.NotFromParser.type">NotFromParser</a><span class="delimiter">)</span> <span class="comment">// have to recheck that the qname is ok</span>

      <span class="delimiter">}</span>
    <span class="keyword">else</span>
      <span title="scales.xml.parser.strategies.NameValue" class="keyword">new</span> <a href="#scales.xml.parser.strategies;NameValue" title="anonymous class $anon extends scales.xml.parser.strategies.NameValue">NameValue</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies.LazyOptimisedTree.newNameValue.iname" title="scales.xml.QName">iname</a>, <a href="#scales.xml.parser.strategies.LazyOptimisedTree.newNameValue.itext" title="String">itext</a><span class="delimiter">)</span> <span class="delimiter">{</span>
	
	<span class="keyword">def</span> <span title="=&gt; scales.xml.Elem">section</span> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a> = <a href="../../XmlTypes.scala.html#scales.xml.Elem.apply(298a8ae74b)" title="(namei: scales.xml.QName, attributesi: scales.xml.Attributes, namespacesi: scala.collection.immutable.Map[String,String])(implicit fromParser: scales.xml.impl.FromParser)scales.xml.Elem">Elem</a><span class="delimiter">(</span><a href="#scales.xml.parser.strategies;NameValue.name" title="=&gt; scales.xml.QName">name</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../impl/FromParser.scala.html#scales.xml.impl.IsFromParser" title="scales.xml.impl.IsFromParser.type">IsFromParser</a><span class="delimiter">)</span> <span class="comment">// don't have to recheck</span>

      <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Optimises QNames and Trees according to LazyOptimisedTree
 */</span> 
<span title="AnyRef" class="keyword">object</span> <a title="scales.xml.parser.strategies.QNameTreeOptimisation.type" id="scales.xml.parser.strategies.QNameTreeOptimisation">QNameTreeOptimisation</a> <a href="#scales.xml.parser.strategies.QNameTreeOptimisation" title="scales.xml.parser.strategies.QNameTreeOptimisation.type" class="keyword">extends</a> <a href="#scales.xml.parser.strategies;TreeOptimisation" title="scales.xml.parser.strategies.TreeOptimisation[scales.xml.parser.strategies.QNameToken]">TreeOptimisation</a><span class="delimiter">[</span>QNameToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="OptimisingStrategies.scala.html#scales.xml.parser.strategies;QNameOptimisationT" title="scales.xml.parser.strategies.QNameOptimisationT[scales.xml.parser.strategies.QNameToken]">QNameOptimisationT</a><span class="delimiter">[</span>QNameToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="OptimisingStrategies.scala.html#scales.xml.parser.strategies;QNameTokenF" title="scales.xml.parser.strategies.QNameTokenF">QNameTokenF</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(elem: scales.xml.Elem, children: scales.xml.XmlChildren, token: scales.xml.parser.strategies.QNameToken)scales.xml.XmlTree" id="scales.xml.parser.strategies.QNameTreeOptimisation.newTree">newTree</a><span class="delimiter">(</span> <a title="scales.xml.Elem" id="scales.xml.parser.strategies.QNameTreeOptimisation.newTree.elem">elem</a> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a>, <a title="scales.xml.XmlChildren" id="scales.xml.parser.strategies.QNameTreeOptimisation.newTree.children">children</a> : <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection;ImmutableArrayProxy" title="scales.xml.XmlChildren">XmlChildren</a>, <a title="scales.xml.parser.strategies.QNameToken" id="scales.xml.parser.strategies.QNameTreeOptimisation.newTree.token">token</a> : <a href="OptimisingStrategies.scala.html#scales.xml.parser.strategies;QNameToken" title="scales.xml.parser.strategies.QNameToken">QNameToken</a> <span class="delimiter">)</span> : <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection;Tree" title="scales.xml.XmlTree">XmlTree</a> =
    <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply" title="(section: scales.xml.Elem, children: scales.xml.XmlChildren)(implicit fromParser: scales.xml.impl.FromParser)scales.xml.XmlTree">LazyOptimisedTree</a><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies.QNameTreeOptimisation.newTree.elem" title="scales.xml.Elem">elem</a>, <a href="#scales.xml.parser.strategies.QNameTreeOptimisation.newTree.children" title="scales.xml.XmlChildren">children</a> <span class="delimiter">)</span><span class="delimiter">(</span><a href="../../impl/FromParser.scala.html#scales.xml.impl.IsFromParser" title="scales.xml.impl.IsFromParser.type">IsFromParser</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Optimised QNames, Elems and Tree, heavily reduced memory consumption with LazyOptimisedTree.
 */</span>
<span class="keyword">object</span> <a title="scales.xml.parser.strategies.QNameElemTreeOptimisation.type" id="scales.xml.parser.strategies.QNameElemTreeOptimisation">QNameElemTreeOptimisation</a> <a href="#scales.xml.parser.strategies.QNameElemTreeOptimisation" title="scales.xml.parser.strategies.QNameElemTreeOptimisation.type" class="keyword">extends</a> <a href="OptimisingStrategies.scala.html#scales.xml.parser.strategies;PathOptimisationStrategy" title="scales.xml.parser.strategies.PathOptimisationStrategy[scales.xml.parser.strategies.ElemToken]">PathOptimisationStrategy</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="NonDefaultStrategies.scala.html#scales.xml.parser.strategies;ElemQNameOptimisationT" title="scales.xml.parser.strategies.ElemQNameOptimisationT[scales.xml.parser.strategies.ElemToken]">ElemQNameOptimisationT</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#scales.xml.parser.strategies;TreeOptimisation" title="scales.xml.parser.strategies.TreeOptimisation[scales.xml.parser.strategies.ElemToken]">TreeOptimisation</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="NonDefaultStrategies.scala.html#scales.xml.parser.strategies;ElemTokenF" title="scales.xml.parser.strategies.ElemTokenF">ElemTokenF</a> <span class="delimiter">{</span>
  
  <span class="keyword">def</span> <a title="(elem: scales.xml.Elem, children: scales.xml.XmlChildren, token: scales.xml.parser.strategies.ElemToken)scales.xml.XmlTree" id="scales.xml.parser.strategies.QNameElemTreeOptimisation.newTree">newTree</a><span class="delimiter">(</span> <a title="scales.xml.Elem" id="scales.xml.parser.strategies.QNameElemTreeOptimisation.newTree.elem">elem</a> : <a href="../../XmlTypes.scala.html#scales.xml;Elem" title="scales.xml.Elem">Elem</a>, <a title="scales.xml.XmlChildren" id="scales.xml.parser.strategies.QNameElemTreeOptimisation.newTree.children">children</a> : <a href="../../../utils/collection/ImmutableArray.scala.html#scales.utils.collection;ImmutableArrayProxy" title="scales.xml.XmlChildren">XmlChildren</a>, <a title="scales.xml.parser.strategies.ElemToken" id="scales.xml.parser.strategies.QNameElemTreeOptimisation.newTree.token">token</a> : <a href="NonDefaultStrategies.scala.html#scales.xml.parser.strategies;ElemToken" title="scales.xml.parser.strategies.ElemToken">ElemToken</a> <span class="delimiter">)</span> : <a href="../../../utils/collection/Trees.scala.html#scales.utils.collection;Tree" title="scales.xml.XmlTree">XmlTree</a> =
    <a href="#scales.xml.parser.strategies.LazyOptimisedTree.apply" title="(section: scales.xml.Elem, children: scales.xml.XmlChildren)(implicit fromParser: scales.xml.impl.FromParser)scales.xml.XmlTree">LazyOptimisedTree</a><span class="delimiter">(</span> <a href="#scales.xml.parser.strategies.QNameElemTreeOptimisation.newTree.elem" title="scales.xml.Elem">elem</a>, <a href="#scales.xml.parser.strategies.QNameElemTreeOptimisation.newTree.children" title="scales.xml.XmlChildren">children</a> <span class="delimiter">)</span><span class="delimiter">(</span><a href="../../impl/FromParser.scala.html#scales.xml.impl.IsFromParser" title="scales.xml.impl.IsFromParser.type">IsFromParser</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
