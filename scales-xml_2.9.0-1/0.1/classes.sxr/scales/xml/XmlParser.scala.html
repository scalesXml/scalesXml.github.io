<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scales\xml\XmlParser.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    
<style id="linesStyle">
.lineHighlight {
  background-color: #a5a5a5;
}
</style>
<script type="text/javascript">
function selectedLine() {
    var loca = /^.*#l(.*)/.exec(location.href);
    return loca ? loca[1] : '0';
}

function highlightLine(ln){
  $('#l'+ln).toggleClass('lineHighlight');
}

function gotoLine(ln){
  $('#l'+ln).focus();
}

$(function(){
  var line = selectedLine();
  if (line != '0') highlightLine(line)
});
</script></head>
    <body>
        <pre>
<!-- SXR_LINES --><a href="l1"></a><span id="l1"><span class="keyword">package</span> scales.xml</span>
<a href="l2"></a><span id="l2"></span>
<a href="l3"></a><span id="l3"><span class="keyword">import</span> org.xml.sax.InputSource</span>
<a href="l4"></a><span id="l4"><span class="keyword">import</span> javax.xml.parsers.SAXParser</span>
<a href="l5"></a><span id="l5"><span class="keyword">import</span> scales.utils._</span>
<a href="l6"></a><span id="l6"><span class="keyword">import</span> java.io._</span>
<a href="l7"></a><span id="l7"></span>
<a href="l8"></a><span id="l8"><span class="keyword">trait</span> <a title="trait XmlParserImplicits extends java.lang.Object with ScalaObject" id="10441">XmlParserImplicits</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l9"></a><span id="l9">  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.XmlParserImplicits.streamToSource : (source: java.io.InputStream)org.xml.sax.InputSource" id="87947">streamToSource</a><span class="delimiter">(</span> <a title="java.io.InputStream" id="90449">source</a> : <span title="java.io.InputStream">InputStream</span> <span class="delimiter">)</span> = <span title="(x$1: java.io.InputStream)org.xml.sax.InputSource" class="keyword">new</span> org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span><span class="delimiter">(</span><a href="#90449" title="java.io.InputStream">source</a><span class="delimiter">)</span></span>
<a href="l10"></a><span id="l10">  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.XmlParserImplicits.readerToSource : (source: java.io.Reader)org.xml.sax.InputSource" id="87948">readerToSource</a><span class="delimiter">(</span> <a title="java.io.Reader" id="90357">source</a> : <span title="java.io.Reader">Reader</span> <span class="delimiter">)</span> = <span title="(x$1: java.io.Reader)org.xml.sax.InputSource" class="keyword">new</span> org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span><span class="delimiter">(</span><a href="#90357" title="java.io.Reader">source</a><span class="delimiter">)</span></span>
<a href="l11"></a><span id="l11"><span class="delimiter">}</span></span>
<a href="l12"></a><span id="l12"></span>
<a href="l13"></a><span id="l13"><span class="keyword">trait</span> <a title="trait XmlParser extends java.lang.Object with ScalaObject" id="10442">XmlParser</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l14"></a><span id="l14"></span>
<a href="l15"></a><span id="l15">  <span class="keyword">import</span> <a href="ScalesXml.scala.html#10381" title="object scales.xml.ScalesXml">ScalesXml</a>.xmlCBF</span>
<a href="l16"></a><span id="l16"></span>
<a href="l17"></a><span id="l17">  <span class="comment">/**</span>
<a href="l18"></a><span id="l18">   * Use a custom parserPool to control the sax factory features </span>
<a href="l19"></a><span id="l19">   */</span> </span>
<a href="l20"></a><span id="l20">  <span class="keyword">def</span> <a title="[Token &lt;: scales.xml.OptimisationToken](source: org.xml.sax.InputSource, strategy: scales.xml.PathOptimisationStrategy[Token], parsers: scales.utils.Loaner[javax.xml.parsers.SAXParser])(implicit xmlVer: scales.xml.XmlVersion)scales.xml.Doc" id="10967">loadXml</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="100260">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="org.xml.sax.InputSource" id="100253">source</a>: <span title="org.xml.sax.InputSource">InputSource</span>, <a title="scales.xml.PathOptimisationStrategy[Token]" id="100258">strategy</a> : <a href="OptimisingStrategies.scala.html#9245" title="scales.xml.PathOptimisationStrategy[Token]">PathOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> = <a href="package.scala.html#10961" title="=&gt; scales.xml.PathOptimisationStrategy[scales.xml.ElemToken]">defaultPathOptimisation</a>, <a title="scales.utils.Loaner[javax.xml.parsers.SAXParser]" id="100261">parsers</a> : <a href="../utils/Resources.scala.html#9171" title="scales.utils.Loaner[javax.xml.parsers.SAXParser]">Loaner</a><span class="delimiter">[</span>SAXParser<span class="delimiter">]</span> = <a href="XmlFactories.scala.html#11060" title="object scales.xml.package.DefaultSAXParserFactoryPool">DefaultSAXParserFactoryPool</a>.<a href="XmlFactories.scala.html#99496" title="=&gt; java.lang.Object with scales.utils.Loaner[javax.xml.parsers.SAXParser]">parsers</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="100256">xmlVer</a> : <a href="QName.scala.html#10348" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <a href="XmlTypes.scala.html#10591" title="scales.xml.Doc">Doc</a> = <span class="delimiter">{</span></span>
<a href="l21"></a><span id="l21">    <span class="keyword">var</span> <a title="XmlParser.this.Handler[Token]" id="100267">handler</a> = <a href="#100256" title="XmlParser.this.Handler[Token]" class="keyword">new</a> <a href="#10976" title="XmlParser.this.Handler[Token]">Handler</a><span class="delimiter">(</span><a href="#100258" title="scales.xml.PathOptimisationStrategy[Token]">strategy</a><span class="delimiter">)</span></span>
<a href="l22"></a><span id="l22">    <a href="#100261" title="scales.utils.Loaner[javax.xml.parsers.SAXParser]">parsers</a>.<a href="../utils/Resources.scala.html#85314" title="(tThunk: (javax.xml.parsers.SAXParser) =&gt; scales.xml.Doc)scales.xml.Doc">loan</a> <span class="delimiter">{</span></span>
<a href="l23"></a><span id="l23">      <a title="javax.xml.parsers.SAXParser" id="100279">parser</a> =&gt;</span>
<a href="l24"></a><span id="l24">      <a href="#100279" title="javax.xml.parsers.SAXParser">parser</a>.<span title="(x$1: java.lang.String, x$2: Any)Unit">setProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;http://xml.org/sax/properties/lexical-handler&quot;)" class="string">&quot;http://xml.org/sax/properties/lexical-handler&quot;</span>, <a href="#100267" title="XmlParser.this.Handler[Token]">handler</a><span class="delimiter">)</span></span>
<a href="l25"></a><span id="l25">      <a href="#100279" title="javax.xml.parsers.SAXParser">parser</a>.<span title="(x$1: org.xml.sax.InputSource, x$2: org.xml.sax.helpers.DefaultHandler)Unit">parse</span><span class="delimiter">(</span><a href="#100253" title="org.xml.sax.InputSource">source</a>, <a href="#100267" title="XmlParser.this.Handler[Token]">handler</a><span class="delimiter">)</span></span>
<a href="l26"></a><span id="l26"></span>
<a href="l27"></a><span id="l27">      <a href="XmlTypes.scala.html#90249" title="(rootElem: scales.xml.package.XmlTree, prolog: scales.xml.Prolog, end: scales.xml.EndMisc)scales.xml.Doc">Doc</a><span class="delimiter">(</span><a href="#100267" title="XmlParser.this.Handler[Token]">handler</a>.<a href="#95331" title="=&gt; scales.xml.TreeProxies">buf</a>.<a href="#89006" title="=&gt; scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">tree</a>, <a href="#100267" title="XmlParser.this.Handler[Token]">handler</a>.<a href="#95340" title="=&gt; scales.xml.Prolog">prolog</a>, <a href="#100267" title="XmlParser.this.Handler[Token]">handler</a>.<a href="#95343" title="=&gt; scales.xml.EndMisc">end</a><span class="delimiter">)</span></span>
<a href="l28"></a><span id="l28">    <span class="delimiter">}</span></span>
<a href="l29"></a><span id="l29">  <span class="delimiter">}</span></span>
<a href="l30"></a><span id="l30">  </span>
<a href="l31"></a><span id="l31"></span>
<a href="l32"></a><span id="l32">  <span class="comment">/** Elems can have any QName, attribs only prefixed or default */</span></span>
<a href="l33"></a><span id="l33">  <span class="keyword">def</span> <a title="[Token &lt;: scales.xml.OptimisationToken](uri: String, localName: String, qName: String, strategy: scales.xml.MemoryOptimisationStrategy[Token], token: Token)scales.xml.QName" id="10970">eqn</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="10972">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="100381">uri</a>: <span title="String">String</span>,</span>
<a href="l34"></a><span id="l34">    <a title="String" id="100382">localName</a>: <span title="String">String</span>,</span>
<a href="l35"></a><span id="l35">    <a title="String" id="100383">qName</a>: <span title="String">String</span>, <a title="scales.xml.MemoryOptimisationStrategy[Token]" id="100384">strategy</a> : <a href="OptimisingStrategies.scala.html#9240" title="scales.xml.MemoryOptimisationStrategy[Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span>, <a title="Token" id="100385">token</a> : <a href="#10972" title="Token">Token</a><span class="delimiter">)</span>: <a href="QName.scala.html#10365" title="scales.xml.QName">QName</a> =</span>
<a href="l36"></a><span id="l36">    <span title="scales.xml.QName" class="keyword">if</span> <span class="delimiter">(</span><a href="#100381" title="String">uri</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l37"></a><span id="l37">      <span class="comment">// can only be in qName</span></span>
<a href="l38"></a><span id="l38">      <a href="#100384" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87868" title="(local: String, token: Token)scales.xml.NoNamespaceQName">noNamespaceQName</a><span class="delimiter">(</span><a href="#100383" title="String">qName</a>, <a href="#100385" title="Token">token</a><span class="delimiter">)</span></span>
<a href="l39"></a><span id="l39">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l40"></a><span id="l40">      <span class="comment">// might have a prefix</span></span>
<a href="l41"></a><span id="l41">      <span title="scales.xml.QName" class="keyword">if</span> <span class="delimiter">(</span><a href="#100383" title="String">qName</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#100382" title="String">localName</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l42"></a><span id="l42">        <span class="comment">// no prefix</span></span>
<a href="l43"></a><span id="l43">	<a href="#100384" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87869" title="(local: String, uri: String, token: Token)scales.xml.UnprefixedQName">unprefixedQName</a><span class="delimiter">(</span><a href="#100382" title="String">localName</a>, <a href="#100381" title="String">uri</a>, <a href="#100385" title="Token">token</a><span class="delimiter">)</span></span>
<a href="l44"></a><span id="l44">      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l45"></a><span id="l45">        <span class="comment">// break up the prefix</span></span>
<a href="l46"></a><span id="l46">        <span class="keyword">val</span> <a title="Array[String]" id="100411">bits</a> = <a href="#100383" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">qName</a>.<span title="(separator: Char)Array[String]">split</span><span class="delimiter">(</span><span title="Char(\':\')" class="char">':'</span><span class="delimiter">)</span></span>
<a href="l47"></a><span id="l47">	</span>
<a href="l48"></a><span id="l48">	<a href="#100384" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87870" title="(local: String, uri: String, prefix: String, token: Token)scales.xml.PrefixedQName">prefixedQName</a><span class="delimiter">(</span><a href="#100382" title="String">localName</a>, <a href="#100381" title="String">uri</a>, <a href="#100411" title="(i: Int)String">bits</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#100385" title="Token">token</a><span class="delimiter">)</span></span>
<a href="l49"></a><span id="l49">      <span class="delimiter">}</span></span>
<a href="l50"></a><span id="l50">    <span class="delimiter">}</span></span>
<a href="l51"></a><span id="l51"></span>
<a href="l52"></a><span id="l52">  <span class="comment">/** attribs only prefixed or default */</span></span>
<a href="l53"></a><span id="l53">  <span class="keyword">def</span> <a title="[Token &lt;: scales.xml.OptimisationToken](uri: String, localName: String, qName: String, strategy: scales.xml.MemoryOptimisationStrategy[Token], token: Token)scales.xml.package.AttributeQName" id="10973">aqn</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="10975">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="100519">uri</a>: <span title="String">String</span>,</span>
<a href="l54"></a><span id="l54">    <a title="String" id="100520">localName</a>: <span title="String">String</span>,</span>
<a href="l55"></a><span id="l55">    <a title="String" id="100521">qName</a>: <span title="String">String</span>, <a title="scales.xml.MemoryOptimisationStrategy[Token]" id="100522">strategy</a> : <a href="OptimisingStrategies.scala.html#9240" title="scales.xml.MemoryOptimisationStrategy[Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span>, <a title="Token" id="100523">token</a> : <a href="#10975" title="Token">Token</a><span class="delimiter">)</span>: <a href="../utils/EitherLike.scala.html#8884" title="scales.xml.package.AttributeQName">AttributeQName</a> =</span>
<a href="l56"></a><span id="l56">    <span title="scales.xml.package.AttributeQName" class="keyword">if</span> <span class="delimiter">(</span><a href="#100519" title="String">uri</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l57"></a><span id="l57">      <span class="comment">// can only be in qName</span></span>
<a href="l58"></a><span id="l58">      <a href="#100522" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87868" title="(local: String, token: Token)scales.xml.NoNamespaceQName">noNamespaceQName</a><span class="delimiter">(</span><a href="#100521" title="String">qName</a>, <a href="#100523" title="Token">token</a><span class="delimiter">)</span> <span class="comment">// Right</span></span>
<a href="l59"></a><span id="l59">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l60"></a><span id="l60">      <span class="comment">// might have a prefix</span></span>
<a href="l61"></a><span id="l61">      <span title="scales.xml.package.AttributeQName" class="keyword">if</span> <span class="delimiter">(</span><a href="#100521" title="String">qName</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#100520" title="String">localName</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l62"></a><span id="l62">        <span class="comment">// no prefix</span></span>
<a href="l63"></a><span id="l63">        scales.utils.<a href="../utils/package.scala.html#10616" title="(str: String)Nothing">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Should not have an attribute with a unprefixed namspace&quot;)" class="string">&quot;Should not have an attribute with a unprefixed namspace&quot;</span><span class="delimiter">)</span></span>
<a href="l64"></a><span id="l64">      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l65"></a><span id="l65">        <span class="comment">// break up the prefix</span></span>
<a href="l66"></a><span id="l66">        <span class="keyword">val</span> <a title="Array[String]" id="100546">bits</a> = <a href="#100521" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">qName</a>.<span title="(separator: Char)Array[String]">split</span><span class="delimiter">(</span><span title="Char(\':\')" class="char">':'</span><span class="delimiter">)</span></span>
<a href="l67"></a><span id="l67">        <a href="#100522" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87870" title="(local: String, uri: String, prefix: String, token: Token)scales.xml.PrefixedQName">prefixedQName</a><span class="delimiter">(</span><a href="#100520" title="String">localName</a>, <a href="#100519" title="String">uri</a>,<a href="#100546" title="(i: Int)String">bits</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#100523" title="Token">token</a><span class="delimiter">)</span> <span class="comment">// Left</span></span>
<a href="l68"></a><span id="l68">      <span class="delimiter">}</span></span>
<a href="l69"></a><span id="l69">    <span class="delimiter">}</span></span>
<a href="l70"></a><span id="l70"></span>
<a href="l71"></a><span id="l71">  <span class="keyword">class</span> <a title="class Handler[Token &lt;: scales.xml.OptimisationToken] extends org.xml.sax.ext.DefaultHandler2 with ScalaObject" id="10976">Handler</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="10977">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><a href="#10976" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="scales.xml.PathOptimisationStrategy[Token]" id="95465">strategy</a> : <a href="OptimisingStrategies.scala.html#9245" title="scales.xml.PathOptimisationStrategy[Token]">PathOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.XmlVersion" id="95466">defaultVersion</a> : <a href="QName.scala.html#10348" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span> <span class="keyword">extends</span> org.xml.sax.ext.<span title="org.xml.sax.ext.DefaultHandler2">DefaultHandler2</span> <span class="delimiter">{</span></span>
<a href="l72"></a><span id="l72"></span>
<a href="l73"></a><span id="l73">    <span class="keyword">import</span> scales.utils.<span class="delimiter">{</span>noPath, Path, top, ScalesUtils <span class="delimiter">}</span></span>
<a href="l74"></a><span id="l74">    <span class="keyword">import</span> org.xml.sax._</span>
<a href="l75"></a><span id="l75">    <span class="keyword">import</span> scala.collection.immutable.Stack</span>
<a href="l76"></a><span id="l76">    <span class="keyword">import</span> <a href="../utils/ScalesUtils.scala.html#9179" title="object scales.utils.ScalesUtils">ScalesUtils</a>._</span>
<a href="l77"></a><span id="l77"><span class="comment">//    import ScalesXml.toQName // Note we aren't validating the names here anyway so we don't need to use the correct xml version, future version may double check perhaps?</span></span>
<a href="l78"></a><span id="l78"></span>
<a href="l79"></a><span id="l79">    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.FromParser" id="95327">weAreInAParser</a> : <a href="XmlTypes.scala.html#10548" title="scales.xml.FromParser">FromParser</a> = <a href="XmlTypes.scala.html#10925" title="object scales.xml.package.IsFromParser">IsFromParser</a></span>
<a href="l80"></a><span id="l80"></span>
<a href="l81"></a><span id="l81">    <span class="keyword">val</span> <a title="Token" id="95329">token</a> : <a href="#10977" title="Token">Token</a> = <a href="#95465" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87866" title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)Token">createToken</a></span>
<a href="l82"></a><span id="l82"></span>
<a href="l83"></a><span id="l83">    <span class="comment">// start with nothing</span></span>
<a href="l84"></a><span id="l84"><span class="comment">//    var path: XmlPath = noXmlPath</span></span>
<a href="l85"></a><span id="l85"></span>
<a href="l86"></a><span id="l86">    <span class="comment">// only trees have kids, and we only need to keep the parent</span></span>
<a href="l87"></a><span id="l87">    <span class="keyword">val</span> <a title="scales.xml.TreeProxies" id="95331">buf</a> = <a href="#95481" title="scales.xml.TreeProxies" class="keyword">new</a> <a href="#10446" title="scales.xml.TreeProxies">TreeProxies</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l88"></a><span id="l88"></span>
<a href="l89"></a><span id="l89">    <span class="keyword">var</span> <a title="Boolean" id="95334">isCData</a> = <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l90"></a><span id="l90"></span>
<a href="l91"></a><span id="l91">    <span class="comment">// declarations on this element</span></span>
<a href="l92"></a><span id="l92">    <span class="keyword">var</span> <a title="scala.collection.immutable.Map[String,String]" id="95337">nsDeclarations</a> = <a href="XmlTypes.scala.html#10946" title="=&gt; scala.collection.immutable.Map[String,String]">emptyNamespaces</a></span>
<a href="l93"></a><span id="l93"></span>
<a href="l94"></a><span id="l94">    <span class="keyword">var</span> <a title="scales.xml.Prolog" id="95340">prolog</a> = <a href="XmlTypes.scala.html#95520" title="(decl: scales.xml.Declaration, misc: scales.xml.package.Miscs, dtd: Option[scales.xml.DTD])scales.xml.Prolog">Prolog</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l95"></a><span id="l95">    <span class="keyword">var</span> <a title="scales.xml.EndMisc" id="95343">end</a> = <a href="XmlTypes.scala.html#95555" title="(misc: scales.xml.package.Miscs)scales.xml.EndMisc">EndMisc</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l96"></a><span id="l96"></span>
<a href="l97"></a><span id="l97">    <span class="comment">// used for judging PI or Comments</span></span>
<a href="l98"></a><span id="l98">    <span class="keyword">var</span> <a title="Boolean" id="95346">inprolog</a> = <span title="Boolean(true)" class="keyword">true</span></span>
<a href="l99"></a><span id="l99"></span>
<a href="l100"></a><span id="l100">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(name: String, publicId: String, systemId: String)Unit" id="95348">startDTD</a><span class="delimiter">(</span><a title="String" id="100666">name</a> : <span title="String">String</span>, <a title="String" id="100667">publicId</a> : <span title="String">String</span>, <a title="String" id="100668">systemId</a> : <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l101"></a><span id="l101">      <a href="#95340" title="(x$1: scales.xml.Prolog)Unit">prolog</a> = <a href="#95340" title="scales.xml.Prolog" id="100683">prolog</a>.<a href="XmlTypes.scala.html#100680" title="scales.xml.Declaration" id="100723">copy</a><span class="delimiter">(</span>dtd = <span title="(x: scales.xml.DTD)Some[scales.xml.DTD]">Some</span><a title="Some[scales.xml.DTD]" id="100721" class="delimiter">(</a><a href="XmlTypes.scala.html#100705" title="(name: String, publicId: String, systemId: String)scales.xml.DTD">DTD</a><span class="delimiter">(</span><a href="#100666" title="String">name</a>, <a href="#100667" title="String">publicId</a>, <a href="#100668" title="String">systemId</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l102"></a><span id="l102">    <span class="delimiter">}</span></span>
<a href="l103"></a><span id="l103"></span>
<a href="l104"></a><span id="l104">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(target: String, data: String)Unit" id="95349">processingInstruction</a><span class="delimiter">(</span><a title="String" id="100726">target</a> : <span title="String">String</span>, <a title="String" id="100727">data</a> : <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l105"></a><span id="l105">      <span class="keyword">val</span> <a title="apply extends java.lang.Object with scales.xml.PI" id="100729">pi</a> = <a href="XmlTypes.scala.html#100731" title="(targeti: String, valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.PI">PI</a><a href="#95327" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="#100726" title="String">target</a>, <a href="#100727" title="String">data</a><span class="delimiter">)</span></span>
<a href="l106"></a><span id="l106">      <a href="#95354" title="(miscItem: scales.xml.package.Misc)Unit">addMisc</a><span class="delimiter">(</span><span title="(b: java.lang.Object with scales.xml.PI)Right[Nothing,java.lang.Object with scales.xml.PI]">Right</span><span class="delimiter">(</span><a href="#100729" title="apply extends java.lang.Object with scales.xml.PI">pi</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l107"></a><span id="l107">    <span class="delimiter">}</span> </span>
<a href="l108"></a><span id="l108"></span>
<a href="l109"></a><span id="l109">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(prefix: String, uri: String)Unit" id="95350">startPrefixMapping</a><span class="delimiter">(</span><a title="String" id="100967">prefix</a>: <span title="String">String</span>, <a title="String" id="100968">uri</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l110"></a><span id="l110">      <a href="#95337" title="(x$1: scala.collection.immutable.Map[String,String])Unit">nsDeclarations</a> <span title="(kv: (String, String))scala.collection.immutable.Map[String,String]">+=</span> <span class="delimiter">(</span><a href="#100967" title="(x: String)ArrowAssoc[String]">prefix</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#100968" title="String">uri</a><span class="delimiter">)</span></span>
<a href="l111"></a><span id="l111">    <span class="delimiter">}</span></span>
<a href="l112"></a><span id="l112"></span>
<a href="l113"></a><span id="l113">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(uri: String, localName: String, qName: String, attributes: org.xml.sax.Attributes)Unit" id="95351">startElement</a><span class="delimiter">(</span><a title="String" id="101357">uri</a>: <span title="String">String</span>,</span>
<a href="l114"></a><span id="l114">      <a title="String" id="101358">localName</a>: <span title="String">String</span>,</span>
<a href="l115"></a><span id="l115">      <a title="String" id="101359">qName</a>: <span title="String">String</span>,</span>
<a href="l116"></a><span id="l116">      <a title="org.xml.sax.Attributes" id="101360">attributes</a>: org.xml.sax.<span title="org.xml.sax.Attributes">Attributes</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l117"></a><span id="l117"></span>
<a href="l118"></a><span id="l118">      <a href="#95346" title="(x$1: Boolean)Unit">inprolog</a> = <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l119"></a><span id="l119"></span>
<a href="l120"></a><span id="l120">      <span class="keyword">var</span> <a title="Int" id="101388">i</a> = <span title="Int(0)" class="int">0</span></span>
<a href="l121"></a><span id="l121">      <span class="keyword">val</span> <a title="Int" id="101389">length</a> = <a href="#101360" title="org.xml.sax.Attributes">attributes</a>.<span title="()Int">getLength</span></span>
<a href="l122"></a><span id="l122">      <span class="keyword">var</span> <a title="scales.utils.ListSet[scales.xml.Attribute]" id="101390">attribs</a> = <a href="XmlTypes.scala.html#10944" title="=&gt; scales.utils.ListSet[scales.xml.Attribute]">emptyAttributes</a></span>
<a href="l123"></a><span id="l123"></span>
<a href="l124"></a><span id="l124">      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#101388" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#101389" title="Int">length</a><span class="delimiter">)</span> <a href="#101392" title="()Unit" class="delimiter">{</a></span>
<a href="l125"></a><span id="l125">        <span class="keyword">val</span> <a title="scales.xml.package.AttributeQName" id="101400">qname</a> = <a href="#10973" title="(uri: String, localName: String, qName: String, strategy: scales.xml.MemoryOptimisationStrategy[Token], token: Token)scales.xml.package.AttributeQName">aqn</a><span class="delimiter">(</span><a href="#101360" title="org.xml.sax.Attributes">attributes</a>.<span title="(x$1: Int)java.lang.String">getURI</span><span class="delimiter">(</span><a href="#101388" title="Int">i</a><span class="delimiter">)</span>, <a href="#101360" title="org.xml.sax.Attributes">attributes</a>.<span title="(x$1: Int)java.lang.String">getLocalName</span><span class="delimiter">(</span><a href="#101388" title="Int">i</a><span class="delimiter">)</span>, <a href="#101360" title="org.xml.sax.Attributes">attributes</a>.<span title="(x$1: Int)java.lang.String">getQName</span><span class="delimiter">(</span><a href="#101388" title="Int">i</a><span class="delimiter">)</span>, <a href="#95465" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>, <a href="#95329" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l126"></a><span id="l126">        <a href="#101390" title="scales.utils.ListSet[scales.xml.Attribute]">attribs</a> = <a href="#101390" title="scales.utils.ListSet[scales.xml.Attribute]">attribs</a> <a href="../utils/ListSet.scala.html#70851" title="(e: scales.xml.Attribute)scales.utils.ListSet[scales.xml.Attribute]">unsafePlus</a> </span>
<a href="l127"></a><span id="l127">	    <a href="#95465" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87867" title="(qname: scales.xml.package.AttributeQName, value: String, token: Token)scales.xml.Attribute">attribute</a><span class="delimiter">(</span><a href="#101400" title="scales.xml.package.AttributeQName">qname</a>, </span>
<a href="l128"></a><span id="l128">			<a href="#101360" title="org.xml.sax.Attributes">attributes</a>.<span title="(x$1: Int)java.lang.String">getValue</span><span class="delimiter">(</span><a href="#101388" title="Int">i</a><span class="delimiter">)</span>, </span>
<a href="l129"></a><span id="l129">			<a href="#95329" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l130"></a><span id="l130"></span>
<a href="l131"></a><span id="l131">        <a href="#101388" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l132"></a><span id="l132">      <span class="delimiter">}</span></span>
<a href="l133"></a><span id="l133">      </span>
<a href="l134"></a><span id="l134">      <span class="comment">// use the current nsMap</span></span>
<a href="l135"></a><span id="l135">      <span class="keyword">val</span> <a title="scales.xml.Elem" id="101391">elem</a> = <a href="#95465" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87871" title="(name: scales.xml.QName, attributes: scales.xml.package.Attributes, namespaces: Map[String,String], token: Token)scales.xml.Elem">elem</a><span class="delimiter">(</span></span>
<a href="l136"></a><span id="l136">	  <a href="#10970" title="(uri: String, localName: String, qName: String, strategy: scales.xml.MemoryOptimisationStrategy[Token], token: Token)scales.xml.QName">eqn</a><span class="delimiter">(</span><a href="#101357" title="String">uri</a>, <a href="#101358" title="String">localName</a>, <a href="#101359" title="String">qName</a>, <a href="#95465" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>, <a href="#95329" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l137"></a><span id="l137">	     , <a href="#101390" title="scales.utils.ListSet[scales.xml.Attribute]">attribs</a>, <a href="#95337" title="=&gt; scala.collection.immutable.Map[String,String]">nsDeclarations</a>, <a href="#95329" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l138"></a><span id="l138"></span>
<a href="l139"></a><span id="l139">      <span class="comment">// reset the map</span></span>
<a href="l140"></a><span id="l140">      <a href="#95337" title="(x$1: scala.collection.immutable.Map[String,String])Unit">nsDeclarations</a> = <a href="XmlTypes.scala.html#10946" title="=&gt; scala.collection.immutable.Map[String,String]">emptyNamespaces</a></span>
<a href="l141"></a><span id="l141"></span>
<a href="l142"></a><span id="l142">      <span class="comment">// give it a fake mutable default to work with</span></span>
<a href="l143"></a><span id="l143">      <a href="#95465" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#88978" title="(stack: scales.xml.TreeProxies, elem: scales.xml.Elem, token: Token)Unit">beginSubTree</a><span class="delimiter">(</span><a href="#95331" title="=&gt; scales.xml.TreeProxies">buf</a>, <a href="#101391" title="scales.xml.Elem">elem</a>, <a href="#95329" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l144"></a><span id="l144">    <span class="delimiter">}</span></span>
<a href="l145"></a><span id="l145"></span>
<a href="l146"></a><span id="l146">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(uri: String, localName: String, qName: String)Unit" id="95352">endElement</a><span class="delimiter">(</span><a title="String" id="101527">uri</a>: <span title="String">String</span>,</span>
<a href="l147"></a><span id="l147">      <a title="String" id="101528">localName</a>: <span title="String">String</span>,</span>
<a href="l148"></a><span id="l148">      <a title="String" id="101529">qName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l149"></a><span id="l149"></span>
<a href="l150"></a><span id="l150">      <span class="comment">// pop it and we are now with the correct parent</span></span>
<a href="l151"></a><span id="l151">      <span class="comment">// let the strategy decide what actually happens</span></span>
<a href="l152"></a><span id="l152">      <a href="#95465" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#88977" title="(xml: scales.xml.TreeProxies, token: Token)Unit">elementEnd</a><span class="delimiter">(</span><a href="#95331" title="=&gt; scales.xml.TreeProxies">buf</a>, <a href="#95329" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l153"></a><span id="l153">    <span class="delimiter">}</span></span>
<a href="l154"></a><span id="l154"></span>
<a href="l155"></a><span id="l155">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ch: Array[Char], offset: Int, length: Int)Unit" id="95353">comment</a><span class="delimiter">(</span><a title="Array[Char]" id="101534">ch</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span>, <a title="Int" id="101535">offset</a>: <span title="Int">Int</span>, <a title="Int" id="101536">length</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span></span>
<a href="l156"></a><span id="l156">      <span class="keyword">val</span> <a title="java.lang.String" id="101538">text</a> = <span title="(x$1: Array[Char], x$2: Int, x$3: Int)java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#101534" title="Array[Char]">ch</a>, <a href="#101535" title="Int">offset</a>, <a href="#101536" title="Int">length</a><span class="delimiter">)</span></span>
<a href="l157"></a><span id="l157"></span>
<a href="l158"></a><span id="l158">      <a href="#95354" title="(miscItem: scales.xml.package.Misc)Unit">addMisc</a><span class="delimiter">(</span> <span title="(a: java.lang.Object with scales.xml.Comment)Left[java.lang.Object with scales.xml.Comment,Nothing]">Left</span><span class="delimiter">(</span><a href="XmlTypes.scala.html#101550" title="(valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.Comment">Comment</a><a href="#95327" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="#101538" title="java.lang.String">text</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">)</span>      </span>
<a href="l159"></a><span id="l159">    <span class="delimiter">}</span></span>
<a href="l160"></a><span id="l160"></span>
<a href="l161"></a><span id="l161">    <span class="keyword">def</span> <a title="(miscItem: scales.xml.package.Misc)Unit" id="95354">addMisc</a><span class="delimiter">(</span> <a title="scales.xml.package.Misc" id="100959">miscItem</a> : <span title="scales.xml.package.Misc">Misc</span> <span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l162"></a><span id="l162">      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95346" title="=&gt; Boolean">inprolog</a><span class="delimiter">)</span> </span>
<a href="l163"></a><span id="l163">	<a href="#95340" title="(x$1: scales.xml.Prolog)Unit">prolog</a> = <a href="#95340" title="scales.xml.Prolog" id="101644">prolog</a>.<a href="XmlTypes.scala.html#100680" title="scales.xml.Declaration" id="101720">copy</a><span class="delimiter">(</span>misc = <a href="#95340" title="=&gt; scales.xml.Prolog">prolog</a>.<a href="XmlTypes.scala.html#95526" title="=&gt; scales.xml.package.Miscs">misc</a> <a title="scales.xml.package.Miscs" id="101718">:+</a> <a href="#100959" title="scales.xml.package.Misc">miscItem</a><span class="delimiter">)</span></span>
<a href="l164"></a><span id="l164">      <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l165"></a><span id="l165">	<span class="comment">// need to tell if its finished the root elem or not</span></span>
<a href="l166"></a><span id="l166">	<span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95331" title="=&gt; scales.xml.TreeProxies">buf</a>.<a href="#95481" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span></span>
<a href="l167"></a><span id="l167">	  <a href="#95343" title="(x$1: scales.xml.EndMisc)Unit">end</a> = <a href="#95343" title="=&gt; scales.xml.EndMisc">end</a>.<a href="XmlTypes.scala.html#95560" title="(misc: scales.xml.package.Miscs)scales.xml.EndMisc">copy</a><span class="delimiter">(</span> misc = <a href="#95343" title="=&gt; scales.xml.EndMisc">end</a>.<a href="XmlTypes.scala.html#95557" title="=&gt; scales.xml.package.Miscs">misc</a> <span title="(elem: scales.xml.package.Misc)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[scales.xml.package.Misc],scales.xml.package.Misc,scales.xml.package.Miscs])scales.xml.package.Miscs">:+</span> <a href="#100959" title="scales.xml.package.Misc">miscItem</a><span class="delimiter">)</span></span>
<a href="l168"></a><span id="l168">	<span class="keyword">else</span></span>
<a href="l169"></a><span id="l169">	  <span class="comment">// add it like a normal child</span></span>
<a href="l170"></a><span id="l170">	  <a href="#95331" title="=&gt; scales.xml.TreeProxies">buf</a>.<a href="#89003" title="(i: scales.xml.XmlItem)Unit">addChild</a><span class="delimiter">(</span> <a href="#100959" title="scales.xml.package.Misc">miscItem</a>.<span title="[X](fa: (scales.xml.Comment) =&gt; X, fb: (scales.xml.PI) =&gt; X)X">fold</span><span title="(fa: (scales.xml.Comment) =&gt; scales.xml.XmlItem, fb: (scales.xml.PI) =&gt; scales.xml.XmlItem)scales.xml.XmlItem" class="delimiter">[</span><a href="XmlTypes.scala.html#10562" title="scales.xml.XmlItem">XmlItem</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.Comment" id="101792">x</a>=&gt;<a href="#101792" title="scales.xml.Comment">x</a>, <a title="scales.xml.PI" id="101794">y</a>=&gt;<a href="#101794" title="scales.xml.PI">y</a><span class="delimiter">)</span><span class="delimiter">)</span> </span>
<a href="l171"></a><span id="l171">      <span class="delimiter">}</span></span>
<a href="l172"></a><span id="l172">    <span class="delimiter">}</span></span>
<a href="l173"></a><span id="l173"></span>
<a href="l174"></a><span id="l174">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ch: Array[Char], offset: Int, length: Int)Unit" id="95355">characters</a><span class="delimiter">(</span><a title="Array[Char]" id="101797">ch</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span>, <a title="Int" id="101798">offset</a>: <span title="Int">Int</span>, <a title="Int" id="101799">length</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span></span>
<a href="l175"></a><span id="l175">      <span class="keyword">val</span> <a title="java.lang.String" id="101801">text</a> = <span title="(x$1: Array[Char], x$2: Int, x$3: Int)java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#101797" title="Array[Char]">ch</a>, <a href="#101798" title="Int">offset</a>, <a href="#101799" title="Int">length</a><span class="delimiter">)</span></span>
<a href="l176"></a><span id="l176"></span>
<a href="l177"></a><span id="l177">      <span class="keyword">val</span> <a title="scales.xml.XmlItem" id="101802">child</a>: <a href="XmlTypes.scala.html#10562" title="scales.xml.XmlItem">XmlItem</a> = <span title="scales.xml.XmlItem" class="keyword">if</span> <span class="delimiter">(</span><a href="#95334" title="=&gt; Boolean">isCData</a><span class="delimiter">)</span> <a href="XmlTypes.scala.html#101811" title="(valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.CData">CData</a><a href="#95327" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="#101801" title="java.lang.String">text</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="XmlTypes.scala.html#99361" title="(value: String)scales.xml.Text">Text</a><span class="delimiter">(</span><a href="#101801" title="java.lang.String">text</a><span class="delimiter">)</span></span>
<a href="l178"></a><span id="l178"></span>
<a href="l179"></a><span id="l179">      <span class="comment">// append as child</span></span>
<a href="l180"></a><span id="l180">      <a href="#95331" title="=&gt; scales.xml.TreeProxies">buf</a>.<a href="#89003" title="(i: scales.xml.XmlItem)Unit">addChild</a><span class="delimiter">(</span><a href="#101802" title="scales.xml.XmlItem">child</a><span class="delimiter">)</span></span>
<a href="l181"></a><span id="l181">    <span class="delimiter">}</span></span>
<a href="l182"></a><span id="l182"></span>
<a href="l183"></a><span id="l183">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="95356">startCDATA</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#95334" title="(x$1: Boolean)Unit">isCData</a> = <span title="Boolean(true)" class="keyword">true</span>; <span class="delimiter">}</span></span>
<a href="l184"></a><span id="l184">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="95357">endCDATA</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#95334" title="(x$1: Boolean)Unit">isCData</a> = <span title="Boolean(false)" class="keyword">false</span>; <span class="delimiter">}</span></span>
<a href="l185"></a><span id="l185"></span>
<a href="l186"></a><span id="l186">  <span class="delimiter">}</span></span>
<a href="l187"></a><span id="l187"></span>
<a href="l188"></a><span id="l188"><span class="delimiter">}</span></span>
<a href="l189"></a><span id="l189"></span>
<a href="l190"></a><span id="l190"><span class="keyword">class</span> <a title="class TreeProxy extends java.lang.Object with ScalaObject" id="10443">TreeProxy</a><a href="#10443" title="ScalaObject" class="delimiter">(</a> <span class="keyword">var</span> <a title="scales.xml.Elem" id="101918">elem</a> : <a href="XmlTypes.scala.html#10558" title="scales.xml.Elem">Elem</a>, <span class="keyword">var</span> <a title="scales.xml.package.XmlChildren" id="101919">children</a> : <a href="../utils/ImmutableArray.scala.html#8932" title="scales.xml.package.XmlChildren">XmlChildren</a><span class="delimiter">)</span></span>
<a href="l191"></a><span id="l191"></span>
<a href="l192"></a><span id="l192"><span class="keyword">import</span> scala.collection.mutable.ArrayBuffer</span>
<a href="l193"></a><span id="l193"></span>
<a href="l194"></a><span id="l194"><span class="comment">/**</span>
<a href="l195"></a><span id="l195"> * Mutable list that keeps the item creation to a minimum, no extra garbage here until the parse is done...</span>
<a href="l196"></a><span id="l196"> */</span> </span>
<a href="l197"></a><span id="l197"><span class="keyword">class</span> <a title="class TreeProxies extends java.lang.Object with ScalaObject" id="10446">TreeProxies</a><a href="#10446" title="ScalaObject" class="delimiter">(</a> <span class="keyword">var</span> <a title="Int" id="95481">depth</a> : <span title="Int">Int</span> = -<span title="Int(-1)" class="int">1</span>, <span class="keyword">var</span> <a title="scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]" id="95482">proxies</a> : <span title="scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]">ArrayBuffer</span><span class="delimiter">[</span>TreeProxy<span class="delimiter">]</span> = <span title="[A](elems: A*)scala.collection.mutable.ArrayBuffer[A]">ArrayBuffer</span><span title="(elems: scales.xml.TreeProxy*)scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]" class="delimiter">[</span><a href="#10443" title="scales.xml.TreeProxy">TreeProxy</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">{</span></span>
<a href="l198"></a><span id="l198">  <span class="keyword">import</span> <a href="ScalesXml.scala.html#10381" title="object scales.xml.ScalesXml">ScalesXml</a>.xmlCBF</span>
<a href="l199"></a><span id="l199"></span>
<a href="l200"></a><span id="l200">  <span class="keyword">var</span> <a title="Int" id="88998">size</a> = <a href="#95482" title="=&gt; scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]">proxies</a>.<span title="=&gt; Int">length</span></span>
<a href="l201"></a><span id="l201"></span>
<a href="l202"></a><span id="l202">  <span class="keyword">var</span> <a title="scales.xml.TreeProxy" id="89001">current</a> : <a href="#10443" title="scales.xml.TreeProxy">TreeProxy</a> = _</span>
<a href="l203"></a><span id="l203"></span>
<a href="l204"></a><span id="l204">  <span class="keyword">def</span> <a title="(i: scales.xml.XmlItem)Unit" id="89003">addChild</a><span class="delimiter">(</span> <a title="scales.xml.XmlItem" id="101785">i</a> : <a href="XmlTypes.scala.html#10562" title="scales.xml.XmlItem">XmlItem</a> <span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l205"></a><span id="l205">    <span class="comment">//println(&quot;proxies addChild &quot;+depth)</span></span>
<a href="l206"></a><span id="l206">    <a href="#89001" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#101919" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <span class="delimiter">(</span><a href="#89001" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#101919" title="=&gt; scales.xml.package.XmlChildren">children</a> <a href="XmlTypes.scala.html#87898" title="(elem: scales.xml.package.ItemOrElem)(implicit bf: scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[scales.xml.package.ItemOrElem],scales.xml.package.ItemOrElem,scales.xml.package.XmlChildren])scales.xml.package.XmlChildren">:+</a> <a href="#101785" title="scales.xml.XmlItem">i</a><span class="delimiter">)</span></span>
<a href="l207"></a><span id="l207">  <span class="delimiter">}</span></span>
<a href="l208"></a><span id="l208"></span>
<a href="l209"></a><span id="l209">  <span class="keyword">def</span> <a title="()Unit" id="89004">elementEnd</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l210"></a><span id="l210">    <span class="keyword">val</span> <a title="scales.xml.TreeProxy" id="101966">l</a> = <a href="#89001" title="=&gt; scales.xml.TreeProxy">current</a></span>
<a href="l211"></a><span id="l211">    <span class="comment">//println(&quot;proxies elementend &quot;+depth)</span></span>
<a href="l212"></a><span id="l212">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95481" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l213"></a><span id="l213">      <a href="#95481" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l214"></a><span id="l214">      <a href="#89001" title="(x$1: scales.xml.TreeProxy)Unit">current</a> = <a href="#95482" title="(idx: Int)scales.xml.TreeProxy">proxies</a><span class="delimiter">(</span> <a href="#95481" title="=&gt; Int">depth</a> <span class="delimiter">)</span></span>
<a href="l215"></a><span id="l215">      <a href="#89001" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#101919" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <span class="delimiter">(</span><a href="#89001" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#101919" title="=&gt; scales.xml.package.XmlChildren">children</a> <a href="XmlTypes.scala.html#87898" title="(elem: scales.xml.package.ItemOrElem)(implicit bf: scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[scales.xml.package.ItemOrElem],scales.xml.package.ItemOrElem,scales.xml.package.XmlChildren])scales.xml.package.XmlChildren">:+</a> <a href="../utils/Trees.scala.html#79610" title="(section: scales.xml.Elem, children: scales.xml.package.XCC[scales.utils.package.ItemOrTree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]])scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">Tree</a><span class="delimiter">(</span><a href="#101966" title="scales.xml.TreeProxy">l</a>.<a href="#101918" title="=&gt; scales.xml.Elem">elem</a>, <a href="#101966" title="scales.xml.TreeProxy">l</a>.<a href="#101919" title="=&gt; scales.xml.package.XmlChildren">children</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l216"></a><span id="l216">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l217"></a><span id="l217">      <a href="#95481" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l218"></a><span id="l218">    <span class="delimiter">}</span></span>
<a href="l219"></a><span id="l219">  <span class="delimiter">}</span></span>
<a href="l220"></a><span id="l220"></span>
<a href="l221"></a><span id="l221">  <span class="keyword">def</span> <a title="(elem: scales.xml.Elem, children: scales.xml.package.XmlChildren)Unit" id="89005">beginSub</a><span class="delimiter">(</span> <a title="scales.xml.Elem" id="89013">elem</a> : <a href="XmlTypes.scala.html#10558" title="scales.xml.Elem">Elem</a>, <a title="scales.xml.package.XmlChildren" id="89016">children</a> : <a href="../utils/ImmutableArray.scala.html#8932" title="scales.xml.package.XmlChildren">XmlChildren</a> = <a href="XmlTypes.scala.html#10952" title="=&gt; scales.utils.ImmutableArrayProxy[scales.utils.EitherLike[scales.xml.XmlItem,scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,[T]scales.utils.ImmutableArrayProxy[T]]]]">emptyChildren</a> <span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l222"></a><span id="l222">    <span class="comment">//println(&quot;proxies beginSub &quot;+depth)</span></span>
<a href="l223"></a><span id="l223">    <a href="#95481" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l224"></a><span id="l224">    </span>
<a href="l225"></a><span id="l225">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95481" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">==</span> <a href="#88998" title="=&gt; Int">size</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l226"></a><span id="l226">      <a href="#89001" title="(x$1: scales.xml.TreeProxy)Unit">current</a> = <span title="scales.xml.TreeProxy" class="keyword">new</span> <a href="#10443" title="scales.xml.TreeProxy">TreeProxy</a><span class="delimiter">(</span><a href="#89013" title="scales.xml.Elem">elem</a>, <a href="#89016" title="scales.xml.package.XmlChildren">children</a><span class="delimiter">)</span></span>
<a href="l227"></a><span id="l227">      <a href="#95482" title="=&gt; scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]">proxies</a> <span title="(elem: scales.xml.TreeProxy)scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]">+=</span> <span class="delimiter">(</span><a href="#89001" title="=&gt; scales.xml.TreeProxy">current</a><span class="delimiter">)</span></span>
<a href="l228"></a><span id="l228">      <a href="#88998" title="(x$1: Int)Unit">size</a> <span title="(x: Int)Int">+=</span><span title="Int(1)" class="int">1</span></span>
<a href="l229"></a><span id="l229">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l230"></a><span id="l230">      <a href="#89001" title="(x$1: scales.xml.TreeProxy)Unit">current</a> = <a href="#95482" title="(idx: Int)scales.xml.TreeProxy">proxies</a><span class="delimiter">(</span><a href="#95481" title="=&gt; Int">depth</a><span class="delimiter">)</span></span>
<a href="l231"></a><span id="l231">      <a href="#89001" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#101918" title="(x$1: scales.xml.Elem)Unit">elem</a> = <a href="#89013" title="scales.xml.Elem">elem</a> </span>
<a href="l232"></a><span id="l232">      <a href="#89001" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#101919" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <a href="#89016" title="scales.xml.package.XmlChildren">children</a></span>
<a href="l233"></a><span id="l233">    <span class="delimiter">}</span></span>
<a href="l234"></a><span id="l234">  <span class="delimiter">}</span></span>
<a href="l235"></a><span id="l235"></span>
<a href="l236"></a><span id="l236">  <span class="comment">/**</span>
<a href="l237"></a><span id="l237">   * Only call when its the end of the parse</span>
<a href="l238"></a><span id="l238">   */</span> </span>
<a href="l239"></a><span id="l239">  <span class="keyword">def</span> <a title="=&gt; scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]" id="89006">tree</a> = <span class="delimiter">{</span></span>
<a href="l240"></a><span id="l240">    <span class="keyword">val</span> <a title="scales.xml.TreeProxy" id="100351">tp</a> = <a href="#95482" title="(idx: Int)scales.xml.TreeProxy">proxies</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span></span>
<a href="l241"></a><span id="l241"></span>
<a href="l242"></a><span id="l242">    <a href="../utils/Trees.scala.html#79610" title="(section: scales.xml.Elem, children: scales.xml.package.XCC[scales.utils.package.ItemOrTree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]])scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">Tree</a><span class="delimiter">(</span><a href="#100351" title="scales.xml.TreeProxy">tp</a>.<a href="#101918" title="=&gt; scales.xml.Elem">elem</a>, <a href="#100351" title="scales.xml.TreeProxy">tp</a>.<a href="#101919" title="=&gt; scales.xml.package.XmlChildren">children</a><span class="delimiter">)</span></span>
<a href="l243"></a><span id="l243">  <span class="delimiter">}</span></span>
<a href="l244"></a><span id="l244"><span class="delimiter">}</span></span>
<a href="l245"></a><span id="l245"></span>
<a href="l246"></a><span id="l246">        </span>
</pre>
    </body>
</html>