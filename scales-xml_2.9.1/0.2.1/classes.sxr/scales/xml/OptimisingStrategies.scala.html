<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scales\xml\OptimisingStrategies.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    
<style id="linesStyle">
.lineHighlight {
  background-color: #a5a5a5;
}
</style>
<script type="text/javascript">
function selectedLine() {
    var loca = /^.*#l(.*)/.exec(location.href);
    return loca ? loca[1] : '0';
}

function highlightLine(ln){
  $('#l'+ln).toggleClass('lineHighlight');
}

function gotoLine(ln){
  $('#l'+ln).focus();
}

$(function(){
  var line = selectedLine();
  if (line != '0') highlightLine(line)
});
</script></head>
    <body>
        <pre>
<!-- SXR_LINES --><a href="l1"></a><span id="l1"><span class="keyword">package</span> scales.xml <span class="delimiter">{</span></span>
<a href="l2"></a><span id="l2"></span>
<a href="l3"></a><span id="l3"><span class="keyword">import</span> scales.utils._</span>
<a href="l4"></a><span id="l4"></span>
<a href="l5"></a><span id="l5"><span class="keyword">trait</span> <a title="trait OptimisingStrategiesImplicits extends java.lang.Object" id="10672">OptimisingStrategiesImplicits</a> <span title="java.lang.Object" class="delimiter">{</span></span>
<a href="l6"></a><span id="l6"><span class="comment">//  implicit val defaultPathOptimisation : PathOptimisationStrategy = NoOptimisation</span></span>
<a href="l7"></a><span id="l7"><span class="comment">//  implicit val defaultOptimisation : MemoryOptimisationStrategy = NoOptimisation</span></span>
<a href="l8"></a><span id="l8"></span>
<a href="l9"></a><span id="l9"><span class="delimiter">}</span></span>
<a href="l10"></a><span id="l10"></span>
<a href="l11"></a><span id="l11"><span class="comment">/**</span>
<a href="l12"></a><span id="l12"> * Simple marker for per parse optimisation oppurtunties</span>
<a href="l13"></a><span id="l13"> */</span></span>
<a href="l14"></a><span id="l14"><span class="keyword">trait</span> <a title="trait OptimisationToken extends java.lang.Object" id="10673">OptimisationToken</a> <span title="java.lang.Object" class="delimiter">{</span></span>
<a href="l15"></a><span id="l15">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="=&gt; scales.xml.XmlVersion" id="87763">ver</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a></span>
<a href="l16"></a><span id="l16">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="=&gt; scales.xml.FromParser" id="87764">fromParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a></span>
<a href="l17"></a><span id="l17"><span class="delimiter">}</span></span>
<a href="l18"></a><span id="l18"></span>
<a href="l19"></a><span id="l19"><span class="keyword">class</span> <a title="class BaseToken extends java.lang.Object with scales.xml.OptimisationToken with ScalaObject" id="10674">BaseToken</a><a href="#10674" title="ScalaObject" class="delimiter">(</a><span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.XmlVersion" id="87777">ver</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a>, <span class="keyword">val</span> <a title="scales.xml.FromParser" id="87778">fromParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#10673" title="scales.xml.OptimisationToken">OptimisationToken</a></span>
<a href="l20"></a><span id="l20"></span>
<a href="l21"></a><span id="l21"><span class="comment">/**</span>
<a href="l22"></a><span id="l22"> * Memory usage in DOMs is often dominated by repeated elements.  Xerces and co use string tables to optimise memory usage, with DTM a key example.</span>
<a href="l23"></a><span id="l23"> *</span>
<a href="l24"></a><span id="l24"> * Performing lookups is expensive so the strategys have selective levels of lookup.  Developers may therefore choose appropriate levels that best fit their trade-off between space and time.</span>
<a href="l25"></a><span id="l25"> *</span>
<a href="l26"></a><span id="l26"> * There will, of course, be temporary garbage created for such a scheme but it should pay off for larger messages.</span>
<a href="l27"></a><span id="l27"> *</span>
<a href="l28"></a><span id="l28"> */</span> </span>
<a href="l29"></a><span id="l29"><span class="keyword">trait</span> <a title="trait MemoryOptimisationStrategy[Token &lt;: scales.xml.OptimisationToken] extends java.lang.Object with ScalaObject" id="10675">MemoryOptimisationStrategy</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="10676">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l30"></a><span id="l30"></span>
<a href="l31"></a><span id="l31">  <span class="keyword">def</span> <a title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)Token" id="87780">createToken</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="87788">ver</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a>, <a title="scales.xml.FromParser" id="87789">fromParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a><span class="delimiter">)</span> : <a href="#10676" title="Token">Token</a></span>
<a href="l32"></a><span id="l32"></span>
<a href="l33"></a><span id="l33"><span class="comment">//  def createToken(implicit ver : XmlVersion, fromParser : FromParser) : Token = new BaseToken()</span></span>
<a href="l34"></a><span id="l34"></span>
<a href="l35"></a><span id="l35">  <span class="comment">/**</span>
<a href="l36"></a><span id="l36">   * It is expected that certain attributes have fixed values, ie. booleans or based on schema enums etc, this function allows such optimisations.</span>
<a href="l37"></a><span id="l37">   *</span>
<a href="l38"></a><span id="l38">   * The qname will have been obtained via qName, so any optimisations provided by it can be leveraged.</span>
<a href="l39"></a><span id="l39">   *</span>
<a href="l40"></a><span id="l40">   */</span> </span>
<a href="l41"></a><span id="l41">  <span class="keyword">def</span> <a title="(qname: scales.xml.package.AttributeQName, value: String, token: Token)scales.xml.Attribute" id="87781">attribute</a><span class="delimiter">(</span> <a title="scales.xml.package.AttributeQName" id="87791">qname</a> : <a href="../utils/EitherLike.scala.html#10328" title="scales.xml.package.AttributeQName">AttributeQName</a>, <a title="String" id="87792">value</a> : <span title="String">String</span>, <a title="Token" id="87793">token</a> : <a href="#10676" title="Token">Token</a><span class="delimiter">)</span> : <a href="XmlTypes.scala.html#11986" title="scales.xml.Attribute">Attribute</a> = <a href="XmlTypes.scala.html#87913" title="(name: scales.xml.package.AttributeQName, value: String)scales.xml.Attribute">Attribute</a><span class="delimiter">(</span><a href="#87791" title="scales.xml.package.AttributeQName">qname</a>,<a href="#87792" title="String">value</a><span class="delimiter">)</span></span>
<a href="l42"></a><span id="l42"></span>
<a href="l43"></a><span id="l43">  <span class="comment">/**</span>
<a href="l44"></a><span id="l44">   * The creation costs can also be reduced</span>
<a href="l45"></a><span id="l45">   */</span> </span>
<a href="l46"></a><span id="l46">  <span class="keyword">def</span> <a title="(local: String, token: Token)scales.xml.NoNamespaceQName" id="87782">noNamespaceQName</a><span class="delimiter">(</span> <a title="String" id="87922">local</a> : <span title="String">String</span>, <a title="Token" id="87923">token</a> : <a href="#10676" title="Token">Token</a><span class="delimiter">)</span> : <a href="QName.scala.html#11799" title="scales.xml.NoNamespaceQName">NoNamespaceQName</a> = <span class="delimiter">{</span></span>
<a href="l47"></a><span id="l47">    <span class="keyword">import</span> <a href="#87923" title="Token">token</a>._</span>
<a href="l48"></a><span id="l48">    <a href="QName.scala.html#87954" title="(locali: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.NoNamespaceQName">NoNamespaceQName</a><a href="#87763" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#87922" title="String">local</a><span class="delimiter">)</span></span>
<a href="l49"></a><span id="l49">  <span class="delimiter">}</span></span>
<a href="l50"></a><span id="l50"></span>
<a href="l51"></a><span id="l51">  <span class="keyword">def</span> <a title="(local: String, uri: String, token: Token)scales.xml.UnprefixedQName" id="87783">unprefixedQName</a><span class="delimiter">(</span> <a title="String" id="88250">local</a> : <span title="String">String</span>, <a title="String" id="88251">uri</a> : <span title="String">String</span>, <a title="Token" id="88252">token</a> : <a href="#10676" title="Token">Token</a><span class="delimiter">)</span> : <a href="QName.scala.html#11805" title="scales.xml.UnprefixedQName">UnprefixedQName</a> =  <span class="delimiter">{</span></span>
<a href="l52"></a><span id="l52">    <span class="keyword">import</span> <a href="#88252" title="Token">token</a>._</span>
<a href="l53"></a><span id="l53">    <a href="QName.scala.html#88259" title="(locali: String, namespacei: scales.xml.Namespace)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.UnprefixedQName">UnprefixedQName</a><a href="#87763" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88250" title="String">local</a>, <a href="QName.scala.html#88304" title="(validUri: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)scales.xml.Namespace">Namespace</a><a href="#87763" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88251" title="String">uri</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l54"></a><span id="l54">  <span class="delimiter">}</span></span>
<a href="l55"></a><span id="l55"></span>
<a href="l56"></a><span id="l56">  <span class="keyword">def</span> <a title="(local: String, uri: String, prefix: String, token: Token)scales.xml.PrefixedQName" id="87784">prefixedQName</a><span class="delimiter">(</span> <a title="String" id="88310">local</a> : <span title="String">String</span>, <a title="String" id="88311">uri</a> : <span title="String">String</span>, <a title="String" id="88312">prefix</a> : <span title="String">String</span>, <a title="Token" id="88313">token</a> : <a href="#10676" title="Token">Token</a><span class="delimiter">)</span> : <a href="QName.scala.html#11802" title="scales.xml.PrefixedQName">PrefixedQName</a> =  <span class="delimiter">{</span></span>
<a href="l57"></a><span id="l57">    <span class="keyword">import</span> <a href="#88313" title="Token">token</a>._</span>
<a href="l58"></a><span id="l58">    <a href="QName.scala.html#88317" title="(locali: String, prefixedNamespace: scales.xml.PrefixedNamespace)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.PrefixedQName{final val prefix: Some[String]}">PrefixedQName</a><a href="#87763" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88310" title="String">local</a>, <a href="QName.scala.html#88304" title="(validUri: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)scales.xml.Namespace">Namespace</a><a href="#87763" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88311" title="String">uri</a><span class="delimiter">)</span>.<a href="QName.scala.html#88278" title="(prefix: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)scales.xml.PrefixedNamespace">prefixed</a><a href="#87763" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88312" title="String">prefix</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l59"></a><span id="l59">  <span class="delimiter">}</span></span>
<a href="l60"></a><span id="l60"></span>
<a href="l61"></a><span id="l61">  <span class="comment">/**</span>
<a href="l62"></a><span id="l62">   * For files without large (and varied) attribute counts per repeated element it may represent significant space savings to optimise against the entire Elem itself.</span>
<a href="l63"></a><span id="l63">   *</span>
<a href="l64"></a><span id="l64">   * The Elements QName is garaunteed to be the last QName evaluated via the QName functions (i.e. Attributes are done first then the Elems QName)  </span>
<a href="l65"></a><span id="l65">   */</span> </span>
<a href="l66"></a><span id="l66">  <span class="keyword">def</span> <a title="(name: scales.xml.QName, attributes: scales.xml.package.Attributes, namespaces: Map[String,String], token: Token)scales.xml.Elem" id="87785">elem</a><span class="delimiter">(</span> <a title="scales.xml.QName" id="88389">name</a> : <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="scales.xml.package.Attributes" id="88390">attributes</a> : <a href="../utils/ListSet.scala.html#10456" title="scales.xml.package.Attributes">Attributes</a>, <a title="Map[String,String]" id="88391">namespaces</a> : <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Token" id="88392">token</a> : <a href="#10676" title="Token">Token</a><span class="delimiter">)</span> : <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a> =  <span class="delimiter">{</span></span>
<a href="l67"></a><span id="l67">    <span class="keyword">import</span> <a href="#88392" title="Token">token</a>._</span>
<a href="l68"></a><span id="l68">    <a href="XmlTypes.scala.html#88403" title="(namei: scales.xml.QName, attributesi: scales.xml.package.Attributes, namespacesi: scala.collection.immutable.Map[String,String])(implicit fromParser: scales.xml.FromParser)scales.xml.Elem">Elem</a><a href="#87764" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="#88389" title="scales.xml.QName">name</a>, <a href="#88390" title="scales.xml.package.Attributes">attributes</a>, <a href="#88391" title="Map[String,String]">namespaces</a><span class="delimiter">)</span></span>
<a href="l69"></a><span id="l69">  <span class="delimiter">}</span></span>
<a href="l70"></a><span id="l70"><span class="delimiter">}</span></span>
<a href="l71"></a><span id="l71"></span>
<a href="l72"></a><span id="l72"><span class="keyword">trait</span> <a title="trait BaseTokenF extends java.lang.Object with ScalaObject" id="10677">BaseTokenF</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l73"></a><span id="l73"></span>
<a href="l74"></a><span id="l74">  <span class="keyword">def</span> <a title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)scales.xml.BaseToken" id="88829">createToken</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="88832">ver</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a>, <a title="scales.xml.FromParser" id="88833">fromParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a><span class="delimiter">)</span> : <a href="#10674" title="scales.xml.BaseToken">BaseToken</a> = <a href="#88832" title="scales.xml.BaseToken" class="keyword">new</a> <a href="#10674" title="scales.xml.BaseToken">BaseToken</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l75"></a><span id="l75"></span>
<a href="l76"></a><span id="l76"><span class="delimiter">}</span></span>
<a href="l77"></a><span id="l77"></span>
<a href="l78"></a><span id="l78"><span class="comment">/**</span>
<a href="l79"></a><span id="l79"> * Default optimisation strategy, performing no optimisation at all</span>
<a href="l80"></a><span id="l80"> */</span> </span>
<a href="l81"></a><span id="l81"><span class="keyword">object</span> <a title="object scales.xml.NoOptimisation" id="10678">NoOptimisation</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10680" title="scales.xml.PathOptimisationStrategy[scales.xml.BaseToken]">PathOptimisationStrategy</a><span class="delimiter">[</span>BaseToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10677" title="scales.xml.BaseTokenF">BaseTokenF</a></span>
<a href="l82"></a><span id="l82"></span>
<a href="l83"></a><span id="l83"><span class="comment">/**</span>
<a href="l84"></a><span id="l84"> * Certain paths may be repeated (based on QNames of parents etc) and known to be by the developer, its also possible that the developer simply is not interested in this path.</span>
<a href="l85"></a><span id="l85"> *</span>
<a href="l86"></a><span id="l86"> * Developers may also customise the creation of paths (for example adding starting children or replacing the XmlChildren implementation.</span>
<a href="l87"></a><span id="l87"> */</span></span>
<a href="l88"></a><span id="l88"><span class="keyword">trait</span> <a title="trait PathOptimisationStrategy[Token &lt;: scales.xml.OptimisationToken] extends java.lang.Object with scales.xml.MemoryOptimisationStrategy[Token] with ScalaObject" id="10680">PathOptimisationStrategy</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="10681">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="#10675" title="scales.xml.MemoryOptimisationStrategy[Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l89"></a><span id="l89">  </span>
<a href="l90"></a><span id="l90">  <span class="comment">/**</span>
<a href="l91"></a><span id="l91">   * Any elementEnd implementation must perform either an xml.zipUp</span>
<a href="l92"></a><span id="l92">   * or removeAndUp.  The default performs a zipUp</span>
<a href="l93"></a><span id="l93">   */</span> </span>
<a href="l94"></a><span id="l94">  <span class="keyword">def</span> <a title="(xml: scales.xml.TreeProxies, token: Token)Unit" id="88836">elementEnd</a><span class="delimiter">(</span> <a title="scales.xml.TreeProxies" id="88842">xml</a> : <a href="XmlParser.scala.html#11877" title="scales.xml.TreeProxies">TreeProxies</a>, <a title="Token" id="88843">token</a> : <a href="#10681" title="Token">Token</a><span class="delimiter">)</span>  </span>
<a href="l95"></a><span id="l95"><span class="comment">//    : XmlPath = xml.zipUp </span></span>
<a href="l96"></a><span id="l96">    <span class="delimiter">{</span></span>
<a href="l97"></a><span id="l97">      <a href="#88842" title="scales.xml.TreeProxies">xml</a>.<a href="XmlParser.scala.html#88862" title="()Unit">elementEnd</a></span>
<a href="l98"></a><span id="l98">    <span class="delimiter">}</span></span>
<a href="l99"></a><span id="l99"></span>
<a href="l100"></a><span id="l100">  <span class="comment">/**</span>
<a href="l101"></a><span id="l101">   * Start a new tree, defaults to addAndFocus.</span>
<a href="l102"></a><span id="l102">   */</span> </span>
<a href="l103"></a><span id="l103">  <span class="keyword">def</span> <a title="(stack: scales.xml.TreeProxies, elem: scales.xml.Elem, token: Token)Unit" id="88837">beginSubTree</a><span class="delimiter">(</span> <a title="scales.xml.TreeProxies" id="88866">stack</a> : <a href="XmlParser.scala.html#11877" title="scales.xml.TreeProxies">TreeProxies</a>, <a title="scales.xml.Elem" id="88867">elem</a> : <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a>, <a title="Token" id="88868">token</a> : <a href="#10681" title="Token">Token</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l104"></a><span id="l104">    <a href="#88866" title="scales.xml.TreeProxies">stack</a>.<a href="XmlParser.scala.html#88863" title="(elem: scales.xml.Elem, children: scales.xml.package.XmlChildren)Unit">beginSub</a><span class="delimiter">(</span><a href="#88867" title="scales.xml.Elem">elem</a><span class="delimiter">)</span></span>
<a href="l105"></a><span id="l105">  <span class="delimiter">}</span></span>
<a href="l106"></a><span id="l106"><span class="delimiter">}</span></span>
<a href="l107"></a><span id="l107"></span>
<a href="l108"></a><span id="l108"><span class="keyword">class</span> <a title="class QNameToken extends java.lang.Object with scales.xml.OptimisationToken with ScalaObject" id="10682">QNameToken</a><a href="#10682" title="ScalaObject" class="delimiter">(</a><span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.XmlVersion" id="88926">ver</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a>, <span class="keyword">val</span> <a title="scales.xml.FromParser" id="88927">fromParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#10673" title="scales.xml.OptimisationToken">OptimisationToken</a> <span class="delimiter">{</span></span>
<a href="l109"></a><span id="l109">  <span class="keyword">val</span> <a title="scales.xml.FullEqualQNameKey" id="88883">qkey</a> = <span title="scales.xml.FullEqualQNameKey" class="keyword">new</span> <a href="QName.scala.html#11798" title="scales.xml.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l110"></a><span id="l110"></span>
<a href="l111"></a><span id="l111">  <span class="comment">// the following reduce init costs was 6% of garbage and 3% of runtime on avg</span></span>
<a href="l112"></a><span id="l112"></span>
<a href="l113"></a><span id="l113">  <span class="keyword">val</span> <a title="scales.xml.FullEqualQNameKey =&gt; java.lang.Object with scales.xml.NoNamespaceQName" id="88885">noNsQ</a> = <span class="delimiter">(</span>k : <a href="QName.scala.html#11798" title="scales.xml.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">)</span> =&gt; <a href="QName.scala.html#87954" title="(locali: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.NoNamespaceQName">NoNamespaceQName</a><a href="#88926" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88916" title="scales.xml.FullEqualQNameKey">k</a>.<a href="QName.scala.html#88898" title="=&gt; String">local</a><span class="delimiter">)</span></span>
<a href="l114"></a><span id="l114">  <span class="keyword">val</span> <a title="scales.xml.FullEqualQNameKey =&gt; java.lang.Object with scales.xml.UnprefixedQName" id="88887">unQ</a> = <span class="delimiter">(</span>k : <a href="QName.scala.html#11798" title="scales.xml.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">)</span> =&gt; <a href="QName.scala.html#88259" title="(locali: String, namespacei: scales.xml.Namespace)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.UnprefixedQName">UnprefixedQName</a><a href="#88926" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88921" title="scales.xml.FullEqualQNameKey">k</a>.<a href="QName.scala.html#88898" title="=&gt; String">local</a>, <a href="QName.scala.html#88304" title="(validUri: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)scales.xml.Namespace">Namespace</a><a href="#88926" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88921" title="scales.xml.FullEqualQNameKey">k</a>.<a href="QName.scala.html#88901" title="=&gt; String">namespace</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l115"></a><span id="l115">  <span class="keyword">val</span> <a title="scales.xml.FullEqualQNameKey =&gt; java.lang.Object with scales.xml.PrefixedQName{final val prefix: Some[String]}" id="88889">pQ</a> = <span class="delimiter">(</span>k : <a href="QName.scala.html#11798" title="scales.xml.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">)</span> =&gt; <a href="QName.scala.html#88317" title="(locali: String, prefixedNamespace: scales.xml.PrefixedNamespace)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.PrefixedQName{final val prefix: Some[String]}">PrefixedQName</a><a href="#88926" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88923" title="scales.xml.FullEqualQNameKey">k</a>.<a href="QName.scala.html#88898" title="=&gt; String">local</a>, <a href="QName.scala.html#88304" title="(validUri: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)scales.xml.Namespace">Namespace</a><a href="#88926" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88923" title="scales.xml.FullEqualQNameKey">k</a>.<a href="QName.scala.html#88901" title="=&gt; String">namespace</a><span class="delimiter">)</span>.<a href="QName.scala.html#88278" title="(prefix: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)scales.xml.PrefixedNamespace">prefixed</a><a href="#88926" title="=&gt; scales.xml.XmlVersion" class="delimiter">(</a><a href="#88923" title="scales.xml.FullEqualQNameKey">k</a>.<a href="QName.scala.html#88895" title="=&gt; String">prefix</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l116"></a><span id="l116">  </span>
<a href="l117"></a><span id="l117"><span class="delimiter">}</span></span>
<a href="l118"></a><span id="l118"></span>
<a href="l119"></a><span id="l119"><span class="keyword">trait</span> <a title="trait QNameTokenF extends java.lang.Object with ScalaObject" id="10683">QNameTokenF</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l120"></a><span id="l120">  <span class="keyword">def</span> <a title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)scales.xml.QNameToken" id="88929">createToken</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="88932">ver</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a>, <a title="scales.xml.FromParser" id="88933">fromParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a><span class="delimiter">)</span> = <a href="#88932" title="scales.xml.QNameToken" class="keyword">new</a> <a href="#10682" title="scales.xml.QNameToken">QNameToken</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l121"></a><span id="l121"><span class="delimiter">}</span></span>
<a href="l122"></a><span id="l122"></span>
<a href="l123"></a><span id="l123"></span>
<a href="l124"></a><span id="l124"><span class="comment">/**</span>
<a href="l125"></a><span id="l125"> * Threadsafe global cache, assumption is most applications would benefit from this </span>
<a href="l126"></a><span id="l126"> */</span></span>
<a href="l127"></a><span id="l127"><span class="keyword">trait</span> <a title="trait QNameOptimisationT[Token &lt;: scales.xml.QNameToken] extends java.lang.Object with scales.xml.MemoryOptimisationStrategy[Token] with ScalaObject" id="10684">QNameOptimisationT</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.QNameToken" id="10685">Token</a> &lt;: QNameToken<span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="#10675" title="scales.xml.MemoryOptimisationStrategy[Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l128"></a><span id="l128"></span>
<a href="l129"></a><span id="l129">  <span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap</span>
<a href="l130"></a><span id="l130"></span>
<a href="l131"></a><span id="l131">  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[scales.xml.FullEqualQNameKey,scales.xml.QName]" id="88938">qNameCache</a> = <span title="()java.util.concurrent.ConcurrentHashMap[scales.xml.FullEqualQNameKey,scales.xml.QName]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[scales.xml.FullEqualQNameKey,scales.xml.QName]">ConcurrentHashMap</span><span class="delimiter">[</span> FullEqualQNameKey, QName <span class="delimiter">]</span></span>
<a href="l132"></a><span id="l132">  </span>
<a href="l133"></a><span id="l133"><span class="comment">//  override def createToken(implicit ver : XmlVersion, fromParser : FromParser) = new QNameToken()</span></span>
<a href="l134"></a><span id="l134"></span>
<a href="l135"></a><span id="l135">  <span class="comment">/**</span>
<a href="l136"></a><span id="l136">   * The creation costs can also be reduced</span>
<a href="l137"></a><span id="l137">   */</span> </span>
<a href="l138"></a><span id="l138">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(local: String, token: Token)scales.xml.NoNamespaceQName" id="88940">noNamespaceQName</a><span class="delimiter">(</span> <a title="String" id="89052">local</a> : <span title="String">String</span>, <a title="Token" id="89053">token</a> : <a href="#10685" title="Token">Token</a><span class="delimiter">)</span> : <a href="QName.scala.html#11799" title="scales.xml.NoNamespaceQName">NoNamespaceQName</a> = <span class="delimiter">{</span></span>
<a href="l139"></a><span id="l139">    <span class="keyword">val</span> <a title="Token" id="89057">qt</a> = <a href="#89053" title="Token">token</a><span class="comment">//.asInstanceOf[QNameToken]</span></span>
<a href="l140"></a><span id="l140">    <span class="keyword">import</span> <a href="#89057" title="Token">qt</a>._</span>
<a href="l141"></a><span id="l141">    <a href="#88943" title="(key: scales.xml.FullEqualQNameKey)(newT: scales.xml.FullEqualQNameKey =&gt; java.lang.Object with scales.xml.NoNamespaceQName)java.lang.Object with scales.xml.NoNamespaceQName">value</a><span class="delimiter">(</span> <a href="#88883" title="=&gt; scales.xml.FullEqualQNameKey">qkey</a>.<a href="QName.scala.html#88906" title="(nlocal: String)scales.xml.FullEqualQNameKey">setNoNamespaceQName</a><span class="delimiter">(</span><a href="#89052" title="String">local</a><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">(</span> <a href="#88885" title="=&gt; scales.xml.FullEqualQNameKey =&gt; java.lang.Object with scales.xml.NoNamespaceQName">noNsQ</a> <span class="delimiter">)</span></span>
<a href="l142"></a><span id="l142">  <span class="delimiter">}</span></span>
<a href="l143"></a><span id="l143"></span>
<a href="l144"></a><span id="l144">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(local: String, uri: String, token: Token)scales.xml.UnprefixedQName" id="88941">unprefixedQName</a><span class="delimiter">(</span> <a title="String" id="89077">local</a> : <span title="String">String</span>, <a title="String" id="89078">uri</a> : <span title="String">String</span>, <a title="Token" id="89079">token</a> : <a href="#10685" title="Token">Token</a><span class="delimiter">)</span> : <a href="QName.scala.html#11805" title="scales.xml.UnprefixedQName">UnprefixedQName</a> = <span class="delimiter">{</span></span>
<a href="l145"></a><span id="l145">    <span class="keyword">val</span> <a title="Token" id="89084">qt</a> = <a href="#89079" title="Token">token</a><span class="comment">//.asInstanceOf[QNameToken]</span></span>
<a href="l146"></a><span id="l146">    <span class="keyword">import</span> <a href="#89084" title="Token">qt</a>._</span>
<a href="l147"></a><span id="l147">    <a href="#88943" title="(key: scales.xml.FullEqualQNameKey)(newT: scales.xml.FullEqualQNameKey =&gt; java.lang.Object with scales.xml.UnprefixedQName)java.lang.Object with scales.xml.UnprefixedQName">value</a><span class="delimiter">(</span> <a href="#88883" title="=&gt; scales.xml.FullEqualQNameKey">qkey</a>.<a href="QName.scala.html#88907" title="(nlocal: String, nnamespace: String)scales.xml.FullEqualQNameKey">setUnprefixedQName</a><span class="delimiter">(</span><a href="#89077" title="String">local</a>, <a href="#89078" title="String">uri</a><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">(</span> <a href="#88887" title="=&gt; scales.xml.FullEqualQNameKey =&gt; java.lang.Object with scales.xml.UnprefixedQName">unQ</a> <span class="delimiter">)</span></span>
<a href="l148"></a><span id="l148">  <span class="delimiter">}</span></span>
<a href="l149"></a><span id="l149"></span>
<a href="l150"></a><span id="l150">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(local: String, uri: String, prefix: String, token: Token)scales.xml.PrefixedQName" id="88942">prefixedQName</a><span class="delimiter">(</span> <a title="String" id="89096">local</a> : <span title="String">String</span>, <a title="String" id="89097">uri</a> : <span title="String">String</span>, <a title="String" id="89098">prefix</a> : <span title="String">String</span>, <a title="Token" id="89099">token</a> : <a href="#10685" title="Token">Token</a><span class="delimiter">)</span> : <a href="QName.scala.html#11802" title="scales.xml.PrefixedQName">PrefixedQName</a> = <span class="delimiter">{</span></span>
<a href="l151"></a><span id="l151">    <span class="keyword">val</span> <a title="Token" id="89105">qt</a> = <a href="#89099" title="Token">token</a><span class="comment">//.asInstanceOf[QNameToken]</span></span>
<a href="l152"></a><span id="l152">    <span class="keyword">import</span> <a href="#89105" title="Token">qt</a>._</span>
<a href="l153"></a><span id="l153">    <a href="#88943" title="(key: scales.xml.FullEqualQNameKey)(newT: scales.xml.FullEqualQNameKey =&gt; java.lang.Object with scales.xml.PrefixedQName{final val prefix: Some[String]})java.lang.Object with scales.xml.PrefixedQName{final val prefix: Some[String]}">value</a><span class="delimiter">(</span> <a href="#88883" title="=&gt; scales.xml.FullEqualQNameKey">qkey</a>.<a href="QName.scala.html#88908" title="(nlocal: String, nnamespace: String, nprefix: String)scales.xml.FullEqualQNameKey">setPrefixedQName</a><span class="delimiter">(</span> <a href="#89096" title="String">local</a>, <a href="#89097" title="String">uri</a>, <a href="#89098" title="String">prefix</a><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">(</span> <a href="#88889" title="=&gt; scales.xml.FullEqualQNameKey =&gt; java.lang.Object with scales.xml.PrefixedQName{final val prefix: Some[String]}">pQ</a> <span class="delimiter">)</span></span>
<a href="l154"></a><span id="l154">  <span class="delimiter">}</span></span>
<a href="l155"></a><span id="l155"></span>
<a href="l156"></a><span id="l156">  <span class="keyword">def</span> <a title="[T &lt;: scales.xml.QName](key: scales.xml.FullEqualQNameKey)(newT: scales.xml.FullEqualQNameKey =&gt; T)T" id="88943">value</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.QName" id="88945">T</a> &lt;: QName<span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.FullEqualQNameKey" id="89059">key</a> : <a href="QName.scala.html#11798" title="scales.xml.FullEqualQNameKey">FullEqualQNameKey</a><span class="delimiter">)</span><span class="delimiter">(</span> <a title="scales.xml.FullEqualQNameKey =&gt; T" id="89060">newT</a> : FullEqualQNameKey =&gt; T <span class="delimiter">)</span> : <a href="#88945" title="T">T</a> = <span class="delimiter">{</span></span>
<a href="l157"></a><span id="l157">    <span class="keyword">var</span> <a title="scales.xml.QName" id="89118">value</a> = <a href="#88938" title="=&gt; java.util.concurrent.ConcurrentHashMap[scales.xml.FullEqualQNameKey,scales.xml.QName]">qNameCache</a>.<span title="(x$1: Any)scales.xml.QName">get</span><span class="delimiter">(</span><a href="#89059" title="scales.xml.FullEqualQNameKey">key</a><span class="delimiter">)</span></span>
<a href="l158"></a><span id="l158">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#89118" title="scales.xml.QName">value</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l159"></a><span id="l159">      <a href="#89118" title="scales.xml.QName">value</a> = <a href="#89060" title="(v1: scales.xml.FullEqualQNameKey)T">newT</a><span class="delimiter">(</span><a href="#89059" title="scales.xml.FullEqualQNameKey">key</a><span class="delimiter">)</span></span>
<a href="l160"></a><span id="l160">      <span class="keyword">val</span> <a title="scales.xml.QName" id="89124">res</a> = <a href="#88938" title="=&gt; java.util.concurrent.ConcurrentHashMap[scales.xml.FullEqualQNameKey,scales.xml.QName]">qNameCache</a>.<span title="(x$1: scales.xml.FullEqualQNameKey, x$2: scales.xml.QName)scales.xml.QName">putIfAbsent</span><span class="delimiter">(</span><a href="#89059" title="scales.xml.FullEqualQNameKey">key</a>.<a href="QName.scala.html#88904" title="=&gt; scales.xml.FullEqualQNameKey">copy</a>, <a href="#89118" title="scales.xml.QName">value</a><span class="delimiter">)</span><span class="comment">// copy because now it needs to be frozen</span></span>
<a href="l161"></a><span id="l161">      <a href="#89118" title="scales.xml.QName">value</a> = <span title="scales.xml.QName" class="keyword">if</span> <span class="delimiter">(</span><a href="#89124" title="scales.xml.QName">res</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#89118" title="scales.xml.QName">value</a> <span class="keyword">else</span> <a href="#89124" title="scales.xml.QName">res</a></span>
<a href="l162"></a><span id="l162">    <span class="delimiter">}</span></span>
<a href="l163"></a><span id="l163">    <a href="#89118" title="scales.xml.QName">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#88945" title="T">T</a><span class="delimiter">]</span></span>
<a href="l164"></a><span id="l164">  <span class="delimiter">}</span></span>
<a href="l165"></a><span id="l165"></span>
<a href="l166"></a><span id="l166"><span class="delimiter">}</span></span>
<a href="l167"></a><span id="l167"></span>
<a href="l168"></a><span id="l168"><span class="keyword">class</span> <a title="class ElemToken extends scales.xml.QNameToken with ScalaObject" id="10686">ElemToken</a><a href="#10686" title="ScalaObject" class="delimiter">(</a><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="89173">ver</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a>, <a title="scales.xml.FromParser" id="89174">fromParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#10682" title="scales.xml.QNameToken">QNameToken</a> <span class="delimiter">{</span></span>
<a href="l169"></a><span id="l169">  <span class="keyword">val</span> <a title="scales.xml.ElemKey" id="89143">ekey</a> = <span title="scales.xml.ElemKey" class="keyword">new</span> <a href="XmlTypes.scala.html#11997" title="scales.xml.ElemKey">ElemKey</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l170"></a><span id="l170">  </span>
<a href="l171"></a><span id="l171">  <span class="keyword">val</span> <a title="scales.xml.ElemKey =&gt; scales.xml.Elem" id="89145">ef</a> = <span class="delimiter">(</span>key : <a href="XmlTypes.scala.html#11997" title="scales.xml.ElemKey">ElemKey</a><span class="delimiter">)</span> =&gt; <a href="XmlTypes.scala.html#88403" title="(namei: scales.xml.QName, attributesi: scales.xml.package.Attributes, namespacesi: scala.collection.immutable.Map[String,String])(implicit fromParser: scales.xml.FromParser)scales.xml.Elem">Elem</a><a href="#89174" title="scales.xml.FromParser" class="delimiter">(</a><a href="#89171" title="scales.xml.ElemKey">key</a>.<a href="XmlTypes.scala.html#89151" title="=&gt; scales.xml.QName">name</a>, <a href="#89171" title="scales.xml.ElemKey">key</a>.<a href="XmlTypes.scala.html#89157" title="=&gt; scales.xml.package.Attributes">attributes</a>, <a href="#89171" title="scales.xml.ElemKey">key</a>.<a href="XmlTypes.scala.html#89160" title="=&gt; scala.collection.immutable.Map[String,String]">namespaces</a><span class="delimiter">)</span></span>
<a href="l172"></a><span id="l172"><span class="delimiter">}</span></span>
<a href="l173"></a><span id="l173"></span>
<a href="l174"></a><span id="l174"><span class="keyword">trait</span> <a title="trait ElemTokenF extends java.lang.Object with ScalaObject" id="10687">ElemTokenF</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l175"></a><span id="l175">  <span class="keyword">def</span> <a title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)scales.xml.ElemToken" id="89176">createToken</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="89179">ver</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a>, <a title="scales.xml.FromParser" id="89180">fromParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a><span class="delimiter">)</span> = <a href="#89179" title="scales.xml.ElemToken" class="keyword">new</a> <a href="#10686" title="scales.xml.ElemToken">ElemToken</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l176"></a><span id="l176"><span class="delimiter">}</span></span>
<a href="l177"></a><span id="l177"></span>
<a href="l178"></a><span id="l178"></span>
<a href="l179"></a><span id="l179"><span class="keyword">trait</span> <a title="trait ElemQNameOptimisationT[Token &lt;: scales.xml.ElemToken] extends java.lang.Object with scales.xml.QNameOptimisationT[Token] with ScalaObject" id="10688">ElemQNameOptimisationT</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.ElemToken" id="10689">Token</a> &lt;: ElemToken<span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="#10684" title="scales.xml.QNameOptimisationT[Token]">QNameOptimisationT</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l180"></a><span id="l180">  <span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap</span>
<a href="l181"></a><span id="l181"></span>
<a href="l182"></a><span id="l182">  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[scales.xml.ElemKey,scales.xml.Elem]" id="89185">ecache</a> = <span title="()java.util.concurrent.ConcurrentHashMap[scales.xml.ElemKey,scales.xml.Elem]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[scales.xml.ElemKey,scales.xml.Elem]">ConcurrentHashMap</span><span class="delimiter">[</span> ElemKey, Elem <span class="delimiter">]</span></span>
<a href="l183"></a><span id="l183"></span>
<a href="l184"></a><span id="l184">  <span class="keyword">val</span> <a title="Boolean" id="89187">cacheAll</a> = <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l185"></a><span id="l185"></span>
<a href="l186"></a><span id="l186">  <span class="keyword">def</span> <a title="(key: scales.xml.ElemKey)(newT: scales.xml.ElemKey =&gt; scales.xml.Elem)scales.xml.Elem" id="89189">elemValue</a><span class="delimiter">(</span><a title="scales.xml.ElemKey" id="89296">key</a> : <a href="XmlTypes.scala.html#11997" title="scales.xml.ElemKey">ElemKey</a><span class="delimiter">)</span><span class="delimiter">(</span> <a title="scales.xml.ElemKey =&gt; scales.xml.Elem" id="89297">newT</a> : ElemKey =&gt; Elem <span class="delimiter">)</span> : <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a> = <span class="delimiter">{</span></span>
<a href="l187"></a><span id="l187">    <span class="keyword">var</span> <a title="scales.xml.Elem" id="89299">value</a> = <a href="#89185" title="=&gt; java.util.concurrent.ConcurrentHashMap[scales.xml.ElemKey,scales.xml.Elem]">ecache</a>.<span title="(x$1: Any)scales.xml.Elem">get</span><span class="delimiter">(</span><a href="#89296" title="scales.xml.ElemKey">key</a><span class="delimiter">)</span></span>
<a href="l188"></a><span id="l188">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#89299" title="scales.xml.Elem">value</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l189"></a><span id="l189">      <a href="#89299" title="scales.xml.Elem">value</a> = <a href="#89297" title="(v1: scales.xml.ElemKey)scales.xml.Elem">newT</a><span class="delimiter">(</span><a href="#89296" title="scales.xml.ElemKey">key</a><span class="delimiter">)</span></span>
<a href="l190"></a><span id="l190">      <span class="keyword">val</span> <a title="scales.xml.Elem" id="89305">res</a> = <a href="#89185" title="=&gt; java.util.concurrent.ConcurrentHashMap[scales.xml.ElemKey,scales.xml.Elem]">ecache</a>.<span title="(x$1: scales.xml.ElemKey, x$2: scales.xml.Elem)scales.xml.Elem">putIfAbsent</span><span class="delimiter">(</span><a href="#89296" title="scales.xml.ElemKey">key</a>.<a href="XmlTypes.scala.html#89164" title="=&gt; scales.xml.ElemKey">copy</a>, <a href="#89299" title="scales.xml.Elem">value</a><span class="delimiter">)</span><span class="comment">// copy because now it needs to be frozen</span></span>
<a href="l191"></a><span id="l191">      <a href="#89299" title="scales.xml.Elem">value</a> = <span title="scales.xml.Elem" class="keyword">if</span> <span class="delimiter">(</span><a href="#89305" title="scales.xml.Elem">res</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#89299" title="scales.xml.Elem">value</a> <span class="keyword">else</span> <a href="#89305" title="scales.xml.Elem">res</a></span>
<a href="l192"></a><span id="l192">    <span class="delimiter">}</span></span>
<a href="l193"></a><span id="l193">    <a href="#89299" title="scales.xml.Elem">value</a></span>
<a href="l194"></a><span id="l194">  <span class="delimiter">}</span></span>
<a href="l195"></a><span id="l195"></span>
<a href="l196"></a><span id="l196">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(name: scales.xml.QName, attributes: scales.xml.package.Attributes, namespaces: Map[String,String], token: Token)scales.xml.Elem" id="89190">elem</a><span class="delimiter">(</span> <a title="scales.xml.QName" id="89323">name</a> : <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="scales.xml.package.Attributes" id="89324">attributes</a> : <a href="../utils/ListSet.scala.html#10456" title="scales.xml.package.Attributes">Attributes</a>, <a title="Map[String,String]" id="89325">namespaces</a> : <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Token" id="89326">token</a> : <a href="#10689" title="Token">Token</a><span class="delimiter">)</span> : <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a> = <span class="delimiter">{</span> </span>
<a href="l197"></a><span id="l197">    <span class="keyword">val</span> <a title="Token" id="89332">et</a> = <a href="#89326" title="Token">token</a><span class="comment">//.asInstanceOf[ElemToken]</span></span>
<a href="l198"></a><span id="l198">    <span class="keyword">import</span> <a href="#89332" title="Token">et</a>._</span>
<a href="l199"></a><span id="l199"></span>
<a href="l200"></a><span id="l200">    <span title="scales.xml.Elem" class="keyword">if</span> <span class="delimiter">(</span><a href="#89187" title="=&gt; Boolean">cacheAll</a> <span title="(x: Boolean)Boolean">||</span></span>
<a href="l201"></a><span id="l201">	<span class="delimiter">(</span><span class="delimiter">(</span><a href="#89324" title="scales.xml.package.Attributes">attributes</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="XmlTypes.scala.html#12419" title="=&gt; scales.utils.ListSet[scales.xml.Attribute]">emptyAttributes</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span></span>
<a href="l202"></a><span id="l202">	<span class="delimiter">(</span><a href="#89325" title="Map[String,String]">namespaces</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="XmlTypes.scala.html#12421" title="=&gt; scala.collection.immutable.Map[String,String]">emptyNamespaces</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l203"></a><span id="l203">	<span class="delimiter">)</span></span>
<a href="l204"></a><span id="l204">        <a href="#89189" title="(key: scales.xml.ElemKey)(newT: scales.xml.ElemKey =&gt; scales.xml.Elem)scales.xml.Elem">elemValue</a><span class="delimiter">(</span><a href="#89143" title="=&gt; scales.xml.ElemKey">ekey</a>.<a href="XmlTypes.scala.html#89163" title="(name: scales.xml.QName, attributes: scales.xml.package.Attributes, namespaces: scala.collection.immutable.Map[String,String], nameHash: Int)scales.xml.ElemKey">set</a><span class="delimiter">(</span><a href="#89323" title="scales.xml.QName">name</a>, <a href="#89324" title="scales.xml.package.Attributes">attributes</a>, <a href="#89325" title="Map[String,String]">namespaces</a>, <a href="#88883" title="=&gt; scales.xml.FullEqualQNameKey">qkey</a>.<a href="QName.scala.html#88911" title="=&gt; Int">lastHash</a><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">(</span> <a href="#89145" title="=&gt; scales.xml.ElemKey =&gt; scales.xml.Elem">ef</a> <span class="delimiter">)</span></span>
<a href="l205"></a><span id="l205">    <span class="keyword">else</span> <a href="XmlTypes.scala.html#88403" title="(namei: scales.xml.QName, attributesi: scales.xml.package.Attributes, namespacesi: scala.collection.immutable.Map[String,String])(implicit fromParser: scales.xml.FromParser)scales.xml.Elem">Elem</a><span class="delimiter">(</span><a href="#89323" title="scales.xml.QName">name</a>, <a href="#89324" title="scales.xml.package.Attributes">attributes</a>, <a href="#89325" title="Map[String,String]">namespaces</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#89326" title="Token">token</a>.<a href="#88927" title="=&gt; scales.xml.FromParser">fromParser</a><span class="delimiter">)</span></span>
<a href="l206"></a><span id="l206">  <span class="delimiter">}</span></span>
<a href="l207"></a><span id="l207">  </span>
<a href="l208"></a><span id="l208"><span class="delimiter">}</span></span>
<a href="l209"></a><span id="l209"></span>
<a href="l210"></a><span id="l210"><span class="keyword">trait</span> <a title="trait FullMemoryOptimisationT[Token &lt;: scales.xml.ElemToken] extends java.lang.Object with scales.xml.ElemQNameOptimisationT[Token] with ScalaObject" id="10690">FullMemoryOptimisationT</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.ElemToken" id="10691">Token</a> &lt;: ElemToken<span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="#10688" title="scales.xml.ElemQNameOptimisationT[Token]">ElemQNameOptimisationT</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l211"></a><span id="l211">  <span class="keyword">override</span> <span class="keyword">val</span> <a title="Boolean" id="90683">cacheAll</a> = <span title="Boolean(true)" class="keyword">true</span></span>
<a href="l212"></a><span id="l212"><span class="delimiter">}</span></span>
<a href="l213"></a><span id="l213"></span>
<a href="l214"></a><span id="l214"><span class="keyword">object</span> <a title="object scales.xml.QNameMemoryOptimisation" id="10692">QNameMemoryOptimisation</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10680" title="scales.xml.PathOptimisationStrategy[scales.xml.QNameToken]">PathOptimisationStrategy</a><span class="delimiter">[</span>QNameToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10684" title="scales.xml.QNameOptimisationT[scales.xml.QNameToken]">QNameOptimisationT</a><span class="delimiter">[</span>QNameToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10683" title="scales.xml.QNameTokenF">QNameTokenF</a></span>
<a href="l215"></a><span id="l215"></span>
<a href="l216"></a><span id="l216"><span class="comment">/**</span>
<a href="l217"></a><span id="l217"> * Simple hashmap on Elem -&gt; Elem, makes no optimisations across qnames (use QNameOptimisationT for that)</span>
<a href="l218"></a><span id="l218"> */</span> </span>
<a href="l219"></a><span id="l219"><span class="keyword">trait</span> <a title="trait ElemOptimisationT[Token &lt;: scales.xml.OptimisationToken] extends java.lang.Object with scales.xml.MemoryOptimisationStrategy[Token] with ScalaObject" id="10694">ElemOptimisationT</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="10695">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="#10675" title="scales.xml.MemoryOptimisationStrategy[Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l220"></a><span id="l220"></span>
<a href="l221"></a><span id="l221">  <span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap</span>
<a href="l222"></a><span id="l222"></span>
<a href="l223"></a><span id="l223">  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[scales.xml.Elem,scales.xml.Elem]" id="90691">cache</a> = <span title="()java.util.concurrent.ConcurrentHashMap[scales.xml.Elem,scales.xml.Elem]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[scales.xml.Elem,scales.xml.Elem]">ConcurrentHashMap</span><span class="delimiter">[</span> Elem, Elem <span class="delimiter">]</span></span>
<a href="l224"></a><span id="l224"></span>
<a href="l225"></a><span id="l225">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(name: scales.xml.QName, attributes: scales.xml.package.Attributes, namespaces: Map[String,String], token: Token)scales.xml.Elem" id="90693">elem</a><span class="delimiter">(</span> <a title="scales.xml.QName" id="90799">name</a> : <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="scales.xml.package.Attributes" id="90800">attributes</a> : <a href="../utils/ListSet.scala.html#10456" title="scales.xml.package.Attributes">Attributes</a>, <a title="Map[String,String]" id="90801">namespaces</a> : <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Token" id="90802">token</a> : <a href="#10695" title="Token">Token</a><span class="delimiter">)</span> : <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a> = <span class="delimiter">{</span></span>
<a href="l226"></a><span id="l226">    <span class="keyword">import</span> <a href="#90802" title="Token">token</a>._</span>
<a href="l227"></a><span id="l227">    <a href="../utils/ConcurrentMapUtils.scala.html#12373" title="(key: scales.xml.Elem, map: java.util.concurrent.ConcurrentHashMap[scales.xml.Elem,scales.xml.Elem])(newT: =&gt; scales.xml.Elem)scales.xml.Elem">value</a><span class="delimiter">(</span><a href="XmlTypes.scala.html#88403" title="(namei: scales.xml.QName, attributesi: scales.xml.package.Attributes, namespacesi: scala.collection.immutable.Map[String,String])(implicit fromParser: scales.xml.FromParser)scales.xml.Elem">Elem</a><a href="#87764" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="#90799" title="scales.xml.QName">name</a>, <a href="#90800" title="scales.xml.package.Attributes">attributes</a>, <a href="#90801" title="Map[String,String]">namespaces</a><span class="delimiter">)</span>, <a href="#90691" title="=&gt; java.util.concurrent.ConcurrentHashMap[scales.xml.Elem,scales.xml.Elem]">cache</a><span class="delimiter">)</span> <span class="delimiter">(</span><a href="XmlTypes.scala.html#88403" title="(namei: scales.xml.QName, attributesi: scales.xml.package.Attributes, namespacesi: scala.collection.immutable.Map[String,String])(implicit fromParser: scales.xml.FromParser)scales.xml.Elem">Elem</a><a href="#87764" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="#90799" title="scales.xml.QName">name</a>, <a href="#90800" title="scales.xml.package.Attributes">attributes</a>, <a href="#90801" title="Map[String,String]">namespaces</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l228"></a><span id="l228">  <span class="delimiter">}</span>  </span>
<a href="l229"></a><span id="l229"><span class="delimiter">}</span></span>
<a href="l230"></a><span id="l230"></span>
<a href="l231"></a><span id="l231"><span class="keyword">object</span> <a title="object scales.xml.ElemMemoryOptimisation" id="10696">ElemMemoryOptimisation</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10680" title="scales.xml.PathOptimisationStrategy[scales.xml.ElemToken]">PathOptimisationStrategy</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10694" title="scales.xml.ElemOptimisationT[scales.xml.ElemToken]">ElemOptimisationT</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10687" title="scales.xml.ElemTokenF">ElemTokenF</a></span>
<a href="l232"></a><span id="l232"></span>
<a href="l233"></a><span id="l233"><span class="comment">/**</span>
<a href="l234"></a><span id="l234"> * Optimises on QNames and Elems, reducing duplicates at the cost of CHM lookups.</span>
<a href="l235"></a><span id="l235"> */</span> </span>
<a href="l236"></a><span id="l236"><span class="keyword">object</span> <a title="object scales.xml.HighMemoryOptimisation" id="10698">HighMemoryOptimisation</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10680" title="scales.xml.PathOptimisationStrategy[scales.xml.ElemToken]">PathOptimisationStrategy</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10694" title="scales.xml.ElemOptimisationT[scales.xml.ElemToken]">ElemOptimisationT</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10684" title="scales.xml.QNameOptimisationT[scales.xml.ElemToken]">QNameOptimisationT</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10687" title="scales.xml.ElemTokenF">ElemTokenF</a></span>
<a href="l237"></a><span id="l237"></span>
<a href="l238"></a><span id="l238"><span class="comment">/**</span>
<a href="l239"></a><span id="l239"> * As this adds extra processing time, but better fits XPath rules (i.e. all text children below are joined) its available to be mixed in, but isn't added by default.</span>
<a href="l240"></a><span id="l240"> *</span>
<a href="l241"></a><span id="l241"> * This also removes any extra parsing time from string joining.</span>
<a href="l242"></a><span id="l242"> */</span> </span>
<a href="l243"></a><span id="l243"><span class="keyword">trait</span> <a title="trait TextNodeJoiner[Token &lt;: scales.xml.OptimisationToken] extends java.lang.Object with scales.xml.PathOptimisationStrategy[Token] with ScalaObject" id="10700">TextNodeJoiner</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="10701">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="#10680" title="scales.xml.PathOptimisationStrategy[Token]">PathOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l244"></a><span id="l244">    </span>
<a href="l245"></a><span id="l245">  <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.xmlCBF</span>
<a href="l246"></a><span id="l246"></span>
<a href="l247"></a><span id="l247">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(proxies: scales.xml.TreeProxies, token: Token)Unit" id="90826">elementEnd</a><span class="delimiter">(</span> <a title="scales.xml.TreeProxies" id="90829">proxies</a> : <a href="XmlParser.scala.html#11877" title="scales.xml.TreeProxies">TreeProxies</a>, <a title="Token" id="90830">token</a> : <a href="#10701" title="Token">Token</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l248"></a><span id="l248">    <span class="comment">// get our current call the real one</span></span>
<a href="l249"></a><span id="l249">    <span class="keyword">val</span> <a title="scales.xml.TreeProxy" id="90834">l</a> = <a href="#90829" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88858" title="=&gt; scales.xml.TreeProxy">current</a></span>
<a href="l250"></a><span id="l250">    <a href="#10700" title="scales.xml.TextNodeJoiner[Token]" class="keyword">super</a>.<a href="#88836" title="(xml: scales.xml.TreeProxies, token: Token)Unit">elementEnd</a><span class="delimiter">(</span><a href="#90829" title="scales.xml.TreeProxies">proxies</a>, <a href="#90830" title="Token">token</a><span class="delimiter">)</span></span>
<a href="l251"></a><span id="l251"></span>
<a href="l252"></a><span id="l252">    <span class="keyword">val</span> <a title="scales.xml.package.XmlChildren" id="90835">joined</a> = <a href="XmlUtils.scala.html#12513" title="(children: scales.xml.package.XmlChildren)scales.xml.package.XmlChildren">joinTextNodes</a><span class="delimiter">(</span><a href="#90834" title="scales.xml.TreeProxy">l</a>.<a href="XmlParser.scala.html#90841" title="=&gt; scales.xml.package.XmlChildren">children</a><span class="delimiter">)</span></span>
<a href="l253"></a><span id="l253"></span>
<a href="l254"></a><span id="l254">    <span class="comment">// if depth == -1 then l.children is now fixed</span></span>
<a href="l255"></a><span id="l255">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#90829" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88847" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l256"></a><span id="l256">      <a href="#90834" title="scales.xml.TreeProxy">l</a>.<a href="XmlParser.scala.html#90842" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <a href="#90835" title="scales.xml.package.XmlChildren">joined</a></span>
<a href="l257"></a><span id="l257">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l258"></a><span id="l258">      <span class="comment">// we have to look at new current and manipulate that</span></span>
<a href="l259"></a><span id="l259">      <span class="keyword">val</span> <a title="scales.xml.TreeProxy" id="90857">nc</a> = <a href="#90829" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88858" title="=&gt; scales.xml.TreeProxy">current</a></span>
<a href="l260"></a><span id="l260">      <a href="#90857" title="scales.xml.TreeProxy">nc</a>.<a href="XmlParser.scala.html#90842" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <a href="#90857" title="scales.xml.TreeProxy">nc</a>.<a href="XmlParser.scala.html#90841" title="=&gt; scales.xml.package.XmlChildren">children</a>.<span title="(index: Int, elem: scales.xml.package.ItemOrElem)(implicit bf: scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[scales.xml.package.ItemOrElem],scales.xml.package.ItemOrElem,scales.xml.package.XmlChildren])scales.xml.package.XmlChildren">updated</span><a href="XmlTypes.scala.html#87812" title="=&gt; scales.xml.package.XmlCBF" class="delimiter">(</a><a href="#90857" title="scales.xml.TreeProxy">nc</a>.<a href="XmlParser.scala.html#90841" title="=&gt; scales.xml.package.XmlChildren">children</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <a href="../utils/Trees.scala.html#80175" title="(section: scales.xml.Elem, children: scales.xml.package.XCC[scales.utils.package.ItemOrTree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]])scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">Tree</a><span class="delimiter">(</span><a href="#90834" title="scales.xml.TreeProxy">l</a>.<a href="XmlParser.scala.html#90838" title="=&gt; scales.xml.Elem">elem</a>, <a href="#90835" title="scales.xml.package.XmlChildren">joined</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l261"></a><span id="l261">    <span class="delimiter">}</span></span>
<a href="l262"></a><span id="l262">  <span class="delimiter">}</span></span>
<a href="l263"></a><span id="l263"></span>
<a href="l264"></a><span id="l264"><span class="delimiter">}</span></span>
<a href="l265"></a><span id="l265"></span>
<a href="l266"></a><span id="l266"><span class="comment">/**</span>
<a href="l267"></a><span id="l267"> * A Mutable vector is used internally, only update on the last element and :+/append is supported, the result of elementEnd is however immutable and safe to re-use via a super call.</span>
<a href="l268"></a><span id="l268"> */</span> </span>
<a href="l269"></a><span id="l269"><span class="keyword">trait</span> <a title="trait MutableVectorLikeStrategy[Token &lt;: scales.xml.OptimisationToken] extends java.lang.Object with scales.xml.PathOptimisationStrategy[Token] with ScalaObject" id="10702">MutableVectorLikeStrategy</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="10703">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="#10680" title="scales.xml.PathOptimisationStrategy[Token]">PathOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l270"></a><span id="l270">  </span>
<a href="l271"></a><span id="l271">  <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.xmlCBF</span>
<a href="l272"></a><span id="l272">  <span class="keyword">import</span> scala.collection.immutable.MutableVectorLike</span>
<a href="l273"></a><span id="l273"></span>
<a href="l274"></a><span id="l274">  <span class="comment">/**</span>
<a href="l275"></a><span id="l275">   * Reproduced zipUp</span>
<a href="l276"></a><span id="l276">   */</span> </span>
<a href="l277"></a><span id="l277">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(proxies: scales.xml.TreeProxies, token: Token)Unit" id="90965">elementEnd</a><span class="delimiter">(</span> <a title="scales.xml.TreeProxies" id="90969">proxies</a> : <a href="XmlParser.scala.html#11877" title="scales.xml.TreeProxies">TreeProxies</a>, <a title="Token" id="90970">token</a> : <a href="#10703" title="Token">Token</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l278"></a><span id="l278">    <span class="keyword">val</span> <a title="scales.xml.TreeProxy" id="90974">l</a> = <a href="#90969" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88858" title="=&gt; scales.xml.TreeProxy">current</a></span>
<a href="l279"></a><span id="l279">    <a href="#90974" title="scales.xml.TreeProxy">l</a>.<a href="XmlParser.scala.html#90842" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <a href="#90974" title="scales.xml.TreeProxy">l</a>.<a href="XmlParser.scala.html#90841" title="=&gt; scales.xml.package.XmlChildren">children</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.collection.immutable.MutableVectorLike[scales.xml.package.ItemOrElem]" class="delimiter">[</span><a href="#11773" title="scala.collection.immutable.MutableVectorLike[scales.xml.package.ItemOrElem]">MutableVectorLike</a><span class="delimiter">[</span>ItemOrElem<span class="delimiter">]</span><span class="delimiter">]</span>.<a href="#91010" title="=&gt; scales.utils.ImmutableArrayProxy[scales.xml.package.ItemOrElem]">immutable</a></span>
<a href="l280"></a><span id="l280">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#90969" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88847" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l281"></a><span id="l281">      <a href="#90969" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88848" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l282"></a><span id="l282">      <span class="keyword">val</span> <a title="scales.xml.TreeProxy" id="91030">newC</a> = <a href="#90969" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88850" title="(idx: Int)scales.xml.TreeProxy">proxies</a><span class="delimiter">(</span> <a href="#90969" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88847" title="=&gt; Int">depth</a> <span class="delimiter">)</span></span>
<a href="l283"></a><span id="l283">      <a href="#90969" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88859" title="(x$1: scales.xml.TreeProxy)Unit">current</a> = <a href="#91030" title="scales.xml.TreeProxy">newC</a></span>
<a href="l284"></a><span id="l284">      <a href="#91030" title="scales.xml.TreeProxy">newC</a>.<a href="XmlParser.scala.html#90842" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <span class="delimiter">(</span><a href="#91030" title="scales.xml.TreeProxy">newC</a>.<a href="XmlParser.scala.html#90841" title="=&gt; scales.xml.package.XmlChildren">children</a> <a href="XmlTypes.scala.html#87812" title="(elem: scales.xml.package.ItemOrElem)(implicit bf: scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[scales.xml.package.ItemOrElem],scales.xml.package.ItemOrElem,scales.xml.package.XmlChildren])scales.xml.package.XmlChildren">:+</a> <a href="../utils/Trees.scala.html#80175" title="(section: scales.xml.Elem, children: scales.xml.package.XCC[scales.utils.package.ItemOrTree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]])scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">Tree</a><span class="delimiter">(</span><a href="#90974" title="scales.xml.TreeProxy">l</a>.<a href="XmlParser.scala.html#90838" title="=&gt; scales.xml.Elem">elem</a>, <a href="#90974" title="scales.xml.TreeProxy">l</a>.<a href="XmlParser.scala.html#90841" title="=&gt; scales.xml.package.XmlChildren">children</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l285"></a><span id="l285">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l286"></a><span id="l286">      <a href="#90969" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88848" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l287"></a><span id="l287">    <span class="delimiter">}</span></span>
<a href="l288"></a><span id="l288">  <span class="delimiter">}</span></span>
<a href="l289"></a><span id="l289">  </span>
<a href="l290"></a><span id="l290">  <span class="comment">/**</span>
<a href="l291"></a><span id="l291">   * Start a new tree, substitutes a MutableVectorLike instead of an immutable</span>
<a href="l292"></a><span id="l292">   */</span> </span>
<a href="l293"></a><span id="l293">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(proxies: scales.xml.TreeProxies, elem: scales.xml.Elem, token: Token)Unit" id="90966">beginSubTree</a><span class="delimiter">(</span> <a title="scales.xml.TreeProxies" id="91151">proxies</a> : <a href="XmlParser.scala.html#11877" title="scales.xml.TreeProxies">TreeProxies</a>, <a title="scales.xml.Elem" id="91152">elem</a> : <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a>, <a title="Token" id="91153">token</a> : <a href="#10703" title="Token">Token</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l294"></a><span id="l294">    <a href="#91151" title="scales.xml.TreeProxies">proxies</a>.<a href="XmlParser.scala.html#88863" title="(elem: scales.xml.Elem, children: scales.xml.package.XmlChildren)Unit">beginSub</a><span class="delimiter">(</span><a href="#91152" title="scales.xml.Elem">elem</a>, <span title="scala.collection.immutable.MutableVectorLike[scales.xml.package.ItemOrElem]" class="keyword">new</span> <a href="#11773" title="scala.collection.immutable.MutableVectorLike[scales.xml.package.ItemOrElem]">MutableVectorLike</a><span class="delimiter">[</span>ItemOrElem<span class="delimiter">]</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l295"></a><span id="l295">  <span class="delimiter">}</span></span>
<a href="l296"></a><span id="l296">   </span>
<a href="l297"></a><span id="l297"><span class="delimiter">}</span></span>
<a href="l298"></a><span id="l298"></span>
<a href="l299"></a><span id="l299"><span class="comment">/**</span>
<a href="l300"></a><span id="l300"> * Reduces memory consumption at a 5-10% perfromance hit over the default QNameAndSpeedierStrategy</span>
<a href="l301"></a><span id="l301"> */</span> </span>
<a href="l302"></a><span id="l302"><span class="keyword">object</span> <a title="object scales.xml.MemoryAndSpeedierStrategy" id="10704">MemoryAndSpeedierStrategy</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10702" title="scales.xml.MutableVectorLikeStrategy[scales.xml.ElemToken]">MutableVectorLikeStrategy</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10690" title="scales.xml.FullMemoryOptimisationT[scales.xml.ElemToken]">FullMemoryOptimisationT</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10687" title="scales.xml.ElemTokenF">ElemTokenF</a></span>
<a href="l303"></a><span id="l303"></span>
<a href="l304"></a><span id="l304"><span class="comment">/**</span>
<a href="l305"></a><span id="l305"> * The default as it will equal or better Scala Xml memory consumption at a performance gain.</span>
<a href="l306"></a><span id="l306"> *</span>
<a href="l307"></a><span id="l307"> * For the lowest memory consumption possible, for example where memory is more important than raw performance, see MemoryAndSpeedierStrategy</span>
<a href="l308"></a><span id="l308"> *</span>
<a href="l309"></a><span id="l309"> */</span></span>
<a href="l310"></a><span id="l310"><span class="keyword">object</span> <a title="object scales.xml.QNameAndSpeedierStrategy" id="10706">QNameAndSpeedierStrategy</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10702" title="scales.xml.MutableVectorLikeStrategy[scales.xml.ElemToken]">MutableVectorLikeStrategy</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10688" title="scales.xml.ElemQNameOptimisationT[scales.xml.ElemToken]">ElemQNameOptimisationT</a><span class="delimiter">[</span>ElemToken<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10687" title="scales.xml.ElemTokenF">ElemTokenF</a></span>
<a href="l311"></a><span id="l311"></span>
<a href="l312"></a><span id="l312"><span class="delimiter">}</span></span>
<a href="l313"></a><span id="l313"></span>
<a href="l314"></a><span id="l314"><span class="keyword">package</span> scala.collection.immutable <span class="delimiter">{</span></span>
<a href="l315"></a><span id="l315"></span>
<a href="l316"></a><span id="l316"><span class="keyword">import</span> scala.annotation.unchecked.uncheckedVariance</span>
<a href="l317"></a><span id="l317"></span>
<a href="l318"></a><span id="l318"><span class="keyword">import</span> scales.utils._</span>
<a href="l319"></a><span id="l319"></span>
<a href="l320"></a><span id="l320"><span class="comment">//import collection.{IndexedSeqOptimized, IndexedSeqLike, IndexedSeq}</span></span>
<a href="l321"></a><span id="l321"><span class="keyword">import</span> collection.mutable.Builder <span class="comment">//{ArrayBuilder, Builder}</span></span>
<a href="l322"></a><span id="l322"><span class="keyword">import</span> collection.generic.<span class="delimiter">{</span>CanBuildFrom, GenericTraversableTemplate, SeqFactory, GenericCompanion<span class="delimiter">}</span></span>
<a href="l323"></a><span id="l323"></span>
<a href="l324"></a><span id="l324"><span class="comment">/**</span>
<a href="l325"></a><span id="l325"> * Don't use this unless you are not having your own OptimisationStrategies.</span>
<a href="l326"></a><span id="l326"> *</span>
<a href="l327"></a><span id="l327"> * Basic copy of a VectorBuilder but without result etc, this only uses ar</span>
<a href="l328"></a><span id="l328"> * and returns either a smaller immutablearray or a vectorimpl.</span>
<a href="l329"></a><span id="l329"> *</span>
<a href="l330"></a><span id="l330"> * The whole idea is not to routinely copy the tree around and provide</span>
<a href="l331"></a><span id="l331"> * very fast updates and access to the current head (i.e. zipUp)</span>
<a href="l332"></a><span id="l332"> */</span> </span>
<a href="l333"></a><span id="l333"><span class="keyword">final</span> <span class="keyword">class</span> <a title="class MutableVectorLike[+A] extends java.lang.Object with scales.utils.ImmutableArrayProxy[A] with scala.collection.immutable.VectorPointer[A @scala.annotation.unchecked.uncheckedVariance] with ScalaObject" id="11773">MutableVectorLike</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="91162">A</a><span class="delimiter">]</span><a href="#11773" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Boolean" id="91160">copyArray</a> : <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../utils/ImmutableArray.scala.html#10380" title="scales.utils.ImmutableArrayProxy[A]">ImmutableArrayProxy</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="keyword">with</span> <span title="scala.collection.immutable.VectorPointer[A @scala.annotation.unchecked.uncheckedVariance]">VectorPointer</span><span class="delimiter">[</span>A @uncheckedVariance<span class="delimiter">]</span><span class="delimiter">{</span></span>
<a href="l334"></a><span id="l334"></span>
<a href="l335"></a><span id="l335">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.generic.GenericCompanion[scales.utils.ImmutableArrayProxy]" id="90979">companion</a>: <span title="scala.collection.generic.GenericCompanion[scales.utils.ImmutableArrayProxy]">GenericCompanion</span><span class="delimiter">[</span>ImmutableArrayProxy<span class="delimiter">]</span> = <a href="#90981" title="=&gt; Nothing">err</a></span>
<a href="l336"></a><span id="l336"></span>
<a href="l337"></a><span id="l337">  <span class="keyword">override</span> <span class="keyword">protected</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.Builder[A,scales.utils.ImmutableArrayProxy[A]]" id="90980">newBuilder</a>: <span title="scala.collection.mutable.Builder[A,scales.utils.ImmutableArrayProxy[A]]">Builder</span><span class="delimiter">[</span>A, ImmutableArrayProxy<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#90981" title="=&gt; Nothing">err</a></span>
<a href="l338"></a><span id="l338"></span>
<a href="l339"></a><span id="l339">  <a href="#11773" title="(x$1: Array[AnyRef])Unit">display0</a> = <span title="Array[AnyRef]" class="keyword">new</span> <span title="Array[AnyRef]">Array</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(32)" class="int">32</span><span class="delimiter">)</span></span>
<a href="l340"></a><span id="l340">  <a href="#11773" title="(x$1: Int)Unit">depth</a> = <span title="Int(1)" class="int">1</span></span>
<a href="l341"></a><span id="l341"></span>
<a href="l342"></a><span id="l342">  <span class="keyword">def</span> <a title="=&gt; Nothing" id="90981">err</a> = <a href="../utils/package.scala.html#12052" title="(str: String)Nothing">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;MutableVector like only supports apply(length-1), updated(length - 1), :+ and immutable&quot;)" class="string">&quot;MutableVector like only supports apply(length-1), updated(length - 1), :+ and immutable&quot;</span><span class="delimiter">)</span></span>
<a href="l343"></a><span id="l343"></span>
<a href="l344"></a><span id="l344">  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="90983">blockIndex</a> = <span title="Int(0)" class="int">0</span></span>
<a href="l345"></a><span id="l345">  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="90986">lo</a> = <span title="Int(0)" class="int">0</span></span>
<a href="l346"></a><span id="l346"></span>
<a href="l347"></a><span id="l347">  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="90989">len</a> = <span title="Int(0)" class="int">0</span></span>
<a href="l348"></a><span id="l348"></span>
<a href="l349"></a><span id="l349">  <span class="keyword">def</span> <a title="(idx: Int)A" id="90991">apply</a><span class="delimiter">(</span><a title="Int" id="91189">idx</a> : <span title="Int">Int</span> <span class="delimiter">)</span> = </span>
<a href="l350"></a><span id="l350">    <span title="A" class="keyword">if</span> <span class="delimiter">(</span><a href="#91189" title="Int">idx</a> <span title="(x: Int)Boolean">!=</span> <span class="delimiter">(</span><a href="#90989" title="=&gt; Int">len</a> <span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l351"></a><span id="l351">      <a href="#90981" title="=&gt; Nothing">err</a></span>
<a href="l352"></a><span id="l352">    <span class="keyword">else</span></span>
<a href="l353"></a><span id="l353">      <a href="#11773" title="(i: Int)AnyRef">display0</a><span class="delimiter">(</span><a href="#90986" title="=&gt; Int">lo</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="A" class="delimiter">[</span><a href="#91162" title="A">A</a><span class="delimiter">]</span></span>
<a href="l354"></a><span id="l354"></span>
<a href="l355"></a><span id="l355">  @inline <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Int" id="90992">length</a> = <a href="#90989" title="=&gt; Int">len</a></span>
<a href="l356"></a><span id="l356">  </span>
<a href="l357"></a><span id="l357">  @inline <span class="keyword">override</span> <span class="keyword">def</span> <a title="[B &gt;: A, That](elem: B)(implicit bf: scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[A],B,That])That" id="90993">+:</a><span class="delimiter">[</span><a title="&gt;: A &lt;: Any" id="90996">B</a> &gt;: A, <a title="&gt;: Nothing &lt;: Any" id="90997">That</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="B" id="91213">elem</a>: <a href="#90996" title="B">B</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[A],B,That]" id="91214">bf</a>: <span title="scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[A],B,That]">CanBuildFrom</span><span class="delimiter">[</span>ImmutableArrayProxy<span class="delimiter">[</span>A<span class="delimiter">]</span>, B, That<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#90997" title="That">That</a> = <a href="#90981" title="=&gt; Nothing">err</a></span>
<a href="l358"></a><span id="l358">  </span>
<a href="l359"></a><span id="l359">  @inline <span class="keyword">override</span> <span class="keyword">def</span> <a title="[B &gt;: A, That](elem: B)(implicit bf: scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[A],B,That])That" id="90998">:+</a><span class="delimiter">[</span><a title="&gt;: A &lt;: Any" id="91001">B</a> &gt;: A, <a title="&gt;: Nothing &lt;: Any" id="91002">That</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="B" id="91239">elem</a>: <a href="#91001" title="B">B</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[A],B,That]" id="91240">bf</a>: <span title="scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[A],B,That]">CanBuildFrom</span><span class="delimiter">[</span>ImmutableArrayProxy<span class="delimiter">[</span>A<span class="delimiter">]</span>, B, That<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#91002" title="That">That</a> = <span class="delimiter">{</span></span>
<a href="l360"></a><span id="l360">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#90986" title="=&gt; Int">lo</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#11773" title="=&gt; Array[AnyRef]">display0</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l361"></a><span id="l361">      <span class="keyword">val</span> <a title="Int" id="91269">newBlockIndex</a> = <a href="#90983" title="=&gt; Int">blockIndex</a><span title="(x: Int)Int">+</span><span title="Int(32)" class="int">32</span></span>
<a href="l362"></a><span id="l362">      <a href="#11773" title="(index: Int, xor: Int)Unit">gotoNextBlockStartWritable</a><span class="delimiter">(</span><a href="#91269" title="Int">newBlockIndex</a>, <a href="#90983" title="=&gt; Int">blockIndex</a> <span title="(x: Int)Int">^</span> <a href="#91269" title="Int">newBlockIndex</a><span class="delimiter">)</span></span>
<a href="l363"></a><span id="l363">      <a href="#90983" title="(x$1: Int)Unit">blockIndex</a> = <a href="#91269" title="Int">newBlockIndex</a></span>
<a href="l364"></a><span id="l364">      <a href="#90986" title="(x$1: Int)Unit">lo</a> = <span title="Int(0)" class="int">0</span></span>
<a href="l365"></a><span id="l365">    <span class="delimiter">}</span></span>
<a href="l366"></a><span id="l366">    <a href="#11773" title="(i: Int, x: AnyRef)Unit">display0</a><span class="delimiter">(</span><a href="#90986" title="=&gt; Int">lo</a><span class="delimiter">)</span> = <a href="#91239" title="B">elem</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span></span>
<a href="l367"></a><span id="l367">    <a href="#90986" title="(x$1: Int)Unit">lo</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l368"></a><span id="l368">    <a href="#90989" title="(x$1: Int)Unit">len</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l369"></a><span id="l369">    <a href="#11773" title="MutableVectorLike.this.type" class="keyword">this</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="That" class="delimiter">[</span><a href="#91002" title="That">That</a><span class="delimiter">]</span></span>
<a href="l370"></a><span id="l370">  <span class="delimiter">}</span></span>
<a href="l371"></a><span id="l371"></span>
<a href="l372"></a><span id="l372">  <span class="comment">/**</span>
<a href="l373"></a><span id="l373">   * Basically optimised version for back, hint used directly, one new array creation</span>
<a href="l374"></a><span id="l374">   */</span> </span>
<a href="l375"></a><span id="l375">  @inline <span class="keyword">override</span> <span class="keyword">def</span> <a title="[B &gt;: A, That](index: Int, elem: B)(implicit bf: scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[A],B,That])That" id="91003">updated</a><span class="delimiter">[</span><a title="&gt;: A &lt;: Any" id="91006">B</a> &gt;: A, <a title="&gt;: Nothing &lt;: Any" id="91007">That</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Int" id="91288">index</a>: <span title="Int">Int</span>, <a title="B" id="91289">elem</a>: <a href="#91006" title="B">B</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[A],B,That]" id="91290">bf</a>: <span title="scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[A],B,That]">CanBuildFrom</span><span class="delimiter">[</span>ImmutableArrayProxy<span class="delimiter">[</span>A<span class="delimiter">]</span>, B, That<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#91007" title="That">That</a> =</span>
<a href="l376"></a><span id="l376">    <span title="That" class="keyword">if</span> <span class="delimiter">(</span><a href="#91288" title="Int">index</a> <span title="(x: Int)Boolean">!=</span> <span class="delimiter">(</span><a href="#90989" title="=&gt; Int">len</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l377"></a><span id="l377">      <a href="#90981" title="=&gt; Nothing">err</a></span>
<a href="l378"></a><span id="l378">    <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l379"></a><span id="l379">      <a href="#11773" title="(i: Int, x: AnyRef)Unit">display0</a><span class="delimiter">(</span><a href="#90986" title="=&gt; Int">lo</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> = <a href="#91289" title="B">elem</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span></span>
<a href="l380"></a><span id="l380">      <a href="#11773" title="MutableVectorLike.this.type" class="keyword">this</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="That" class="delimiter">[</span><a href="#91007" title="That">That</a><span class="delimiter">]</span></span>
<a href="l381"></a><span id="l381">    <span class="delimiter">}</span></span>
<a href="l382"></a><span id="l382"></span>
<a href="l383"></a><span id="l383">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Nothing" id="91008">iterator</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#90981" title="=&gt; Nothing">err</a></span>
<a href="l384"></a><span id="l384"></span>
<a href="l385"></a><span id="l385">  <span class="keyword">def</span> <a title="=&gt; Nothing" id="91009">ar</a> = <a href="#90981" title="=&gt; Nothing">err</a></span>
<a href="l386"></a><span id="l386"></span>
<a href="l387"></a><span id="l387">  <span class="keyword">def</span> <a title="=&gt; scales.utils.ImmutableArrayProxy[A]" id="91010">immutable</a> : <a href="../utils/ImmutableArray.scala.html#10380" title="scales.utils.ImmutableArrayProxy[A]">ImmutableArrayProxy</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l388"></a><span id="l388">    <span class="keyword">val</span> <a title="Int" id="91339">size</a> = <a href="#90989" title="=&gt; Int">len</a></span>
<a href="l389"></a><span id="l389"></span>
<a href="l390"></a><span id="l390">    <span class="keyword">import</span> scala.annotation.switch	</span>
<a href="l391"></a><span id="l391"></span>
<a href="l392"></a><span id="l392">    <span class="keyword">val</span> <a title="scales.utils.ImmutableArrayProxy[A]" id="91341">res</a> : <a href="../utils/ImmutableArray.scala.html#10380" title="scales.utils.ImmutableArrayProxy[A]">ImmutableArrayProxy</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = </span>
<a href="l393"></a><span id="l393">      <span title="scales.utils.ImmutableArrayProxy[A]" class="keyword">if</span> <span class="delimiter">(</span><a href="#90989" title="=&gt; Int">len</a> <span title="(x: Int)Boolean">&gt;</span> ImmutableArrayProxyBuilder.<span title="Int(31)">vectorAfter</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l394"></a><span id="l394">	<span title="scales.utils.ImmutableArrayProxy[A]" class="keyword">if</span> <span class="delimiter">(</span><a href="#91339" title="Int">size</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span></span>
<a href="l395"></a><span id="l395">	  <a href="../utils/ImmutableArray.scala.html#46713" title="(ar: Vector[Nothing])scales.utils.VectorImpl[Nothing]">VectorImpl</a><span class="delimiter">(</span><span title="object scala.collection.immutable.Vector">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span></span>
<a href="l396"></a><span id="l396">	<span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l397"></a><span id="l397">	  <span class="keyword">val</span> <a title="scala.collection.immutable.Vector[A]" id="91388">s</a> = <span title="scala.collection.immutable.Vector[A]" class="keyword">new</span> <span title="scala.collection.immutable.Vector[A]">Vector</span><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#91339" title="Int">size</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span></span>
<a href="l398"></a><span id="l398">	  <a href="#91388" title="scala.collection.immutable.Vector[A]">s</a>.<span title="(that: scala.collection.immutable.VectorPointer[A])Unit">initFrom</span><span class="delimiter">(</span><a href="#11773" title="scala.collection.immutable.MutableVectorLike[A]" class="keyword">this</a><span class="delimiter">)</span></span>
<a href="l399"></a><span id="l399">	  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#11773" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="#91388" title="scala.collection.immutable.Vector[A]">s</a>.<span title="(index: Int, xor: Int)Unit">gotoPos</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#91339" title="Int">size</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span> <span class="delimiter">)</span></span>
<a href="l400"></a><span id="l400"></span>
<a href="l401"></a><span id="l401">	  <a href="../utils/ImmutableArray.scala.html#46713" title="(ar: Vector[A])scales.utils.VectorImpl[A]">VectorImpl</a><span class="delimiter">(</span><a href="#91388" title="scala.collection.immutable.Vector[A]">s</a><span class="delimiter">)</span></span>
<a href="l402"></a><span id="l402">	<span class="delimiter">}</span></span>
<a href="l403"></a><span id="l403">      <span class="delimiter">}</span> <span class="keyword">else</span> </span>
<a href="l404"></a><span id="l404">	<span class="delimiter">(</span><a href="#90989" title="=&gt; Int">len</a> : @<span title="Int @scala.annotation.switch">switch</span><span class="delimiter">)</span> <span title="scales.utils.ImmutableArrayProxy[A]" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l405"></a><span id="l405">	  <span class="keyword">case</span> <span title="scales.utils.ImmutableArrayProxy[A]" class="int">0</span> =&gt; </span>
<a href="l406"></a><span id="l406">	      <a href="../utils/ImmutableArray.scala.html#10374" title="object scales.utils.ImmutableArrayProxy">ImmutableArrayProxy</a>.<a href="../utils/ImmutableArray.scala.html#46274" title="=&gt; scales.utils.IAEmpty[Nothing]">emptyImmutableArray</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scales.utils.ImmutableArrayProxy[A]" class="delimiter">[</span><a href="../utils/ImmutableArray.scala.html#10380" title="scales.utils.ImmutableArrayProxy[A]">ImmutableArrayProxy</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span></span>
<a href="l407"></a><span id="l407">	  <span class="keyword">case</span> <span title="scales.utils.IAOne[A]" class="int">1</span> =&gt;</span>
<a href="l408"></a><span id="l408">	    <a href="../utils/ImmutableArray.scala.html#45303" title="(one: A)scales.utils.IAOne[A]">IAOne</a><span class="delimiter">(</span><a href="#11773" title="(i: Int)AnyRef">display0</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="A" class="delimiter">[</span><a href="#91162" title="A">A</a><span class="delimiter">]</span><span class="delimiter">)</span></span>
<a href="l409"></a><span id="l409">	  <span class="keyword">case</span> <span title="scales.utils.IATwo[A]" class="int">2</span> =&gt;</span>
<a href="l410"></a><span id="l410">	    <a href="../utils/ImmutableArray.scala.html#45412" title="(one: A, two: A)scales.utils.IATwo[A]">IATwo</a><span class="delimiter">(</span><a href="#11773" title="(i: Int)AnyRef">display0</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="A" class="delimiter">[</span><a href="#91162" title="A">A</a><span class="delimiter">]</span>, <a href="#11773" title="(i: Int)AnyRef">display0</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="A" class="delimiter">[</span><a href="#91162" title="A">A</a><span class="delimiter">]</span><span class="delimiter">)</span></span>
<a href="l411"></a><span id="l411">	  <span class="keyword">case</span> <span title="scales.utils.IAThree[A]" class="int">3</span> =&gt;</span>
<a href="l412"></a><span id="l412">	    <a href="../utils/ImmutableArray.scala.html#45578" title="(one: A, two: A, three: A)scales.utils.IAThree[A]">IAThree</a><span class="delimiter">(</span><a href="#11773" title="(i: Int)AnyRef">display0</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="A" class="delimiter">[</span><a href="#91162" title="A">A</a><span class="delimiter">]</span>, <a href="#11773" title="(i: Int)AnyRef">display0</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="A" class="delimiter">[</span><a href="#91162" title="A">A</a><span class="delimiter">]</span>, <a href="#11773" title="(i: Int)AnyRef">display0</a><span class="delimiter">(</span><span title="Int(2)" class="int">2</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="A" class="delimiter">[</span><a href="#91162" title="A">A</a><span class="delimiter">]</span><span class="delimiter">)</span></span>
<a href="l413"></a><span id="l413">	  <span class="keyword">case</span> <span title="scales.utils.ImmutableArrayProxy[A]">_</span> =&gt; </span>
<a href="l414"></a><span id="l414">	    <span title="scales.utils.ImmutableArrayProxy[A]" class="keyword">if</span> <span class="delimiter">(</span><a href="#91160" title="=&gt; Boolean">copyArray</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l415"></a><span id="l415">	      <span class="keyword">val</span> <a title="Array[AnyRef]" id="91442">nar</a> = <span title="Array[AnyRef]" class="keyword">new</span> <span title="Array[AnyRef]">Array</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span><span class="delimiter">(</span><a href="#91339" title="Int">size</a><span class="delimiter">)</span></span>
<a href="l416"></a><span id="l416">	      <span title="object Array">Array</span>.<span title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</span><span class="delimiter">(</span><a href="#11773" title="=&gt; Array[AnyRef]">display0</a>, <span title="Int(0)" class="int">0</span>, <a href="#91442" title="Array[AnyRef]">nar</a>, <span title="Int(0)" class="int">0</span>, <a href="#91339" title="Int">size</a><span class="delimiter">)</span></span>
<a href="l417"></a><span id="l417">	      <a href="../utils/ImmutableArray.scala.html#45972" title="[A](base: Array[AnyRef])scales.utils.ImmutableArrayAll[A]">ImmutableArrayAll</a><span title="(base: Array[AnyRef])scales.utils.ImmutableArrayAll[A]" class="delimiter">[</span><a href="#91162" title="A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#91442" title="Array[AnyRef]">nar</a><span class="delimiter">)</span></span>
<a href="l418"></a><span id="l418">	    <span class="delimiter">}</span> <span class="keyword">else</span></span>
<a href="l419"></a><span id="l419">	      <a href="../utils/ImmutableArray.scala.html#43132" title="(base: Array[AnyRef], offset: Int, len: Int)scales.utils.ImmutableArray[Nothing]">ImmutableArray</a><span class="delimiter">(</span><a href="#11773" title="=&gt; Array[AnyRef]">display0</a>, <span title="Int(0)" class="int">0</span>, <a href="#91339" title="Int">size</a><span class="delimiter">)</span> <span class="comment">// bad memory wise but no added cost</span></span>
<a href="l420"></a><span id="l420">	<span class="delimiter">}</span></span>
<a href="l421"></a><span id="l421">      </span>
<a href="l422"></a><span id="l422">    </span>
<a href="l423"></a><span id="l423">    <span class="comment">// wipe this one out</span></span>
<a href="l424"></a><span id="l424">    <a href="#11773" title="(x$1: Array[AnyRef])Unit">display0</a> = <span title="Null(null)" class="keyword">null</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Array[AnyRef]" class="delimiter">[</span><span title="Array[AnyRef]">Array</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span><span class="delimiter">]</span></span>
<a href="l425"></a><span id="l425"></span>
<a href="l426"></a><span id="l426">    <a href="#91341" title="scales.utils.ImmutableArrayProxy[A]">res</a></span>
<a href="l427"></a><span id="l427">  <span class="delimiter">}</span></span>
<a href="l428"></a><span id="l428"></span>
<a href="l429"></a><span id="l429">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="91011">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="java.lang.String(&quot;MutableVectorLike&quot;)" class="string">&quot;MutableVectorLike&quot;</span></span>
<a href="l430"></a><span id="l430"><span class="delimiter">}</span></span>
<a href="l431"></a><span id="l431"></span>
<a href="l432"></a><span id="l432"><span class="delimiter">}</span></span>
<a href="l433"></a><span id="l433"></span>
<a href="l434"></a><span id="l434">        </span>
</pre>
    </body>
</html>