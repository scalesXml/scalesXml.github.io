<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scales\xml\XmlPull.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    
<style id="linesStyle">
.lineHighlight {
  background-color: #a5a5a5;
}
</style>
<script type="text/javascript">
function selectedLine() {
    var loca = /^.*#l(.*)/.exec(location.href);
    return loca ? loca[1] : '0';
}

function highlightLine(ln){
  $('#l'+ln).toggleClass('lineHighlight');
}

function gotoLine(ln){
  $('#l'+ln).focus();
}

$(function(){
  var line = selectedLine();
  if (line != '0') highlightLine(line)
});
</script></head>
    <body>
        <pre>
<!-- SXR_LINES --><a href="l1"></a><span id="l1"></span>
<a href="l2"></a><span id="l2"><span class="keyword">package</span> scales.xml</span>
<a href="l3"></a><span id="l3"></span>
<a href="l4"></a><span id="l4"><span class="keyword">import</span> javax.xml.stream._</span>
<a href="l5"></a><span id="l5"><span class="keyword">import</span> scales.utils._</span>
<a href="l6"></a><span id="l6"></span>
<a href="l7"></a><span id="l7"><span class="comment">/**</span>
<a href="l8"></a><span id="l8"> * Wraps the stax cursor inteface (iterator just adds weight here).</span>
<a href="l9"></a><span id="l9"> *</span>
<a href="l10"></a><span id="l10"> * scala.xml.pull uses a thread based on stax approach to push/pull events.</span>
<a href="l11"></a><span id="l11"> *</span>
<a href="l12"></a><span id="l12"> * This code uses stax only, extra iteratee goodness will appear curtousy of scalaz....</span>
<a href="l13"></a><span id="l13"> *</span>
<a href="l14"></a><span id="l14"> */</span></span>
<a href="l15"></a><span id="l15"><span class="keyword">trait</span> <a title="trait XmlPulls extends java.lang.Object with ScalaObject" id="11965">XmlPulls</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l16"></a><span id="l16">  <span class="keyword">import</span> java.io._</span>
<a href="l17"></a><span id="l17"></span>
<a href="l18"></a><span id="l18">  <span class="comment">/**</span>
<a href="l19"></a><span id="l19">   * Load xml via pull parsing</span>
<a href="l20"></a><span id="l20">   */</span> </span>
<a href="l21"></a><span id="l21">  <span class="keyword">def</span> <a title="[RToken &lt;: scales.xml.OptimisationToken](source: org.xml.sax.InputSource, strategy: scales.xml.PathOptimisationStrategy[RToken], parserFactoryPool: scales.utils.Pool[javax.xml.stream.XMLInputFactory], closeAfterUse: Boolean)scales.xml.Doc" id="12516">pullXmlCompletely</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="110012">RToken</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span> <a title="org.xml.sax.InputSource" id="110005">source</a> : org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span>, <a title="scales.xml.PathOptimisationStrategy[RToken]" id="110010">strategy</a> : <a href="OptimisingStrategies.scala.html#10680" title="scales.xml.PathOptimisationStrategy[RToken]">PathOptimisationStrategy</a><span class="delimiter">[</span>RToken<span class="delimiter">]</span> = <a href="package.scala.html#12436" title="=&gt; scales.xml.PathOptimisationStrategy[scales.xml.ElemToken]">defaultPathOptimisation</a>, <a title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]" id="110013">parserFactoryPool</a> : <a href="../utils/Resources.scala.html#10607" title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]">Pool</a><span class="delimiter">[</span>XMLInputFactory<span class="delimiter">]</span> = <a href="XmlFactories.scala.html#12546" title="object scales.xml.package.DefaultStaxInputFactoryPool">DefaultStaxInputFactoryPool</a>, <a title="Boolean" id="110016">closeAfterUse</a> : <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> : <a href="XmlTypes.scala.html#12027" title="scales.xml.Doc">Doc</a> = <span class="delimiter">{</span></span>
<a href="l22"></a><span id="l22">    <span class="keyword">val</span> <a title="XmlPulls extends scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed" id="110023">pull</a> = <a href="#12522" title="[RToken &lt;: scales.xml.OptimisationToken](source: org.xml.sax.InputSource, optimisationStrategy: scales.xml.MemoryOptimisationStrategy[RToken], parserFactoryPool: scales.utils.Pool[javax.xml.stream.XMLInputFactory], closeAfterUse: Boolean)scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed">pullXml</a><span title="(source: org.xml.sax.InputSource, optimisationStrategy: scales.xml.MemoryOptimisationStrategy[RToken], parserFactoryPool: scales.utils.Pool[javax.xml.stream.XMLInputFactory], closeAfterUse: Boolean)scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed" class="delimiter">[</span><a href="#110012" title="RToken">RToken</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#110005" title="org.xml.sax.InputSource">source</a>, <a href="#110010" title="scales.xml.PathOptimisationStrategy[RToken]">strategy</a>, <a href="#110013" title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]">parserFactoryPool</a>, <a href="#110016" title="Boolean">closeAfterUse</a><span class="delimiter">)</span></span>
<a href="l23"></a><span id="l23">    <span class="keyword">val</span> <a title="RToken" id="110024">token</a> = <a href="#110023" title="XmlPulls extends scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed">pull</a>.<a href="#89877" title="=&gt; pull.Token">token</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="RToken" class="delimiter">[</span><a href="#110012" title="RToken">RToken</a><span class="delimiter">]</span> <span class="comment">// really is an RToken but we lose the type</span></span>
<a href="l24"></a><span id="l24"></span>
<a href="l25"></a><span id="l25">    <span class="comment">// start with nothing</span></span>
<a href="l26"></a><span id="l26">    <span class="keyword">val</span> <a title="scales.xml.TreeProxies" id="110025">buf</a> = <a href="XmlParser.scala.html#94351" title="scales.xml.TreeProxies" class="keyword">new</a> <a href="XmlParser.scala.html#11877" title="scales.xml.TreeProxies">TreeProxies</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l27"></a><span id="l27"></span>
<a href="l28"></a><span id="l28">    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span> <a href="#110023" title="XmlPulls extends scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed">pull</a>.<a href="#89901" title="=&gt; Boolean">hasNext</a> <span class="delimiter">)</span><span class="delimiter">{</span></span>
<a href="l29"></a><span id="l29">      <a href="#110023" title="XmlPulls extends scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed">pull</a>.<a href="#89905" title="()scales.xml.package.PullType">next</a> <a href="#110026" title="Unit" class="keyword">match</a> <span class="delimiter">{</span></span>
<a href="l30"></a><span id="l30">	<span class="keyword">case</span> <span title="Unit">Left</span><span class="delimiter">(</span> <a title="scales.xml.XmlItem" id="110056">i</a> : <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a> <span class="delimiter">)</span> =&gt; </span>
<a href="l31"></a><span id="l31">	  <a href="#110025" title="scales.xml.TreeProxies">buf</a>.<a href="XmlParser.scala.html#88861" title="(i: scales.xml.XmlItem)Unit">addChild</a><span class="delimiter">(</span><a href="#110056" title="scales.xml.XmlItem">i</a><span class="delimiter">)</span></span>
<a href="l32"></a><span id="l32">	<span class="keyword">case</span> <span title="Unit">Left</span><span class="delimiter">(</span> <a title="scales.xml.Elem" id="110058">e</a> : <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a> <span class="delimiter">)</span> =&gt; </span>
<a href="l33"></a><span id="l33">	  <a href="#110010" title="scales.xml.PathOptimisationStrategy[RToken]">strategy</a>.<a href="OptimisingStrategies.scala.html#88837" title="(stack: scales.xml.TreeProxies, elem: scales.xml.Elem, token: RToken)Unit">beginSubTree</a><span class="delimiter">(</span><a href="#110025" title="scales.xml.TreeProxies">buf</a>, <a href="#110058" title="scales.xml.Elem">e</a>, <a href="#110024" title="RToken">token</a><span class="delimiter">)</span></span>
<a href="l34"></a><span id="l34">	<span class="keyword">case</span> <span title="Unit">Right</span><span class="delimiter">(</span><a title="scales.xml.EndElem" id="110063">endElem</a><span class="delimiter">)</span> =&gt; </span>
<a href="l35"></a><span id="l35">	  <a href="#110010" title="scales.xml.PathOptimisationStrategy[RToken]">strategy</a>.<a href="OptimisingStrategies.scala.html#88836" title="(xml: scales.xml.TreeProxies, token: RToken)Unit">elementEnd</a><span class="delimiter">(</span><a href="#110025" title="scales.xml.TreeProxies">buf</a>, <a href="#110024" title="RToken">token</a><span class="delimiter">)</span></span>
<a href="l36"></a><span id="l36">      <span class="delimiter">}</span></span>
<a href="l37"></a><span id="l37">    <span class="delimiter">}</span></span>
<a href="l38"></a><span id="l38">    <a href="XmlTypes.scala.html#89985" title="(rootElem: scales.xml.package.XmlTree, prolog: scales.xml.Prolog, end: scales.xml.EndMisc)scales.xml.Doc">Doc</a><span class="delimiter">(</span><a href="#110025" title="scales.xml.TreeProxies">buf</a>.<a href="XmlParser.scala.html#88864" title="=&gt; scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">tree</a>, <a href="#110023" title="XmlPulls extends scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed">pull</a>.<a href="#89887" title="=&gt; scales.xml.Prolog">prolog</a>, <a href="#110023" title="XmlPulls extends scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed">pull</a>.<a href="#89888" title="=&gt; scales.xml.EndMisc">end</a><span class="delimiter">)</span></span>
<a href="l39"></a><span id="l39">  <span class="delimiter">}</span></span>
<a href="l40"></a><span id="l40"></span>
<a href="l41"></a><span id="l41">  <span class="comment">/**</span>
<a href="l42"></a><span id="l42">   * Creates a new XmlPull based on source for direct handling of the stream.  Note to close the stream you must bracket.</span>
<a href="l43"></a><span id="l43">   * The individual XmlPull will be closed after the document end but the stream will remain open</span>
<a href="l44"></a><span id="l44">   */</span></span>
<a href="l45"></a><span id="l45">  <span class="keyword">def</span> <a title="[RToken &lt;: scales.xml.OptimisationToken](source: org.xml.sax.InputSource, optimisationStrategy: scales.xml.MemoryOptimisationStrategy[RToken], parserFactoryPool: scales.utils.Pool[javax.xml.stream.XMLInputFactory])(scales.utils.CloseOnNeed, scales.xml.XmlPull)" id="12519">pullXmlResource</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="110081">RToken</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="org.xml.sax.InputSource" id="110075">source</a>: org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span>, <a title="scales.xml.MemoryOptimisationStrategy[RToken]" id="110079">optimisationStrategy</a> : <a href="OptimisingStrategies.scala.html#10675" title="scales.xml.MemoryOptimisationStrategy[RToken]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>RToken<span class="delimiter">]</span> = <a href="package.scala.html#12438" title="=&gt; scales.xml.MemoryOptimisationStrategy[scales.xml.ElemToken]">defaultOptimisation</a>, <a title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]" id="110082">parserFactoryPool</a>: <a href="../utils/Resources.scala.html#10607" title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]">Pool</a><span class="delimiter">[</span>XMLInputFactory<span class="delimiter">]</span> = <a href="XmlFactories.scala.html#12546" title="object scales.xml.package.DefaultStaxInputFactoryPool">DefaultStaxInputFactoryPool</a><span class="delimiter">)</span> : <span title="(scales.utils.CloseOnNeed, scales.xml.XmlPull)" class="delimiter">(</span>CloseOnNeed, XmlPull<span class="delimiter">)</span> = <span class="delimiter">{</span></span>
<a href="l46"></a><span id="l46">    <span class="keyword">val</span> <a title="scales.utils.ProxiedCloseOnNeedReader" id="110088">stream</a> = <a href="../utils/Resources.scala.html#85486" title="(orig: java.io.Reader)scales.utils.ProxiedCloseOnNeedReader">ProxiedCloseOnNeedReader</a><span class="delimiter">(</span><a href="#110075" title="org.xml.sax.InputSource">source</a>.<span title="()java.io.Reader">getCharacterStream</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// getByteStream() doesn't always work</span></span>
<a href="l47"></a><span id="l47"></span>
<a href="l48"></a><span id="l48">    <span class="keyword">val</span> <a title="javax.xml.stream.XMLInputFactory" id="110089">pf</a> = <a href="#110082" title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]">parserFactoryPool</a>.<a href="../utils/Resources.scala.html#85736" title="=&gt; javax.xml.stream.XMLInputFactory">grab</a></span>
<a href="l49"></a><span id="l49">    </span>
<a href="l50"></a><span id="l50">    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.FromParser" id="110090">weAreInAParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a> = <a href="XmlTypes.scala.html#12400" title="object scales.xml.package.IsFromParser">IsFromParser</a></span>
<a href="l51"></a><span id="l51"></span>
<a href="l52"></a><span id="l52">    <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.defaultVersion</span>
<a href="l53"></a><span id="l53"></span>
<a href="l54"></a><span id="l54">    <span title="(_1: scales.utils.ProxiedCloseOnNeedReader, _2: java.lang.Object with scales.xml.XmlPull{type Token = RToken})(scales.utils.ProxiedCloseOnNeedReader, java.lang.Object with scales.xml.XmlPull{type Token = RToken})" class="delimiter">(</span><a href="#110088" title="scales.utils.ProxiedCloseOnNeedReader">stream</a>,</span>
<a href="l55"></a><span id="l55">      <a href="#110098" title="java.lang.Object with scales.xml.XmlPull{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.XmlPull" id="110098">XmlPull</a> <span class="delimiter">{</span></span>
<a href="l56"></a><span id="l56">	<span class="keyword">type</span> <a title="RToken" id="110270">Token</a> = <a href="#110081" title="RToken">RToken</a></span>
<a href="l57"></a><span id="l57">	</span>
<a href="l58"></a><span id="l58">	<span class="keyword">val</span> <a title="scales.xml.MemoryOptimisationStrategy[RToken]" id="110271">strategy</a> = <a href="#110079" title="scales.xml.MemoryOptimisationStrategy[RToken]">optimisationStrategy</a></span>
<a href="l59"></a><span id="l59">	<span class="keyword">implicit</span> <span class="keyword">val</span> <a title="RToken" id="110273">token</a> = <a href="#110079" title="scales.xml.MemoryOptimisationStrategy[RToken]">optimisationStrategy</a>.<a href="OptimisingStrategies.scala.html#87780" title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)RToken">createToken</a></span>
<a href="l60"></a><span id="l60"></span>
<a href="l61"></a><span id="l61">        <span class="keyword">val</span> <a title="javax.xml.stream.XMLStreamReader" id="110275">parser</a> = <a href="#110089" title="javax.xml.stream.XMLInputFactory">pf</a>.<span title="(x$1: java.io.Reader)javax.xml.stream.XMLStreamReader">createXMLStreamReader</span><span class="delimiter">(</span><a href="#110088" title="scales.utils.ProxiedCloseOnNeedReader">stream</a><span class="delimiter">)</span></span>
<a href="l62"></a><span id="l62">        <span class="keyword">val</span> <a title="() =&gt; Unit" id="110277">resourceCloser</a> = <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span> <a href="#110082" title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]">parserFactoryPool</a>.<a href="../utils/Resources.scala.html#85737" title="(t: javax.xml.stream.XMLInputFactory)Unit">giveBack</a><span class="delimiter">(</span><a href="#110089" title="javax.xml.stream.XMLInputFactory">pf</a><span class="delimiter">)</span> <span class="delimiter">}</span> <span class="comment">//noop its now the CloseOnNeeds job</span></span>
<a href="l63"></a><span id="l63"></span>
<a href="l64"></a><span id="l64">        <a href="#89898" title="=&gt; Unit">start</a></span>
<a href="l65"></a><span id="l65">      <span class="delimiter">}</span><span class="delimiter">)</span></span>
<a href="l66"></a><span id="l66">  <span class="delimiter">}</span></span>
<a href="l67"></a><span id="l67"></span>
<a href="l68"></a><span id="l68">  <span class="comment">/**</span>
<a href="l69"></a><span id="l69">   * Creates a new XmlPull based on source.  By default it will close the stream after use.</span>
<a href="l70"></a><span id="l70">   */</span></span>
<a href="l71"></a><span id="l71">  <span class="keyword">def</span> <a title="[RToken &lt;: scales.xml.OptimisationToken](source: org.xml.sax.InputSource, optimisationStrategy: scales.xml.MemoryOptimisationStrategy[RToken], parserFactoryPool: scales.utils.Pool[javax.xml.stream.XMLInputFactory], closeAfterUse: Boolean)scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed" id="12522">pullXml</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="110035">RToken</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="org.xml.sax.InputSource" id="110027">source</a>: org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span>, <a title="scales.xml.MemoryOptimisationStrategy[RToken]" id="110033">optimisationStrategy</a> : <a href="OptimisingStrategies.scala.html#10675" title="scales.xml.MemoryOptimisationStrategy[RToken]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>RToken<span class="delimiter">]</span> = <a href="package.scala.html#12438" title="=&gt; scales.xml.MemoryOptimisationStrategy[scales.xml.ElemToken]">defaultOptimisation</a>, <a title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]" id="110036">parserFactoryPool</a>: <a href="../utils/Resources.scala.html#10607" title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]">Pool</a><span class="delimiter">[</span>XMLInputFactory<span class="delimiter">]</span> = <a href="XmlFactories.scala.html#12546" title="object scales.xml.package.DefaultStaxInputFactoryPool">DefaultStaxInputFactoryPool</a>, <a title="Boolean" id="110039">closeAfterUse</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> : <a href="#110031" title="XmlPulls extends scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed">XmlPull</a> <span class="keyword">with</span> java.io.Closeable <span class="keyword">with</span> IsClosed = <span class="delimiter">{</span></span>
<a href="l72"></a><span id="l72">    <span class="keyword">val</span> <a title="scales.utils.ProxiedCloseOnNeedReader" id="110382">stream</a> = <a href="../utils/Resources.scala.html#85486" title="(orig: java.io.Reader)scales.utils.ProxiedCloseOnNeedReader">ProxiedCloseOnNeedReader</a><span class="delimiter">(</span><a href="#110027" title="org.xml.sax.InputSource">source</a>.<span title="()java.io.Reader">getCharacterStream</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// getByteStream() doesn't always work</span></span>
<a href="l73"></a><span id="l73"></span>
<a href="l74"></a><span id="l74">    <span class="keyword">val</span> <a title="javax.xml.stream.XMLInputFactory" id="110383">pf</a> = <a href="#110036" title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]">parserFactoryPool</a>.<a href="../utils/Resources.scala.html#85736" title="=&gt; javax.xml.stream.XMLInputFactory">grab</a></span>
<a href="l75"></a><span id="l75"></span>
<a href="l76"></a><span id="l76">    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.FromParser" id="110384">weAreInAParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a> = <a href="XmlTypes.scala.html#12400" title="object scales.xml.package.IsFromParser">IsFromParser</a></span>
<a href="l77"></a><span id="l77">    </span>
<a href="l78"></a><span id="l78">    <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.defaultVersion</span>
<a href="l79"></a><span id="l79"></span>
<a href="l80"></a><span id="l80">    <a href="#110388" title="java.lang.Object with scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed" id="110388">XmlPull</a> <span class="keyword">with</span> java.io.<span title="java.io.Closeable">Closeable</span> <span class="keyword">with</span> <a href="../utils/Resources.scala.html#10596" title="scales.utils.IsClosed">IsClosed</a> <span class="delimiter">{</span></span>
<a href="l81"></a><span id="l81">      <span class="keyword">type</span> <a title="RToken" id="110558">Token</a> = <a href="#110035" title="RToken">RToken</a></span>
<a href="l82"></a><span id="l82"></span>
<a href="l83"></a><span id="l83">      <span class="keyword">val</span> <a title="scales.xml.MemoryOptimisationStrategy[RToken]" id="110559">strategy</a> = <a href="#110033" title="scales.xml.MemoryOptimisationStrategy[RToken]">optimisationStrategy</a></span>
<a href="l84"></a><span id="l84">      <span class="keyword">val</span> <a title="RToken" id="110561">token</a> = <a href="#110033" title="scales.xml.MemoryOptimisationStrategy[RToken]">optimisationStrategy</a>.<a href="OptimisingStrategies.scala.html#87780" title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)RToken">createToken</a></span>
<a href="l85"></a><span id="l85"></span>
<a href="l86"></a><span id="l86">      <span class="keyword">val</span> <a title="javax.xml.stream.XMLStreamReader" id="110563">parser</a> = <a href="#110383" title="javax.xml.stream.XMLInputFactory">pf</a>.<span title="(x$1: java.io.Reader)javax.xml.stream.XMLStreamReader">createXMLStreamReader</span><span class="delimiter">(</span><a href="#110382" title="scales.utils.ProxiedCloseOnNeedReader">stream</a><span class="delimiter">)</span></span>
<a href="l87"></a><span id="l87">      <span class="keyword">val</span> <a title="() =&gt; Unit" id="110565">resourceCloser</a> = <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span> <a href="#110036" title="scales.utils.Pool[javax.xml.stream.XMLInputFactory]">parserFactoryPool</a>.<a href="../utils/Resources.scala.html#85737" title="(t: javax.xml.stream.XMLInputFactory)Unit">giveBack</a><span class="delimiter">(</span><a href="#110383" title="javax.xml.stream.XMLInputFactory">pf</a><span class="delimiter">)</span>; <a href="#110382" title="scales.utils.ProxiedCloseOnNeedReader">stream</a>.<a href="../utils/Resources.scala.html#85194" title="=&gt; Unit">closeResource</a> <span class="delimiter">}</span> <span class="comment">// bug: 6539065 javadocs say does not close, implementation seems to close :&lt; calling it twice should be safe - especially with CloseOnNeed</span></span>
<a href="l88"></a><span id="l88"></span>
<a href="l89"></a><span id="l89">      <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Boolean" id="110567">closed</a> = <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l90"></a><span id="l90">      <span class="keyword">def</span> <a title="=&gt; Boolean" id="110568">isClosed</a> = <a href="#110567" title="Boolean">closed</a></span>
<a href="l91"></a><span id="l91"></span>
<a href="l92"></a><span id="l92">      <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="110569">internalClose</a> <span class="delimiter">{</span> <a href="#110570" title="()Unit">close</a> <span class="delimiter">}</span></span>
<a href="l93"></a><span id="l93"></span>
<a href="l94"></a><span id="l94">      <span class="keyword">def</span> <a title="()Unit" id="110570">close</a> <span class="delimiter">{</span></span>
<a href="l95"></a><span id="l95">        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#110567" title="Boolean">closed</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l96"></a><span id="l96">          <a href="#110563" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()Unit">close</span></span>
<a href="l97"></a><span id="l97">          <a href="#110565" title="()Unit">resourceCloser</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// parser close doesn't close the resource</span></span>
<a href="l98"></a><span id="l98">          <a href="#110567" title="Boolean">closed</a> = <span title="Boolean(true)" class="keyword">true</span></span>
<a href="l99"></a><span id="l99">        <span class="delimiter">}</span></span>
<a href="l100"></a><span id="l100">      <span class="delimiter">}</span></span>
<a href="l101"></a><span id="l101"></span>
<a href="l102"></a><span id="l102">      <a href="#89898" title="=&gt; Unit">start</a></span>
<a href="l103"></a><span id="l103">    <span class="delimiter">}</span></span>
<a href="l104"></a><span id="l104">  <span class="delimiter">}</span></span>
<a href="l105"></a><span id="l105"></span>
<a href="l106"></a><span id="l106">  <span class="comment">/**</span>
<a href="l107"></a><span id="l107">   * Allows plugging in other feeds, non source based, as such not closeable</span>
<a href="l108"></a><span id="l108">   */</span> </span>
<a href="l109"></a><span id="l109">  <span class="keyword">def</span> <a title="[RToken &lt;: scales.xml.OptimisationToken](reader: javax.xml.stream.XMLStreamReader, defaultOptimisationStrategy: scales.xml.MemoryOptimisationStrategy[RToken])scales.xml.XmlPull" id="12525">pullXmlReader</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="110593">RToken</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span> <a title="javax.xml.stream.XMLStreamReader" id="110588">reader</a>  : <span title="javax.xml.stream.XMLStreamReader">XMLStreamReader</span>, <a title="scales.xml.MemoryOptimisationStrategy[RToken]" id="110591">defaultOptimisationStrategy</a> : <a href="OptimisingStrategies.scala.html#10675" title="scales.xml.MemoryOptimisationStrategy[RToken]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>RToken<span class="delimiter">]</span> = <a href="package.scala.html#12438" title="=&gt; scales.xml.MemoryOptimisationStrategy[scales.xml.ElemToken]">defaultOptimisation</a><span class="delimiter">)</span> : <a href="#11969" title="scales.xml.XmlPull">XmlPull</a> = <a href="#110596" title="java.lang.Object with scales.xml.XmlPull{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.XmlPull" id="110596">XmlPull</a> <span class="delimiter">{</span></span>
<a href="l110"></a><span id="l110">    <span class="keyword">type</span> <a title="RToken" id="110767">Token</a> = <a href="#110593" title="RToken">RToken</a></span>
<a href="l111"></a><span id="l111"></span>
<a href="l112"></a><span id="l112">    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.FromParser" id="110768">eweAreInAParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a> = <a href="XmlTypes.scala.html#12400" title="object scales.xml.package.IsFromParser">IsFromParser</a></span>
<a href="l113"></a><span id="l113"></span>
<a href="l114"></a><span id="l114">    <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.defaultVersion</span>
<a href="l115"></a><span id="l115"></span>
<a href="l116"></a><span id="l116">    <span class="keyword">val</span> <a title="scales.xml.MemoryOptimisationStrategy[RToken]" id="110771">strategy</a> = <a href="#110591" title="scales.xml.MemoryOptimisationStrategy[RToken]">defaultOptimisationStrategy</a></span>
<a href="l117"></a><span id="l117">    <span class="keyword">val</span> <a title="RToken" id="110773">token</a> = <a href="#110591" title="scales.xml.MemoryOptimisationStrategy[RToken]">defaultOptimisationStrategy</a>.<a href="OptimisingStrategies.scala.html#87780" title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)RToken">createToken</a></span>
<a href="l118"></a><span id="l118"></span>
<a href="l119"></a><span id="l119">    <span class="keyword">val</span> <a title="javax.xml.stream.XMLStreamReader" id="110775">parser</a> = <a href="#110588" title="javax.xml.stream.XMLStreamReader">reader</a></span>
<a href="l120"></a><span id="l120">    <span class="keyword">val</span> <a title="() =&gt; Unit" id="110777">resourceCloser</a> = <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span></span>
<a href="l121"></a><span id="l121"></span>
<a href="l122"></a><span id="l122">    <a href="#89898" title="=&gt; Unit">start</a></span>
<a href="l123"></a><span id="l123">  <span class="delimiter">}</span></span>
<a href="l124"></a><span id="l124"></span>
<a href="l125"></a><span id="l125">  <span class="keyword">type</span> <a title="Either[scales.xml.XmlEvent,scales.xml.EndElem]" id="12528">PullType</a> = <span title="Either[scales.xml.XmlEvent,scales.xml.EndElem]">Either</span><span class="delimiter">[</span>XmlEvent, EndElem<span class="delimiter">]</span></span>
<a href="l126"></a><span id="l126"></span>
<a href="l127"></a><span id="l127">  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.XmlPulls.toLeft : (ev: scales.xml.XmlEvent)Left[scales.xml.XmlEvent,Nothing]" id="12529">toLeft</a><span class="delimiter">(</span><a title="scales.xml.XmlEvent" id="88204">ev</a>: <a href="XmlTypes.scala.html#11991" title="scales.xml.XmlEvent">XmlEvent</a><span class="delimiter">)</span> = <span title="(a: scales.xml.XmlEvent)Left[scales.xml.XmlEvent,Nothing]">Left</span><span class="delimiter">(</span><a href="#88204" title="scales.xml.XmlEvent">ev</a><span class="delimiter">)</span></span>
<a href="l128"></a><span id="l128">  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.XmlPulls.toRight : (ev: scales.xml.EndElem)Right[Nothing,scales.xml.EndElem]" id="12530">toRight</a><span class="delimiter">(</span><a title="scales.xml.EndElem" id="88045">ev</a>: <a href="#112951" title="scales.xml.EndElem">EndElem</a><span class="delimiter">)</span> = <span title="(b: scales.xml.EndElem)Right[Nothing,scales.xml.EndElem]">Right</span><span class="delimiter">(</span><a href="#88045" title="scales.xml.EndElem">ev</a><span class="delimiter">)</span></span>
<a href="l129"></a><span id="l129"></span>
<a href="l130"></a><span id="l130">  <span class="comment">// enumerators and iteratees follow</span></span>
<a href="l131"></a><span id="l131"></span>
<a href="l132"></a><span id="l132">  <span class="keyword">import</span> scalaz._</span>
<a href="l133"></a><span id="l133">  <span class="keyword">import</span> <span title="object scalaz.Scalaz">Scalaz</span>._</span>
<a href="l134"></a><span id="l134">  <span class="keyword">import</span> scalaz.<span title="object scalaz.IterV">IterV</span>._</span>
<a href="l135"></a><span id="l135"></span>
<a href="l136"></a><span id="l136">  <span class="keyword">type</span> <a title="(List[scales.xml.QName], Option[scales.xml.package.XmlPath])" id="12534">QNamesMatch</a> = <span title="(List[scales.xml.QName], Option[scales.xml.package.XmlPath])" class="delimiter">(</span>List<span class="delimiter">[</span>QName<span class="delimiter">]</span>, Option<span class="delimiter">[</span>XmlPath<span class="delimiter">]</span><span class="delimiter">)</span></span>
<a href="l137"></a><span id="l137"></span>
<a href="l138"></a><span id="l138">  <span class="comment">/**</span>
<a href="l139"></a><span id="l139">   * Collects all data belonging to an element that matches</span>
<a href="l140"></a><span id="l140">   * the list. &lt;top&gt;&lt;middle&gt;&lt;ofInterest&gt; content &lt;/ofInterest&gt;&lt;ofInterest....</span>
<a href="l141"></a><span id="l141">   * onQNames(List(&quot;top&quot;l, &quot;middle&quot;l, &quot;ofInterest&quot;l))</span>
<a href="l142"></a><span id="l142">   * would return an iteratee that returned every &lt;ofInterest&gt; content &lt;/ofInterest&gt;</span>
<a href="l143"></a><span id="l143">   * as a path (each parent node containing only one child node).</span>
<a href="l144"></a><span id="l144">   */</span></span>
<a href="l145"></a><span id="l145">  <span class="keyword">def</span> <a title="(qnames: List[scales.xml.QName])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]" id="12535">onQNames</a><span class="delimiter">(</span><a title="List[scales.xml.QName]" id="110783">qnames</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">ResumableIter</span><span class="delimiter">[</span>PullType, QNamesMatch<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l146"></a><span id="l146"></span>
<a href="l147"></a><span id="l147">    <span class="comment">/*</span>
<a href="l148"></a><span id="l148">     * The pairs allow the depth of each element to be followed.  In particular this stops both descent and ascent problems in the</span>
<a href="l149"></a><span id="l149">     * pushing and popping on the stack.  I.e. it covers the case where you have nested repeating QNames, both when you are looking for them</span>
<a href="l150"></a><span id="l150">     * and when your are not.  Don't pop to early and don't incorrectly force a done.</span>
<a href="l151"></a><span id="l151">     */</span></span>
<a href="l152"></a><span id="l152"></span>
<a href="l153"></a><span id="l153">    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]" id="110786">starter</a> = <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Cont</span><span class="delimiter">(</span><a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#110905" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><span title="object Nil">Nil</span>, <a href="#110902" title="(_1: scales.xml.QName, _2: Int)(scales.xml.QName, Int)" class="delimiter">(</a><a href="#110783" title="List[scales.xml.QName]">qnames</a>.<span title="=&gt; scales.xml.QName">head</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#110783" title="List[scales.xml.QName]">qnames</a>.<span title="=&gt; List[scales.xml.QName]">tail</span>.<span title="(f: scales.xml.QName =&gt; (scales.xml.QName, Int))(implicit bf: scala.collection.generic.CanBuildFrom[List[scales.xml.QName],(scales.xml.QName, Int),List[(scales.xml.QName, Int)]])List[(scales.xml.QName, Int)]">map</span><a href="#110903" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,(scales.xml.QName, Int),List[(scales.xml.QName, Int)]]" class="delimiter">(</a><span title="(_1: scales.xml.QName, _2: Int)(scales.xml.QName, Int)" class="delimiter">(</span><a href="#110837" title="scales.xml.QName">_</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="XmlTypes.scala.html#12429" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">noXmlPath</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l154"></a><span id="l154"></span>
<a href="l155"></a><span id="l155">    <span class="keyword">def</span> <a title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]" id="110787">step</a><span class="delimiter">(</span><a title="List[(scales.xml.QName, Int)]" id="110791">before</a>: <span title="List[(scales.xml.QName, Int)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>QName, Int<span class="delimiter">)</span><span class="delimiter">]</span>, <a title="(scales.xml.QName, Int)" id="110792">focus</a>: <span title="(scales.xml.QName, Int)" class="delimiter">(</span>QName, Int<span class="delimiter">)</span>, <a title="List[(scales.xml.QName, Int)]" id="110793">toGo</a>: <span title="List[(scales.xml.QName, Int)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>QName, Int<span class="delimiter">)</span><span class="delimiter">]</span>, <a title="scales.xml.package.XmlPath" id="110794">path</a>: <a href="../utils/Paths.scala.html#10533" title="scales.xml.package.XmlPath">XmlPath</a>, <a title="Boolean" id="110795">collecting</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="scalaz.Input[XmlPulls.this.PullType]" id="110796">s</a>: <span title="scalaz.Input[XmlPulls.this.PullType]">Input</span><span class="delimiter">[</span>PullType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">ResumableIter</span><span class="delimiter">[</span>PullType, QNamesMatch<span class="delimiter">]</span> =</span>
<a href="l156"></a><span id="l156">      <a href="#110796" title="(empty: =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])], el: =&gt; XmlPulls.this.PullType =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])], eof: =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">s</a><span class="delimiter">(</span>el = <span class="delimiter">{</span> <a title="=&gt; XmlPulls.this.PullType" id="110921">e</a> =&gt; <span class="comment">//println(e +&quot; &quot;+before+&quot; &quot;+focus+&quot; &quot; + toGo); </span></span>
<a href="l157"></a><span id="l157">        <a href="#110921" title="=&gt; XmlPulls.this.PullType">e</a> <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l158"></a><span id="l158"></span>
<a href="l159"></a><span id="l159">          <span class="keyword">case</span> <span title="scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Left</span><span class="delimiter">(</span><a title="scales.xml.Elem" id="110923">elem</a>@<a href="XmlTypes.scala.html#88404" title="(el: scales.xml.Elem)Some[(scales.xml.QName, scales.xml.package.Attributes, scala.collection.immutable.Map[String,String])]">Elem</a><span class="delimiter">(</span><a title="scales.xml.QName" id="110940">q</a>, <a title="scales.xml.package.Attributes" id="110941">a</a>, <a title="scala.collection.immutable.Map[String,String]" id="110942">n</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span></span>
<a href="l160"></a><span id="l160">            <span class="keyword">val</span> <a title="(scales.xml.QName, Int)" id="110943">nfocus</a> = <span title="(scales.xml.QName, Int)" class="keyword">if</span> <span class="delimiter">(</span><a href="#110940" title="scales.xml.QName">q</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#110792" title="(scales.xml.QName, Int)">focus</a>.<span title="=&gt; scales.xml.QName">_1</span><span class="delimiter">)</span> <span title="(_1: scales.xml.QName, _2: Int)(scales.xml.QName, Int)" class="delimiter">(</span><a href="#110792" title="(scales.xml.QName, Int)">focus</a>.<span title="=&gt; scales.xml.QName">_1</span>, <a href="#110792" title="(scales.xml.QName, Int)">focus</a>.<span title="=&gt; Int">_2</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span></span>
<a href="l161"></a><span id="l161">            <span class="keyword">else</span> <a href="#110792" title="(scales.xml.QName, Int)">focus</a></span>
<a href="l162"></a><span id="l162">            <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]" id="110945">npath</a> = <a href="XmlTypes.scala.html#12433" title="(path: scales.xml.package.XmlPath, elem: scales.xml.Elem, dchildren: scales.xml.package.XmlChildren)scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">addAndFocus</a><span class="delimiter">(</span><a href="#110794" title="scales.xml.package.XmlPath">path</a>, <a href="#110923" title="scales.xml.Elem">elem</a><span class="delimiter">)</span></span>
<a href="l163"></a><span id="l163"></span>
<a href="l164"></a><span id="l164">            <span class="keyword">val</span> <a title="Boolean" id="110946">shouldCollect</a> = <a href="#110795" title="Boolean">collecting</a> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#110940" title="scales.xml.QName">q</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#110792" title="(scales.xml.QName, Int)">focus</a>.<span title="=&gt; scales.xml.QName">_1</span><span class="delimiter">)</span></span>
<a href="l165"></a><span id="l165"></span>
<a href="l166"></a><span id="l166">            <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Cont</span><span class="delimiter">(</span></span>
<a href="l167"></a><span id="l167">              <span class="comment">// is it our head?</span></span>
<a href="l168"></a><span id="l168">              <span title="scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#110940" title="scales.xml.QName">q</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#110792" title="(scales.xml.QName, Int)">focus</a>.<span title="=&gt; scales.xml.QName">_1</span><span class="delimiter">)</span></span>
<a href="l169"></a><span id="l169">                <span class="comment">// move down</span></span>
<a href="l170"></a><span id="l170">                <a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#111324" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#110791" title="List[(scales.xml.QName, Int)]">before</a> <a href="#111320" title="(elem: (scales.xml.QName, Int))(implicit bf: scala.collection.generic.CanBuildFrom[List[(scales.xml.QName, Int)],(scales.xml.QName, Int),List[(scales.xml.QName, Int)]])List[(scales.xml.QName, Int)]">:+</a> <a href="#110792" title="(scales.xml.QName, Int)">focus</a>, <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>.<a href="#111321" title="=&gt; (scales.xml.QName, Int)">head</a>, <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>.<a href="#111322" title="=&gt; List[(scales.xml.QName, Int)]">tail</a>, <a href="#110944" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">npath</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span></span>
<a href="l171"></a><span id="l171">              <span class="keyword">else</span></span>
<a href="l172"></a><span id="l172">                <span class="comment">// wait for a down</span></span>
<a href="l173"></a><span id="l173">                <a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#111326" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>, <a href="#110943" title="(scales.xml.QName, Int)">nfocus</a>, <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>, <a href="#110944" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">npath</a>, <a href="#110946" title="Boolean">shouldCollect</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l174"></a><span id="l174">          <span class="delimiter">}</span></span>
<a href="l175"></a><span id="l175"></span>
<a href="l176"></a><span id="l176">          <span class="keyword">case</span> <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">Left</span><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="111329">x</a>: <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a><span class="delimiter">)</span> =&gt;</span>
<a href="l177"></a><span id="l177">            <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]" class="keyword">if</span> <span class="delimiter">(</span><a href="#110795" title="Boolean">collecting</a><span class="delimiter">)</span> <span class="comment">// collect</span></span>
<a href="l178"></a><span id="l178">              <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Cont</span><span class="delimiter">(</span><a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#111446" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>, <a href="#110792" title="(scales.xml.QName, Int)">focus</a>, <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>, <a href="XmlTypes.scala.html#12434" title="(path: scales.xml.package.XmlPath, child: scales.xml.XmlItem)scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">addChild</a><a href="#111444" title="scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]" class="delimiter">(</a><a href="#110794" title="scales.xml.package.XmlPath">path</a>, <a href="#111329" title="scales.xml.XmlItem">x</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l179"></a><span id="l179">            <span class="keyword">else</span></span>
<a href="l180"></a><span id="l180">              <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Cont</span><span class="delimiter">(</span><a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#111452" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>, <a href="#110792" title="(scales.xml.QName, Int)">focus</a>, <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>, <a href="#110794" title="scales.xml.package.XmlPath">path</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// don't collect</span></span>
<a href="l181"></a><span id="l181"></span>
<a href="l182"></a><span id="l182">          <span class="keyword">case</span> <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">Right</span><span class="delimiter">(</span>EndElem<span class="delimiter">(</span><a title="scales.xml.QName" id="111487">q</a>, <a title="Map[String,String]" id="111488">n</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;</span>
<a href="l183"></a><span id="l183"></span>
<a href="l184"></a><span id="l184">            <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111487" title="scales.xml.QName">q</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#110792" title="(scales.xml.QName, Int)">focus</a>.<span title="=&gt; scales.xml.QName">_1</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l185"></a><span id="l185">              <span class="keyword">val</span> <a title="(scales.xml.QName, Int)" id="111493">ncfocus</a> = <span title="(_1: scales.xml.QName, _2: Int)(scales.xml.QName, Int)" class="delimiter">(</span><a href="#110792" title="(scales.xml.QName, Int)">focus</a>.<span title="=&gt; scales.xml.QName">_1</span>, <a href="#110792" title="(scales.xml.QName, Int)">focus</a>.<span title="=&gt; Int">_2</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span></span>
<a href="l186"></a><span id="l186"></span>
<a href="l187"></a><span id="l187">              <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]" class="keyword">if</span> <span class="delimiter">(</span><a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#111493" title="(scales.xml.QName, Int)">ncfocus</a>.<span title="=&gt; Int">_2</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// we are popping to the selected level</span></span>
<a href="l188"></a><span id="l188">                <span title="(a: =&gt; ((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _]), i: =&gt; scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Done</span><span class="delimiter">(</span><span title="(_1: (List[scales.xml.QName], Some[scales.xml.package.XmlPath]), _2: scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])((List[scales.xml.QName], Some[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])" class="delimiter">(</span><span title="(_1: List[scales.xml.QName], _2: Some[scales.xml.package.XmlPath])(List[scales.xml.QName], Some[scales.xml.package.XmlPath])" class="delimiter">(</span><a href="#110783" title="List[scales.xml.QName]">qnames</a>, <span title="(x: scales.xml.package.XmlPath)Some[scales.xml.package.XmlPath]">Some</span><span class="delimiter">(</span><a href="#110794" title="scales.xml.package.XmlPath">path</a><span class="delimiter">)</span><span class="delimiter">)</span>,</span>
<a href="l189"></a><span id="l189">                  <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Cont</span><span class="delimiter">(</span><a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#111536" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>, <a href="#111493" title="(scales.xml.QName, Int)">ncfocus</a>, <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>,</span>
<a href="l190"></a><span id="l190">                    <span class="comment">// remove all children on the next iteration</span></span>
<a href="l191"></a><span id="l191">                    <a href="#110794" title="scales.xml.package.XmlPath">path</a>.<a href="../utils/Paths.scala.html#39617" title="()Option[scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]]">removeAndUp</a>.<span title="(default: =&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC])scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">getOrElse</span><a href="#111534" title="scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]" class="delimiter">(</a><a href="XmlTypes.scala.html#12429" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">noXmlPath</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="object scalaz.IterV">IterV</span>.<span title="[E]=&gt; scalaz.Input[E]">Empty</span><span title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">[</span><span title="XmlPulls.this.PullType">PullType</span><span class="delimiter">]</span><span class="delimiter">)</span></span>
<a href="l192"></a><span id="l192">              <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l193"></a><span id="l193">                <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]" class="keyword">if</span> <span class="delimiter">(</span><a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span></span>
<a href="l194"></a><span id="l194">                  <a href="#110785" title="=&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">starter</a> <span class="comment">// only when the root is asked for, could just refuse that of course?		</span></span>
<a href="l195"></a><span id="l195">                <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l196"></a><span id="l196">                  <span title="scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]" class="keyword">if</span> <span class="delimiter">(</span><a href="#110795" title="Boolean">collecting</a><span class="delimiter">)</span></span>
<a href="l197"></a><span id="l197">                    <span class="comment">// we are collecting but we still have more than 0 repeated qnames deep</span></span>
<a href="l198"></a><span id="l198">                    <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Cont</span><span class="delimiter">(</span><a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#111554" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>, <a href="#111493" title="(scales.xml.QName, Int)">ncfocus</a>, <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>, <a href="#110794" title="scales.xml.package.XmlPath">path</a>.<a href="../utils/Paths.scala.html#39615" title="()scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">zipUp</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l199"></a><span id="l199">                  <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l200"></a><span id="l200">                    <span class="comment">// we aren't collecting but we are moving up, we just have repeated names </span></span>
<a href="l201"></a><span id="l201">                    <span class="keyword">val</span> <a title="(scales.xml.QName, Int)" id="111556">nfocus</a> = <a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>.<span title="=&gt; (scales.xml.QName, Int)">last</span></span>
<a href="l202"></a><span id="l202">                    <span class="keyword">val</span> <a title="List[(scales.xml.QName, Int)]" id="111557">nbefore</a> = <a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>.<span title="(n: Int)List[(scales.xml.QName, Int)]">dropRight</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span></span>
<a href="l203"></a><span id="l203">                    <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Cont</span><span class="delimiter">(</span><a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#111573" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#111557" title="List[(scales.xml.QName, Int)]">nbefore</a>, <a href="#111556" title="(scales.xml.QName, Int)">nfocus</a>, <a href="#110792" title="(scales.xml.QName, Int)">focus</a> <a href="#111561" title="(x: (scales.xml.QName, Int))List[(scales.xml.QName, Int)]">::</a> <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>,</span>
<a href="l204"></a><span id="l204">                      <a href="#110794" title="scales.xml.package.XmlPath">path</a>.<a href="../utils/Paths.scala.html#39617" title="()Option[scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]]">removeAndUp</a>.<span title="(default: =&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC])scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">getOrElse</span><a href="#111571" title="scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]" class="delimiter">(</a><a href="XmlTypes.scala.html#12429" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">noXmlPath</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span> <span class="comment">// we have NOT been collecting	</span></span>
<a href="l205"></a><span id="l205">                      <span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l206"></a><span id="l206">                  <span class="delimiter">}</span></span>
<a href="l207"></a><span id="l207">                <span class="delimiter">}</span></span>
<a href="l208"></a><span id="l208">              <span class="delimiter">}</span></span>
<a href="l209"></a><span id="l209">            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l210"></a><span id="l210">              <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Cont</span><span class="delimiter">(</span><a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#111583" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>, <a href="#110792" title="(scales.xml.QName, Int)">focus</a>, <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>,</span>
<a href="l211"></a><span id="l211">                <a href="#111581" title="scales.xml.package.XmlPath" class="keyword">if</a> <span class="delimiter">(</span><a href="#110795" title="Boolean">collecting</a><span class="delimiter">)</span> <span class="comment">// empty is not enough, it should also be definitely collecting</span></span>
<a href="l212"></a><span id="l212">                  <a href="#110794" title="scales.xml.package.XmlPath">path</a>.<a href="../utils/Paths.scala.html#39615" title="()scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">zipUp</a></span>
<a href="l213"></a><span id="l213">                <span class="keyword">else</span></span>
<a href="l214"></a><span id="l214">                  <a href="#110794" title="scales.xml.package.XmlPath">path</a>.<a href="../utils/Paths.scala.html#39617" title="()Option[scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]]">removeAndUp</a>.<span title="(default: =&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC])scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">getOrElse</span><span class="delimiter">(</span><a href="XmlTypes.scala.html#12429" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">noXmlPath</a><span class="delimiter">)</span>, <a href="#110795" title="Boolean">collecting</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l215"></a><span id="l215">            <span class="delimiter">}</span></span>
<a href="l216"></a><span id="l216"></span>
<a href="l217"></a><span id="l217">        <span class="delimiter">}</span></span>
<a href="l218"></a><span id="l218">      <span class="delimiter">}</span>,</span>
<a href="l219"></a><span id="l219">        empty = <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Cont</span><a title="() =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]" id="111613" class="delimiter">(</a><a href="#110787" title="(before: List[(scales.xml.QName, Int)], focus: (scales.xml.QName, Int), toGo: List[(scales.xml.QName, Int)], path: scales.xml.package.XmlPath, collecting: Boolean)(s: scalaz.Input[XmlPulls.this.PullType])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">step</a><a href="#111618" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#110791" title="List[(scales.xml.QName, Int)]">before</a>, <a href="#110792" title="(scales.xml.QName, Int)">focus</a>, <a href="#110793" title="List[(scales.xml.QName, Int)]">toGo</a>, <a href="#110794" title="scales.xml.package.XmlPath">path</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>,</span>
<a href="l220"></a><span id="l220">        eof = <span title="(a: =&gt; ((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _]), i: =&gt; scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">Done</span><a title="() =&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]" id="111614" class="delimiter">(</a><span title="(_1: (List[scales.xml.QName], None.type), _2: scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])((List[scales.xml.QName], None.type), scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])])" class="delimiter">(</span><span title="(_1: List[scales.xml.QName], _2: None.type)(List[scales.xml.QName], None.type)" class="delimiter">(</span><a href="#110783" title="List[scales.xml.QName]">qnames</a>, <span title="object None">None</span><span class="delimiter">)</span>, <a href="#110785" title="=&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">starter</a><span class="delimiter">)</span>, <span title="object scalaz.IterV">IterV</span>.<span title="[E]=&gt; scalaz.Input[E]">EOF</span><span title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">[</span><span title="XmlPulls.this.PullType">PullType</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l221"></a><span id="l221"></span>
<a href="l222"></a><span id="l222">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#110783" title="List[scales.xml.QName]">qnames</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="../utils/package.scala.html#12052" title="(str: String)Nothing">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Qnames is empty&quot;)" class="string">&quot;Qnames is empty&quot;</span><span class="delimiter">)</span></span>
<a href="l223"></a><span id="l223"></span>
<a href="l224"></a><span id="l224">    <a href="#110785" title="=&gt; scalaz.IterV[XmlPulls.this.PullType,((List[scales.xml.QName], Option[scales.xml.package.XmlPath]), scalaz.IterV[XmlPulls.this.PullType, _])]">starter</a></span>
<a href="l225"></a><span id="l225">  <span class="delimiter">}</span></span>
<a href="l226"></a><span id="l226"></span>
<a href="l227"></a><span id="l227">  <span class="keyword">type</span> <a title="Option[scales.xml.package.XmlPath]" id="12536">PeekMatch</a> = <span title="Option[scales.xml.package.XmlPath]">Option</span><span class="delimiter">[</span>XmlPath<span class="delimiter">]</span></span>
<a href="l228"></a><span id="l228"></span>
<a href="l229"></a><span id="l229">  <span class="keyword">def</span> <a title="(downTo: Int*)scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" id="12537">skipv</a><span class="delimiter">(</span><a title="Int*" id="111627">downTo</a>: <span title="Int*">Int</span>*<span class="delimiter">)</span>: <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">IterV</span><span class="delimiter">[</span>PullType, PeekMatch<span class="delimiter">]</span> = <a href="#12538" title="(downTo: =&gt; List[Int])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">skip</a><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#111627" title="Int*">downTo</a>: _*<span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l230"></a><span id="l230"></span>
<a href="l231"></a><span id="l231">  <span class="comment">/**</span>
<a href="l232"></a><span id="l232">   * Skips all events until the indexes match downTo, can be seen as</span>
<a href="l233"></a><span id="l233">   * \*\*[b]\*[c] skipping until c with skip(List(b,c)).</span>
<a href="l234"></a><span id="l234">   * This can be used, for example, to identify qnames within a message and combined with capture to allow replaying.</span>
<a href="l235"></a><span id="l235">   * Identifying a soap doc-lit request would be skip(List(2,1)).</span>
<a href="l236"></a><span id="l236">   * It returns the XmlPath to the skipped position, for soap /Envelope/Body/Request but does not collect the contents of that node.</span>
<a href="l237"></a><span id="l237">   * An empty list will simply return the first Element found.</span>
<a href="l238"></a><span id="l238">   */</span></span>
<a href="l239"></a><span id="l239">  <span class="keyword">def</span> <a title="(downTo: =&gt; List[Int])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" id="12538">skip</a><span class="delimiter">(</span><a title="=&gt; List[Int]" id="111629">downTo</a>: =&gt; List<span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">IterV</span><span class="delimiter">[</span>PullType, PeekMatch<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l240"></a><span id="l240"></span>
<a href="l241"></a><span id="l241">    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" id="111639">dEof</a>: <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">IterV</span><span class="delimiter">[</span>PullType, PeekMatch<span class="delimiter">]</span> = <span title="(a: =&gt; XmlPulls.this.PeekMatch, i: =&gt; scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Done</span><span class="delimiter">(</span><span title="object None">None</span>, <span title="object scalaz.IterV">IterV</span>.<span title="[E]=&gt; scalaz.Input[E]">EOF</span><span title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">[</span><span title="XmlPulls.this.PullType">PullType</span><span class="delimiter">]</span><span class="delimiter">)</span></span>
<a href="l242"></a><span id="l242"></span>
<a href="l243"></a><span id="l243">    <span class="keyword">def</span> <a title="(before: List[Int], pos: List[Int], toGo: List[Int], path: scales.xml.package.XmlPath)(s: scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" id="111640">step</a><span class="delimiter">(</span><a title="List[Int]" id="111647">before</a>: <span title="List[Int]">List</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="List[Int]" id="111648">pos</a>: <span title="List[Int]">List</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="List[Int]" id="111649">toGo</a>: <span title="List[Int]">List</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="scales.xml.package.XmlPath" id="111650">path</a>: <a href="../utils/Paths.scala.html#10533" title="scales.xml.package.XmlPath">XmlPath</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="scalaz.Input[XmlPulls.this.PullType]" id="111651">s</a>: <span title="scalaz.Input[XmlPulls.this.PullType]">Input</span><span class="delimiter">[</span>PullType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">IterV</span><span class="delimiter">[</span>PullType, PeekMatch<span class="delimiter">]</span> =</span>
<a href="l244"></a><span id="l244">      <a href="#111651" title="(empty: =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch], el: =&gt; XmlPulls.this.PullType =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch], eof: =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">s</a><span class="delimiter">(</span>el = <span class="delimiter">{</span> <a title="=&gt; XmlPulls.this.PullType" id="111666">e</a> =&gt;</span>
<a href="l245"></a><span id="l245">        <a href="#111666" title="=&gt; XmlPulls.this.PullType">e</a> <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l246"></a><span id="l246"></span>
<a href="l247"></a><span id="l247">          <span class="keyword">case</span> <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Left</span><span class="delimiter">(</span><a title="scales.xml.Elem" id="111668">elem</a>@<a href="XmlTypes.scala.html#88404" title="(el: scales.xml.Elem)Some[(scales.xml.QName, scales.xml.package.Attributes, scala.collection.immutable.Map[String,String])]">Elem</a><span class="delimiter">(</span><a title="scales.xml.QName" id="111670">q</a>, <a title="scales.xml.package.Attributes" id="111671">a</a>, <a title="scala.collection.immutable.Map[String,String]" id="111672">n</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span></span>
<a href="l248"></a><span id="l248">            <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]" id="111674">npath</a> = <a href="XmlTypes.scala.html#12433" title="(path: scales.xml.package.XmlPath, elem: scales.xml.Elem, dchildren: scales.xml.package.XmlChildren)scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">addAndFocus</a><span class="delimiter">(</span><a href="#111650" title="scales.xml.package.XmlPath">path</a>, <a href="#111668" title="scales.xml.Elem">elem</a><span class="delimiter">)</span></span>
<a href="l249"></a><span id="l249">            <span class="keyword">val</span> <a title="List[Int]" id="111675">npos</a> = <a href="#111648" title="List[Int]">pos</a>.<span title="=&gt; Int">head</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span> <a href="#111677" title="(x: Int)List[Int]">::</a> <a href="#111648" title="List[Int]">pos</a>.<span title="=&gt; List[Int]">tail</span></span>
<a href="l250"></a><span id="l250">            <span class="keyword">val</span> <a title="Boolean" id="111676">could</a> = <a href="#111649" title="List[Int]">toGo</a>.<span title="=&gt; Int">head</span> <span title="(x: Int)Boolean">==</span> <a href="#111675" title="List[Int]">npos</a>.<span title="=&gt; Int">head</span></span>
<a href="l251"></a><span id="l251">            <span class="comment">//println(&quot;pos &quot;+pos+ &quot; npos &quot;+npos+&quot; before &quot;+before+&quot; toGo &quot;+toGo)</span></span>
<a href="l252"></a><span id="l252">            <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111648" title="List[Int]">pos</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span class="delimiter">(</span><a href="#111647" title="List[Int]">before</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// correct level</span></span>
<a href="l253"></a><span id="l253">              <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111649" title="List[Int]">toGo</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#111676" title="Boolean">could</a><span class="delimiter">)</span></span>
<a href="l254"></a><span id="l254">                <span title="(a: =&gt; XmlPulls.this.PeekMatch, i: =&gt; scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Done</span><span class="delimiter">(</span><span title="(x: scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC])Some[scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]]">Some</span><span class="delimiter">(</span><a href="#111673" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">npath</a><span class="delimiter">)</span>, <span title="object scalaz.IterV">IterV</span>.<span title="[E]=&gt; scalaz.Input[E]">Empty</span><span title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">[</span><span title="XmlPulls.this.PullType">PullType</span><span class="delimiter">]</span><span class="delimiter">)</span></span>
<a href="l255"></a><span id="l255">              <span class="keyword">else</span> <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111675" title="List[Int]">npos</a>.<span title="=&gt; Int">head</span> <span title="(x: Int)Boolean">&gt;</span> <a href="#111649" title="List[Int]">toGo</a>.<span title="=&gt; Int">head</span><span class="delimiter">)</span></span>
<a href="l256"></a><span id="l256">                <a href="#111638" title="=&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">dEof</a></span>
<a href="l257"></a><span id="l257">              <span class="keyword">else</span> <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111676" title="Boolean">could</a><span class="delimiter">)</span></span>
<a href="l258"></a><span id="l258">                <span class="comment">// pop and move down</span></span>
<a href="l259"></a><span id="l259">                <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Cont</span><span class="delimiter">(</span><a href="#111640" title="(before: List[Int], pos: List[Int], toGo: List[Int], path: scales.xml.package.XmlPath)(s: scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">step</a><a href="#111785" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#111647" title="List[Int]">before</a> <a href="#111781" title="(elem: Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Int],Int,List[Int]])List[Int]">:+</a> <a href="#111649" title="List[Int]">toGo</a>.<span title="=&gt; Int">head</span>, <span title="Int(0)" class="int">0</span> <a href="#111775" title="(x: Int)List[Int]">::</a> <a href="#111675" title="List[Int]">npos</a>, <a href="#111649" title="List[Int]">toGo</a>.<a href="#111783" title="=&gt; List[Int]">tail</a>, <a href="#111673" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">npath</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l260"></a><span id="l260">              <span class="keyword">else</span></span>
<a href="l261"></a><span id="l261">                <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Cont</span><span class="delimiter">(</span><a href="#111640" title="(before: List[Int], pos: List[Int], toGo: List[Int], path: scales.xml.package.XmlPath)(s: scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">step</a><a href="#111796" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#111647" title="List[Int]">before</a>, <span title="Int(0)" class="int">0</span> <a href="#111790" title="(x: Int)List[Int]">::</a> <a href="#111675" title="List[Int]">npos</a>, <a href="#111649" title="List[Int]">toGo</a>, <a href="#111673" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">npath</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l262"></a><span id="l262">            <span class="keyword">else</span></span>
<a href="l263"></a><span id="l263">              <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Cont</span><span class="delimiter">(</span><a href="#111640" title="(before: List[Int], pos: List[Int], toGo: List[Int], path: scales.xml.package.XmlPath)(s: scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">step</a><a href="#111807" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#111647" title="List[Int]">before</a>, <span title="Int(0)" class="int">0</span> <a href="#111801" title="(x: Int)List[Int]">::</a> <a href="#111675" title="List[Int]">npos</a>, <a href="#111649" title="List[Int]">toGo</a>, <a href="#111673" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">npath</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l264"></a><span id="l264"></span>
<a href="l265"></a><span id="l265">          <span class="delimiter">}</span></span>
<a href="l266"></a><span id="l266"></span>
<a href="l267"></a><span id="l267">          <span class="comment">// just return this again</span></span>
<a href="l268"></a><span id="l268">          <span class="keyword">case</span> <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Left</span><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="111810">x</a>: <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a><span class="delimiter">)</span> =&gt;</span>
<a href="l269"></a><span id="l269">            <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Cont</span><span class="delimiter">(</span><a href="#111640" title="(before: List[Int], pos: List[Int], toGo: List[Int], path: scales.xml.package.XmlPath)(s: scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">step</a><a href="#111815" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#111647" title="List[Int]">before</a>, <a href="#111648" title="List[Int]">pos</a>, <a href="#111649" title="List[Int]">toGo</a>, <a href="#111650" title="scales.xml.package.XmlPath">path</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l270"></a><span id="l270"></span>
<a href="l271"></a><span id="l271">          <span class="comment">// pop up no collecting, loose the head as we are moving up again</span></span>
<a href="l272"></a><span id="l272">          <span class="keyword">case</span> <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Right</span><span class="delimiter">(</span>EndElem<span class="delimiter">(</span><a title="scales.xml.QName" id="111818">q</a>, <a title="Map[String,String]" id="111819">n</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;</span>
<a href="l273"></a><span id="l273">            <span class="comment">// get or else end doc elem</span></span>
<a href="l274"></a><span id="l274">            <span title="scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" class="keyword">if</span> <span class="delimiter">(</span><a href="#111648" title="List[Int]">pos</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#111648" title="List[Int]">pos</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#111647" title="List[Int]">before</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span></span>
<a href="l275"></a><span id="l275">              <span class="comment">// we have moved down in toGo</span></span>
<a href="l276"></a><span id="l276">              <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Cont</span><span class="delimiter">(</span><a href="#111640" title="(before: List[Int], pos: List[Int], toGo: List[Int], path: scales.xml.package.XmlPath)(s: scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">step</a><a href="#111850" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#111647" title="List[Int]">before</a>.<span title="(n: Int)List[Int]">dropRight</span><a href="#111845" title="List[Int]" class="delimiter">(</a><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#111648" title="List[Int]">pos</a>.<a href="#111846" title="=&gt; List[Int]">tail</a>, <a href="#111647" title="List[Int]">before</a>.<span title="=&gt; Int">last</span> <a href="#111836" title="(x: Int)List[Int]">::</a> <a href="#111649" title="List[Int]">toGo</a>, <a href="#111650" title="scales.xml.package.XmlPath">path</a>.<a href="../utils/Paths.scala.html#39617" title="()Option[scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]]">removeAndUp</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(default: =&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC])scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">getOrElse</span><a href="#111848" title="scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]" class="delimiter">(</a><a href="XmlTypes.scala.html#12429" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">noXmlPath</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l277"></a><span id="l277">            <span class="keyword">else</span></span>
<a href="l278"></a><span id="l278">              <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Cont</span><span class="delimiter">(</span><a href="#111640" title="(before: List[Int], pos: List[Int], toGo: List[Int], path: scales.xml.package.XmlPath)(s: scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">step</a><a href="#111861" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#111647" title="List[Int]">before</a>, <a href="#111648" title="List[Int]">pos</a>.<a href="#111858" title="=&gt; List[Int]">tail</a>, <a href="#111649" title="List[Int]">toGo</a>, <a href="#111650" title="scales.xml.package.XmlPath">path</a>.<a href="../utils/Paths.scala.html#39617" title="()Option[scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]]">removeAndUp</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(default: =&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC])scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">getOrElse</span><a href="#111859" title="scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]" class="delimiter">(</a><a href="XmlTypes.scala.html#12429" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">noXmlPath</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l279"></a><span id="l279"></span>
<a href="l280"></a><span id="l280">        <span class="delimiter">}</span></span>
<a href="l281"></a><span id="l281">      <span class="delimiter">}</span>,</span>
<a href="l282"></a><span id="l282">        empty = <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Cont</span><a title="() =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" id="111867" class="delimiter">(</a><a href="#111640" title="(before: List[Int], pos: List[Int], toGo: List[Int], path: scales.xml.package.XmlPath)(s: scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">step</a><a href="#111872" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a><a href="#111647" title="List[Int]">before</a>, <a href="#111648" title="List[Int]">pos</a>, <a href="#111649" title="List[Int]">toGo</a>, <a href="#111650" title="scales.xml.package.XmlPath">path</a><span class="delimiter">)</span><span class="delimiter">)</span>,</span>
<a href="l283"></a><span id="l283">        eof = <a href="#111638" title="() =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]" id="111868">dEof</a> <span class="comment">//Done((downTo, None),IterV.EOF[PullType])</span></span>
<a href="l284"></a><span id="l284">        <span class="delimiter">)</span></span>
<a href="l285"></a><span id="l285"></span>
<a href="l286"></a><span id="l286">    <span title="(f: scalaz.Input[XmlPulls.this.PullType] =&gt; scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">Cont</span><span class="delimiter">(</span><a href="#111640" title="(before: List[Int], pos: List[Int], toGo: List[Int], path: scales.xml.package.XmlPath)(s: scalaz.Input[XmlPulls.this.PullType])scalaz.IterV[XmlPulls.this.PullType,XmlPulls.this.PeekMatch]">step</a><a href="#111898" title="scalaz.Input[XmlPulls.this.PullType]" class="delimiter">(</a>List<span class="delimiter">[</span>Int<span class="delimiter">]</span><span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="(xs: Int*)List[Int]">List</span><a href="#111895" title="List[Int]" class="delimiter">(</a><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span> <a href="#111889" title="(x: Int)List[Int]">::</a> <a href="#111629" title="=&gt; List[Int]">downTo</a>, <a href="XmlTypes.scala.html#12429" title="=&gt; scales.utils.Path[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">noXmlPath</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l287"></a><span id="l287">  <span class="delimiter">}</span></span>
<a href="l288"></a><span id="l288"></span>
<a href="l289"></a><span id="l289">  <span class="comment">/**</span>
<a href="l290"></a><span id="l290">   * Wraps XmlPull</span>
<a href="l291"></a><span id="l291">   */</span> </span>
<a href="l292"></a><span id="l292">  <span class="keyword">def</span> <a title="(path: List[scales.xml.QName], xml: scales.xml.XmlPull)Iterable[scales.xml.package.XmlPath]" id="12539">iterate</a><span class="delimiter">(</span><a title="List[scales.xml.QName]" id="91170">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span>, <a title="scales.xml.XmlPull" id="91171">xml</a>: <a href="#11969" title="scales.xml.XmlPull">XmlPull</a><span class="delimiter">)</span>: <span title="Iterable[scales.xml.package.XmlPath]">Iterable</span><span class="delimiter">[</span>XmlPath<span class="delimiter">]</span> = <a href="#12540" title="(path: List[scales.xml.QName], xml: Iterator[XmlPulls.this.PullType])Iterable[scales.xml.package.XmlPath]">iterate</a><span class="delimiter">(</span><a href="#91170" title="List[scales.xml.QName]">path</a>, <a href="#91171" title="scales.xml.XmlPull">xml</a>.<a href="#89899" title="=&gt; Iterator[scales.xml.package.PullType]">it</a><span class="delimiter">)</span></span>
<a href="l293"></a><span id="l293"></span>
<a href="l294"></a><span id="l294">  <span class="comment">/**</span>
<a href="l295"></a><span id="l295">   * A wrapping around withIter(onDone(List(onQNames(path))))(enumXml(xml, _))</span>
<a href="l296"></a><span id="l296">   * it unwraps the data providing an Iterator[XPath]</span>
<a href="l297"></a><span id="l297">   */</span></span>
<a href="l298"></a><span id="l298">  <span class="keyword">def</span> <a title="(path: List[scales.xml.QName], xml: Iterator[XmlPulls.this.PullType])Iterable[scales.xml.package.XmlPath]" id="12540">iterate</a><span class="delimiter">(</span><a title="List[scales.xml.QName]" id="91167">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span>, <a title="Iterator[XmlPulls.this.PullType]" id="91168">xml</a>: <span title="Iterator[XmlPulls.this.PullType]">Iterator</span><span class="delimiter">[</span>PullType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Iterable[scales.xml.package.XmlPath]">Iterable</span><span class="delimiter">[</span>XmlPath<span class="delimiter">]</span> = <a href="#111906" title="java.lang.Object with Iterable[scales.xml.package.XmlPath]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Iterable[scales.xml.package.XmlPath]" id="111906">Iterable</a><span class="delimiter">[</span>XmlPath<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l299"></a><span id="l299"></span>
<a href="l300"></a><span id="l300">    <span class="keyword">def</span> <a title="=&gt; java.lang.Object with Iterator[scales.xml.package.XmlPath]" id="112259">iterator</a> = <a href="#112269" title="java.lang.Object with Iterator[scales.xml.package.XmlPath]{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Iterator[scales.xml.package.XmlPath]" id="112269">Iterator</a><span class="delimiter">[</span>XmlPath<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l301"></a><span id="l301">      <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>._</span>
<a href="l302"></a><span id="l302">      <span class="keyword">import</span> <a href="../utils/ScalesUtils.scala.html#10619" title="object scales.utils.ScalesUtils">ScalesUtils</a>._</span>
<a href="l303"></a><span id="l303"></span>
<a href="l304"></a><span id="l304">      <span class="keyword">val</span> <a title="scales.utils.package.ResumableIterIterator[XmlPulls.this.PullType,Iterable[(List[scales.xml.QName], Option[scales.xml.package.XmlPath])],Iterator]" id="112442">orig</a> = <a href="../utils/Iteratees.scala.html#12161" title="(it: Iterator[XmlPulls.this.PullType])(initResumable: scales.utils.package.ResumableIter[XmlPulls.this.PullType,Iterable[(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]])(implicit e: scalaz.Enumerator[Iterator])scales.utils.package.ResumableIterIterator[XmlPulls.this.PullType,Iterable[(List[scales.xml.QName], Option[scales.xml.package.XmlPath])],Iterator]">withIter</a><span class="delimiter">(</span><a href="#91168" title="Iterator[XmlPulls.this.PullType]">xml</a><span class="delimiter">)</span><a href="../utils/Iteratees.scala.html#59839" title="=&gt; java.lang.Object with scalaz.Enumerator[Iterator]" class="delimiter">(</a><a href="../utils/Iteratees.scala.html#12168" title="(originalList: List[scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]])scales.utils.package.ResumableIterList[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">onDone</a><span class="delimiter">(</span><span title="(xs: scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]*)List[scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]]">List</span><span class="delimiter">(</span><a href="#12535" title="(qnames: List[scales.xml.QName])scales.utils.package.ResumableIter[XmlPulls.this.PullType,(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">onQNames</a><span class="delimiter">(</span><a href="#91167" title="List[scales.xml.QName]">path</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l305"></a><span id="l305">      <span class="keyword">def</span> <a title="=&gt; (Boolean, Option[scales.xml.package.XmlPath])" id="112444">getNext</a> = <span class="delimiter">{</span></span>
<a href="l306"></a><span id="l306">        <span title="(Boolean, Option[scales.xml.package.XmlPath])" class="keyword">if</span> <span class="delimiter">(</span><a href="#112442" title="=&gt; scales.utils.package.ResumableIterIterator[XmlPulls.this.PullType,Iterable[(List[scales.xml.QName], Option[scales.xml.package.XmlPath])],Iterator]">orig</a>.<a href="../utils/Iteratees.scala.html#69359" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l307"></a><span id="l307">          <span class="keyword">val</span> <a title="Iterable[(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]" id="112519">t</a> = <a href="#112442" title="=&gt; scales.utils.package.ResumableIterIterator[XmlPulls.this.PullType,Iterable[(List[scales.xml.QName], Option[scales.xml.package.XmlPath])],Iterator]">orig</a>.<a href="../utils/Iteratees.scala.html#69358" title="()Iterable[(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">next</a></span>
<a href="l308"></a><span id="l308">          <span title="(Boolean, Option[scales.xml.package.XmlPath])" class="keyword">if</span> <span class="delimiter">(</span><a href="#112519" title="Iterable[(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">t</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span></span>
<a href="l309"></a><span id="l309">            <span title="(_1: Boolean, _2: Option[scales.xml.package.XmlPath])(Boolean, Option[scales.xml.package.XmlPath])" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="#112519" title="Iterable[(List[scales.xml.QName], Option[scales.xml.package.XmlPath])]">t</a>.<span title="=&gt; (List[scales.xml.QName], Option[scales.xml.package.XmlPath])">head</span>.<span title="=&gt; Option[scales.xml.package.XmlPath]">_2</span><span class="delimiter">)</span></span>
<a href="l310"></a><span id="l310">          <span class="keyword">else</span> <span title="(_1: Boolean, _2: None.type)(Boolean, None.type)" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="object None">None</span><span class="delimiter">)</span></span>
<a href="l311"></a><span id="l311">        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="(_1: Boolean, _2: None.type)(Boolean, None.type)" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="object None">None</span><span class="delimiter">)</span></span>
<a href="l312"></a><span id="l312">      <span class="delimiter">}</span></span>
<a href="l313"></a><span id="l313">      <span class="keyword">var</span> <a title="(Boolean, Option[scales.xml.package.XmlPath])" id="112446">cur</a> = <a href="#112444" title="=&gt; (Boolean, Option[scales.xml.package.XmlPath])">getNext</a></span>
<a href="l314"></a><span id="l314">      <span class="keyword">def</span> <a title="=&gt; Boolean" id="112448">hasNext</a> = <a href="#112446" title="=&gt; (Boolean, Option[scales.xml.package.XmlPath])">cur</a>.<span title="=&gt; Boolean">_1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#112446" title="=&gt; (Boolean, Option[scales.xml.package.XmlPath])">cur</a>.<span title="=&gt; Option[scales.xml.package.XmlPath]">_2</span>.<span title="=&gt; Boolean">isDefined</span></span>
<a href="l315"></a><span id="l315">      <span class="keyword">def</span> <a title="()scales.xml.package.XmlPath" id="112449">next</a> = <span class="delimiter">{</span></span>
<a href="l316"></a><span id="l316">        <span class="keyword">val</span> <a title="Option[scales.xml.package.XmlPath]" id="112549">t</a> = <a href="#112446" title="=&gt; (Boolean, Option[scales.xml.package.XmlPath])">cur</a>.<span title="=&gt; Option[scales.xml.package.XmlPath]">_2</span></span>
<a href="l317"></a><span id="l317">        <a href="#112446" title="(x$1: (Boolean, Option[scales.xml.package.XmlPath]))Unit">cur</a> = <a href="#112444" title="=&gt; (Boolean, Option[scales.xml.package.XmlPath])">getNext</a></span>
<a href="l318"></a><span id="l318">        <a href="#112549" title="Option[scales.xml.package.XmlPath]">t</a>.<span title="=&gt; scales.xml.package.XmlPath">get</span></span>
<a href="l319"></a><span id="l319">      <span class="delimiter">}</span></span>
<a href="l320"></a><span id="l320">    <span class="delimiter">}</span></span>
<a href="l321"></a><span id="l321">  <span class="delimiter">}</span></span>
<a href="l322"></a><span id="l322"></span>
<a href="l323"></a><span id="l323"><span class="delimiter">}</span></span>
<a href="l324"></a><span id="l324"></span>
<a href="l325"></a><span id="l325"><span class="comment">/**</span>
<a href="l326"></a><span id="l326"> * Exists purely to satisfy staxs events and indicate to the client code that the xml &quot;stack&quot; should be popped</span>
<a href="l327"></a><span id="l327"> */</span></span>
<a href="l328"></a><span id="l328">case <span class="keyword">class</span> <a title="class EndElem extends java.lang.Object with ScalaObject with Product with Serializable" id="112951">EndElem</a><a href="#112951" title="ScalaObject" class="delimiter">(</a><a title="scales.xml.QName" id="95150">name</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Map[String,String]" id="95151">namespaces</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span> = <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]" class="delimiter">[</span><span title="String">String</span>, <span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l329"></a><span id="l329"></span>
<a href="l330"></a><span id="l330"><span class="comment">/**</span>
<a href="l331"></a><span id="l331"> * Basis for xmlpulls, next is (event, start/finish)</span>
<a href="l332"></a><span id="l332"> */</span></span>
<a href="l333"></a><span id="l333"><span class="keyword">trait</span> <a title="trait XmlPull extends java.lang.Object with Iterator[scales.xml.package.PullType] with scales.xml.DocLike with ScalaObject" id="11969">XmlPull</a> <span title="ScalaObject" class="keyword">extends</span> <span title="Iterator[scales.xml.package.PullType]">Iterator</span><span class="delimiter">[</span>PullType<span class="delimiter">]</span> <span class="keyword">with</span> <a href="XmlTypes.scala.html#12023" title="scales.xml.DocLike">DocLike</a> <span class="delimiter">{</span></span>
<a href="l334"></a><span id="l334"></span>
<a href="l335"></a><span id="l335">  <span class="keyword">type</span> <a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="89869">Token</a> &lt;: OptimisationToken</span>
<a href="l336"></a><span id="l336"></span>
<a href="l337"></a><span id="l337">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.FromParser" id="89870">weAreInAParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a> = <a href="XmlTypes.scala.html#12400" title="object scales.xml.package.IsFromParser">IsFromParser</a></span>
<a href="l338"></a><span id="l338"></span>
<a href="l339"></a><span id="l339">  <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.defaultVersion</span>
<a href="l340"></a><span id="l340"></span>
<a href="l341"></a><span id="l341">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">val</span> <a title="=&gt; javax.xml.stream.XMLStreamReader" id="89873">parser</a>: <span title="javax.xml.stream.XMLStreamReader">XMLStreamReader</span></span>
<a href="l342"></a><span id="l342">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">val</span> <a title="=&gt; () =&gt; Unit" id="89874">resourceCloser</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Unit</span>
<a href="l343"></a><span id="l343"></span>
<a href="l344"></a><span id="l344">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="89875">internalClose</a> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span></span>
<a href="l345"></a><span id="l345"></span>
<a href="l346"></a><span id="l346">  <span class="comment">/**</span>
<a href="l347"></a><span id="l347">   * Why is this on a pull parser?  Simple answer is by default it costs little,</span>
<a href="l348"></a><span id="l348">   * and by selection the user can optimise whole streams at an early and central place.  Optimising the stream in onQNames or another iteratee or in user code seems to go against the definition of a good design.</span>
<a href="l349"></a><span id="l349">   */</span> </span>
<a href="l350"></a><span id="l350">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">val</span> <a title="=&gt; scales.xml.MemoryOptimisationStrategy[XmlPull.this.Token]" id="89876">strategy</a> : <a href="OptimisingStrategies.scala.html#10675" title="scales.xml.MemoryOptimisationStrategy[XmlPull.this.Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span></span>
<a href="l351"></a><span id="l351">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">val</span> <a title="=&gt; XmlPull.this.Token" id="89877">token</a> : <a href="#89869" title="XmlPull.this.Token">Token</a></span>
<a href="l352"></a><span id="l352"></span>
<a href="l353"></a><span id="l353">  <span class="keyword">private</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">var</span> <a title="scales.xml.package.PullType" id="89879">current</a>: <span title="scales.xml.package.PullType">PullType</span> = <span title="Null(null)" class="keyword">null</span></span>
<a href="l354"></a><span id="l354"></span>
<a href="l355"></a><span id="l355">  <span class="comment">/*</span>
<a href="l356"></a><span id="l356">     * DocLike parts follow</span>
<a href="l357"></a><span id="l357">     */</span></span>
<a href="l358"></a><span id="l358"></span>
<a href="l359"></a><span id="l359">  <span class="keyword">private</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">var</span> <a title="scales.xml.Prolog" id="89882">vprolog</a>: <a href="XmlTypes.scala.html#12017" title="scales.xml.Prolog">Prolog</a> = <a href="XmlTypes.scala.html#94387" title="(decl: scales.xml.Declaration, misc: scales.xml.package.Miscs, dtd: Option[scales.xml.DTD])scales.xml.Prolog">Prolog</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l360"></a><span id="l360">  <span class="keyword">private</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">var</span> <a title="scales.xml.EndMisc" id="89885">emisc</a>: <a href="XmlTypes.scala.html#12020" title="scales.xml.EndMisc">EndMisc</a> = <a href="XmlTypes.scala.html#94421" title="(misc: scales.xml.package.Miscs)scales.xml.EndMisc">EndMisc</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l361"></a><span id="l361"></span>
<a href="l362"></a><span id="l362">  <span class="keyword">def</span> <a title="=&gt; scales.xml.Prolog" id="89887">prolog</a> = <a href="#89882" title="=&gt; scales.xml.Prolog">vprolog</a></span>
<a href="l363"></a><span id="l363">  <span class="keyword">def</span> <a title="=&gt; scales.xml.EndMisc" id="89888">end</a> = <a href="#89885" title="=&gt; scales.xml.EndMisc">emisc</a></span>
<a href="l364"></a><span id="l364"></span>
<a href="l365"></a><span id="l365">  <span class="comment">/**</span>
<a href="l366"></a><span id="l366">   * If the depth is -1 then we haven't hit an element yet, and</span>
<a href="l367"></a><span id="l367">   * start should keep pumping until that happens.</span>
<a href="l368"></a><span id="l368">   *</span>
<a href="l369"></a><span id="l369">   * If the depth is -1 after processing the end root (haveRoot), then we keep pumping into the endMisc</span>
<a href="l370"></a><span id="l370">   */</span></span>
<a href="l371"></a><span id="l371">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Int" id="89890">depth</a> = -<span title="Int(-1)" class="int">1</span></span>
<a href="l372"></a><span id="l372">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Boolean" id="89893">haveRoot</a> = <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l373"></a><span id="l373"></span>
<a href="l374"></a><span id="l374">  <span class="keyword">private</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">val</span> <a title="apply extends java.lang.Object with scales.xml.PI" id="89895">dtdDummy</a> = <a href="XmlTypes.scala.html#98588" title="(targeti: String, valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.PI">PI</a><a href="#89870" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><span title="java.lang.String(&quot;onlyforme&quot;)" class="string">&quot;onlyforme&quot;</span>, <span title="java.lang.String(&quot;init&quot;)" class="string">&quot;init&quot;</span><span class="delimiter">)</span></span>
<a href="l375"></a><span id="l375"></span>
<a href="l376"></a><span id="l376">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(c: scales.xml.package.PullType, in: String)scales.xml.package.Misc" id="89897">getMisc</a><span class="delimiter">(</span><a title="scales.xml.package.PullType" id="110345">c</a>: <span title="scales.xml.package.PullType">PullType</span>, <a title="String" id="110346">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="scales.xml.package.Misc">Misc</span> =</span>
<a href="l377"></a><span id="l377">    <a href="#110345" title="scales.xml.package.PullType">c</a>.<span title="[X](fa: scales.xml.XmlEvent =&gt; X, fb: scales.xml.EndElem =&gt; X)X">fold</span><span title="(fa: scales.xml.XmlEvent =&gt; scales.xml.package.Misc, fb: scales.xml.EndElem =&gt; scales.xml.package.Misc)scales.xml.package.Misc" class="delimiter">[</span><span title="scales.xml.package.Misc">Misc</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.XmlEvent" id="112636">e</a> =&gt; <a href="#112636" title="scales.xml.XmlEvent">e</a> <span title="scales.xml.package.Misc" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l378"></a><span id="l378">      <span class="keyword">case</span> <a title="Left[scales.xml.Comment,Nothing]" id="112637">ev</a>: <a href="XmlTypes.scala.html#12002" title="scales.xml.Comment">Comment</a> =&gt; <span title="(a: scales.xml.Comment)Left[scales.xml.Comment,Nothing]">Left</span><span class="delimiter">(</span><a href="#112637" title="scales.xml.Comment">ev</a><span class="delimiter">)</span></span>
<a href="l379"></a><span id="l379">      <span class="keyword">case</span> <a title="Right[Nothing,scales.xml.PI]" id="112642">ev</a>: <a href="XmlTypes.scala.html#12008" title="scales.xml.PI">PI</a> =&gt; <span title="(b: scales.xml.PI)Right[Nothing,scales.xml.PI]">Right</span><span class="delimiter">(</span><a href="#112642" title="scales.xml.PI">ev</a><span class="delimiter">)</span></span>
<a href="l380"></a><span id="l380">      <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../utils/package.scala.html#12052" title="(str: String)Nothing">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Got an event (&quot;)" class="string">&quot;Got an event (&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#112636" title="scales.xml.XmlEvent">e</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;) that should not be in the &quot;)" class="string">&quot;) that should not be in the &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#110346" title="String">in</a><span class="delimiter">)</span></span>
<a href="l381"></a><span id="l381">    <span class="delimiter">}</span>, <a title="scales.xml.EndElem" id="112648">f</a> =&gt; <a href="../utils/package.scala.html#12052" title="(str: String)Nothing">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;End element found in &quot;)" class="string">&quot;End element found in &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#110346" title="String">in</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#110345" title="scales.xml.package.PullType">c</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l382"></a><span id="l382">  <span class="comment">// it must be a left and a comment or pi</span></span>
<a href="l383"></a><span id="l383"></span>
<a href="l384"></a><span id="l384">  <span class="comment">/**</span>
<a href="l385"></a><span id="l385">   * Pumps until the first elem, always collecting the prolog</span>
<a href="l386"></a><span id="l386">   */</span></span>
<a href="l387"></a><span id="l387">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="89898">start</a> = <span class="delimiter">{</span></span>
<a href="l388"></a><span id="l388">    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#89890" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="#110294" title="()Unit" class="delimiter">{</a></span>
<a href="l389"></a><span id="l389">      <a href="#89879" title="(x$1: scales.xml.package.PullType)Unit">current</a> = <a href="#89906" title="=&gt; scales.xml.package.PullType">pumpEvent</a></span>
<a href="l390"></a><span id="l390">      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#89879" title="=&gt; scales.xml.package.PullType">current</a>.<span title="=&gt; Boolean">isLeft</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#89879" title="=&gt; scales.xml.package.PullType">current</a>.<span title="=&gt; Either.LeftProjection[scales.xml.XmlEvent,scales.xml.EndElem]">left</span>.<span title="=&gt; scales.xml.XmlEvent">get</span> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#89895" title="=&gt; java.lang.Object with scales.xml.PI">dtdDummy</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l391"></a><span id="l391">        <a href="#89882" title="(x$1: scales.xml.Prolog)Unit">vprolog</a> = <a href="#89882" title="scales.xml.Prolog" id="110306">vprolog</a>.<a href="XmlTypes.scala.html#98542" title="scales.xml.Declaration" id="110315">copy</a><span class="delimiter">(</span>dtd = <span title="(x: scales.xml.DTD)Some[scales.xml.DTD]">Some</span><a title="Some[scales.xml.DTD]" id="110313" class="delimiter">(</a></span>
<a href="l392"></a><span id="l392">          <a href="XmlTypes.scala.html#98567" title="(name: String, publicId: String, systemId: String)scales.xml.DTD">DTD</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="comment">// DTD has funnyness TODO find out what it looks like</span></span>
<a href="l393"></a><span id="l393">          <span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l394"></a><span id="l394">      <span class="delimiter">}</span></span>
<a href="l395"></a><span id="l395"></span>
<a href="l396"></a><span id="l396">      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#89890" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l397"></a><span id="l397">        <a href="#89882" title="(x$1: scales.xml.Prolog)Unit">vprolog</a> = <a href="#89882" title="scales.xml.Prolog" id="110321">vprolog</a>.<a href="XmlTypes.scala.html#98542" title="scales.xml.Declaration" id="110372">copy</a><span class="delimiter">(</span>misc = <a href="#89882" title="=&gt; scales.xml.Prolog">vprolog</a>.<a href="XmlTypes.scala.html#94393" title="=&gt; scales.xml.package.Miscs">misc</a> <a title="scales.xml.package.Miscs" id="110370">:+</a> <a href="#89897" title="(c: scales.xml.package.PullType, in: String)scales.xml.package.Misc">getMisc</a><span class="delimiter">(</span><a href="#89879" title="=&gt; scales.xml.package.PullType">current</a>, <span title="java.lang.String(&quot;prolog&quot;)" class="string">&quot;prolog&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l398"></a><span id="l398">      <span class="delimiter">}</span></span>
<a href="l399"></a><span id="l399">    <span class="delimiter">}</span></span>
<a href="l400"></a><span id="l400">  <span class="delimiter">}</span></span>
<a href="l401"></a><span id="l401"></span>
<a href="l402"></a><span id="l402">  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Iterator[scales.xml.package.PullType]" id="89899">it</a> = <a href="#11969" title="scales.xml.XmlPull" class="keyword">this</a>: <span title="Iterator[scales.xml.package.PullType]">Iterator</span><span class="delimiter">[</span>PullType<span class="delimiter">]</span></span>
<a href="l403"></a><span id="l403"></span>
<a href="l404"></a><span id="l404">  <span class="keyword">def</span> <a title="=&gt; Boolean" id="89901">hasNext</a> = <a href="#89879" title="=&gt; scales.xml.package.PullType">current</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span></span>
<a href="l405"></a><span id="l405"></span>
<a href="l406"></a><span id="l406">  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; scales.xml.package.Attributes" id="89902">getAttributes</a>: <a href="../utils/ListSet.scala.html#10456" title="scales.xml.package.Attributes">Attributes</a> = <span class="delimiter">{</span></span>
<a href="l407"></a><span id="l407">    <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.toQName</span>
<a href="l408"></a><span id="l408"></span>
<a href="l409"></a><span id="l409">    <span class="keyword">val</span> <a title="Int" id="112652">count</a> = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()Int">getAttributeCount</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l410"></a><span id="l410">    <span class="keyword">var</span> <a title="Int" id="112653">i</a> = <span title="Int(0)" class="int">0</span></span>
<a href="l411"></a><span id="l411">    <span class="keyword">var</span> <a title="scales.utils.ListSet[scales.xml.Attribute]" id="112654">map</a> = <a href="XmlTypes.scala.html#12419" title="=&gt; scales.utils.ListSet[scales.xml.Attribute]">emptyAttributes</a></span>
<a href="l412"></a><span id="l412">    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#112653" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#112652" title="Int">count</a><span class="delimiter">)</span> <a href="#112655" title="()Unit" class="delimiter">{</a></span>
<a href="l413"></a><span id="l413">      <span class="keyword">val</span> <a title="javax.xml.namespace.QName" id="112660">jqname</a> = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="(x$1: Int)javax.xml.namespace.QName">getAttributeName</span><span class="delimiter">(</span><a href="#112653" title="Int">i</a><span class="delimiter">)</span></span>
<a href="l414"></a><span id="l414">      <span class="keyword">val</span> <a title="java.lang.String" id="112661">pre</a> = <a href="#112660" title="javax.xml.namespace.QName">jqname</a>.<span title="()java.lang.String">getPrefix</span></span>
<a href="l415"></a><span id="l415">      <span class="keyword">val</span> <a title="java.lang.String" id="112662">local</a> = <a href="#112660" title="javax.xml.namespace.QName">jqname</a>.<span title="()java.lang.String">getLocalPart</span></span>
<a href="l416"></a><span id="l416">      <span class="comment">// attr qnames must be either prefixed or no namespace</span></span>
<a href="l417"></a><span id="l417">      <span class="keyword">val</span> <a title="scales.xml.package.AttributeQName" id="112663">aqname</a>: <a href="../utils/EitherLike.scala.html#10328" title="scales.xml.package.AttributeQName">AttributeQName</a> =</span>
<a href="l418"></a><span id="l418">        <span title="scales.xml.package.AttributeQName" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#112661" title="java.lang.String">pre</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#112661" title="java.lang.String">pre</a>.<span title="()Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l419"></a><span id="l419">          <span class="comment">// no namespace</span></span>
<a href="l420"></a><span id="l420">          <a href="#89876" title="=&gt; scales.xml.MemoryOptimisationStrategy[XmlPull.this.Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87782" title="(local: String, token: XmlPull.this.Token)scales.xml.NoNamespaceQName">noNamespaceQName</a><span class="delimiter">(</span><a href="#112662" title="java.lang.String">local</a>, <a href="#89877" title="=&gt; XmlPull.this.Token">token</a><span class="delimiter">)</span> <span class="comment">// Right)</span></span>
<a href="l421"></a><span id="l421">        <span class="keyword">else</span></span>
<a href="l422"></a><span id="l422">          <a href="#89876" title="=&gt; scales.xml.MemoryOptimisationStrategy[XmlPull.this.Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87784" title="(local: String, uri: String, prefix: String, token: XmlPull.this.Token)scales.xml.PrefixedQName">prefixedQName</a><span class="delimiter">(</span><a href="#112662" title="java.lang.String">local</a>, <a href="#112660" title="javax.xml.namespace.QName">jqname</a>.<span title="()java.lang.String">getNamespaceURI</span>, <a href="#112661" title="java.lang.String">pre</a>, <a href="#89877" title="=&gt; XmlPull.this.Token">token</a><span class="delimiter">)</span> <span class="comment">// Left )</span></span>
<a href="l423"></a><span id="l423"></span>
<a href="l424"></a><span id="l424">      <a href="#112654" title="scales.utils.ListSet[scales.xml.Attribute]">map</a> = <a href="#112654" title="scales.utils.ListSet[scales.xml.Attribute]">map</a> <a href="../utils/ListSet.scala.html#70319" title="(e: scales.xml.Attribute)scales.utils.ListSet[scales.xml.Attribute]">unsafePlus</a> </span>
<a href="l425"></a><span id="l425">	<a href="#89876" title="=&gt; scales.xml.MemoryOptimisationStrategy[XmlPull.this.Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87781" title="(qname: scales.xml.package.AttributeQName, value: String, token: XmlPull.this.Token)scales.xml.Attribute">attribute</a><span class="delimiter">(</span><a href="#112663" title="scales.xml.package.AttributeQName">aqname</a>, </span>
<a href="l426"></a><span id="l426">		       <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="(x$1: Int)java.lang.String">getAttributeValue</span><span class="delimiter">(</span><a href="#112653" title="Int">i</a><span class="delimiter">)</span>, <a href="#89877" title="=&gt; XmlPull.this.Token">token</a><span class="delimiter">)</span></span>
<a href="l427"></a><span id="l427"></span>
<a href="l428"></a><span id="l428">      <a href="#112653" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l429"></a><span id="l429">    <span class="delimiter">}</span></span>
<a href="l430"></a><span id="l430">    <a href="#112654" title="scales.utils.ListSet[scales.xml.Attribute]">map</a></span>
<a href="l431"></a><span id="l431">  <span class="delimiter">}</span></span>
<a href="l432"></a><span id="l432"></span>
<a href="l433"></a><span id="l433">  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Map[String,String]" id="89903">getNamespaces</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l434"></a><span id="l434">    <span class="keyword">val</span> <a title="Int" id="112686">count</a> = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()Int">getNamespaceCount</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l435"></a><span id="l435">    <span class="keyword">var</span> <a title="Int" id="112687">i</a> = <span title="Int(0)" class="int">0</span></span>
<a href="l436"></a><span id="l436">    <span class="keyword">var</span> <a title="scala.collection.immutable.Map[String,String]" id="112688">map</a> = <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]" class="delimiter">[</span><span title="String">String</span>, <span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l437"></a><span id="l437">    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#112687" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#112686" title="Int">count</a><span class="delimiter">)</span> <a href="#112689" title="()Unit" class="delimiter">{</a></span>
<a href="l438"></a><span id="l438">      <span class="keyword">val</span> <a title="java.lang.String" id="112695">pre</a> = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="(x$1: Int)java.lang.String">getNamespacePrefix</span><span class="delimiter">(</span><a href="#112687" title="Int">i</a><span class="delimiter">)</span></span>
<a href="l439"></a><span id="l439">      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#112695" title="java.lang.String">pre</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l440"></a><span id="l440">        <a href="#112688" title="scala.collection.immutable.Map[String,String]">map</a> <span title="(kv: (String, String))scala.collection.immutable.Map[String,String]">+=</span> <span class="delimiter">(</span><a href="#112695" title="(x: java.lang.String)ArrowAssoc[java.lang.String]">pre</a> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="(x$1: Int)java.lang.String">getNamespaceURI</span><span class="delimiter">(</span><a href="#112687" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l441"></a><span id="l441">      <span class="delimiter">}</span> <span class="comment">// else nothing, the element will define it, question is should we accept it here as it was defined as such!!??</span></span>
<a href="l442"></a><span id="l442">      <a href="#112687" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l443"></a><span id="l443">    <span class="delimiter">}</span></span>
<a href="l444"></a><span id="l444">    <a href="#112688" title="scala.collection.immutable.Map[String,String]">map</a></span>
<a href="l445"></a><span id="l445">  <span class="delimiter">}</span></span>
<a href="l446"></a><span id="l446"></span>
<a href="l447"></a><span id="l447">  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; scales.xml.QName" id="89904">getElemQName</a> = <span class="delimiter">{</span></span>
<a href="l448"></a><span id="l448">    <span class="comment">// elems can have all three, prefixed, ns and none</span></span>
<a href="l449"></a><span id="l449"><span class="comment">/*    val jqname = parser.getName()</span>
<a href="l450"></a><span id="l450">    val ns = jqname.getNamespaceURI</span>
<a href="l451"></a><span id="l451">    val pre = jqname.getPrefix</span>
<a href="l452"></a><span id="l452">    val local = jqname.getLocalPart</span>
<a href="l453"></a><span id="l453">*/</span></span>
<a href="l454"></a><span id="l454">    <span class="keyword">val</span> <a title="java.lang.String" id="112789">ns</a> = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getNamespaceURI</span></span>
<a href="l455"></a><span id="l455">    <span class="keyword">val</span> <a title="java.lang.String" id="112790">pre</a> = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getPrefix</span></span>
<a href="l456"></a><span id="l456">    <span class="keyword">val</span> <a title="java.lang.String" id="112791">local</a> = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getLocalName</span></span>
<a href="l457"></a><span id="l457"></span>
<a href="l458"></a><span id="l458">    <span title="scales.xml.QName" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#112790" title="java.lang.String">pre</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#112790" title="java.lang.String">pre</a>.<span title="()Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l459"></a><span id="l459">	<span class="comment">// ns only or none</span></span>
<a href="l460"></a><span id="l460">      <span title="&lt;none&gt; extends scales.xml.QName" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#112789" title="java.lang.String">ns</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#112789" title="java.lang.String">ns</a>.<span title="()Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l461"></a><span id="l461">        <a href="#89876" title="=&gt; scales.xml.MemoryOptimisationStrategy[XmlPull.this.Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87782" title="(local: String, token: XmlPull.this.Token)scales.xml.NoNamespaceQName">noNamespaceQName</a><span class="delimiter">(</span><a href="#112791" title="java.lang.String">local</a>, <a href="#89877" title="=&gt; XmlPull.this.Token">token</a><span class="delimiter">)</span></span>
<a href="l462"></a><span id="l462">      <span class="keyword">else</span></span>
<a href="l463"></a><span id="l463">	<a href="#89876" title="=&gt; scales.xml.MemoryOptimisationStrategy[XmlPull.this.Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87783" title="(local: String, uri: String, token: XmlPull.this.Token)scales.xml.UnprefixedQName">unprefixedQName</a><span class="delimiter">(</span><a href="#112791" title="java.lang.String">local</a>, <a href="#112789" title="java.lang.String">ns</a>, <a href="#89877" title="=&gt; XmlPull.this.Token">token</a><span class="delimiter">)</span></span>
<a href="l464"></a><span id="l464">    <span class="delimiter">}</span> <span class="keyword">else</span></span>
<a href="l465"></a><span id="l465">      <a href="#89876" title="=&gt; scales.xml.MemoryOptimisationStrategy[XmlPull.this.Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87784" title="(local: String, uri: String, prefix: String, token: XmlPull.this.Token)scales.xml.PrefixedQName">prefixedQName</a><span class="delimiter">(</span><a href="#112791" title="java.lang.String">local</a>, <a href="#112789" title="java.lang.String">ns</a>, <a href="#112790" title="java.lang.String">pre</a>, <a href="#89877" title="=&gt; XmlPull.this.Token">token</a><span class="delimiter">)</span></span>
<a href="l466"></a><span id="l466">    </span>
<a href="l467"></a><span id="l467">  <span class="delimiter">}</span></span>
<a href="l468"></a><span id="l468"></span>
<a href="l469"></a><span id="l469">  <span class="keyword">def</span> <a title="()scales.xml.package.PullType" id="89905">next</a>: <span title="scales.xml.package.PullType">PullType</span> = <span class="delimiter">{</span></span>
<a href="l470"></a><span id="l470">    <span class="keyword">val</span> <a title="scales.xml.package.PullType" id="112837">c</a> = <a href="#89879" title="=&gt; scales.xml.package.PullType">current</a> <span class="comment">// cache current</span></span>
<a href="l471"></a><span id="l471">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#89879" title="=&gt; scales.xml.package.PullType">current</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.util.NoSuchElementException" class="keyword">new</span> <span title="java.util.NoSuchElementException">NoSuchElementException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;The end of the document has been reached&quot;)" class="string">&quot;The end of the document has been reached&quot;</span><span class="delimiter">)</span></span>
<a href="l472"></a><span id="l472"></span>
<a href="l473"></a><span id="l473">    <a href="#89879" title="(x$1: scales.xml.package.PullType)Unit">current</a> = <a href="#89906" title="=&gt; scales.xml.package.PullType">pumpEvent</a> <span class="comment">// pump for the next</span></span>
<a href="l474"></a><span id="l474">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#89879" title="=&gt; scales.xml.package.PullType">current</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#89879" title="=&gt; scales.xml.package.PullType">current</a>.<span title="=&gt; Boolean">isRight</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#89890" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l475"></a><span id="l475">      <span class="comment">// we are now into the end doc, no more events will be pumped</span></span>
<a href="l476"></a><span id="l476">      <span class="keyword">var</span> <a title="scales.xml.package.PullType" id="112845">ends</a> = <a href="#89906" title="=&gt; scales.xml.package.PullType">pumpEvent</a></span>
<a href="l477"></a><span id="l477">      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#112845" title="scales.xml.package.PullType">ends</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#112846" title="()Unit" class="delimiter">{</a></span>
<a href="l478"></a><span id="l478">        <a href="#89885" title="(x$1: scales.xml.EndMisc)Unit">emisc</a> = <a href="#89885" title="=&gt; scales.xml.EndMisc">emisc</a>.<a href="XmlTypes.scala.html#94426" title="(misc: scales.xml.package.Miscs)scales.xml.EndMisc">copy</a><span class="delimiter">(</span>misc = <a href="#89885" title="=&gt; scales.xml.EndMisc">emisc</a>.<a href="XmlTypes.scala.html#94423" title="=&gt; scales.xml.package.Miscs">misc</a> <span title="(elem: scales.xml.package.Misc)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[scales.xml.package.Misc],scales.xml.package.Misc,scales.xml.package.Miscs])scales.xml.package.Miscs">:+</span> <a href="#89897" title="(c: scales.xml.package.PullType, in: String)scales.xml.package.Misc">getMisc</a><span class="delimiter">(</span><a href="#112845" title="scales.xml.package.PullType">ends</a>, <span title="java.lang.String(&quot;document end Misc&quot;)" class="string">&quot;document end Misc&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l479"></a><span id="l479">        <a href="#112845" title="scales.xml.package.PullType">ends</a> = <a href="#89906" title="=&gt; scales.xml.package.PullType">pumpEvent</a></span>
<a href="l480"></a><span id="l480">      <span class="delimiter">}</span></span>
<a href="l481"></a><span id="l481">    <span class="delimiter">}</span></span>
<a href="l482"></a><span id="l482"></span>
<a href="l483"></a><span id="l483">    <a href="#112837" title="scales.xml.package.PullType">c</a> <span class="comment">// return cached</span></span>
<a href="l484"></a><span id="l484">  <span class="delimiter">}</span></span>
<a href="l485"></a><span id="l485"></span>
<a href="l486"></a><span id="l486">  <span class="keyword">protected</span><span class="delimiter">[</span>xml<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; scales.xml.package.PullType" id="89906">pumpEvent</a>: <span title="scales.xml.package.PullType">PullType</span> = <span class="delimiter">{</span></span>
<a href="l487"></a><span id="l487">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span></span>
<a href="l488"></a><span id="l488"></span>
<a href="l489"></a><span id="l489">    <span class="keyword">var</span> <a title="Int" id="112892">nextEvent</a> = XMLStreamConstants.<span title="Int(8)">END_DOCUMENT</span> <span class="comment">// use this in the case of error from calling next as well, blow it up but try to shut down</span></span>
<a href="l490"></a><span id="l490">    <span class="keyword">try</span> <span class="delimiter">{</span></span>
<a href="l491"></a><span id="l491">      <a href="#112892" title="Int">nextEvent</a> = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()Int">next</span></span>
<a href="l492"></a><span id="l492"></span>
<a href="l493"></a><span id="l493">      <span class="keyword">val</span> <a title="scales.xml.package.PullType" id="112893">event</a>: <span title="scales.xml.package.PullType">PullType</span> = <a href="#112892" title="Int">nextEvent</a> <span title="scales.xml.package.PullType" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l494"></a><span id="l494">        <span class="keyword">case</span> <span title="Left[scales.xml.XmlEvent,Nothing]">XMLStreamConstants</span>.<span title="Int(1)">START_ELEMENT</span> =&gt; </span>
<a href="l495"></a><span id="l495">	  <a href="#89890" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l496"></a><span id="l496">	  <a href="#89876" title="=&gt; scales.xml.MemoryOptimisationStrategy[XmlPull.this.Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87785" title="(name: scales.xml.QName, attributes: scales.xml.package.Attributes, namespaces: Map[String,String], token: XmlPull.this.Token)scales.xml.Elem">elem</a><a href="#12529" title="implicit scales.xml.XmlPulls.toLeft : (ev: scales.xml.XmlEvent)Left[scales.xml.XmlEvent,Nothing]" class="delimiter">(</a><a href="#89904" title="=&gt; scales.xml.QName">getElemQName</a>, <a href="#89902" title="=&gt; scales.xml.package.Attributes">getAttributes</a>, <a href="#89903" title="=&gt; Map[String,String]">getNamespaces</a>, <a href="#89877" title="=&gt; XmlPull.this.Token">token</a><span class="delimiter">)</span></span>
<a href="l497"></a><span id="l497"></span>
<a href="l498"></a><span id="l498">        <span class="keyword">case</span> <span title="Right[Nothing,scales.xml.EndElem]">XMLStreamConstants</span>.<span title="Int(2)">END_ELEMENT</span> =&gt; <a href="#89890" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>; <a href="#112951" title="(name: scales.xml.QName, namespaces: Map[String,String])scales.xml.EndElem">EndElem</a><a href="#12530" title="implicit scales.xml.XmlPulls.toRight : (ev: scales.xml.EndElem)Right[Nothing,scales.xml.EndElem]" class="delimiter">(</a><a href="#89904" title="=&gt; scales.xml.QName">getElemQName</a>, <a href="#89903" title="=&gt; Map[String,String]">getNamespaces</a><span class="delimiter">)</span></span>
<a href="l499"></a><span id="l499">        <span class="keyword">case</span> <span title="Left[scales.xml.XmlEvent,Nothing]">XMLStreamConstants</span>.<span title="Int(4)">CHARACTERS</span> =&gt; <a href="XmlTypes.scala.html#97509" title="(value: String)scales.xml.Text">Text</a><a href="#12529" title="implicit scales.xml.XmlPulls.toLeft : (ev: scales.xml.XmlEvent)Left[scales.xml.XmlEvent,Nothing]" class="delimiter">(</a><a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getText</span><span class="delimiter">)</span></span>
<a href="l500"></a><span id="l500">        <span class="keyword">case</span> <span title="Left[scales.xml.XmlEvent,Nothing]">XMLStreamConstants</span>.<span title="Int(12)">CDATA</span> =&gt; <a href="XmlTypes.scala.html#99391" title="(valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.CData">CData</a><a href="#12529" title="implicit scales.xml.XmlPulls.toLeft : (ev: scales.xml.XmlEvent)Left[scales.xml.XmlEvent,Nothing]" class="delimiter">(</a><a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getText</span><span class="delimiter">)</span></span>
<a href="l501"></a><span id="l501">        <span class="keyword">case</span> <span title="Left[scales.xml.XmlEvent,Nothing]">XMLStreamConstants</span>.<span title="Int(5)">COMMENT</span> =&gt; <a href="XmlTypes.scala.html#99149" title="(valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.Comment">Comment</a><a href="#12529" title="implicit scales.xml.XmlPulls.toLeft : (ev: scales.xml.XmlEvent)Left[scales.xml.XmlEvent,Nothing]" class="delimiter">(</a><a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getText</span><span class="delimiter">)</span></span>
<a href="l502"></a><span id="l502">        <span class="keyword">case</span> <span title="Left[scales.xml.XmlEvent,Nothing]">XMLStreamConstants</span>.<span title="Int(3)">PROCESSING_INSTRUCTION</span> =&gt; <a href="XmlTypes.scala.html#98588" title="(targeti: String, valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.PI">PI</a><a href="#12529" title="implicit scales.xml.XmlPulls.toLeft : (ev: scales.xml.XmlEvent)Left[scales.xml.XmlEvent,Nothing]" class="delimiter">(</a><a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getPITarget</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getPIData</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l503"></a><span id="l503">        <span class="keyword">case</span> <span title="Left[scales.xml.XmlEvent,Nothing]">XMLStreamConstants</span>.<span title="Int(6)">SPACE</span> =&gt; <a href="XmlTypes.scala.html#97509" title="(value: String)scales.xml.Text">Text</a><a href="#12529" title="implicit scales.xml.XmlPulls.toLeft : (ev: scales.xml.XmlEvent)Left[scales.xml.XmlEvent,Nothing]" class="delimiter">(</a><a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getText</span><span class="delimiter">)</span> <span class="comment">// jdk impl never calls but to be safe we should grab it</span></span>
<a href="l504"></a><span id="l504">        <span class="keyword">case</span> <span title="scales.xml.package.PullType">XMLStreamConstants</span>.<span title="Int(7)">START_DOCUMENT</span> =&gt; <span class="delimiter">{</span></span>
<a href="l505"></a><span id="l505">          <span class="comment">// get the encoding etc</span></span>
<a href="l506"></a><span id="l506">          <span class="keyword">val</span> <a title="java.lang.String" id="112909">ec</a> = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getCharacterEncodingScheme</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l507"></a><span id="l507"></span>
<a href="l508"></a><span id="l508">          <a href="#89882" title="(x$1: scales.xml.Prolog)Unit">vprolog</a> = <a href="#89882" title="scales.xml.Prolog" id="112910">vprolog</a>.<a href="XmlTypes.scala.html#98543" title="scales.xml.package.Miscs" id="112935">copy</a><span class="delimiter">(</span>decl = <a href="XmlTypes.scala.html#112913" title="(version: scales.xml.XmlVersion, encoding: java.nio.charset.Charset, standalone: Boolean)scales.xml.Declaration">Declaration</a><a title="scales.xml.Declaration" id="112933" class="delimiter">(</a></span>
<a href="l509"></a><span id="l509">            version = <span title="scales.xml.XmlVersion" class="keyword">if</span> <span class="delimiter">(</span><a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()java.lang.String">getVersion</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;1.1&quot;)" class="string">&quot;1.1&quot;</span><span class="delimiter">)</span></span>
<a href="l510"></a><span id="l510">              <a href="QName.scala.html#11781" title="object scales.xml.Xml11">Xml11</a> <span class="keyword">else</span> <a href="QName.scala.html#11783" title="object scales.xml.Xml10">Xml10</a>,</span>
<a href="l511"></a><span id="l511">            encoding = <span title="java.nio.charset.Charset" class="keyword">if</span> <span class="delimiter">(</span><a href="#112909" title="java.lang.String">ec</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../utils/Localisation.scala.html#12395" title="=&gt; java.nio.charset.Charset">defaultCharset</a> <span class="keyword">else</span> java.nio.charset.<span title="object java.nio.charset.Charset">Charset</span>.<span title="(x$1: java.lang.String)java.nio.charset.Charset">forName</span><span class="delimiter">(</span><a href="#112909" title="java.lang.String">ec</a><span class="delimiter">)</span>, <span class="comment">// TODO what do we do about unsupported, throwing is probably fine, but it irritates, if we can get here the parser at least supports it, even if we can't write to it</span></span>
<a href="l512"></a><span id="l512">            standalone = <a href="#89873" title="=&gt; javax.xml.stream.XMLStreamReader">parser</a>.<span title="()Boolean">isStandalone</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l513"></a><span id="l513"></span>
<a href="l514"></a><span id="l514">          <a href="#89906" title="=&gt; scales.xml.package.PullType">pumpEvent</a> <span class="comment">// we don't want to handle this</span></span>
<a href="l515"></a><span id="l515">        <span class="delimiter">}</span></span>
<a href="l516"></a><span id="l516">        <span class="keyword">case</span> <span title="Left[scales.xml.XmlEvent,Nothing]">XMLStreamConstants</span>.<span title="Int(11)">DTD</span> =&gt; <a href="#12529" title="implicit scales.xml.XmlPulls.toLeft : (ev: scales.xml.XmlEvent)Left[scales.xml.XmlEvent,Nothing]">dtdDummy</a> <span class="comment">// push it through in start</span></span>
<a href="l517"></a><span id="l517"></span>
<a href="l518"></a><span id="l518">        <span class="comment">// we don't really want to handle other types?</span></span>
<a href="l519"></a><span id="l519">        <span class="keyword">case</span> <span title="scales.xml.package.PullType">_</span> =&gt; <a href="#89906" title="=&gt; scales.xml.package.PullType">pumpEvent</a> <span class="comment">// push another through if possible, this also stops doc starts and doc ends etc</span></span>
<a href="l520"></a><span id="l520">      <span class="delimiter">}</span></span>
<a href="l521"></a><span id="l521">      <a href="#112893" title="scales.xml.package.PullType">event</a></span>
<a href="l522"></a><span id="l522">    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span></span>
<a href="l523"></a><span id="l523">      <span class="comment">// should we close it? </span></span>
<a href="l524"></a><span id="l524">      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#112892" title="Int">nextEvent</a> <span title="(x: Int)Boolean">==</span> XMLStreamConstants.<span title="Int(8)">END_DOCUMENT</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l525"></a><span id="l525">        <a href="#89875" title="=&gt; Unit">internalClose</a></span>
<a href="l526"></a><span id="l526">      <span class="delimiter">}</span></span>
<a href="l527"></a><span id="l527">    <span class="delimiter">}</span></span>
<a href="l528"></a><span id="l528">  <span class="delimiter">}</span></span>
<a href="l529"></a><span id="l529"><span class="delimiter">}</span></span>
<a href="l530"></a><span id="l530"></span>
<a href="l531"></a><span id="l531">        </span>
</pre>
    </body>
</html>