<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scales\xml\XmlParser.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    
<style id="linesStyle">
.lineHighlight {
  background-color: #a5a5a5;
}
</style>
<script type="text/javascript">
function selectedLine() {
    var loca = /^.*#l(.*)/.exec(location.href);
    return loca ? loca[1] : '0';
}

function highlightLine(ln){
  $('#l'+ln).toggleClass('lineHighlight');
}

function gotoLine(ln){
  $('#l'+ln).focus();
}

$(function(){
  var line = selectedLine();
  if (line != '0') highlightLine(line)
});
</script></head>
    <body>
        <pre>
<!-- SXR_LINES --><a href="l1"></a><span id="l1"><span class="keyword">package</span> scales.xml</span>
<a href="l2"></a><span id="l2"></span>
<a href="l3"></a><span id="l3"><span class="keyword">import</span> org.xml.sax.InputSource</span>
<a href="l4"></a><span id="l4"><span class="keyword">import</span> javax.xml.parsers.SAXParser</span>
<a href="l5"></a><span id="l5"><span class="keyword">import</span> scales.utils._</span>
<a href="l6"></a><span id="l6"><span class="keyword">import</span> java.io._</span>
<a href="l7"></a><span id="l7"></span>
<a href="l8"></a><span id="l8"><span class="keyword">trait</span> <a title="trait XmlParserImplicits extends java.lang.Object with ScalaObject" id="11873">XmlParserImplicits</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l9"></a><span id="l9">  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.XmlParserImplicits.streamToSource : (source: java.io.InputStream)org.xml.sax.InputSource" id="87864">streamToSource</a><span class="delimiter">(</span> <a title="java.io.InputStream" id="90177">source</a> : <span title="java.io.InputStream">InputStream</span> <span class="delimiter">)</span> = <span title="(x$1: java.io.InputStream)org.xml.sax.InputSource" class="keyword">new</span> org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span><span class="delimiter">(</span><a href="#90177" title="java.io.InputStream">source</a><span class="delimiter">)</span></span>
<a href="l10"></a><span id="l10">  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.XmlParserImplicits.readerToSource : (source: java.io.Reader)org.xml.sax.InputSource" id="87865">readerToSource</a><span class="delimiter">(</span> <a title="java.io.Reader" id="90086">source</a> : <span title="java.io.Reader">Reader</span> <span class="delimiter">)</span> = <span title="(x$1: java.io.Reader)org.xml.sax.InputSource" class="keyword">new</span> org.xml.sax.<span title="org.xml.sax.InputSource">InputSource</span><span class="delimiter">(</span><a href="#90086" title="java.io.Reader">source</a><span class="delimiter">)</span></span>
<a href="l11"></a><span id="l11"><span class="delimiter">}</span></span>
<a href="l12"></a><span id="l12"></span>
<a href="l13"></a><span id="l13"><span class="keyword">trait</span> <a title="trait XmlParser extends java.lang.Object with ScalaObject" id="11874">XmlParser</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l14"></a><span id="l14"></span>
<a href="l15"></a><span id="l15">  <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.xmlCBF</span>
<a href="l16"></a><span id="l16"></span>
<a href="l17"></a><span id="l17">  <span class="comment">/**</span>
<a href="l18"></a><span id="l18">   * Use a custom parserPool to control the sax factory features </span>
<a href="l19"></a><span id="l19">   */</span> </span>
<a href="l20"></a><span id="l20">  <span class="keyword">def</span> <a title="[Token &lt;: scales.xml.OptimisationToken](source: org.xml.sax.InputSource, strategy: scales.xml.PathOptimisationStrategy[Token], parsers: scales.utils.Loaner[javax.xml.parsers.SAXParser])(implicit xmlVer: scales.xml.XmlVersion)scales.xml.Doc" id="12442">loadXml</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="98258">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="org.xml.sax.InputSource" id="98251">source</a>: <span title="org.xml.sax.InputSource">InputSource</span>, <a title="scales.xml.PathOptimisationStrategy[Token]" id="98256">strategy</a> : <a href="OptimisingStrategies.scala.html#10680" title="scales.xml.PathOptimisationStrategy[Token]">PathOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span> = <a href="package.scala.html#12436" title="=&gt; scales.xml.PathOptimisationStrategy[scales.xml.ElemToken]">defaultPathOptimisation</a>, <a title="scales.utils.Loaner[javax.xml.parsers.SAXParser]" id="98259">parsers</a> : <a href="../utils/Resources.scala.html#10611" title="scales.utils.Loaner[javax.xml.parsers.SAXParser]">Loaner</a><span class="delimiter">[</span>SAXParser<span class="delimiter">]</span> = <a href="XmlFactories.scala.html#12542" title="object scales.xml.package.DefaultSAXParserFactoryPool">DefaultSAXParserFactoryPool</a>.<a href="XmlFactories.scala.html#97588" title="=&gt; java.lang.Object with scales.utils.Loaner[javax.xml.parsers.SAXParser]">parsers</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.XmlVersion" id="98254">xmlVer</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <a href="XmlTypes.scala.html#12027" title="scales.xml.Doc">Doc</a> = <span class="delimiter">{</span></span>
<a href="l21"></a><span id="l21">    <span class="keyword">var</span> <a title="XmlParser.this.Handler[Token]" id="98265">handler</a> = <a href="#98254" title="XmlParser.this.Handler[Token]" class="keyword">new</a> <a href="#12451" title="XmlParser.this.Handler[Token]">Handler</a><span class="delimiter">(</span><a href="#98256" title="scales.xml.PathOptimisationStrategy[Token]">strategy</a><span class="delimiter">)</span></span>
<a href="l22"></a><span id="l22">    <a href="#98259" title="scales.utils.Loaner[javax.xml.parsers.SAXParser]">parsers</a>.<a href="../utils/Resources.scala.html#85752" title="(tThunk: javax.xml.parsers.SAXParser =&gt; scales.xml.Doc)scales.xml.Doc">loan</a> <span class="delimiter">{</span></span>
<a href="l23"></a><span id="l23">      <a title="javax.xml.parsers.SAXParser" id="98275">parser</a> =&gt;</span>
<a href="l24"></a><span id="l24">      <a href="#98275" title="javax.xml.parsers.SAXParser">parser</a>.<span title="(x$1: java.lang.String, x$2: Any)Unit">setProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;http://xml.org/sax/properties/lexical-handler&quot;)" class="string">&quot;http://xml.org/sax/properties/lexical-handler&quot;</span>, <a href="#98265" title="XmlParser.this.Handler[Token]">handler</a><span class="delimiter">)</span></span>
<a href="l25"></a><span id="l25">      <a href="#98275" title="javax.xml.parsers.SAXParser">parser</a>.<span title="(x$1: org.xml.sax.InputSource, x$2: org.xml.sax.helpers.DefaultHandler)Unit">parse</span><span class="delimiter">(</span><a href="#98251" title="org.xml.sax.InputSource">source</a>, <a href="#98265" title="XmlParser.this.Handler[Token]">handler</a><span class="delimiter">)</span></span>
<a href="l26"></a><span id="l26"></span>
<a href="l27"></a><span id="l27">      <a href="XmlTypes.scala.html#89984" title="(rootElem: scales.xml.package.XmlTree, prolog: scales.xml.Prolog, end: scales.xml.EndMisc)scales.xml.Doc">Doc</a><span class="delimiter">(</span><a href="#98265" title="XmlParser.this.Handler[Token]">handler</a>.<a href="#94182" title="=&gt; scales.xml.TreeProxies">buf</a>.<a href="#88863" title="=&gt; scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">tree</a>, <a href="#98265" title="XmlParser.this.Handler[Token]">handler</a>.<a href="#94191" title="=&gt; scales.xml.Prolog">prolog</a>, <a href="#98265" title="XmlParser.this.Handler[Token]">handler</a>.<a href="#94194" title="=&gt; scales.xml.EndMisc">end</a><span class="delimiter">)</span></span>
<a href="l28"></a><span id="l28">    <span class="delimiter">}</span></span>
<a href="l29"></a><span id="l29">  <span class="delimiter">}</span></span>
<a href="l30"></a><span id="l30">  </span>
<a href="l31"></a><span id="l31"></span>
<a href="l32"></a><span id="l32">  <span class="comment">/** Elems can have any QName, attribs only prefixed or default */</span></span>
<a href="l33"></a><span id="l33">  <span class="keyword">def</span> <a title="[Token &lt;: scales.xml.OptimisationToken](uri: String, localName: String, qName: String, strategy: scales.xml.MemoryOptimisationStrategy[Token], token: Token)scales.xml.QName" id="12445">eqn</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="12447">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="98371">uri</a>: <span title="String">String</span>,</span>
<a href="l34"></a><span id="l34">    <a title="String" id="98372">localName</a>: <span title="String">String</span>,</span>
<a href="l35"></a><span id="l35">    <a title="String" id="98373">qName</a>: <span title="String">String</span>, <a title="scales.xml.MemoryOptimisationStrategy[Token]" id="98374">strategy</a> : <a href="OptimisingStrategies.scala.html#10675" title="scales.xml.MemoryOptimisationStrategy[Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span>, <a title="Token" id="98375">token</a> : <a href="#12447" title="Token">Token</a><span class="delimiter">)</span>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a> =</span>
<a href="l36"></a><span id="l36">    <span title="scales.xml.QName" class="keyword">if</span> <span class="delimiter">(</span><a href="#98371" title="String">uri</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l37"></a><span id="l37">      <span class="comment">// can only be in qName</span></span>
<a href="l38"></a><span id="l38">      <a href="#98374" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87782" title="(local: String, token: Token)scales.xml.NoNamespaceQName">noNamespaceQName</a><span class="delimiter">(</span><a href="#98373" title="String">qName</a>, <a href="#98375" title="Token">token</a><span class="delimiter">)</span></span>
<a href="l39"></a><span id="l39">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l40"></a><span id="l40">      <span class="comment">// might have a prefix</span></span>
<a href="l41"></a><span id="l41">      <span title="scales.xml.QName" class="keyword">if</span> <span class="delimiter">(</span><a href="#98373" title="String">qName</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#98372" title="String">localName</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l42"></a><span id="l42">        <span class="comment">// no prefix</span></span>
<a href="l43"></a><span id="l43">	<a href="#98374" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87783" title="(local: String, uri: String, token: Token)scales.xml.UnprefixedQName">unprefixedQName</a><span class="delimiter">(</span><a href="#98372" title="String">localName</a>, <a href="#98371" title="String">uri</a>, <a href="#98375" title="Token">token</a><span class="delimiter">)</span></span>
<a href="l44"></a><span id="l44">      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l45"></a><span id="l45">        <span class="comment">// break up the prefix</span></span>
<a href="l46"></a><span id="l46">        <span class="keyword">val</span> <a title="Array[String]" id="98396">bits</a> = <a href="#98373" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">qName</a>.<span title="(separator: Char)Array[String]">split</span><span class="delimiter">(</span><span title="Char(\':\')" class="char">':'</span><span class="delimiter">)</span></span>
<a href="l47"></a><span id="l47">	</span>
<a href="l48"></a><span id="l48">	<a href="#98374" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87784" title="(local: String, uri: String, prefix: String, token: Token)scales.xml.PrefixedQName">prefixedQName</a><span class="delimiter">(</span><a href="#98372" title="String">localName</a>, <a href="#98371" title="String">uri</a>, <a href="#98396" title="(i: Int)String">bits</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#98375" title="Token">token</a><span class="delimiter">)</span></span>
<a href="l49"></a><span id="l49">      <span class="delimiter">}</span></span>
<a href="l50"></a><span id="l50">    <span class="delimiter">}</span></span>
<a href="l51"></a><span id="l51"></span>
<a href="l52"></a><span id="l52">  <span class="comment">/** attribs only prefixed or default */</span></span>
<a href="l53"></a><span id="l53">  <span class="keyword">def</span> <a title="[Token &lt;: scales.xml.OptimisationToken](uri: String, localName: String, qName: String, strategy: scales.xml.MemoryOptimisationStrategy[Token], token: Token)scales.xml.package.AttributeQName" id="12448">aqn</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="12450">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="98424">uri</a>: <span title="String">String</span>,</span>
<a href="l54"></a><span id="l54">    <a title="String" id="98425">localName</a>: <span title="String">String</span>,</span>
<a href="l55"></a><span id="l55">    <a title="String" id="98426">qName</a>: <span title="String">String</span>, <a title="scales.xml.MemoryOptimisationStrategy[Token]" id="98427">strategy</a> : <a href="OptimisingStrategies.scala.html#10675" title="scales.xml.MemoryOptimisationStrategy[Token]">MemoryOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span>, <a title="Token" id="98428">token</a> : <a href="#12450" title="Token">Token</a><span class="delimiter">)</span>: <a href="../utils/EitherLike.scala.html#10328" title="scales.xml.package.AttributeQName">AttributeQName</a> =</span>
<a href="l56"></a><span id="l56">    <span title="scales.xml.package.AttributeQName" class="keyword">if</span> <span class="delimiter">(</span><a href="#98424" title="String">uri</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l57"></a><span id="l57">      <span class="comment">// can only be in qName</span></span>
<a href="l58"></a><span id="l58">      <a href="#98427" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87782" title="(local: String, token: Token)scales.xml.NoNamespaceQName">noNamespaceQName</a><span class="delimiter">(</span><a href="#98426" title="String">qName</a>, <a href="#98428" title="Token">token</a><span class="delimiter">)</span> <span class="comment">// Right</span></span>
<a href="l59"></a><span id="l59">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l60"></a><span id="l60">      <span class="comment">// might have a prefix</span></span>
<a href="l61"></a><span id="l61">      <span title="scales.xml.package.AttributeQName" class="keyword">if</span> <span class="delimiter">(</span><a href="#98426" title="String">qName</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#98425" title="String">localName</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l62"></a><span id="l62">        <span class="comment">// no prefix</span></span>
<a href="l63"></a><span id="l63">        scales.utils.<a href="../utils/package.scala.html#12052" title="(str: String)Nothing">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Should not have an attribute with a unprefixed namspace&quot;)" class="string">&quot;Should not have an attribute with a unprefixed namspace&quot;</span><span class="delimiter">)</span></span>
<a href="l64"></a><span id="l64">      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l65"></a><span id="l65">        <span class="comment">// break up the prefix</span></span>
<a href="l66"></a><span id="l66">        <span class="keyword">val</span> <a title="Array[String]" id="98446">bits</a> = <a href="#98426" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">qName</a>.<span title="(separator: Char)Array[String]">split</span><span class="delimiter">(</span><span title="Char(\':\')" class="char">':'</span><span class="delimiter">)</span></span>
<a href="l67"></a><span id="l67">        <a href="#98427" title="scales.xml.MemoryOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87784" title="(local: String, uri: String, prefix: String, token: Token)scales.xml.PrefixedQName">prefixedQName</a><span class="delimiter">(</span><a href="#98425" title="String">localName</a>, <a href="#98424" title="String">uri</a>,<a href="#98446" title="(i: Int)String">bits</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#98428" title="Token">token</a><span class="delimiter">)</span> <span class="comment">// Left</span></span>
<a href="l68"></a><span id="l68">      <span class="delimiter">}</span></span>
<a href="l69"></a><span id="l69">    <span class="delimiter">}</span></span>
<a href="l70"></a><span id="l70"></span>
<a href="l71"></a><span id="l71">  <span class="keyword">class</span> <a title="class Handler[Token &lt;: scales.xml.OptimisationToken] extends org.xml.sax.ext.DefaultHandler2 with ScalaObject" id="12451">Handler</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: scales.xml.OptimisationToken" id="12452">Token</a> &lt;: OptimisationToken<span class="delimiter">]</span><a href="#12451" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="scales.xml.PathOptimisationStrategy[Token]" id="94316">strategy</a> : <a href="OptimisingStrategies.scala.html#10680" title="scales.xml.PathOptimisationStrategy[Token]">PathOptimisationStrategy</a><span class="delimiter">[</span>Token<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.XmlVersion" id="94317">defaultVersion</a> : <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span> <span class="keyword">extends</span> org.xml.sax.ext.<span title="org.xml.sax.ext.DefaultHandler2">DefaultHandler2</span> <span class="delimiter">{</span></span>
<a href="l72"></a><span id="l72"></span>
<a href="l73"></a><span id="l73">    <span class="keyword">import</span> scales.utils.<span class="delimiter">{</span>noPath, Path, top, ScalesUtils <span class="delimiter">}</span></span>
<a href="l74"></a><span id="l74">    <span class="keyword">import</span> org.xml.sax._</span>
<a href="l75"></a><span id="l75">    <span class="keyword">import</span> scala.collection.immutable.Stack</span>
<a href="l76"></a><span id="l76">    <span class="keyword">import</span> <a href="../utils/ScalesUtils.scala.html#10619" title="object scales.utils.ScalesUtils">ScalesUtils</a>._</span>
<a href="l77"></a><span id="l77"><span class="comment">//    import ScalesXml.toQName // Note we aren't validating the names here anyway so we don't need to use the correct xml version, future version may double check perhaps?</span></span>
<a href="l78"></a><span id="l78"></span>
<a href="l79"></a><span id="l79">    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.FromParser" id="94178">weAreInAParser</a> : <a href="XmlTypes.scala.html#11984" title="scales.xml.FromParser">FromParser</a> = <a href="XmlTypes.scala.html#12400" title="object scales.xml.package.IsFromParser">IsFromParser</a></span>
<a href="l80"></a><span id="l80"></span>
<a href="l81"></a><span id="l81">    <span class="keyword">val</span> <a title="Token" id="94180">token</a> : <a href="#12452" title="Token">Token</a> = <a href="#94316" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87780" title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)Token">createToken</a></span>
<a href="l82"></a><span id="l82"></span>
<a href="l83"></a><span id="l83">    <span class="comment">// start with nothing</span></span>
<a href="l84"></a><span id="l84"><span class="comment">//    var path: XmlPath = noXmlPath</span></span>
<a href="l85"></a><span id="l85"></span>
<a href="l86"></a><span id="l86">    <span class="comment">// only trees have kids, and we only need to keep the parent</span></span>
<a href="l87"></a><span id="l87">    <span class="keyword">val</span> <a title="scales.xml.TreeProxies" id="94182">buf</a> = <a href="#94328" title="scales.xml.TreeProxies" class="keyword">new</a> <a href="#11878" title="scales.xml.TreeProxies">TreeProxies</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l88"></a><span id="l88"></span>
<a href="l89"></a><span id="l89">    <span class="keyword">var</span> <a title="Boolean" id="94185">isCData</a> = <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l90"></a><span id="l90"></span>
<a href="l91"></a><span id="l91">    <span class="comment">// declarations on this element</span></span>
<a href="l92"></a><span id="l92">    <span class="keyword">var</span> <a title="scala.collection.immutable.Map[String,String]" id="94188">nsDeclarations</a> = <a href="XmlTypes.scala.html#12421" title="=&gt; scala.collection.immutable.Map[String,String]">emptyNamespaces</a></span>
<a href="l93"></a><span id="l93"></span>
<a href="l94"></a><span id="l94">    <span class="keyword">var</span> <a title="scales.xml.Prolog" id="94191">prolog</a> = <a href="XmlTypes.scala.html#94364" title="(decl: scales.xml.Declaration, misc: scales.xml.package.Miscs, dtd: Option[scales.xml.DTD])scales.xml.Prolog">Prolog</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l95"></a><span id="l95">    <span class="keyword">var</span> <a title="scales.xml.EndMisc" id="94194">end</a> = <a href="XmlTypes.scala.html#94398" title="(misc: scales.xml.package.Miscs)scales.xml.EndMisc">EndMisc</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l96"></a><span id="l96"></span>
<a href="l97"></a><span id="l97">    <span class="comment">// used for judging PI or Comments</span></span>
<a href="l98"></a><span id="l98">    <span class="keyword">var</span> <a title="Boolean" id="94197">inprolog</a> = <span title="Boolean(true)" class="keyword">true</span></span>
<a href="l99"></a><span id="l99"></span>
<a href="l100"></a><span id="l100">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(name: String, publicId: String, systemId: String)Unit" id="94199">startDTD</a><span class="delimiter">(</span><a title="String" id="98484">name</a> : <span title="String">String</span>, <a title="String" id="98485">publicId</a> : <span title="String">String</span>, <a title="String" id="98486">systemId</a> : <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l101"></a><span id="l101">      <a href="#94191" title="(x$1: scales.xml.Prolog)Unit">prolog</a> = <a href="#94191" title="scales.xml.Prolog" id="98501">prolog</a>.<a href="XmlTypes.scala.html#98498" title="scales.xml.Declaration" id="98538">copy</a><span class="delimiter">(</span>dtd = <span title="(x: scales.xml.DTD)Some[scales.xml.DTD]">Some</span><a title="Some[scales.xml.DTD]" id="98536" class="delimiter">(</a><a href="XmlTypes.scala.html#98523" title="(name: String, publicId: String, systemId: String)scales.xml.DTD">DTD</a><span class="delimiter">(</span><a href="#98484" title="String">name</a>, <a href="#98485" title="String">publicId</a>, <a href="#98486" title="String">systemId</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l102"></a><span id="l102">    <span class="delimiter">}</span></span>
<a href="l103"></a><span id="l103"></span>
<a href="l104"></a><span id="l104">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(target: String, data: String)Unit" id="94200">processingInstruction</a><span class="delimiter">(</span><a title="String" id="98539">target</a> : <span title="String">String</span>, <a title="String" id="98540">data</a> : <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l105"></a><span id="l105">      <span class="keyword">val</span> <a title="apply extends java.lang.Object with scales.xml.PI" id="98542">pi</a> = <a href="XmlTypes.scala.html#98544" title="(targeti: String, valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.PI">PI</a><a href="#94178" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="#98539" title="String">target</a>, <a href="#98540" title="String">data</a><span class="delimiter">)</span></span>
<a href="l106"></a><span id="l106">      <a href="#94205" title="(miscItem: scales.xml.package.Misc)Unit">addMisc</a><span class="delimiter">(</span><span title="(b: java.lang.Object with scales.xml.PI)Right[Nothing,java.lang.Object with scales.xml.PI]">Right</span><span class="delimiter">(</span><a href="#98542" title="apply extends java.lang.Object with scales.xml.PI">pi</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l107"></a><span id="l107">    <span class="delimiter">}</span> </span>
<a href="l108"></a><span id="l108"></span>
<a href="l109"></a><span id="l109">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(prefix: String, uri: String)Unit" id="94201">startPrefixMapping</a><span class="delimiter">(</span><a title="String" id="98776">prefix</a>: <span title="String">String</span>, <a title="String" id="98777">uri</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l110"></a><span id="l110">      <a href="#94188" title="(x$1: scala.collection.immutable.Map[String,String])Unit">nsDeclarations</a> <span title="(kv: (String, String))scala.collection.immutable.Map[String,String]">+=</span> <span class="delimiter">(</span><a href="#98776" title="(x: String)ArrowAssoc[String]">prefix</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#98777" title="String">uri</a><span class="delimiter">)</span></span>
<a href="l111"></a><span id="l111">    <span class="delimiter">}</span></span>
<a href="l112"></a><span id="l112"></span>
<a href="l113"></a><span id="l113">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(uri: String, localName: String, qName: String, attributes: org.xml.sax.Attributes)Unit" id="94202">startElement</a><span class="delimiter">(</span><a title="String" id="99002">uri</a>: <span title="String">String</span>,</span>
<a href="l114"></a><span id="l114">      <a title="String" id="99003">localName</a>: <span title="String">String</span>,</span>
<a href="l115"></a><span id="l115">      <a title="String" id="99004">qName</a>: <span title="String">String</span>,</span>
<a href="l116"></a><span id="l116">      <a title="org.xml.sax.Attributes" id="99005">attributes</a>: org.xml.sax.<span title="org.xml.sax.Attributes">Attributes</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l117"></a><span id="l117"></span>
<a href="l118"></a><span id="l118">      <a href="#94197" title="(x$1: Boolean)Unit">inprolog</a> = <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l119"></a><span id="l119"></span>
<a href="l120"></a><span id="l120">      <span class="keyword">var</span> <a title="Int" id="99033">i</a> = <span title="Int(0)" class="int">0</span></span>
<a href="l121"></a><span id="l121">      <span class="keyword">val</span> <a title="Int" id="99034">length</a> = <a href="#99005" title="org.xml.sax.Attributes">attributes</a>.<span title="()Int">getLength</span></span>
<a href="l122"></a><span id="l122">      <span class="keyword">var</span> <a title="scales.utils.ListSet[scales.xml.Attribute]" id="99035">attribs</a> = <a href="XmlTypes.scala.html#12419" title="=&gt; scales.utils.ListSet[scales.xml.Attribute]">emptyAttributes</a></span>
<a href="l123"></a><span id="l123"></span>
<a href="l124"></a><span id="l124">      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#99033" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#99034" title="Int">length</a><span class="delimiter">)</span> <a href="#99037" title="()Unit" class="delimiter">{</a></span>
<a href="l125"></a><span id="l125">        <span class="keyword">val</span> <a title="scales.xml.package.AttributeQName" id="99042">qname</a> = <a href="#12448" title="(uri: String, localName: String, qName: String, strategy: scales.xml.MemoryOptimisationStrategy[Token], token: Token)scales.xml.package.AttributeQName">aqn</a><span class="delimiter">(</span><a href="#99005" title="org.xml.sax.Attributes">attributes</a>.<span title="(x$1: Int)java.lang.String">getURI</span><span class="delimiter">(</span><a href="#99033" title="Int">i</a><span class="delimiter">)</span>, <a href="#99005" title="org.xml.sax.Attributes">attributes</a>.<span title="(x$1: Int)java.lang.String">getLocalName</span><span class="delimiter">(</span><a href="#99033" title="Int">i</a><span class="delimiter">)</span>, <a href="#99005" title="org.xml.sax.Attributes">attributes</a>.<span title="(x$1: Int)java.lang.String">getQName</span><span class="delimiter">(</span><a href="#99033" title="Int">i</a><span class="delimiter">)</span>, <a href="#94316" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>, <a href="#94180" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l126"></a><span id="l126">        <a href="#99035" title="scales.utils.ListSet[scales.xml.Attribute]">attribs</a> = <a href="#99035" title="scales.utils.ListSet[scales.xml.Attribute]">attribs</a> <a href="../utils/ListSet.scala.html#70319" title="(e: scales.xml.Attribute)scales.utils.ListSet[scales.xml.Attribute]">unsafePlus</a> </span>
<a href="l127"></a><span id="l127">	    <a href="#94316" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87781" title="(qname: scales.xml.package.AttributeQName, value: String, token: Token)scales.xml.Attribute">attribute</a><span class="delimiter">(</span><a href="#99042" title="scales.xml.package.AttributeQName">qname</a>, </span>
<a href="l128"></a><span id="l128">			<a href="#99005" title="org.xml.sax.Attributes">attributes</a>.<span title="(x$1: Int)java.lang.String">getValue</span><span class="delimiter">(</span><a href="#99033" title="Int">i</a><span class="delimiter">)</span>, </span>
<a href="l129"></a><span id="l129">			<a href="#94180" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l130"></a><span id="l130"></span>
<a href="l131"></a><span id="l131">        <a href="#99033" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l132"></a><span id="l132">      <span class="delimiter">}</span></span>
<a href="l133"></a><span id="l133">      </span>
<a href="l134"></a><span id="l134">      <span class="comment">// use the current nsMap</span></span>
<a href="l135"></a><span id="l135">      <span class="keyword">val</span> <a title="scales.xml.Elem" id="99036">elem</a> = <a href="#94316" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#87785" title="(name: scales.xml.QName, attributes: scales.xml.package.Attributes, namespaces: Map[String,String], token: Token)scales.xml.Elem">elem</a><span class="delimiter">(</span></span>
<a href="l136"></a><span id="l136">	  <a href="#12445" title="(uri: String, localName: String, qName: String, strategy: scales.xml.MemoryOptimisationStrategy[Token], token: Token)scales.xml.QName">eqn</a><span class="delimiter">(</span><a href="#99002" title="String">uri</a>, <a href="#99003" title="String">localName</a>, <a href="#99004" title="String">qName</a>, <a href="#94316" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>, <a href="#94180" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l137"></a><span id="l137">	     , <a href="#99035" title="scales.utils.ListSet[scales.xml.Attribute]">attribs</a>, <a href="#94188" title="=&gt; scala.collection.immutable.Map[String,String]">nsDeclarations</a>, <a href="#94180" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l138"></a><span id="l138"></span>
<a href="l139"></a><span id="l139">      <span class="comment">// reset the map</span></span>
<a href="l140"></a><span id="l140">      <a href="#94188" title="(x$1: scala.collection.immutable.Map[String,String])Unit">nsDeclarations</a> = <a href="XmlTypes.scala.html#12421" title="=&gt; scala.collection.immutable.Map[String,String]">emptyNamespaces</a></span>
<a href="l141"></a><span id="l141"></span>
<a href="l142"></a><span id="l142">      <span class="comment">// give it a fake mutable default to work with</span></span>
<a href="l143"></a><span id="l143">      <a href="#94316" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#88836" title="(stack: scales.xml.TreeProxies, elem: scales.xml.Elem, token: Token)Unit">beginSubTree</a><span class="delimiter">(</span><a href="#94182" title="=&gt; scales.xml.TreeProxies">buf</a>, <a href="#99036" title="scales.xml.Elem">elem</a>, <a href="#94180" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l144"></a><span id="l144">    <span class="delimiter">}</span></span>
<a href="l145"></a><span id="l145"></span>
<a href="l146"></a><span id="l146">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(uri: String, localName: String, qName: String)Unit" id="94203">endElement</a><span class="delimiter">(</span><a title="String" id="99084">uri</a>: <span title="String">String</span>,</span>
<a href="l147"></a><span id="l147">      <a title="String" id="99085">localName</a>: <span title="String">String</span>,</span>
<a href="l148"></a><span id="l148">      <a title="String" id="99086">qName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l149"></a><span id="l149"></span>
<a href="l150"></a><span id="l150">      <span class="comment">// pop it and we are now with the correct parent</span></span>
<a href="l151"></a><span id="l151">      <span class="comment">// let the strategy decide what actually happens</span></span>
<a href="l152"></a><span id="l152">      <a href="#94316" title="=&gt; scales.xml.PathOptimisationStrategy[Token]">strategy</a>.<a href="OptimisingStrategies.scala.html#88835" title="(xml: scales.xml.TreeProxies, token: Token)Unit">elementEnd</a><span class="delimiter">(</span><a href="#94182" title="=&gt; scales.xml.TreeProxies">buf</a>, <a href="#94180" title="=&gt; Token">token</a><span class="delimiter">)</span></span>
<a href="l153"></a><span id="l153">    <span class="delimiter">}</span></span>
<a href="l154"></a><span id="l154"></span>
<a href="l155"></a><span id="l155">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ch: Array[Char], offset: Int, length: Int)Unit" id="94204">comment</a><span class="delimiter">(</span><a title="Array[Char]" id="99090">ch</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span>, <a title="Int" id="99091">offset</a>: <span title="Int">Int</span>, <a title="Int" id="99092">length</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span></span>
<a href="l156"></a><span id="l156">      <span class="keyword">val</span> <a title="java.lang.String" id="99094">text</a> = <span title="(x$1: Array[Char], x$2: Int, x$3: Int)java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#99090" title="Array[Char]">ch</a>, <a href="#99091" title="Int">offset</a>, <a href="#99092" title="Int">length</a><span class="delimiter">)</span></span>
<a href="l157"></a><span id="l157"></span>
<a href="l158"></a><span id="l158">      <a href="#94205" title="(miscItem: scales.xml.package.Misc)Unit">addMisc</a><span class="delimiter">(</span> <span title="(a: java.lang.Object with scales.xml.Comment)Left[java.lang.Object with scales.xml.Comment,Nothing]">Left</span><span class="delimiter">(</span><a href="XmlTypes.scala.html#99105" title="(valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.Comment">Comment</a><a href="#94178" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="#99094" title="java.lang.String">text</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">)</span>      </span>
<a href="l159"></a><span id="l159">    <span class="delimiter">}</span></span>
<a href="l160"></a><span id="l160"></span>
<a href="l161"></a><span id="l161">    <span class="keyword">def</span> <a title="(miscItem: scales.xml.package.Misc)Unit" id="94205">addMisc</a><span class="delimiter">(</span> <a title="scales.xml.package.Misc" id="98770">miscItem</a> : <span title="scales.xml.package.Misc">Misc</span> <span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l162"></a><span id="l162">      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94197" title="=&gt; Boolean">inprolog</a><span class="delimiter">)</span> </span>
<a href="l163"></a><span id="l163">	<a href="#94191" title="(x$1: scales.xml.Prolog)Unit">prolog</a> = <a href="#94191" title="scales.xml.Prolog" id="99193">prolog</a>.<a href="XmlTypes.scala.html#98498" title="scales.xml.Declaration" id="99266">copy</a><span class="delimiter">(</span>misc = <a href="#94191" title="=&gt; scales.xml.Prolog">prolog</a>.<a href="XmlTypes.scala.html#94370" title="=&gt; scales.xml.package.Miscs">misc</a> <a title="scales.xml.package.Miscs" id="99264">:+</a> <a href="#98770" title="scales.xml.package.Misc">miscItem</a><span class="delimiter">)</span></span>
<a href="l164"></a><span id="l164">      <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l165"></a><span id="l165">	<span class="comment">// need to tell if its finished the root elem or not</span></span>
<a href="l166"></a><span id="l166">	<span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94182" title="=&gt; scales.xml.TreeProxies">buf</a>.<a href="#94328" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span></span>
<a href="l167"></a><span id="l167">	  <a href="#94194" title="(x$1: scales.xml.EndMisc)Unit">end</a> = <a href="#94194" title="=&gt; scales.xml.EndMisc">end</a>.<a href="XmlTypes.scala.html#94403" title="(misc: scales.xml.package.Miscs)scales.xml.EndMisc">copy</a><span class="delimiter">(</span> misc = <a href="#94194" title="=&gt; scales.xml.EndMisc">end</a>.<a href="XmlTypes.scala.html#94400" title="=&gt; scales.xml.package.Miscs">misc</a> <span title="(elem: scales.xml.package.Misc)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[scales.xml.package.Misc],scales.xml.package.Misc,scales.xml.package.Miscs])scales.xml.package.Miscs">:+</span> <a href="#98770" title="scales.xml.package.Misc">miscItem</a><span class="delimiter">)</span></span>
<a href="l168"></a><span id="l168">	<span class="keyword">else</span></span>
<a href="l169"></a><span id="l169">	  <span class="comment">// add it like a normal child</span></span>
<a href="l170"></a><span id="l170">	  <a href="#94182" title="=&gt; scales.xml.TreeProxies">buf</a>.<a href="#88860" title="(i: scales.xml.XmlItem)Unit">addChild</a><span class="delimiter">(</span> <a href="#98770" title="scales.xml.package.Misc">miscItem</a>.<span title="[X](fa: scales.xml.Comment =&gt; X, fb: scales.xml.PI =&gt; X)X">fold</span><span title="(fa: scales.xml.Comment =&gt; scales.xml.XmlItem, fb: scales.xml.PI =&gt; scales.xml.XmlItem)scales.xml.XmlItem" class="delimiter">[</span><a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.Comment" id="99331">x</a>=&gt;<a href="#99331" title="scales.xml.Comment">x</a>, <a title="scales.xml.PI" id="99333">y</a>=&gt;<a href="#99333" title="scales.xml.PI">y</a><span class="delimiter">)</span><span class="delimiter">)</span> </span>
<a href="l171"></a><span id="l171">      <span class="delimiter">}</span></span>
<a href="l172"></a><span id="l172">    <span class="delimiter">}</span></span>
<a href="l173"></a><span id="l173"></span>
<a href="l174"></a><span id="l174">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ch: Array[Char], offset: Int, length: Int)Unit" id="94206">characters</a><span class="delimiter">(</span><a title="Array[Char]" id="99334">ch</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span>, <a title="Int" id="99335">offset</a>: <span title="Int">Int</span>, <a title="Int" id="99336">length</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span></span>
<a href="l175"></a><span id="l175">      <span class="keyword">val</span> <a title="java.lang.String" id="99338">text</a> = <span title="(x$1: Array[Char], x$2: Int, x$3: Int)java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#99334" title="Array[Char]">ch</a>, <a href="#99335" title="Int">offset</a>, <a href="#99336" title="Int">length</a><span class="delimiter">)</span></span>
<a href="l176"></a><span id="l176"></span>
<a href="l177"></a><span id="l177">      <span class="keyword">val</span> <a title="scales.xml.XmlItem" id="99339">child</a>: <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a> = <span title="scales.xml.XmlItem" class="keyword">if</span> <span class="delimiter">(</span><a href="#94185" title="=&gt; Boolean">isCData</a><span class="delimiter">)</span> <a href="XmlTypes.scala.html#99347" title="(valuei: String)(implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.CData">CData</a><a href="#94178" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="#99338" title="java.lang.String">text</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="XmlTypes.scala.html#97465" title="(value: String)scales.xml.Text">Text</a><span class="delimiter">(</span><a href="#99338" title="java.lang.String">text</a><span class="delimiter">)</span></span>
<a href="l178"></a><span id="l178"></span>
<a href="l179"></a><span id="l179">      <span class="comment">// append as child</span></span>
<a href="l180"></a><span id="l180">      <a href="#94182" title="=&gt; scales.xml.TreeProxies">buf</a>.<a href="#88860" title="(i: scales.xml.XmlItem)Unit">addChild</a><span class="delimiter">(</span><a href="#99339" title="scales.xml.XmlItem">child</a><span class="delimiter">)</span></span>
<a href="l181"></a><span id="l181">    <span class="delimiter">}</span></span>
<a href="l182"></a><span id="l182"></span>
<a href="l183"></a><span id="l183">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="94207">startCDATA</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#94185" title="(x$1: Boolean)Unit">isCData</a> = <span title="Boolean(true)" class="keyword">true</span>; <span class="delimiter">}</span></span>
<a href="l184"></a><span id="l184">    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="94208">endCDATA</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#94185" title="(x$1: Boolean)Unit">isCData</a> = <span title="Boolean(false)" class="keyword">false</span>; <span class="delimiter">}</span></span>
<a href="l185"></a><span id="l185"></span>
<a href="l186"></a><span id="l186">  <span class="delimiter">}</span></span>
<a href="l187"></a><span id="l187"></span>
<a href="l188"></a><span id="l188"><span class="delimiter">}</span></span>
<a href="l189"></a><span id="l189"></span>
<a href="l190"></a><span id="l190"><span class="keyword">class</span> <a title="class TreeProxy extends java.lang.Object with ScalaObject" id="11875">TreeProxy</a><a href="#11875" title="ScalaObject" class="delimiter">(</a> <span class="keyword">var</span> <a title="scales.xml.Elem" id="99446">elem</a> : <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a>, <span class="keyword">var</span> <a title="scales.xml.package.XmlChildren" id="99447">children</a> : <a href="../utils/ImmutableArray.scala.html#10380" title="scales.xml.package.XmlChildren">XmlChildren</a><span class="delimiter">)</span></span>
<a href="l191"></a><span id="l191"></span>
<a href="l192"></a><span id="l192"><span class="keyword">import</span> scala.collection.mutable.ArrayBuffer</span>
<a href="l193"></a><span id="l193"></span>
<a href="l194"></a><span id="l194"><span class="comment">/**</span>
<a href="l195"></a><span id="l195"> * Mutable list that keeps the item creation to a minimum, no extra garbage here until the parse is done...</span>
<a href="l196"></a><span id="l196"> */</span> </span>
<a href="l197"></a><span id="l197"><span class="keyword">class</span> <a title="class TreeProxies extends java.lang.Object with ScalaObject" id="11878">TreeProxies</a><a href="#11878" title="ScalaObject" class="delimiter">(</a> <span class="keyword">var</span> <a title="Int" id="94328">depth</a> : <span title="Int">Int</span> = -<span title="Int(-1)" class="int">1</span>, <span class="keyword">var</span> <a title="scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]" id="94329">proxies</a> : <span title="scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]">ArrayBuffer</span><span class="delimiter">[</span>TreeProxy<span class="delimiter">]</span> = <span title="[A](elems: A*)scala.collection.mutable.ArrayBuffer[A]">ArrayBuffer</span><span title="(elems: scales.xml.TreeProxy*)scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]" class="delimiter">[</span><a href="#11875" title="scales.xml.TreeProxy">TreeProxy</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">{</span></span>
<a href="l198"></a><span id="l198">  <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.xmlCBF</span>
<a href="l199"></a><span id="l199"></span>
<a href="l200"></a><span id="l200">  <span class="keyword">var</span> <a title="Int" id="88855">size</a> = <a href="#94329" title="=&gt; scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]">proxies</a>.<span title="=&gt; Int">length</span></span>
<a href="l201"></a><span id="l201"></span>
<a href="l202"></a><span id="l202">  <span class="keyword">var</span> <a title="scales.xml.TreeProxy" id="88858">current</a> : <a href="#11875" title="scales.xml.TreeProxy">TreeProxy</a> = _</span>
<a href="l203"></a><span id="l203"></span>
<a href="l204"></a><span id="l204">  <span class="keyword">def</span> <a title="(i: scales.xml.XmlItem)Unit" id="88860">addChild</a><span class="delimiter">(</span> <a title="scales.xml.XmlItem" id="99324">i</a> : <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a> <span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l205"></a><span id="l205">    <span class="comment">//println(&quot;proxies addChild &quot;+depth)</span></span>
<a href="l206"></a><span id="l206">    <a href="#88858" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#99447" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <span class="delimiter">(</span><a href="#88858" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#99447" title="=&gt; scales.xml.package.XmlChildren">children</a> <a href="XmlTypes.scala.html#87812" title="(elem: scales.xml.package.ItemOrElem)(implicit bf: scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[scales.xml.package.ItemOrElem],scales.xml.package.ItemOrElem,scales.xml.package.XmlChildren])scales.xml.package.XmlChildren">:+</a> <a href="#99324" title="scales.xml.XmlItem">i</a><span class="delimiter">)</span></span>
<a href="l207"></a><span id="l207">  <span class="delimiter">}</span></span>
<a href="l208"></a><span id="l208"></span>
<a href="l209"></a><span id="l209">  <span class="keyword">def</span> <a title="()Unit" id="88861">elementEnd</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l210"></a><span id="l210">    <span class="keyword">val</span> <a title="scales.xml.TreeProxy" id="99488">l</a> = <a href="#88858" title="=&gt; scales.xml.TreeProxy">current</a></span>
<a href="l211"></a><span id="l211">    <span class="comment">//println(&quot;proxies elementend &quot;+depth)</span></span>
<a href="l212"></a><span id="l212">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94328" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l213"></a><span id="l213">      <a href="#94328" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l214"></a><span id="l214">      <a href="#88858" title="(x$1: scales.xml.TreeProxy)Unit">current</a> = <a href="#94329" title="(idx: Int)scales.xml.TreeProxy">proxies</a><span class="delimiter">(</span> <a href="#94328" title="=&gt; Int">depth</a> <span class="delimiter">)</span></span>
<a href="l215"></a><span id="l215">      <a href="#88858" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#99447" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <span class="delimiter">(</span><a href="#88858" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#99447" title="=&gt; scales.xml.package.XmlChildren">children</a> <a href="XmlTypes.scala.html#87812" title="(elem: scales.xml.package.ItemOrElem)(implicit bf: scala.collection.generic.CanBuildFrom[scales.utils.ImmutableArrayProxy[scales.xml.package.ItemOrElem],scales.xml.package.ItemOrElem,scales.xml.package.XmlChildren])scales.xml.package.XmlChildren">:+</a> <a href="../utils/Trees.scala.html#80175" title="(section: scales.xml.Elem, children: scales.xml.package.XCC[scales.utils.package.ItemOrTree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]])scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">Tree</a><span class="delimiter">(</span><a href="#99488" title="scales.xml.TreeProxy">l</a>.<a href="#99446" title="=&gt; scales.xml.Elem">elem</a>, <a href="#99488" title="scales.xml.TreeProxy">l</a>.<a href="#99447" title="=&gt; scales.xml.package.XmlChildren">children</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l216"></a><span id="l216">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l217"></a><span id="l217">      <a href="#94328" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l218"></a><span id="l218">    <span class="delimiter">}</span></span>
<a href="l219"></a><span id="l219">  <span class="delimiter">}</span></span>
<a href="l220"></a><span id="l220"></span>
<a href="l221"></a><span id="l221">  <span class="keyword">def</span> <a title="(elem: scales.xml.Elem, children: scales.xml.package.XmlChildren)Unit" id="88862">beginSub</a><span class="delimiter">(</span> <a title="scales.xml.Elem" id="88869">elem</a> : <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a>, <a title="scales.xml.package.XmlChildren" id="88872">children</a> : <a href="../utils/ImmutableArray.scala.html#10380" title="scales.xml.package.XmlChildren">XmlChildren</a> = <a href="XmlTypes.scala.html#12427" title="=&gt; scales.utils.ImmutableArrayProxy[scales.utils.EitherLike[scales.xml.XmlItem,scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,[T]scales.utils.ImmutableArrayProxy[T]]]]">emptyChildren</a> <span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l222"></a><span id="l222">    <span class="comment">//println(&quot;proxies beginSub &quot;+depth)</span></span>
<a href="l223"></a><span id="l223">    <a href="#94328" title="(x$1: Int)Unit">depth</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span></span>
<a href="l224"></a><span id="l224">    </span>
<a href="l225"></a><span id="l225">    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94328" title="=&gt; Int">depth</a> <span title="(x: Int)Boolean">==</span> <a href="#88855" title="=&gt; Int">size</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l226"></a><span id="l226">      <a href="#88858" title="(x$1: scales.xml.TreeProxy)Unit">current</a> = <span title="scales.xml.TreeProxy" class="keyword">new</span> <a href="#11875" title="scales.xml.TreeProxy">TreeProxy</a><span class="delimiter">(</span><a href="#88869" title="scales.xml.Elem">elem</a>, <a href="#88872" title="scales.xml.package.XmlChildren">children</a><span class="delimiter">)</span></span>
<a href="l227"></a><span id="l227">      <a href="#94329" title="=&gt; scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]">proxies</a> <span title="(elem: scales.xml.TreeProxy)scala.collection.mutable.ArrayBuffer[scales.xml.TreeProxy]">+=</span> <span class="delimiter">(</span><a href="#88858" title="=&gt; scales.xml.TreeProxy">current</a><span class="delimiter">)</span></span>
<a href="l228"></a><span id="l228">      <a href="#88855" title="(x$1: Int)Unit">size</a> <span title="(x: Int)Int">+=</span><span title="Int(1)" class="int">1</span></span>
<a href="l229"></a><span id="l229">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l230"></a><span id="l230">      <a href="#88858" title="(x$1: scales.xml.TreeProxy)Unit">current</a> = <a href="#94329" title="(idx: Int)scales.xml.TreeProxy">proxies</a><span class="delimiter">(</span><a href="#94328" title="=&gt; Int">depth</a><span class="delimiter">)</span></span>
<a href="l231"></a><span id="l231">      <a href="#88858" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#99446" title="(x$1: scales.xml.Elem)Unit">elem</a> = <a href="#88869" title="scales.xml.Elem">elem</a> </span>
<a href="l232"></a><span id="l232">      <a href="#88858" title="=&gt; scales.xml.TreeProxy">current</a>.<a href="#99447" title="(x$1: scales.xml.package.XmlChildren)Unit">children</a> = <a href="#88872" title="scales.xml.package.XmlChildren">children</a></span>
<a href="l233"></a><span id="l233">    <span class="delimiter">}</span></span>
<a href="l234"></a><span id="l234">  <span class="delimiter">}</span></span>
<a href="l235"></a><span id="l235"></span>
<a href="l236"></a><span id="l236">  <span class="comment">/**</span>
<a href="l237"></a><span id="l237">   * Only call when its the end of the parse</span>
<a href="l238"></a><span id="l238">   */</span> </span>
<a href="l239"></a><span id="l239">  <span class="keyword">def</span> <a title="=&gt; scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]" id="88863">tree</a> = <span class="delimiter">{</span></span>
<a href="l240"></a><span id="l240">    <span class="keyword">val</span> <a title="scales.xml.TreeProxy" id="98345">tp</a> = <a href="#94329" title="(idx: Int)scales.xml.TreeProxy">proxies</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span></span>
<a href="l241"></a><span id="l241"></span>
<a href="l242"></a><span id="l242">    <a href="../utils/Trees.scala.html#80175" title="(section: scales.xml.Elem, children: scales.xml.package.XCC[scales.utils.package.ItemOrTree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]])scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC]">Tree</a><span class="delimiter">(</span><a href="#98345" title="scales.xml.TreeProxy">tp</a>.<a href="#99446" title="=&gt; scales.xml.Elem">elem</a>, <a href="#98345" title="scales.xml.TreeProxy">tp</a>.<a href="#99447" title="=&gt; scales.xml.package.XmlChildren">children</a><span class="delimiter">)</span></span>
<a href="l243"></a><span id="l243">  <span class="delimiter">}</span></span>
<a href="l244"></a><span id="l244"><span class="delimiter">}</span></span>
<a href="l245"></a><span id="l245"></span>
<a href="l246"></a><span id="l246">        </span>
</pre>
    </body>
</html>