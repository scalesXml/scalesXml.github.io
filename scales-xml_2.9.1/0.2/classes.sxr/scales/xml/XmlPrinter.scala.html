<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scales\xml\XmlPrinter.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    
<style id="linesStyle">
.lineHighlight {
  background-color: #a5a5a5;
}
</style>
<script type="text/javascript">
function selectedLine() {
    var loca = /^.*#l(.*)/.exec(location.href);
    return loca ? loca[1] : '0';
}

function highlightLine(ln){
  $('#l'+ln).toggleClass('lineHighlight');
}

function gotoLine(ln){
  $('#l'+ln).focus();
}

$(function(){
  var line = selectedLine();
  if (line != '0') highlightLine(line)
});
</script></head>
    <body>
        <pre>
<!-- SXR_LINES --><a href="l1"></a><span id="l1"><span class="keyword">package</span> scales.xml</span>
<a href="l2"></a><span id="l2"></span>
<a href="l3"></a><span id="l3"><span class="keyword">import</span> scales.utils._</span>
<a href="l4"></a><span id="l4"></span>
<a href="l5"></a><span id="l5"><span class="keyword">import</span> scala.collection.immutable.<span class="delimiter">{</span> Stack, Map <span class="delimiter">}</span></span>
<a href="l6"></a><span id="l6"></span>
<a href="l7"></a><span id="l7"><span class="keyword">import</span> java.io.Writer</span>
<a href="l8"></a><span id="l8"></span>
<a href="l9"></a><span id="l9"><span class="keyword">import</span> java.nio.charset.Charset</span>
<a href="l10"></a><span id="l10"></span>
<a href="l11"></a><span id="l11"><span class="comment">/**</span>
<a href="l12"></a><span id="l12"> * Interface used for serializing the XML events, same for both stream and tree.</span>
<a href="l13"></a><span id="l13"> *</span>
<a href="l14"></a><span id="l14"> * The default implementation validates the output via LSSerializer against a given encoding.</span>
<a href="l15"></a><span id="l15"> *</span>
<a href="l16"></a><span id="l16"> * An alternative FastSerializer simply outputs strings and is in no way correct but at least faster then going to StreamWriter for incorrectness.</span>
<a href="l17"></a><span id="l17"> *</span>
<a href="l18"></a><span id="l18"> * Serializers should use qName.ncName for serialization purposes of both attributes and elements, the QName is provided to allow for validation of ouput.</span>
<a href="l19"></a><span id="l19"> *</span>
<a href="l20"></a><span id="l20"> * If a function returns Some it should signal the termination of the serializing.  Implementations are expected to respect this approach, its for the benefit of all developers.</span>
<a href="l21"></a><span id="l21"> *</span>
<a href="l22"></a><span id="l22"> * List[QName] is provided to help if path relevant information is needed for serialization.  For example if a use case requires that a particular path is filtered out.  Purely for performance reasons the list is in reverse order with the current QName at the top and root at the bottom.</span>
<a href="l23"></a><span id="l23"> *</span>
<a href="l24"></a><span id="l24"> */</span></span>
<a href="l25"></a><span id="l25"><span class="keyword">trait</span> <a title="trait Serializer extends java.lang.Object" id="11913">Serializer</a> <span title="java.lang.Object" class="delimiter">{</span></span>
<a href="l26"></a><span id="l26"></span>
<a href="l27"></a><span id="l27">  <span class="keyword">def</span> <a title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]" id="89940">item</a><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="105926">item</a>: <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a>, <a title="List[scales.xml.QName]" id="105927">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span></span>
<a href="l28"></a><span id="l28"></span>
<a href="l29"></a><span id="l29">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="89941">emptyElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="105928">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="105929">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="105930">namespaces</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="105931">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="105932">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span></span>
<a href="l30"></a><span id="l30">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="89942">startElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="105933">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="105934">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="105935">namespaces</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="105936">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="105937">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span></span>
<a href="l31"></a><span id="l31">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, path: List[scales.xml.QName])Option[Throwable]" id="89943">endElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="105938">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="List[scales.xml.QName]" id="105939">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span></span>
<a href="l32"></a><span id="l32"></span>
<a href="l33"></a><span id="l33">  <span class="keyword">def</span> <a title="(encoding: java.nio.charset.Charset, version: scales.xml.XmlVersion)Option[Throwable]" id="89944">xmlDeclaration</a><span class="delimiter">(</span><a title="java.nio.charset.Charset" id="105940">encoding</a>: <span title="java.nio.charset.Charset">Charset</span>, <a title="scales.xml.XmlVersion" id="105941">version</a>: <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span></span>
<a href="l34"></a><span id="l34"></span>
<a href="l35"></a><span id="l35"><span class="delimiter">}</span></span>
<a href="l36"></a><span id="l36"></span>
<a href="l37"></a><span id="l37">case <span class="keyword">class</span> <a title="class SerializerData extends java.lang.Object with ScalaObject with Product with Serializable" id="109955">SerializerData</a><a href="#109955" title="ScalaObject" class="delimiter">(</a><a title="java.io.Writer" id="109095">out</a>: <span title="java.io.Writer">Writer</span>, <a title="scales.xml.XmlVersion" id="109096">version</a>: <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a> = <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>.<a href="QName.scala.html#87867" title="=&gt; scales.xml.XmlVersion">defaultVersion</a>, <a title="java.nio.charset.Charset" id="109097">encoding</a>: <span title="java.nio.charset.Charset">Charset</span> = <a href="../utils/Localisation.scala.html#12395" title="=&gt; java.nio.charset.Charset">defaultCharset</a><span class="delimiter">)</span></span>
<a href="l38"></a><span id="l38"></span>
<a href="l39"></a><span id="l39"><span class="comment">/**</span>
<a href="l40"></a><span id="l40"> * Serializer factories are responsible for the life cycle of serializers and</span>
<a href="l41"></a><span id="l41"> * their resources.</span>
<a href="l42"></a><span id="l42"> *</span>
<a href="l43"></a><span id="l43"> */</span></span>
<a href="l44"></a><span id="l44"><span class="keyword">trait</span> <a title="trait SerializerFactory extends java.lang.Object" id="11917">SerializerFactory</a> <span title="java.lang.Object" class="delimiter">{</span></span>
<a href="l45"></a><span id="l45">  <span class="keyword">def</span> <a title="[R](thunk: scales.xml.Serializer =&gt; R)(data: scales.xml.SerializerData)R" id="90067">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="90069">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.Serializer =&gt; R" id="106036">thunk</a>: Serializer =&gt; R<span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.SerializerData" id="106037">data</a>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a><span class="delimiter">)</span>: <a href="#90069" title="R">R</a></span>
<a href="l46"></a><span id="l46"><span class="delimiter">}</span></span>
<a href="l47"></a><span id="l47"></span>
<a href="l48"></a><span id="l48"><span class="keyword">object</span> <a title="object scales.xml.SerializerHelpers" id="11918">SerializerHelpers</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l49"></a><span id="l49">  <span class="comment">/**</span>
<a href="l50"></a><span id="l50">   * Outputs the xml document declaration</span>
<a href="l51"></a><span id="l51">   */</span></span>
<a href="l52"></a><span id="l52">  <span class="keyword">def</span> <a title="(out: java.io.Writer, encoding: java.nio.charset.Charset, version: scales.xml.XmlVersion)Option[Throwable]" id="106040">xmlDecl</a><span class="delimiter">(</span><a title="java.io.Writer" id="106043">out</a>: <span title="java.io.Writer">Writer</span>, <a title="java.nio.charset.Charset" id="106044">encoding</a>: java.nio.charset.<span title="java.nio.charset.Charset">Charset</span>, <a title="scales.xml.XmlVersion" id="106045">version</a>: <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l53"></a><span id="l53">    <a href="#106043" title="java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;?xml version=\&quot;&quot;)" class="string">&quot;&lt;?xml version=\&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106045" title="scales.xml.XmlVersion">version</a>.<a href="QName.scala.html#87766" title="=&gt; String">version</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\&quot; encoding=\&quot;&quot;)" class="string">&quot;\&quot; encoding=\&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106044" title="java.nio.charset.Charset">encoding</a>.<span title="()java.lang.String">displayName</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\&quot;?&gt;&quot;)" class="string">&quot;\&quot;?&gt;&quot;</span><span class="delimiter">)</span></span>
<a href="l54"></a><span id="l54">    <span title="object None">None</span></span>
<a href="l55"></a><span id="l55">  <span class="delimiter">}</span></span>
<a href="l56"></a><span id="l56"></span>
<a href="l57"></a><span id="l57">  <span class="comment">/**</span>
<a href="l58"></a><span id="l58">   * Default serializer for items, usefull for when the contents aren't correct but you want to see them anyway</span>
<a href="l59"></a><span id="l59">   */</span></span>
<a href="l60"></a><span id="l60">  <span class="keyword">def</span> <a title="(out: java.io.Writer, item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]" id="106041">item</a><span class="delimiter">(</span><a title="java.io.Writer" id="106053">out</a>: <span title="java.io.Writer">Writer</span>, <a title="scales.xml.XmlItem" id="106054">item</a>: <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a>, <a title="List[scales.xml.QName]" id="106055">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l61"></a><span id="l61">    <span class="keyword">val</span> <a title="String" id="106057">res</a> = <a href="#106054" title="scales.xml.XmlItem">item</a> <span title="String" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l62"></a><span id="l62">      <span class="keyword">case</span> <span title="String">Text</span><span class="delimiter">(</span><a title="String" id="106058">value</a><span class="delimiter">)</span> =&gt; <a href="#106058" title="String">value</a></span>
<a href="l63"></a><span id="l63">      <span class="keyword">case</span> <a href="XmlTypes.scala.html#99348" title="java.lang.String">CData</a><span class="delimiter">(</span><a title="String" id="106066">value</a><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;&lt;![CDATA[&quot;)" class="string">&quot;&lt;![CDATA[&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106066" title="String">value</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;]]&gt;&quot;)" class="string">&quot;]]&gt;&quot;</span></span>
<a href="l64"></a><span id="l64">      <span class="keyword">case</span> <a href="XmlTypes.scala.html#99106" title="java.lang.String">Comment</a><span class="delimiter">(</span><a title="String" id="106074">value</a><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;&lt;!--&quot;)" class="string">&quot;&lt;!--&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106074" title="String">value</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;--&gt;&quot;)" class="string">&quot;--&gt;&quot;</span></span>
<a href="l65"></a><span id="l65">      <span class="keyword">case</span> <a href="XmlTypes.scala.html#98545" title="java.lang.String">PI</a><span class="delimiter">(</span><a title="String" id="106088">target</a>, <a title="String" id="106089">value</a><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;&lt;?&quot;)" class="string">&quot;&lt;?&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106088" title="String">target</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106089" title="String">value</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;?&gt;&quot;)" class="string">&quot;?&gt;&quot;</span></span>
<a href="l66"></a><span id="l66">    <span class="delimiter">}</span></span>
<a href="l67"></a><span id="l67">    <a href="#106053" title="java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><a href="#106057" title="String">res</a><span class="delimiter">)</span></span>
<a href="l68"></a><span id="l68">    <span title="object None">None</span></span>
<a href="l69"></a><span id="l69">  <span class="delimiter">}</span></span>
<a href="l70"></a><span id="l70"></span>
<a href="l71"></a><span id="l71"><span class="delimiter">}</span></span>
<a href="l72"></a><span id="l72"></span>
<a href="l73"></a><span id="l73"><span class="keyword">object</span> <a title="object scales.xml.SimpleSerializerFactory" id="11920">SimpleSerializerFactory</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11917" title="scales.xml.SerializerFactory">SerializerFactory</a> <span class="delimiter">{</span></span>
<a href="l74"></a><span id="l74">  <span class="keyword">def</span> <a title="[R](thunk: scales.xml.Serializer =&gt; R)(sdata: scales.xml.SerializerData)R" id="106095">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="106097">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.Serializer =&gt; R" id="106099">thunk</a>: Serializer =&gt; R<span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.SerializerData" id="106100">sdata</a>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a><span class="delimiter">)</span>: <a href="#106097" title="R">R</a> =</span>
<a href="l75"></a><span id="l75">    <a href="#106099" title="(v1: scales.xml.Serializer)R">thunk</a><span class="delimiter">(</span><a href="#106106" title="java.lang.Object with scales.xml.SimpleSerializer{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.SimpleSerializer" id="106106">SimpleSerializer</a> <span class="delimiter">{</span> <span class="keyword">val</span> <a title="scales.xml.SerializerData" id="106119">data</a> = <a href="#106100" title="scales.xml.SerializerData">sdata</a> <span class="delimiter">}</span><span class="delimiter">)</span></span>
<a href="l76"></a><span id="l76"></span>
<a href="l77"></a><span id="l77"><span class="delimiter">}</span></span>
<a href="l78"></a><span id="l78"></span>
<a href="l79"></a><span id="l79"><span class="comment">/**</span>
<a href="l80"></a><span id="l80"> * Performs no validation, sorting of attributes, extra spaces on the end of empty element declarations and uses the short form for empty elements.</span>
<a href="l81"></a><span id="l81"> *</span>
<a href="l82"></a><span id="l82"> * Basically its good for non-pretty printing debugging only</span>
<a href="l83"></a><span id="l83"> *</span>
<a href="l84"></a><span id="l84"> */</span></span>
<a href="l85"></a><span id="l85"><span class="keyword">trait</span> <a title="trait SimpleSerializer extends java.lang.Object with scales.xml.Serializer with ScalaObject" id="11922">SimpleSerializer</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11913" title="scales.xml.Serializer">Serializer</a> <span class="delimiter">{</span></span>
<a href="l86"></a><span id="l86"></span>
<a href="l87"></a><span id="l87">  <span class="keyword">val</span> <a title="=&gt; scales.xml.SerializerData" id="106110">data</a>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a></span>
<a href="l88"></a><span id="l88">  <span class="keyword">import</span> <a href="#106110" title="=&gt; scales.xml.SerializerData">data</a>._</span>
<a href="l89"></a><span id="l89"></span>
<a href="l90"></a><span id="l90">  <span class="keyword">def</span> <a title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]" id="106112">item</a><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="106125">item</a>: <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a>, <a title="List[scales.xml.QName]" id="106126">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> =</span>
<a href="l91"></a><span id="l91">    <a href="#11918" title="object scales.xml.SerializerHelpers">SerializerHelpers</a>.<a href="#106041" title="(out: java.io.Writer, item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">item</a><span class="delimiter">(</span><a href="#109095" title="=&gt; java.io.Writer">out</a>, <a href="#106125" title="scales.xml.XmlItem">item</a>, <a href="#106126" title="List[scales.xml.QName]">path</a><span class="delimiter">)</span></span>
<a href="l92"></a><span id="l92"></span>
<a href="l93"></a><span id="l93">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String])Unit" id="106113">doElem</a><span class="delimiter">(</span><a title="scales.xml.QName" id="106128">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="106129">attribs</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="106130">ns</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="106131">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l94"></a><span id="l94"></span>
<a href="l95"></a><span id="l95">    <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;&quot;)" class="string">&quot;&lt;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106128" title="scales.xml.QName">qName</a>.<a href="QName.scala.html#87937" title="=&gt; java.lang.String">qName</a><span class="delimiter">)</span></span>
<a href="l96"></a><span id="l96"></span>
<a href="l97"></a><span id="l97">    <a href="#106131" title="Option[String]">declareDefaultNS</a>.<span title="(f: String =&gt; java.io.Writer)Unit">foreach</span> <span class="delimiter">{</span> <a title="String" id="106142">dns</a> =&gt;</span>
<a href="l98"></a><span id="l98">      <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot; xmlns=\&quot;&quot;)" class="string">&quot; xmlns=\&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106142" title="String">dns</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span></span>
<a href="l99"></a><span id="l99">    <span class="delimiter">}</span></span>
<a href="l100"></a><span id="l100"></span>
<a href="l101"></a><span id="l101">    <a href="#106130" title="scala.collection.immutable.Map[String,String]">ns</a>.<span title="(f: (String, String) =&gt; java.io.Writer)Unit">foreach</span> <span class="delimiter">{</span> <a title="(String, String)" id="106173">x</a> =&gt;</span>
<a href="l102"></a><span id="l102">      <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot; xmlns:&quot;)" class="string">&quot; xmlns:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106173" title="(String, String)">x</a>.<span title="=&gt; String">_1</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=\&quot;&quot;)" class="string">&quot;=\&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106173" title="(String, String)">x</a>.<span title="=&gt; String">_2</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span></span>
<a href="l103"></a><span id="l103">    <span class="delimiter">}</span></span>
<a href="l104"></a><span id="l104"></span>
<a href="l105"></a><span id="l105">    <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>._</span>
<a href="l106"></a><span id="l106"></span>
<a href="l107"></a><span id="l107">    <a href="#106129" title="Traversable[scales.xml.Attribute]">attribs</a>.<span title="(f: scales.xml.Attribute =&gt; java.io.Writer)Unit">foreach</span> <span class="delimiter">{</span> <a title="scales.xml.Attribute" id="106194">x</a> =&gt;</span>
<a href="l108"></a><span id="l108">      <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106194" title="scales.xml.Attribute">x</a>.<a href="XmlTypes.scala.html#87809" title="implicit scales.xml.XmlTypesImplicits.toQName : (attribQName: scales.xml.package.AttributeQName)scales.xml.QName">name</a>.<a href="QName.scala.html#87937" title="=&gt; java.lang.String">qName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=\&quot;&quot;)" class="string">&quot;=\&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106194" title="scales.xml.Attribute">x</a>.<a href="XmlTypes.scala.html#87902" title="=&gt; String">value</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span></span>
<a href="l109"></a><span id="l109">    <span class="delimiter">}</span></span>
<a href="l110"></a><span id="l110">  <span class="delimiter">}</span></span>
<a href="l111"></a><span id="l111"></span>
<a href="l112"></a><span id="l112">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="106114">emptyElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="106214">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="106215">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="106216">namespaces</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="106217">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="106218">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l113"></a><span id="l113">    <a href="#106113" title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String])Unit">doElem</a><span class="delimiter">(</span><a href="#106214" title="scales.xml.QName">qName</a>, <a href="#106215" title="Traversable[scales.xml.Attribute]">attributes</a>, <a href="#106216" title="scala.collection.immutable.Map[String,String]">namespaces</a>, <a href="#106217" title="Option[String]">declareDefaultNS</a><span class="delimiter">)</span></span>
<a href="l114"></a><span id="l114">    <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&gt;&quot;)" class="string">&quot;/&gt;&quot;</span><span class="delimiter">)</span></span>
<a href="l115"></a><span id="l115">    <span title="object None">None</span></span>
<a href="l116"></a><span id="l116">  <span class="delimiter">}</span></span>
<a href="l117"></a><span id="l117"></span>
<a href="l118"></a><span id="l118">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="106115">startElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="106224">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="106225">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="106226">namespaces</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="106227">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="106228">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l119"></a><span id="l119">    <a href="#106113" title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String])Unit">doElem</a><span class="delimiter">(</span><a href="#106224" title="scales.xml.QName">qName</a>, <a href="#106225" title="Traversable[scales.xml.Attribute]">attributes</a>, <a href="#106226" title="scala.collection.immutable.Map[String,String]">namespaces</a>, <a href="#106227" title="Option[String]">declareDefaultNS</a><span class="delimiter">)</span></span>
<a href="l120"></a><span id="l120">    <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span><span class="delimiter">)</span></span>
<a href="l121"></a><span id="l121">    <span title="object None">None</span></span>
<a href="l122"></a><span id="l122">  <span class="delimiter">}</span></span>
<a href="l123"></a><span id="l123"></span>
<a href="l124"></a><span id="l124">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, path: List[scales.xml.QName])Option[Throwable]" id="106116">endElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="106234">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="List[scales.xml.QName]" id="106235">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l125"></a><span id="l125">    <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;/&quot;)" class="string">&quot;&lt;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106234" title="scales.xml.QName">qName</a>.<a href="QName.scala.html#87937" title="=&gt; java.lang.String">qName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span><span class="delimiter">)</span></span>
<a href="l126"></a><span id="l126">    <span title="object None">None</span></span>
<a href="l127"></a><span id="l127">  <span class="delimiter">}</span></span>
<a href="l128"></a><span id="l128"></span>
<a href="l129"></a><span id="l129">  <span class="keyword">def</span> <a title="(encoding: java.nio.charset.Charset, version: scales.xml.XmlVersion)Option[Throwable]" id="106117">xmlDeclaration</a><span class="delimiter">(</span><a title="java.nio.charset.Charset" id="106241">encoding</a>: <span title="java.nio.charset.Charset">Charset</span>, <a title="scales.xml.XmlVersion" id="106242">version</a>: <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <a href="#11918" title="object scales.xml.SerializerHelpers">SerializerHelpers</a>.<a href="#106040" title="(out: java.io.Writer, encoding: java.nio.charset.Charset, version: scales.xml.XmlVersion)Option[Throwable]">xmlDecl</a><span class="delimiter">(</span><a href="#109095" title="=&gt; java.io.Writer">out</a>, <a href="#106241" title="java.nio.charset.Charset">encoding</a>, <a href="#106242" title="scales.xml.XmlVersion">version</a><span class="delimiter">)</span></span>
<a href="l130"></a><span id="l130"><span class="delimiter">}</span></span>
<a href="l131"></a><span id="l131"></span>
<a href="l132"></a><span id="l132"><span class="comment">/**</span>
<a href="l133"></a><span id="l133"> * Base exception marker for serialization</span>
<a href="l134"></a><span id="l134"> */</span></span>
<a href="l135"></a><span id="l135"><span class="keyword">class</span> <a title="class SerializationException extends java.lang.RuntimeException with ScalaObject" id="11923">SerializationException</a><a href="#11923" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="String" id="106250">what</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><a href="#106250" title="String">what</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l136"></a><span id="l136">  <span class="comment">//  override def fillInStackTrace() = this</span></span>
<a href="l137"></a><span id="l137"><span class="delimiter">}</span></span>
<a href="l138"></a><span id="l138"></span>
<a href="l139"></a><span id="l139"><span class="keyword">class</span> <a title="class CannotBeEncoded extends scales.xml.SerializationException with ScalaObject" id="11924">CannotBeEncoded</a><a href="#11924" title="ScalaObject" class="delimiter">(</a><span class="keyword">override</span> <span class="keyword">val</span> <a title="String" id="106262">what</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#11923" title="scales.xml.SerializationException">SerializationException</a><span class="delimiter">(</span><a href="#106262" title="String">what</a><span class="delimiter">)</span></span>
<a href="l140"></a><span id="l140"></span>
<a href="l141"></a><span id="l141"><span class="comment">/**</span>
<a href="l142"></a><span id="l142"> * The serialization encoding cannot support the characters in a given markup (attribute name or element name. Ã¤chtung in UTF-8 works but not in US-ASCII.</span>
<a href="l143"></a><span id="l143"> */</span></span>
<a href="l144"></a><span id="l144">case <span class="keyword">class</span> <a title="class InvalidCharacterInMarkup extends scales.xml.SerializationException with ScalaObject with Product with Serializable" id="109947">InvalidCharacterInMarkup</a><a href="#109947" title="ScalaObject" class="delimiter">(</a><span class="keyword">override</span> <span class="keyword">val</span> <a title="String" id="107197">what</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#11923" title="scales.xml.SerializationException">SerializationException</a><span class="delimiter">(</span><a href="#107197" title="String">what</a><span class="delimiter">)</span></span>
<a href="l145"></a><span id="l145"></span>
<a href="l146"></a><span id="l146"><span class="comment">/**</span>
<a href="l147"></a><span id="l147"> * The CData content must be split due to encoding issues, which isn't supported (due to bad CData handling on Sun JRE and differences with Xalan.</span>
<a href="l148"></a><span id="l148"> *</span>
<a href="l149"></a><span id="l149"> * NOTE The Xalan behaviour follows the DOMConfiguration behaviour but will split on encoding issues, which breaks the point of using CData, so if you need that, don't use it, let your sax / pull parser handle proper serilization and escaping for you in a normal text field.</span>
<a href="l150"></a><span id="l150"> */</span></span>
<a href="l151"></a><span id="l151">case <span class="keyword">class</span> <a title="class CDataCannotBeEncoded extends scales.xml.CannotBeEncoded with ScalaObject with Product with Serializable" id="109943">CDataCannotBeEncoded</a><a href="#109943" title="ScalaObject" class="delimiter">(</a><span class="keyword">override</span> <span class="keyword">val</span> <a title="String" id="107537">what</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#11924" title="scales.xml.CannotBeEncoded">CannotBeEncoded</a><span class="delimiter">(</span><a href="#107537" title="String">what</a><span class="delimiter">)</span></span>
<a href="l152"></a><span id="l152"></span>
<a href="l153"></a><span id="l153"><span class="comment">/**</span>
<a href="l154"></a><span id="l154"> * Comments don't support &amp; recognition, which means you can't escape the encoding, either they encode or they do not</span>
<a href="l155"></a><span id="l155"> */</span></span>
<a href="l156"></a><span id="l156">case <span class="keyword">class</span> <a title="class CommentCannotBeEncoded extends scales.xml.CannotBeEncoded with ScalaObject with Product with Serializable" id="109939">CommentCannotBeEncoded</a><a href="#109939" title="ScalaObject" class="delimiter">(</a><span class="keyword">override</span> <span class="keyword">val</span> <a title="String" id="107546">what</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#11924" title="scales.xml.CannotBeEncoded">CannotBeEncoded</a><span class="delimiter">(</span><a href="#107546" title="String">what</a><span class="delimiter">)</span></span>
<a href="l157"></a><span id="l157"></span>
<a href="l158"></a><span id="l158"><span class="comment">/**</span>
<a href="l159"></a><span id="l159"> * PIs also suffer a bad specification</span>
<a href="l160"></a><span id="l160"> */</span></span>
<a href="l161"></a><span id="l161">case <span class="keyword">class</span> <a title="class PICannotBeEncoded extends scales.xml.CannotBeEncoded with ScalaObject with Product with Serializable" id="109935">PICannotBeEncoded</a><a href="#109935" title="ScalaObject" class="delimiter">(</a><span class="keyword">override</span> <span class="keyword">val</span> <a title="String" id="107555">what</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#11924" title="scales.xml.CannotBeEncoded">CannotBeEncoded</a><span class="delimiter">(</span><a href="#107555" title="String">what</a><span class="delimiter">)</span></span>
<a href="l162"></a><span id="l162"></span>
<a href="l163"></a><span id="l163"><span class="comment">/**</span>
<a href="l164"></a><span id="l164"> * For a given content it could not be serialized in the document.</span>
<a href="l165"></a><span id="l165"> */</span></span>
<a href="l166"></a><span id="l166">case <span class="keyword">class</span> <a title="class CannotSerialize extends scales.xml.SerializationException with ScalaObject with Product with Serializable" id="109931">CannotSerialize</a><a href="#109931" title="ScalaObject" class="delimiter">(</a><span class="keyword">override</span> <span class="keyword">val</span> <a title="String" id="107519">what</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#11923" title="scales.xml.SerializationException">SerializationException</a><span class="delimiter">(</span><a href="#107519" title="String">what</a><span class="delimiter">)</span></span>
<a href="l167"></a><span id="l167"></span>
<a href="l168"></a><span id="l168"><span class="comment">/**</span>
<a href="l169"></a><span id="l169"> * Result of trying to serialize a 1.1 ncname into a 1.0 document</span>
<a href="l170"></a><span id="l170"> */</span></span>
<a href="l171"></a><span id="l171">case <span class="keyword">class</span> <a title="class IncompatibleQNameVersions extends scales.xml.SerializationException with ScalaObject with Product with Serializable" id="109927">IncompatibleQNameVersions</a><a href="#109927" title="ScalaObject" class="delimiter">(</a><span class="keyword">override</span> <span class="keyword">val</span> <a title="String" id="107672">what</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#11923" title="scales.xml.SerializationException">SerializationException</a><span class="delimiter">(</span><a href="#107672" title="String">what</a><span class="delimiter">)</span></span>
<a href="l172"></a><span id="l172"></span>
<a href="l173"></a><span id="l173"><span class="comment">/**</span>
<a href="l174"></a><span id="l174"> * Base implementation for a correct serializer using LSSerializer to provide escape character references.</span>
<a href="l175"></a><span id="l175"> *</span>
<a href="l176"></a><span id="l176"> * Developers can override this directly implementing encF, or choose to override createSerializer to further change serialization behaviour</span>
<a href="l177"></a><span id="l177"> */</span> </span>
<a href="l178"></a><span id="l178"><span class="keyword">trait</span> <a title="trait LSSerializerFactoryBase extends java.lang.Object with scales.xml.SerializerFactory with ScalaObject" id="11943">LSSerializerFactoryBase</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11917" title="scales.xml.SerializerFactory">SerializerFactory</a> <span class="delimiter">{</span></span>
<a href="l179"></a><span id="l179">  <span class="keyword">import</span> javax.xml.parsers._</span>
<a href="l180"></a><span id="l180">  <span class="keyword">import</span> org.w3c.dom._</span>
<a href="l181"></a><span id="l181">  <span class="keyword">import</span> ls._</span>
<a href="l182"></a><span id="l182"></span>
<a href="l183"></a><span id="l183">  <span class="comment">/**</span>
<a href="l184"></a><span id="l184">   * Override to create the serialazer</span>
<a href="l185"></a><span id="l185">   */</span> </span>
<a href="l186"></a><span id="l186">  <span class="keyword">def</span> <a title="(sdata: scales.xml.SerializerData, ndoc: org.w3c.dom.Document)scales.xml.LSSerializer" id="90074">createSerializer</a><span class="delimiter">(</span> <a title="scales.xml.SerializerData" id="106571">sdata</a>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a>, <a title="org.w3c.dom.Document" id="106572">ndoc</a> : org.w3c.dom.<span title="org.w3c.dom.Document">Document</span><span class="delimiter">)</span> : scales.xml.<a href="#11954" title="scales.xml.LSSerializer">LSSerializer</a> = <a href="#106659" title="java.lang.Object with scales.xml.LSSerializer{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.LSSerializer" id="106659">scales</a>.xml.<a href="#11954" title="scales.xml.LSSerializer">LSSerializer</a> <span class="delimiter">{</span></span>
<a href="l187"></a><span id="l187">          <span class="keyword">val</span> <a title="scales.xml.SerializerData" id="106684">data</a> = <a href="#106571" title="scales.xml.SerializerData">sdata</a></span>
<a href="l188"></a><span id="l188">          <span class="keyword">val</span> <a title="String =&gt; Option[Throwable]" id="106686">encMap</a> = <a href="#90075" title="(v1: java.nio.charset.Charset)String =&gt; Option[Throwable]">encF</a><span class="delimiter">(</span><a href="#106571" title="scales.xml.SerializerData">sdata</a>.<a href="#109097" title="=&gt; java.nio.charset.Charset">encoding</a><span class="delimiter">)</span></span>
<a href="l189"></a><span id="l189">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.Document" id="106689">doc</a> = <a href="#106572" title="org.w3c.dom.Document">ndoc</a></span>
<a href="l190"></a><span id="l190">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.DOMImplementationLS" id="106691">impl</a> = <a href="#106688" title="=&gt; org.w3c.dom.Document">doc</a>.<span title="()org.w3c.dom.DOMImplementation">getImplementation</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.w3c.dom.ls.DOMImplementationLS" class="delimiter">[</span><span title="org.w3c.dom.ls.DOMImplementationLS">DOMImplementationLS</span><span class="delimiter">]</span></span>
<a href="l191"></a><span id="l191">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSOutput" id="106693">lsout</a> = <a href="#106690" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSOutput">createLSOutput</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l192"></a><span id="l192">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSOutput" id="106695">lsaout</a> = <a href="#106690" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSOutput">createLSOutput</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l193"></a><span id="l193">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSSerializer" id="106697">lss</a> = <a href="#106690" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSSerializer">createLSSerializer</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l194"></a><span id="l194">        <span class="delimiter">}</span></span>
<a href="l195"></a><span id="l195"></span>
<a href="l196"></a><span id="l196">  <span class="comment">/**</span>
<a href="l197"></a><span id="l197">   * Can the content be encoded in a given charset</span>
<a href="l198"></a><span id="l198">   */</span></span>
<a href="l199"></a><span id="l199">  <span class="keyword">val</span> <a title="=&gt; java.nio.charset.Charset =&gt; String =&gt; Option[Throwable]" id="90075">encF</a>: Charset =&gt; String =&gt; Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span></span>
<a href="l200"></a><span id="l200"></span>
<a href="l201"></a><span id="l201">  <span class="keyword">def</span> <a title="[R](thunk: scales.xml.Serializer =&gt; R)(sdata: scales.xml.SerializerData)R" id="90076">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="90078">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.Serializer =&gt; R" id="106829">thunk</a>: Serializer =&gt; R<span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.SerializerData" id="106830">sdata</a>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a><span class="delimiter">)</span>: <a href="#90078" title="R">R</a> = <span class="delimiter">{</span></span>
<a href="l202"></a><span id="l202">    <a href="XmlFactories.scala.html#12544" title="object scales.xml.package.DefaultDOMFactoryPool">DefaultDOMFactoryPool</a>.<a href="XmlFactories.scala.html#97735" title="=&gt; java.lang.Object with scales.utils.Loaner[javax.xml.parsers.DocumentBuilder]">parsers</a>.<a href="../utils/Resources.scala.html#85752" title="(tThunk: javax.xml.parsers.DocumentBuilder =&gt; R)R">loan</a> <span class="delimiter">{</span> <a title="javax.xml.parsers.DocumentBuilder" id="106839">db</a> =&gt;</span>
<a href="l203"></a><span id="l203">      <span class="keyword">val</span> <a title="org.w3c.dom.Document" id="106840">ndoc</a> = <a href="#106839" title="javax.xml.parsers.DocumentBuilder">db</a>.<span title="()org.w3c.dom.Document">newDocument</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l204"></a><span id="l204">      <a href="#106840" title="org.w3c.dom.Document">ndoc</a>.<span title="(x$1: java.lang.String)Unit">setXmlVersion</span><span class="delimiter">(</span><a href="#106830" title="scales.xml.SerializerData">sdata</a>.<a href="#109096" title="=&gt; scales.xml.XmlVersion">version</a>.<a href="QName.scala.html#87766" title="=&gt; String">version</a><span class="delimiter">)</span></span>
<a href="l205"></a><span id="l205"></span>
<a href="l206"></a><span id="l206">      <a href="#106829" title="(v1: scales.xml.Serializer)R">thunk</a><span class="delimiter">(</span><span class="delimiter">{</span></span>
<a href="l207"></a><span id="l207">        <span class="keyword">val</span> <a title="scales.xml.LSSerializer" id="106842">s</a> = <a href="#90074" title="(sdata: scales.xml.SerializerData, ndoc: org.w3c.dom.Document)scales.xml.LSSerializer">createSerializer</a><span class="delimiter">(</span><a href="#106830" title="scales.xml.SerializerData">sdata</a>, <a href="#106840" title="org.w3c.dom.Document">ndoc</a><span class="delimiter">)</span></span>
<a href="l208"></a><span id="l208">        <a href="#106842" title="scales.xml.LSSerializer">s</a>.<a href="#106640" title="=&gt; org.w3c.dom.ls.LSOutput">lsout</a>.<span title="(x$1: java.lang.String)Unit">setEncoding</span><span class="delimiter">(</span><a href="#106830" title="scales.xml.SerializerData">sdata</a>.<a href="#109097" title="=&gt; java.nio.charset.Charset">encoding</a>.<span title="()java.lang.String">displayName</span><span class="delimiter">)</span></span>
<a href="l209"></a><span id="l209">        <a href="#106842" title="scales.xml.LSSerializer">s</a>.<a href="#106640" title="=&gt; org.w3c.dom.ls.LSOutput">lsout</a>.<span title="(x$1: java.io.Writer)Unit">setCharacterStream</span><span class="delimiter">(</span><a href="#106830" title="scales.xml.SerializerData">sdata</a>.<a href="#109095" title="=&gt; java.io.Writer">out</a><span class="delimiter">)</span></span>
<a href="l210"></a><span id="l210">        <a href="#106842" title="scales.xml.LSSerializer">s</a>.<a href="#106642" title="=&gt; org.w3c.dom.ls.LSOutput">lsaout</a>.<span title="(x$1: java.lang.String)Unit">setEncoding</span><span class="delimiter">(</span><a href="#106830" title="scales.xml.SerializerData">sdata</a>.<a href="#109097" title="=&gt; java.nio.charset.Charset">encoding</a>.<span title="()java.lang.String">displayName</span><span class="delimiter">)</span></span>
<a href="l211"></a><span id="l211"></span>
<a href="l212"></a><span id="l212">        <span class="keyword">val</span> <a title="org.w3c.dom.DOMConfiguration" id="106843">dc</a> = <a href="#106842" title="scales.xml.LSSerializer">s</a>.<a href="#106641" title="=&gt; org.w3c.dom.ls.LSSerializer">lss</a>.<span title="()org.w3c.dom.DOMConfiguration">getDomConfig</span> <span class="comment">// got to be the lss, as the xalan impl is unrelated </span></span>
<a href="l213"></a><span id="l213">        <span class="comment">//println(&quot;Configured with LSSerializer &quot; + s.lss.getClass.getName)</span></span>
<a href="l214"></a><span id="l214">        <span class="comment">//val xs = new org.apache.xml.serializer.dom3.LSSerializerImpl</span></span>
<a href="l215"></a><span id="l215">        <span class="comment">// if the user wants to add a cdata then we shouldn't split it, but &quot;throw&quot;</span></span>
<a href="l216"></a><span id="l216">        <span class="comment">// NOTE that no implementation does this for Ã¤ and only for ]]&gt;</span></span>
<a href="l217"></a><span id="l217">        <a href="#106843" title="org.w3c.dom.DOMConfiguration">dc</a>.<span title="(x$1: java.lang.String, x$2: Any)Unit">setParameter</span><span class="delimiter">(</span><span title="java.lang.String(&quot;split-cdata-sections&quot;)" class="string">&quot;split-cdata-sections&quot;</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span></span>
<a href="l218"></a><span id="l218">        <a href="#106843" title="org.w3c.dom.DOMConfiguration">dc</a>.<span title="(x$1: java.lang.String, x$2: Any)Unit">setParameter</span><span class="delimiter">(</span><span title="java.lang.String(&quot;well-formed&quot;)" class="string">&quot;well-formed&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span></span>
<a href="l219"></a><span id="l219">        <a href="#106843" title="org.w3c.dom.DOMConfiguration">dc</a>.<span title="(x$1: java.lang.String, x$2: Any)Unit">setParameter</span><span class="delimiter">(</span><span title="java.lang.String(&quot;xml-declaration&quot;)" class="string">&quot;xml-declaration&quot;</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span></span>
<a href="l220"></a><span id="l220"></span>
<a href="l221"></a><span id="l221">        <a href="#106842" title="scales.xml.LSSerializer">s</a></span>
<a href="l222"></a><span id="l222">      <span class="delimiter">}</span><span class="delimiter">)</span></span>
<a href="l223"></a><span id="l223">    <span class="delimiter">}</span></span>
<a href="l224"></a><span id="l224">  <span class="delimiter">}</span></span>
<a href="l225"></a><span id="l225"></span>
<a href="l226"></a><span id="l226"><span class="delimiter">}</span></span>
<a href="l227"></a><span id="l227"></span>
<a href="l228"></a><span id="l228"><span class="comment">/**</span>
<a href="l229"></a><span id="l229"> * XHTML serialization extra touches</span>
<a href="l230"></a><span id="l230"> */</span> </span>
<a href="l231"></a><span id="l231"><span class="keyword">object</span> <a title="object scales.xml.LSSerializerFactoryXHTML" id="11944">LSSerializerFactoryXHTML</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11946" title="scales.xml.LSSerializerConcurrentCacheFactoryXHTML">LSSerializerConcurrentCacheFactoryXHTML</a> <span class="delimiter">{</span></span>
<a href="l232"></a><span id="l232"><span class="delimiter">}</span></span>
<a href="l233"></a><span id="l233"></span>
<a href="l234"></a><span id="l234"><span class="keyword">trait</span> <a title="trait LSSerializerConcurrentCacheFactoryXHTML extends java.lang.Object with scales.xml.LSSerializerConcurrentCacheFactory with ScalaObject" id="11946">LSSerializerConcurrentCacheFactoryXHTML</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11949" title="scales.xml.LSSerializerConcurrentCacheFactory">LSSerializerConcurrentCacheFactory</a> <span class="delimiter">{</span></span>
<a href="l235"></a><span id="l235">  <span class="keyword">import</span> org.w3c.dom._</span>
<a href="l236"></a><span id="l236">  <span class="keyword">import</span> ls._</span>
<a href="l237"></a><span id="l237"></span>
<a href="l238"></a><span id="l238">  <span class="comment">/**</span>
<a href="l239"></a><span id="l239">   * Override to create the serialazer</span>
<a href="l240"></a><span id="l240">   */</span> </span>
<a href="l241"></a><span id="l241">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(sdata: scales.xml.SerializerData, ndoc: org.w3c.dom.Document)scales.xml.LSSerializer" id="106861">createSerializer</a><span class="delimiter">(</span> <a title="scales.xml.SerializerData" id="106867">sdata</a>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a>, <a title="org.w3c.dom.Document" id="106868">ndoc</a> : org.w3c.dom.<span title="org.w3c.dom.Document">Document</span><span class="delimiter">)</span> : scales.xml.<a href="#11954" title="scales.xml.LSSerializer">LSSerializer</a> = <a href="#106870" title="java.lang.Object with scales.xml.XHTMLLSSerializer{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.XHTMLLSSerializer" id="106870">scales</a>.xml.<a href="#11953" title="scales.xml.XHTMLLSSerializer">XHTMLLSSerializer</a> <span class="delimiter">{</span></span>
<a href="l242"></a><span id="l242">          <span class="keyword">val</span> <a title="scales.xml.SerializerData" id="106877">data</a> = <a href="#106867" title="scales.xml.SerializerData">sdata</a></span>
<a href="l243"></a><span id="l243">          <span class="keyword">val</span> <a title="String =&gt; Option[Throwable]" id="106879">encMap</a> = <a href="#90083" title="(v1: java.nio.charset.Charset)String =&gt; Option[Throwable]">encF</a><span class="delimiter">(</span><a href="#106867" title="scales.xml.SerializerData">sdata</a>.<a href="#109097" title="=&gt; java.nio.charset.Charset">encoding</a><span class="delimiter">)</span></span>
<a href="l244"></a><span id="l244">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.Document" id="106882">doc</a> = <a href="#106868" title="org.w3c.dom.Document">ndoc</a></span>
<a href="l245"></a><span id="l245">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.DOMImplementationLS" id="106884">impl</a> = <a href="#106881" title="=&gt; org.w3c.dom.Document">doc</a>.<span title="()org.w3c.dom.DOMImplementation">getImplementation</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.w3c.dom.ls.DOMImplementationLS" class="delimiter">[</span><span title="org.w3c.dom.ls.DOMImplementationLS">DOMImplementationLS</span><span class="delimiter">]</span></span>
<a href="l246"></a><span id="l246">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSOutput" id="106886">lsout</a> = <a href="#106883" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSOutput">createLSOutput</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l247"></a><span id="l247">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSOutput" id="106888">lsaout</a> = <a href="#106883" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSOutput">createLSOutput</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l248"></a><span id="l248">          <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.ls.LSSerializer" id="106890">lss</a> = <a href="#106883" title="=&gt; org.w3c.dom.ls.DOMImplementationLS">impl</a>.<span title="()org.w3c.dom.ls.LSSerializer">createLSSerializer</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l249"></a><span id="l249">        <span class="delimiter">}</span></span>
<a href="l250"></a><span id="l250"></span>
<a href="l251"></a><span id="l251"><span class="delimiter">}</span></span>
<a href="l252"></a><span id="l252"></span>
<a href="l253"></a><span id="l253"></span>
<a href="l254"></a><span id="l254"><span class="comment">/**</span>
<a href="l255"></a><span id="l255"> * Default implmementation of serialization</span>
<a href="l256"></a><span id="l256"> */</span> </span>
<a href="l257"></a><span id="l257"><span class="keyword">object</span> <a title="object scales.xml.LSSerializerFactory" id="11947">LSSerializerFactory</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11949" title="scales.xml.LSSerializerConcurrentCacheFactory">LSSerializerConcurrentCacheFactory</a> <span class="delimiter">{</span></span>
<a href="l258"></a><span id="l258"><span class="delimiter">}</span></span>
<a href="l259"></a><span id="l259"></span>
<a href="l260"></a><span id="l260"><span class="keyword">trait</span> <a title="trait LSSerializerConcurrentCacheFactory extends java.lang.Object with scales.xml.LSSerializerFactoryBase with ScalaObject" id="11949">LSSerializerConcurrentCacheFactory</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11943" title="scales.xml.LSSerializerFactoryBase">LSSerializerFactoryBase</a> <span class="delimiter">{</span></span>
<a href="l261"></a><span id="l261">  <span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap</span>
<a href="l262"></a><span id="l262"></span>
<a href="l263"></a><span id="l263">  <span class="comment">/**</span>
<a href="l264"></a><span id="l264">   * On the assumption that a given apps qname population is larger than that of its possible encodings.</span>
<a href="l265"></a><span id="l265">   */</span></span>
<a href="l266"></a><span id="l266">  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]]]" id="90081">globalEncMap</a> = <span title="()java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]]]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]]]">ConcurrentHashMap</span><span class="delimiter">[</span>String, ConcurrentHashMap<span class="delimiter">[</span>Charset, Once<span class="delimiter">[</span>Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span></span>
<a href="l267"></a><span id="l267"></span>
<a href="l268"></a><span id="l268">  <span class="keyword">val</span> <a title="java.nio.charset.Charset =&gt; String =&gt; Option[Throwable]" id="90083">encF</a> = <span class="delimiter">{</span> encoding: <span title="java.nio.charset.Charset">Charset</span> =&gt;</span>
<a href="l269"></a><span id="l269">    <span class="keyword">val</span> <a title="java.nio.charset.CharsetEncoder" id="106893">encoder</a> = <a href="#106892" title="java.nio.charset.Charset">encoding</a>.<span title="()java.nio.charset.CharsetEncoder">newEncoder</span></span>
<a href="l270"></a><span id="l270"></span>
<a href="l271"></a><span id="l271">    <span class="comment">/**</span>
<a href="l272"></a><span id="l272">     * Perhaps silly optimisation given a bug about it but worth trying</span>
<a href="l273"></a><span id="l273">     *</span>
<a href="l274"></a><span id="l274">     * If the charset contains utf8 then its able to support all unicode characters that utf8 can.  Wierdly I would also have expected utf8 to contain32 as it contains utf16 - must verify.</span>
<a href="l275"></a><span id="l275">     */</span></span>
<a href="l276"></a><span id="l276">    <span title="String =&gt; Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#106892" title="java.nio.charset.Charset">encoding</a>.<span title="(x$1: java.nio.charset.Charset)Boolean">contains</span><span class="delimiter">(</span><a href="../utils/Localisation.scala.html#12395" title="=&gt; java.nio.charset.Charset">defaultCharset</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt; <span title="object None">None</span> <span class="delimiter">}</span></span>
<a href="l277"></a><span id="l277">    <span class="keyword">else</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt;</span>
<a href="l278"></a><span id="l278"></span>
<a href="l279"></a><span id="l279">      <a href="../utils/ConcurrentMapUtils.scala.html#12368" title="(key: java.nio.charset.Charset, map: java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]])(calc: =&gt; Option[Throwable])Option[Throwable]">calcOnce</a><span class="delimiter">(</span><a href="#106892" title="java.nio.charset.Charset">encoding</a>, <a href="../utils/ConcurrentMapUtils.scala.html#12373" title="(key: String, map: java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]]])(newT: =&gt; java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]])java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]]">value</a><span class="delimiter">(</span><a href="#106960" title="String">s</a>, <a href="#90081" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]]]">globalEncMap</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="()java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[java.nio.charset.Charset,scales.utils.package.Once[Option[Throwable]]]">ConcurrentHashMap</span><span class="delimiter">[</span>Charset, Once<span class="delimiter">[</span>Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l280"></a><span id="l280">        <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#106893" title="java.nio.charset.CharsetEncoder">encoder</a>.<span title="(x$1: java.lang.CharSequence)Boolean">canEncode</span><span class="delimiter">(</span><a href="#106960" title="String">s</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l281"></a><span id="l281">          <span title="object None">None</span> <span class="comment">// it can do it</span></span>
<a href="l282"></a><span id="l282">        <span class="keyword">else</span></span>
<a href="l283"></a><span id="l283">          <span title="(x: scales.xml.InvalidCharacterInMarkup)Some[scales.xml.InvalidCharacterInMarkup]">Some</span><span class="delimiter">(</span><a href="#109947" title="(what: String)scales.xml.InvalidCharacterInMarkup">InvalidCharacterInMarkup</a><span class="delimiter">(</span><a href="#106960" title="String">s</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l284"></a><span id="l284">      <span class="delimiter">}</span></span>
<a href="l285"></a><span id="l285">    <span class="delimiter">}</span></span>
<a href="l286"></a><span id="l286">  <span class="delimiter">}</span></span>
<a href="l287"></a><span id="l287"></span>
<a href="l288"></a><span id="l288"><span class="delimiter">}</span></span>
<a href="l289"></a><span id="l289"></span>
<a href="l290"></a><span id="l290"><span class="keyword">object</span> <a title="object scales.xml.LSSerializerNoCacheFactory" id="11950">LSSerializerNoCacheFactory</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11952" title="scales.xml.LSSerializerNoCacheFactoryT">LSSerializerNoCacheFactoryT</a> <span class="delimiter">{</span></span>
<a href="l291"></a><span id="l291"><span class="delimiter">}</span></span>
<a href="l292"></a><span id="l292"></span>
<a href="l293"></a><span id="l293"><span class="comment">/**</span>
<a href="l294"></a><span id="l294"> * This variety does not use a thread safe global cache, use when your data</span>
<a href="l295"></a><span id="l295"> * is progressivly radically different for each run.</span>
<a href="l296"></a><span id="l296"> *</span>
<a href="l297"></a><span id="l297"> * If you don't like this scheme either simply implement LSSerializerFactoryBase with your own caching needs.</span>
<a href="l298"></a><span id="l298"> */</span></span>
<a href="l299"></a><span id="l299"><span class="keyword">trait</span> <a title="trait LSSerializerNoCacheFactoryT extends java.lang.Object with scales.xml.LSSerializerFactoryBase with ScalaObject" id="11952">LSSerializerNoCacheFactoryT</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11943" title="scales.xml.LSSerializerFactoryBase">LSSerializerFactoryBase</a> <span class="delimiter">{</span></span>
<a href="l300"></a><span id="l300">  <span class="keyword">import</span> java.util.HashMap</span>
<a href="l301"></a><span id="l301"></span>
<a href="l302"></a><span id="l302">  <span class="keyword">val</span> <a title="java.nio.charset.Charset =&gt; String =&gt; Option[Throwable]" id="107209">encF</a> = <span class="delimiter">{</span> encoding: <span title="java.nio.charset.Charset">Charset</span> =&gt;</span>
<a href="l303"></a><span id="l303">    <span class="keyword">val</span> <a title="java.nio.charset.CharsetEncoder" id="107216">encoder</a> = <a href="#107215" title="java.nio.charset.Charset">encoding</a>.<span title="()java.nio.charset.CharsetEncoder">newEncoder</span></span>
<a href="l304"></a><span id="l304">    <span class="keyword">val</span> <a title="java.util.HashMap[String,Option[Throwable]]" id="107217">map</a> = <span title="()java.util.HashMap[String,Option[Throwable]]" class="keyword">new</span> <span title="java.util.HashMap[String,Option[Throwable]]">HashMap</span><span class="delimiter">[</span>String, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">]</span></span>
<a href="l305"></a><span id="l305"></span>
<a href="l306"></a><span id="l306">    <span class="comment">/**</span>
<a href="l307"></a><span id="l307">     * See the above explanation for this</span>
<a href="l308"></a><span id="l308">     */</span></span>
<a href="l309"></a><span id="l309">    <span title="String =&gt; Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#107215" title="java.nio.charset.Charset">encoding</a>.<span title="(x$1: java.nio.charset.Charset)Boolean">contains</span><span class="delimiter">(</span><a href="../utils/Localisation.scala.html#12395" title="=&gt; java.nio.charset.Charset">defaultCharset</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt; <span title="object None">None</span> <span class="delimiter">}</span></span>
<a href="l310"></a><span id="l310">    <span class="keyword">else</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt;</span>
<a href="l311"></a><span id="l311"></span>
<a href="l312"></a><span id="l312">      <span class="keyword">var</span> <a title="Option[Throwable]" id="107452">r</a> = <a href="#107217" title="java.util.HashMap[String,Option[Throwable]]">map</a>.<span title="(x$1: Any)Option[Throwable]">get</span><span class="delimiter">(</span><a href="#107451" title="String">s</a><span class="delimiter">)</span></span>
<a href="l313"></a><span id="l313">      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#107452" title="Option[Throwable]">r</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l314"></a><span id="l314">        <a href="#107452" title="Option[Throwable]">r</a> = <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#107216" title="java.nio.charset.CharsetEncoder">encoder</a>.<span title="(x$1: java.lang.CharSequence)Boolean">canEncode</span><span class="delimiter">(</span><a href="#107451" title="String">s</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l315"></a><span id="l315">          <span title="object None">None</span> <span class="comment">// it can do it</span></span>
<a href="l316"></a><span id="l316">        <span class="keyword">else</span></span>
<a href="l317"></a><span id="l317">          <span title="(x: scales.xml.InvalidCharacterInMarkup)Some[scales.xml.InvalidCharacterInMarkup]">Some</span><span class="delimiter">(</span><a href="#109947" title="(what: String)scales.xml.InvalidCharacterInMarkup">InvalidCharacterInMarkup</a><span class="delimiter">(</span><a href="#107451" title="String">s</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l318"></a><span id="l318"></span>
<a href="l319"></a><span id="l319">        <a href="#107217" title="java.util.HashMap[String,Option[Throwable]]">map</a>.<span title="(x$1: String, x$2: Option[Throwable])Option[Throwable]">put</span><span class="delimiter">(</span><a href="#107451" title="String">s</a>, <a href="#107452" title="Option[Throwable]">r</a><span class="delimiter">)</span></span>
<a href="l320"></a><span id="l320">      <span class="delimiter">}</span></span>
<a href="l321"></a><span id="l321"></span>
<a href="l322"></a><span id="l322">      <a href="#107452" title="Option[Throwable]">r</a></span>
<a href="l323"></a><span id="l323">    <span class="delimiter">}</span></span>
<a href="l324"></a><span id="l324">  <span class="delimiter">}</span></span>
<a href="l325"></a><span id="l325"></span>
<a href="l326"></a><span id="l326"><span class="delimiter">}</span></span>
<a href="l327"></a><span id="l327"></span>
<a href="l328"></a><span id="l328"><span class="comment">/**</span>
<a href="l329"></a><span id="l329"> * Adds an extra space after an empty element</span>
<a href="l330"></a><span id="l330"> */</span> </span>
<a href="l331"></a><span id="l331"><span class="keyword">trait</span> <a title="trait XHTMLLSSerializer extends java.lang.Object with scales.xml.LSSerializer with ScalaObject" id="11953">XHTMLLSSerializer</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11954" title="scales.xml.LSSerializer">LSSerializer</a> <span class="delimiter">{</span></span>
<a href="l332"></a><span id="l332">  <span class="keyword">import</span> <a href="#106636" title="=&gt; scales.xml.SerializerData">data</a>._</span>
<a href="l333"></a><span id="l333"></span>
<a href="l334"></a><span id="l334">  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="106875">emptyElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="107479">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="107480">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="107481">namespaces</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="107482">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="107483">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> =</span>
<a href="l335"></a><span id="l335">    <a href="#106654" title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String])Option[Throwable]">doElem</a><span class="delimiter">(</span><a href="#107479" title="scales.xml.QName">qName</a>, <a href="#107480" title="Traversable[scales.xml.Attribute]">attributes</a>, <a href="#107481" title="scala.collection.immutable.Map[String,String]">namespaces</a>, <a href="#107482" title="Option[String]">declareDefaultNS</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l336"></a><span id="l336">      <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot; /&gt;&quot;)" class="string">&quot; /&gt;&quot;</span><span class="delimiter">)</span></span>
<a href="l337"></a><span id="l337">      <span title="object None">None</span></span>
<a href="l338"></a><span id="l338">    <span class="delimiter">}</span></span>
<a href="l339"></a><span id="l339"><span class="delimiter">}</span></span>
<a href="l340"></a><span id="l340"></span>
<a href="l341"></a><span id="l341"><span class="comment">/**</span>
<a href="l342"></a><span id="l342"> * Default serializer, correctness first.  Uses the LSSerializer present in each DOM L3 impl.  XmlItems are always serialized with the LS, elements and attributes are however for speed reasons, verified for encoding once per QName; the attribute values themselves are written via Text nodes and LS.</span>
<a href="l343"></a><span id="l343"> */</span></span>
<a href="l344"></a><span id="l344"><span class="keyword">trait</span> <a title="trait LSSerializer extends java.lang.Object with scales.xml.Serializer with ScalaObject" id="11954">LSSerializer</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11913" title="scales.xml.Serializer">Serializer</a> <span class="delimiter">{</span></span>
<a href="l345"></a><span id="l345">  <span class="keyword">import</span> javax.xml.parsers._</span>
<a href="l346"></a><span id="l346">  <span class="keyword">import</span> org.w3c.dom._</span>
<a href="l347"></a><span id="l347">  <span class="keyword">import</span> ls._</span>
<a href="l348"></a><span id="l348">  <span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap</span>
<a href="l349"></a><span id="l349"></span>
<a href="l350"></a><span id="l350">  <span class="keyword">val</span> <a title="=&gt; scales.xml.SerializerData" id="106636">data</a>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a></span>
<a href="l351"></a><span id="l351">  <span class="keyword">import</span> <a href="#106636" title="=&gt; scales.xml.SerializerData">data</a>._</span>
<a href="l352"></a><span id="l352"></span>
<a href="l353"></a><span id="l353">  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.Document" id="106638">doc</a>: <span title="org.w3c.dom.Document">Document</span></span>
<a href="l354"></a><span id="l354">  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.ls.DOMImplementationLS" id="106639">impl</a>: <span title="org.w3c.dom.ls.DOMImplementationLS">DOMImplementationLS</span></span>
<a href="l355"></a><span id="l355">  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.ls.LSOutput" id="106640">lsout</a>: <span title="org.w3c.dom.ls.LSOutput">LSOutput</span></span>
<a href="l356"></a><span id="l356">  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.ls.LSSerializer" id="106641">lss</a>: ls.<span title="org.w3c.dom.ls.LSSerializer">LSSerializer</span></span>
<a href="l357"></a><span id="l357"></span>
<a href="l358"></a><span id="l358">  <span class="keyword">val</span> <a title="=&gt; org.w3c.dom.ls.LSOutput" id="106642">lsaout</a>: <span title="org.w3c.dom.ls.LSOutput">LSOutput</span></span>
<a href="l359"></a><span id="l359"></span>
<a href="l360"></a><span id="l360">  <span class="comment">/**</span>
<a href="l361"></a><span id="l361">   * Can the ncName be mapped for a given encoding</span>
<a href="l362"></a><span id="l362">   */</span></span>
<a href="l363"></a><span id="l363">  <span class="keyword">val</span> <a title="=&gt; String =&gt; Option[Throwable]" id="106643">encMap</a>: String =&gt; Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span></span>
<a href="l364"></a><span id="l364"></span>
<a href="l365"></a><span id="l365">  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.w3c.dom.Text" id="106645">textNode</a> = <a href="#106638" title="=&gt; org.w3c.dom.Document">doc</a>.<span title="(x$1: java.lang.String)org.w3c.dom.Text">createTextNode</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span></span>
<a href="l366"></a><span id="l366"></span>
<a href="l367"></a><span id="l367">  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.nio.charset.CharsetEncoder" id="106647">encoder</a> = <a href="#109097" title="=&gt; java.nio.charset.Charset">encoding</a>.<span title="()java.nio.charset.CharsetEncoder">newEncoder</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l368"></a><span id="l368"></span>
<a href="l369"></a><span id="l369">  <span class="comment">/**</span>
<a href="l370"></a><span id="l370">   * See default SF for logic on this, however faulty :-)</span>
<a href="l371"></a><span id="l371">   */</span></span>
<a href="l372"></a><span id="l372">  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String =&gt; Boolean" id="106649">canEncode</a> =</span>
<a href="l373"></a><span id="l373">    <span title="String =&gt; Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#109097" title="=&gt; java.nio.charset.Charset">encoding</a>.<span title="(x$1: java.nio.charset.Charset)Boolean">contains</span><span class="delimiter">(</span><a href="../utils/Localisation.scala.html#12395" title="=&gt; java.nio.charset.Charset">defaultCharset</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt; <span title="Boolean(true)" class="keyword">true</span> <span class="delimiter">}</span></span>
<a href="l374"></a><span id="l374">    <span class="keyword">else</span> <span class="delimiter">{</span> s: <span title="String">String</span> =&gt; <a href="#106646" title="=&gt; java.nio.charset.CharsetEncoder">encoder</a>.<span title="(x$1: java.lang.CharSequence)Boolean">canEncode</span><span class="delimiter">(</span><a href="#107509" title="String">s</a><span class="delimiter">)</span> <span class="delimiter">}</span></span>
<a href="l375"></a><span id="l375"></span>
<a href="l376"></a><span id="l376">  <span class="keyword">def</span> <a title="(t: =&gt; Boolean, s: =&gt; String)Option[Throwable]" id="106650">ct</a><span class="delimiter">(</span><a title="=&gt; Boolean" id="107514">t</a>: =&gt; Boolean, <a title="=&gt; String" id="107515">s</a>: =&gt; String<span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l377"></a><span id="l377">    <span class="keyword">try</span> <span class="delimiter">{</span></span>
<a href="l378"></a><span id="l378">      <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#107514" title="=&gt; Boolean">t</a><span class="delimiter">)</span></span>
<a href="l379"></a><span id="l379">        <span title="object None">None</span></span>
<a href="l380"></a><span id="l380">      <span class="keyword">else</span></span>
<a href="l381"></a><span id="l381">        <span title="(x: scales.xml.CannotSerialize)Some[scales.xml.CannotSerialize]">Some</span><span class="delimiter">(</span><a href="#109931" title="(what: String)scales.xml.CannotSerialize">CannotSerialize</a><span class="delimiter">(</span><a href="#107515" title="=&gt; String">s</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l382"></a><span id="l382">    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span></span>
<a href="l383"></a><span id="l383">      <span class="keyword">case</span> <a title="Some[java.lang.Throwable]" id="107524">t</a>: <span title="Throwable">Throwable</span> =&gt; <span title="(x: java.lang.Throwable)Some[java.lang.Throwable]">Some</span><span class="delimiter">(</span><a href="#107524" title="java.lang.Throwable">t</a><span class="delimiter">)</span></span>
<a href="l384"></a><span id="l384">    <span class="delimiter">}</span></span>
<a href="l385"></a><span id="l385">  <span class="delimiter">}</span></span>
<a href="l386"></a><span id="l386"></span>
<a href="l387"></a><span id="l387">  <span class="comment">/**</span>
<a href="l388"></a><span id="l388">   * Performs the actual write for Comments/CData/PI, due to LSSerializer issues this function is seperated for easy overriding, should anyone really trust their DOM/JAXP versions.</span>
<a href="l389"></a><span id="l389">   *</span>
<a href="l390"></a><span id="l390">   * For this method to be called the encoding has already been verified.</span>
<a href="l391"></a><span id="l391">   */</span></span>
<a href="l392"></a><span id="l392">  <span class="keyword">def</span> <a title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]" id="106651">writeNonText</a><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="107528">item</a>: <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a>, <a title="List[scales.xml.QName]" id="107529">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> =</span>
<a href="l393"></a><span id="l393">    <a href="#11918" title="object scales.xml.SerializerHelpers">SerializerHelpers</a>.<a href="#106041" title="(out: java.io.Writer, item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">item</a><span class="delimiter">(</span><a href="#109095" title="=&gt; java.io.Writer">out</a>, <a href="#107528" title="scales.xml.XmlItem">item</a>, <a href="#107529" title="List[scales.xml.QName]">path</a><span class="delimiter">)</span></span>
<a href="l394"></a><span id="l394"></span>
<a href="l395"></a><span id="l395">  <span class="comment">/**</span>
<a href="l396"></a><span id="l396">   * LSSerializer in 6_24 is garbage, but the xalan one isn't much better.  jre uses hex, xalan numberic character refs.  And jre is totally useless for cdata, writing no end part, both ignore the split-cdata-sections option when escaping, choosing to split, I assume this is only being done for character refs but follows the DOMConfiguration (instead of the load and save spec) for end sequence splitting.</span>
<a href="l397"></a><span id="l397">   *</span>
<a href="l398"></a><span id="l398">   * As such there only seems to be one safe way to handle this:</span>
<a href="l399"></a><span id="l399">   *   # Use the encoder to check if a CData or Comment can be written without splitting, throw if it can't.</span>
<a href="l400"></a><span id="l400">   *   # Write the start and end CData directly</span>
<a href="l401"></a><span id="l401">   */</span></span>
<a href="l402"></a><span id="l402">  <span class="keyword">def</span> <a title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]" id="106652">item</a><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="106679">item</a>: <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a>, <a title="List[scales.xml.QName]" id="106680">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l403"></a><span id="l403">    <span class="keyword">val</span> <a title="Option[Throwable]" id="107531">canEncodeI</a>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <a href="#106679" title="scales.xml.XmlItem">item</a> <span title="Option[Throwable]" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l404"></a><span id="l404">      <span class="keyword">case</span> <a title="None.type" id="107532">x</a>: scales.xml.<a href="XmlTypes.scala.html#11999" title="scales.xml.Text">Text</a> =&gt;</span>
<a href="l405"></a><span id="l405">        <span title="object None">None</span> <span class="comment">// never a problem</span></span>
<a href="l406"></a><span id="l406">      <span class="keyword">case</span> <a title="Option[Throwable]" id="107533">x</a>: <a href="XmlTypes.scala.html#12005" title="scales.xml.CData">CData</a> =&gt;</span>
<a href="l407"></a><span id="l407">        <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#106648" title="(v1: String)Boolean">canEncode</a><span class="delimiter">(</span><a href="#106679" title="scales.xml.XmlItem">item</a>.<a href="XmlTypes.scala.html#89670" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l408"></a><span id="l408">          <span title="object None">None</span></span>
<a href="l409"></a><span id="l409">        <span class="keyword">else</span></span>
<a href="l410"></a><span id="l410">          <span title="(x: scales.xml.CDataCannotBeEncoded)Some[scales.xml.CDataCannotBeEncoded]">Some</span><span class="delimiter">(</span><a href="#109943" title="(what: String)scales.xml.CDataCannotBeEncoded">CDataCannotBeEncoded</a><span class="delimiter">(</span><a href="#106679" title="scales.xml.XmlItem">item</a>.<a href="XmlTypes.scala.html#89670" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l411"></a><span id="l411">      <span class="keyword">case</span> <a title="Option[Throwable]" id="107542">x</a>: scales.xml.<a href="XmlTypes.scala.html#12002" title="scales.xml.Comment">Comment</a> =&gt;</span>
<a href="l412"></a><span id="l412">        <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#106648" title="(v1: String)Boolean">canEncode</a><span class="delimiter">(</span><a href="#106679" title="scales.xml.XmlItem">item</a>.<a href="XmlTypes.scala.html#89670" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l413"></a><span id="l413">          <span title="object None">None</span></span>
<a href="l414"></a><span id="l414">        <span class="keyword">else</span></span>
<a href="l415"></a><span id="l415">          <span title="(x: scales.xml.CommentCannotBeEncoded)Some[scales.xml.CommentCannotBeEncoded]">Some</span><span class="delimiter">(</span><a href="#109939" title="(what: String)scales.xml.CommentCannotBeEncoded">CommentCannotBeEncoded</a><span class="delimiter">(</span><a href="#106679" title="scales.xml.XmlItem">item</a>.<a href="XmlTypes.scala.html#89670" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l416"></a><span id="l416">      <span class="keyword">case</span> <a title="Option[Throwable]" id="107551">x</a>: scales.xml.<a href="XmlTypes.scala.html#12008" title="scales.xml.PI">PI</a> =&gt;</span>
<a href="l417"></a><span id="l417">        <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#106648" title="(v1: String)Boolean">canEncode</a><span class="delimiter">(</span><a href="#107551" title="scales.xml.PI">x</a>.<a href="XmlTypes.scala.html#89670" title="=&gt; String">value</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#106648" title="(v1: String)Boolean">canEncode</a><span class="delimiter">(</span><a href="#107551" title="scales.xml.PI">x</a>.<a href="XmlTypes.scala.html#95656" title="=&gt; String">target</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l418"></a><span id="l418">          <span title="object None">None</span></span>
<a href="l419"></a><span id="l419">        <span class="keyword">else</span></span>
<a href="l420"></a><span id="l420">          <span title="(x: scales.xml.PICannotBeEncoded)Some[scales.xml.PICannotBeEncoded]">Some</span><span class="delimiter">(</span><a href="#109935" title="(what: String)scales.xml.PICannotBeEncoded">PICannotBeEncoded</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Target: &quot;)" class="string">&quot;Target: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#107551" title="scales.xml.PI">x</a>.<a href="XmlTypes.scala.html#95656" title="=&gt; String">target</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; value: &quot;)" class="string">&quot; value: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#107551" title="scales.xml.PI">x</a>.<a href="XmlTypes.scala.html#89670" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l421"></a><span id="l421">    <span class="delimiter">}</span></span>
<a href="l422"></a><span id="l422">    <a href="#107531" title="Option[Throwable]">canEncodeI</a> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span> <span class="comment">// its serializeable, without cdata breaks</span></span>
<a href="l423"></a><span id="l423"></span>
<a href="l424"></a><span id="l424">      <a href="#106679" title="scales.xml.XmlItem">item</a> <span title="Option[Throwable]" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l425"></a><span id="l425">        <span class="keyword">case</span> <a title="Option[Throwable]" id="107564">x</a>: scales.xml.<a href="XmlTypes.scala.html#11999" title="scales.xml.Text">Text</a> =&gt;</span>
<a href="l426"></a><span id="l426">          <a href="#106644" title="=&gt; org.w3c.dom.Text">textNode</a>.<span title="(x$1: java.lang.String)Unit">setNodeValue</span><span class="delimiter">(</span><a href="#106679" title="scales.xml.XmlItem">item</a>.<a href="XmlTypes.scala.html#89670" title="=&gt; String">value</a><span class="delimiter">)</span> <span class="comment">// twice for pi's but I'm not going to work around them</span></span>
<a href="l427"></a><span id="l427">          <a href="#106650" title="(t: =&gt; Boolean, s: =&gt; String)Option[Throwable]">ct</a><span class="delimiter">(</span><a href="#106641" title="=&gt; org.w3c.dom.ls.LSSerializer">lss</a>.<span title="(x$1: org.w3c.dom.Node, x$2: org.w3c.dom.ls.LSOutput)Boolean">write</span><span class="delimiter">(</span><a href="#106644" title="=&gt; org.w3c.dom.Text">textNode</a>, <a href="#106640" title="=&gt; org.w3c.dom.ls.LSOutput">lsout</a><span class="delimiter">)</span>,</span>
<a href="l428"></a><span id="l428">            <span class="delimiter">{</span></span>
<a href="l429"></a><span id="l429">              <span class="keyword">val</span> <a title="java.io.StringWriter" id="107584">str</a> = <span title="java.io.StringWriter" class="keyword">new</span> java.io.<span title="java.io.StringWriter">StringWriter</span><span class="delimiter">(</span><span class="delimiter">)</span>;</span>
<a href="l430"></a><span id="l430">              <a href="#11918" title="object scales.xml.SerializerHelpers">SerializerHelpers</a>.<a href="#106041" title="(out: java.io.Writer, item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">item</a><span class="delimiter">(</span><a href="#107584" title="java.io.StringWriter">str</a>, <a href="#106679" title="scales.xml.XmlItem">item</a>, <a href="#106680" title="List[scales.xml.QName]">path</a><span class="delimiter">)</span></span>
<a href="l431"></a><span id="l431">              <a href="#107584" title="java.io.StringWriter">str</a>.<span title="()java.lang.String">toString</span></span>
<a href="l432"></a><span id="l432">            <span class="delimiter">}</span><span class="delimiter">)</span></span>
<a href="l433"></a><span id="l433">        <span class="keyword">case</span> <span title="Option[Throwable]">_</span> =&gt;</span>
<a href="l434"></a><span id="l434">          <a href="#106651" title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">writeNonText</a><span class="delimiter">(</span><a href="#106679" title="scales.xml.XmlItem">item</a>, <a href="#106680" title="List[scales.xml.QName]">path</a><span class="delimiter">)</span></span>
<a href="l435"></a><span id="l435">      <span class="delimiter">}</span></span>
<a href="l436"></a><span id="l436">    <span class="delimiter">}</span></span>
<a href="l437"></a><span id="l437">  <span class="delimiter">}</span></span>
<a href="l438"></a><span id="l438"></span>
<a href="l439"></a><span id="l439">  <span class="keyword">def</span> <a title="(before: =&gt; String, toCt: =&gt; String, after: =&gt; String)Option[Throwable]" id="106653">writeAttr</a><span class="delimiter">(</span><a title="=&gt; String" id="107632">before</a>: =&gt; String, <a title="=&gt; String" id="107633">toCt</a>: =&gt; String, <a title="=&gt; String" id="107634">after</a>: =&gt; String<span class="delimiter">)</span> =</span>
<a href="l440"></a><span id="l440">    <a href="#106650" title="(t: =&gt; Boolean, s: =&gt; String)Option[Throwable]">ct</a><span class="delimiter">(</span><span class="delimiter">{</span></span>
<a href="l441"></a><span id="l441">      <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><a href="#107632" title="=&gt; String">before</a><span class="delimiter">)</span></span>
<a href="l442"></a><span id="l442">      <span class="comment">// every other escape takes place</span></span>
<a href="l443"></a><span id="l443">      <span class="comment">// </span></span>
<a href="l444"></a><span id="l444">      <a href="#106644" title="=&gt; org.w3c.dom.Text">textNode</a>.<span title="(x$1: java.lang.String)Unit">setNodeValue</span><span class="delimiter">(</span><a href="#107633" title="=&gt; String">toCt</a><span class="delimiter">)</span></span>
<a href="l445"></a><span id="l445">      <span class="keyword">val</span> <a title="java.io.StringWriter" id="107637">str</a> = <span title="java.io.StringWriter" class="keyword">new</span> java.io.<span title="java.io.StringWriter">StringWriter</span><span class="delimiter">(</span><span class="delimiter">)</span>;</span>
<a href="l446"></a><span id="l446">      <a href="#106642" title="=&gt; org.w3c.dom.ls.LSOutput">lsaout</a>.<span title="(x$1: java.io.Writer)Unit">setCharacterStream</span><span class="delimiter">(</span><a href="#107637" title="java.io.StringWriter">str</a><span class="delimiter">)</span></span>
<a href="l447"></a><span id="l447">      <span class="keyword">val</span> <a title="Boolean" id="107638">r</a> = <a href="#106641" title="=&gt; org.w3c.dom.ls.LSSerializer">lss</a>.<span title="(x$1: org.w3c.dom.Node, x$2: org.w3c.dom.ls.LSOutput)Boolean">write</span><span class="delimiter">(</span><a href="#106644" title="=&gt; org.w3c.dom.Text">textNode</a>, <a href="#106642" title="=&gt; org.w3c.dom.ls.LSOutput">lsaout</a><span class="delimiter">)</span></span>
<a href="l448"></a><span id="l448">      <a href="#106642" title="=&gt; org.w3c.dom.ls.LSOutput">lsaout</a>.<span title="(x$1: java.io.Writer)Unit">setCharacterStream</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="comment">// let it be collected</span></span>
<a href="l449"></a><span id="l449">      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#107638" title="Boolean">r</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l450"></a><span id="l450">        <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><a href="#107637" title="java.io.StringWriter">str</a>.<span title="()java.lang.String">toString</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">replaceAll</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span>, <span title="java.lang.String(&quot;&amp;quot;&quot;)" class="string">&quot;&amp;quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l451"></a><span id="l451">        <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><a href="#107634" title="=&gt; String">after</a><span class="delimiter">)</span></span>
<a href="l452"></a><span id="l452">      <span class="delimiter">}</span></span>
<a href="l453"></a><span id="l453">      <a href="#107638" title="Boolean">r</a></span>
<a href="l454"></a><span id="l454">    <span class="delimiter">}</span>, <a href="#107632" title="=&gt; String">before</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#107633" title="=&gt; String">toCt</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#107634" title="=&gt; String">after</a><span class="delimiter">)</span></span>
<a href="l455"></a><span id="l455"></span>
<a href="l456"></a><span id="l456">  <span class="comment">/**</span>
<a href="l457"></a><span id="l457">   * Override this to order the attributes.</span>
<a href="l458"></a><span id="l458">   */</span></span>
<a href="l459"></a><span id="l459">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String])Option[Throwable]" id="106654">doElem</a><span class="delimiter">(</span><a title="scales.xml.QName" id="107485">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="107486">attribs</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="107487">ns</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="107488">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l460"></a><span id="l460"></span>
<a href="l461"></a><span id="l461">    <span class="delimiter">{</span></span>
<a href="l462"></a><span id="l462">      <span title="Option[scales.xml.IncompatibleQNameVersions]" class="keyword">if</span> <span class="delimiter">(</span><a href="#107485" title="scales.xml.QName">qName</a>.<a href="QName.scala.html#87935" title="=&gt; scales.xml.XmlVersion">qNameVersion</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="QName.scala.html#11781" title="object scales.xml.Xml11">Xml11</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#109096" title="=&gt; scales.xml.XmlVersion">version</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="QName.scala.html#11783" title="object scales.xml.Xml10">Xml10</a><span class="delimiter">)</span></span>
<a href="l463"></a><span id="l463">        <span title="(x: scales.xml.IncompatibleQNameVersions)Some[scales.xml.IncompatibleQNameVersions]">Some</span><span class="delimiter">(</span><a href="#109927" title="(what: String)scales.xml.IncompatibleQNameVersions">IncompatibleQNameVersions</a><span class="delimiter">(</span><a href="#107485" title="scales.xml.QName">qName</a>.<a href="QName.scala.html#87937" title="=&gt; java.lang.String">qName</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l464"></a><span id="l464">      <span class="keyword">else</span></span>
<a href="l465"></a><span id="l465">        <span title="object None">None</span></span>
<a href="l466"></a><span id="l466">    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l467"></a><span id="l467">      <span class="comment">// we don't have to encode it, just check it can be encoded, the writer will do the rest for markup</span></span>
<a href="l468"></a><span id="l468">      <a href="#106643" title="(v1: String)Option[Throwable]">encMap</a><span class="delimiter">(</span><a href="#107485" title="scales.xml.QName">qName</a>.<a href="QName.scala.html#87937" title="=&gt; java.lang.String">qName</a><span class="delimiter">)</span></span>
<a href="l469"></a><span id="l469">    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l470"></a><span id="l470"></span>
<a href="l471"></a><span id="l471">      <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;&quot;)" class="string">&quot;&lt;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#107485" title="scales.xml.QName">qName</a>.<a href="QName.scala.html#87937" title="=&gt; java.lang.String">qName</a><span class="delimiter">)</span></span>
<a href="l472"></a><span id="l472">      <span title="object None">None</span></span>
<a href="l473"></a><span id="l473"></span>
<a href="l474"></a><span id="l474">    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l475"></a><span id="l475"></span>
<a href="l476"></a><span id="l476">      <a href="#107488" title="Option[String]">declareDefaultNS</a>.<span title="(f: String =&gt; Option[Throwable])Option[Throwable]">flatMap</span> <span class="delimiter">{</span> <a title="String" id="107709">dns</a> =&gt;</span>
<a href="l477"></a><span id="l477">        <a href="#106653" title="(before: =&gt; String, toCt: =&gt; String, after: =&gt; String)Option[Throwable]">writeAttr</a><span class="delimiter">(</span><span title="java.lang.String(&quot; xmlns=\&quot;&quot;)" class="string">&quot; xmlns=\&quot;&quot;</span>, <a href="#107709" title="String">dns</a>, <span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span></span>
<a href="l478"></a><span id="l478">      <span class="delimiter">}</span></span>
<a href="l479"></a><span id="l479">    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l480"></a><span id="l480"></span>
<a href="l481"></a><span id="l481">      <a href="#107487" title="scala.collection.immutable.Map[String,String]">ns</a>.<span title="(z: Option[Throwable])(op: (Option[Throwable], (String, String)) =&gt; Option[Throwable])Option[Throwable]">foldLeft</span><span class="delimiter">(</span><span title="object None">None</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Option[Throwable]" id="107726">r</a>, <a title="(String, String)" id="107727">x</a><span class="delimiter">)</span> =&gt;</span>
<a href="l482"></a><span id="l482">        <a href="#107726" title="Option[Throwable]">r</a> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l483"></a><span id="l483">          <span class="comment">// check the prefix is valid</span></span>
<a href="l484"></a><span id="l484">          <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="QName.scala.html#11786" title="object scales.xml.QNameCharUtils">QNameCharUtils</a>.<a href="QName.scala.html#87928" title="(prefix: String)(implicit ver: scales.xml.XmlVersion)Boolean">validXmlPrefix</a><span class="delimiter">(</span><a href="#107727" title="(String, String)">x</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#109096" title="=&gt; scales.xml.XmlVersion">version</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l485"></a><span id="l485">            <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot; xmlns:&quot;)" class="string">&quot; xmlns:&quot;</span><span class="delimiter">)</span></span>
<a href="l486"></a><span id="l486">            <a href="#106643" title="(v1: String)Option[Throwable]">encMap</a><span class="delimiter">(</span><a href="#107727" title="(String, String)">x</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span></span>
<a href="l487"></a><span id="l487">              <a href="#106653" title="(before: =&gt; String, toCt: =&gt; String, after: =&gt; String)Option[Throwable]">writeAttr</a><span class="delimiter">(</span><a href="#107727" title="(String, String)">x</a>.<span title="=&gt; String">_1</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=\&quot;&quot;)" class="string">&quot;=\&quot;&quot;</span>, <a href="#107727" title="(String, String)">x</a>.<span title="=&gt; String">_2</span>, <span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span></span>
<a href="l488"></a><span id="l488">          <span class="delimiter">}</span> <span class="keyword">else</span></span>
<a href="l489"></a><span id="l489">            <span title="(x: scales.xml.IncompatibleQNameVersions)Some[scales.xml.IncompatibleQNameVersions]">Some</span><span class="delimiter">(</span><a href="#109927" title="(what: String)scales.xml.IncompatibleQNameVersions">IncompatibleQNameVersions</a><span class="delimiter">(</span><a href="#107727" title="(String, String)">x</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l490"></a><span id="l490">        <span class="delimiter">}</span></span>
<a href="l491"></a><span id="l491">      <span class="delimiter">}</span></span>
<a href="l492"></a><span id="l492"></span>
<a href="l493"></a><span id="l493">    <span class="delimiter">}</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l494"></a><span id="l494"></span>
<a href="l495"></a><span id="l495">      <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>._</span>
<a href="l496"></a><span id="l496"></span>
<a href="l497"></a><span id="l497">      <a href="#107486" title="Traversable[scales.xml.Attribute]">attribs</a>.<span title="(z: Option[Throwable])(op: (Option[Throwable], scales.xml.Attribute) =&gt; Option[Throwable])Option[Throwable]">foldLeft</span><span class="delimiter">(</span><span title="object None">None</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Option[Throwable]" id="107762">r</a>, <a title="scales.xml.Attribute" id="107763">x</a><span class="delimiter">)</span> =&gt;</span>
<a href="l498"></a><span id="l498">        <a href="#107762" title="Option[Throwable]">r</a> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l499"></a><span id="l499">          <span class="comment">// is the name valid</span></span>
<a href="l500"></a><span id="l500">          <span title="Option[Throwable]" class="keyword">if</span> <span class="delimiter">(</span><a href="#107485" title="scales.xml.QName">qName</a>.<a href="QName.scala.html#87935" title="=&gt; scales.xml.XmlVersion">qNameVersion</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="QName.scala.html#11781" title="object scales.xml.Xml11">Xml11</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#109096" title="=&gt; scales.xml.XmlVersion">version</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="QName.scala.html#11783" title="object scales.xml.Xml10">Xml10</a><span class="delimiter">)</span></span>
<a href="l501"></a><span id="l501">            <span title="(x: scales.xml.IncompatibleQNameVersions)Some[scales.xml.IncompatibleQNameVersions]">Some</span><span class="delimiter">(</span><a href="#109927" title="(what: String)scales.xml.IncompatibleQNameVersions">IncompatibleQNameVersions</a><span class="delimiter">(</span><a href="#107485" title="scales.xml.QName">qName</a>.<a href="QName.scala.html#87937" title="=&gt; java.lang.String">qName</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l502"></a><span id="l502">          <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l503"></a><span id="l503">            <span class="keyword">val</span> <a title="java.lang.String" id="107780">n</a> = <a href="#107763" title="scales.xml.Attribute">x</a>.<a href="XmlTypes.scala.html#87809" title="implicit scales.xml.XmlTypesImplicits.toQName : (attribQName: scales.xml.package.AttributeQName)scales.xml.QName">name</a>.<a href="QName.scala.html#87937" title="=&gt; java.lang.String">qName</a></span>
<a href="l504"></a><span id="l504">            <a href="#106643" title="(v1: String)Option[Throwable]">encMap</a><span class="delimiter">(</span><a href="#107780" title="java.lang.String">n</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span></span>
<a href="l505"></a><span id="l505">              <a href="#106653" title="(before: =&gt; String, toCt: =&gt; String, after: =&gt; String)Option[Throwable]">writeAttr</a><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#107780" title="java.lang.String">n</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=\&quot;&quot;)" class="string">&quot;=\&quot;&quot;</span>, <a href="#107763" title="scales.xml.Attribute">x</a>.<a href="XmlTypes.scala.html#87902" title="=&gt; String">value</a>, <span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span></span>
<a href="l506"></a><span id="l506">          <span class="delimiter">}</span></span>
<a href="l507"></a><span id="l507">        <span class="delimiter">}</span></span>
<a href="l508"></a><span id="l508">      <span class="delimiter">}</span></span>
<a href="l509"></a><span id="l509"></span>
<a href="l510"></a><span id="l510">    <span class="delimiter">}</span></span>
<a href="l511"></a><span id="l511">  <span class="delimiter">}</span></span>
<a href="l512"></a><span id="l512"></span>
<a href="l513"></a><span id="l513">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="106655">emptyElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="106673">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="106674">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="106675">namespaces</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="106676">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="106677">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> =</span>
<a href="l514"></a><span id="l514">    <a href="#106654" title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String])Option[Throwable]">doElem</a><span class="delimiter">(</span><a href="#106673" title="scales.xml.QName">qName</a>, <a href="#106674" title="Traversable[scales.xml.Attribute]">attributes</a>, <a href="#106675" title="scala.collection.immutable.Map[String,String]">namespaces</a>, <a href="#106676" title="Option[String]">declareDefaultNS</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l515"></a><span id="l515">      <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&gt;&quot;)" class="string">&quot;/&gt;&quot;</span><span class="delimiter">)</span></span>
<a href="l516"></a><span id="l516">      <span title="object None">None</span></span>
<a href="l517"></a><span id="l517">    <span class="delimiter">}</span></span>
<a href="l518"></a><span id="l518"></span>
<a href="l519"></a><span id="l519">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]" id="106656">startElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="106667">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="Traversable[scales.xml.Attribute]" id="106668">attributes</a>: <span title="Traversable[scales.xml.Attribute]">Traversable</span><span class="delimiter">[</span>Attribute<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="106669">namespaces</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Option[String]" id="106670">declareDefaultNS</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[scales.xml.QName]" id="106671">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> =</span>
<a href="l520"></a><span id="l520">    <a href="#106654" title="(qName: scales.xml.QName, attribs: Traversable[scales.xml.Attribute], ns: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String])Option[Throwable]">doElem</a><span class="delimiter">(</span><a href="#106667" title="scales.xml.QName">qName</a>, <a href="#106668" title="Traversable[scales.xml.Attribute]">attributes</a>, <a href="#106669" title="scala.collection.immutable.Map[String,String]">namespaces</a>, <a href="#106670" title="Option[String]">declareDefaultNS</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l521"></a><span id="l521">      <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span><span class="delimiter">)</span></span>
<a href="l522"></a><span id="l522">      <span title="object None">None</span></span>
<a href="l523"></a><span id="l523">    <span class="delimiter">}</span></span>
<a href="l524"></a><span id="l524"></span>
<a href="l525"></a><span id="l525">  <span class="keyword">def</span> <a title="(qName: scales.xml.QName, path: List[scales.xml.QName])Option[Throwable]" id="106657">endElement</a><span class="delimiter">(</span><a title="scales.xml.QName" id="106664">qName</a>: <a href="QName.scala.html#11797" title="scales.xml.QName">QName</a>, <a title="List[scales.xml.QName]" id="106665">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span></span>
<a href="l526"></a><span id="l526">    <a href="#109095" title="=&gt; java.io.Writer">out</a>.<span title="(x$1: java.lang.CharSequence)java.io.Writer">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;/&quot;)" class="string">&quot;&lt;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#106664" title="scales.xml.QName">qName</a>.<a href="QName.scala.html#87937" title="=&gt; java.lang.String">qName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span><span class="delimiter">)</span> <span class="comment">// to get here it must be valid</span></span>
<a href="l527"></a><span id="l527">    <span title="object None">None</span></span>
<a href="l528"></a><span id="l528">  <span class="delimiter">}</span></span>
<a href="l529"></a><span id="l529"></span>
<a href="l530"></a><span id="l530">  <span class="keyword">def</span> <a title="(encoding: java.nio.charset.Charset, version: scales.xml.XmlVersion)Option[Throwable]" id="106658">xmlDeclaration</a><span class="delimiter">(</span><a title="java.nio.charset.Charset" id="106661">encoding</a>: <span title="java.nio.charset.Charset">Charset</span>, <a title="scales.xml.XmlVersion" id="106662">version</a>: <a href="QName.scala.html#11780" title="scales.xml.XmlVersion">XmlVersion</a><span class="delimiter">)</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <a href="#11918" title="object scales.xml.SerializerHelpers">SerializerHelpers</a>.<a href="#106040" title="(out: java.io.Writer, encoding: java.nio.charset.Charset, version: scales.xml.XmlVersion)Option[Throwable]">xmlDecl</a><span class="delimiter">(</span><a href="#109095" title="=&gt; java.io.Writer">out</a>, <a href="#106661" title="java.nio.charset.Charset">encoding</a>, <a href="#106662" title="scales.xml.XmlVersion">version</a><span class="delimiter">)</span></span>
<a href="l531"></a><span id="l531"></span>
<a href="l532"></a><span id="l532"><span class="delimiter">}</span></span>
<a href="l533"></a><span id="l533"></span>
<a href="l534"></a><span id="l534"><span class="comment">/**</span>
<a href="l535"></a><span id="l535"> * Defaults to correctness and checking everything</span>
<a href="l536"></a><span id="l536"> * Possible approach to easily configuring some performance aspects</span>
<a href="l537"></a><span id="l537"> * I.e. the are really sure that after the 100th time of sending the same</span>
<a href="l538"></a><span id="l538"> * message template they don't need to verify the QNames again.</span>
<a href="l539"></a><span id="l539"> *</span>
<a href="l540"></a><span id="l540"> * case class SerializationOptions(</span>
<a href="l541"></a><span id="l541"> * checkCDataEncoding : Boolean = true,</span>
<a href="l542"></a><span id="l542"> * checkCommentEncoding : Boolean = true,</span>
<a href="l543"></a><span id="l543"> * checkPIEncoding : Boolean = true,</span>
<a href="l544"></a><span id="l544"> * checkNSDeclPrefix : Boolean = true,</span>
<a href="l545"></a><span id="l545"> * checkNSDeclPrefixEncoding : Boolean = true,</span>
<a href="l546"></a><span id="l546"> * check</span>
<a href="l547"></a><span id="l547"> * )</span>
<a href="l548"></a><span id="l548"> */</span></span>
<a href="l549"></a><span id="l549"></span>
<a href="l550"></a><span id="l550"><span class="comment">/**</span>
<a href="l551"></a><span id="l551"> * This class represents state during a serialization</span>
<a href="l552"></a><span id="l552"> */</span></span>
<a href="l553"></a><span id="l553">case <span class="keyword">class</span> <a title="class XmlOutput extends java.lang.Object with ScalaObject with Product with Serializable" id="109923">XmlOutput</a><a href="#109923" title="ScalaObject" class="delimiter">(</a><a title="scales.xml.SerializerData" id="109537">data</a>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a>,</span>
<a href="l554"></a><span id="l554">  <a title="scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]" id="109538">currentMappings</a>: <span title="scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]">Stack</span><span class="delimiter">[</span>Map<span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="[A](elems: A*)scala.collection.immutable.Stack[A]">Stack</span><span title="(elems: scala.collection.immutable.Map[String,String]*)scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]" class="delimiter">[</span><span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(elem: scala.collection.immutable.Map[String,String])scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]">push</span><span class="delimiter">(</span></span>
<a href="l555"></a><span id="l555">    <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]" class="delimiter">[</span><span title="String">String</span>, <span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(kv: (String, String))scala.collection.immutable.Map[String,String]">+</span> <span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="comment">// default namespace </span></span>
<a href="l556"></a><span id="l556">    <span class="delimiter">)</span>, <a title="List[scales.xml.QName]" id="109539">path</a>: <span title="List[scales.xml.QName]">List</span><span class="delimiter">[</span>QName<span class="delimiter">]</span> = List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.SerializerFactory" id="109540">serializerFI</a>: <a href="#11917" title="scales.xml.SerializerFactory">SerializerFactory</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l557"></a><span id="l557">  <span class="keyword">val</span> <a title="scales.xml.SerializerFactory" id="89937">serializerF</a> = <a href="#109540" title="scales.xml.SerializerFactory">serializerFI</a></span>
<a href="l558"></a><span id="l558"><span class="delimiter">}</span></span>
<a href="l559"></a><span id="l559"></span>
<a href="l560"></a><span id="l560"><span class="keyword">trait</span> <a title="trait XmlPrinterImplicits extends java.lang.Object with ScalaObject" id="11958">XmlPrinterImplicits</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l561"></a><span id="l561">  <span class="comment">/**</span>
<a href="l562"></a><span id="l562">   * Import to _ and replace with your own SerializerFactory if desired</span>
<a href="l563"></a><span id="l563">   */</span></span>
<a href="l564"></a><span id="l564">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.LSSerializerFactory.type" id="87870">defaultSerializerFactory</a> = <a href="#11947" title="object scales.xml.LSSerializerFactory">LSSerializerFactory</a></span>
<a href="l565"></a><span id="l565"></span>
<a href="l566"></a><span id="l566">  case <span class="keyword">class</span> <a title="class DeclarationConverter extends java.lang.Object with ScalaObject with Product with Serializable" id="90055">DeclarationConverter</a><a href="#90055" title="ScalaObject" class="delimiter">(</a><a title="scales.xml.Declaration" id="90063">decl</a>: <a href="XmlTypes.scala.html#12011" title="scales.xml.Declaration">Declaration</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l567"></a><span id="l567">    <span class="keyword">def</span> <a title="(out: java.io.Writer)scales.xml.SerializerData" id="90060">withWriter</a><span class="delimiter">(</span><a title="java.io.Writer" id="108034">out</a>: <span title="java.io.Writer">Writer</span><span class="delimiter">)</span>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a> = scales.xml.<a href="#12489" title="(decl: scales.xml.Declaration, out: java.io.Writer)scales.xml.SerializerData">withWriter</a><span class="delimiter">(</span><a href="#90063" title="=&gt; scales.xml.Declaration">decl</a>, <a href="#108034" title="java.io.Writer">out</a><span class="delimiter">)</span></span>
<a href="l568"></a><span id="l568">  <span class="delimiter">}</span></span>
<a href="l569"></a><span id="l569"></span>
<a href="l570"></a><span id="l570">  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scales.xml.XmlPrinterImplicits.toWithWriter : (decl: scales.xml.Declaration)XmlPrinterImplicits.this.DeclarationConverter" id="87875">toWithWriter</a><span class="delimiter">(</span><a title="scales.xml.Declaration" id="90050">decl</a>: <a href="XmlTypes.scala.html#12011" title="scales.xml.Declaration">Declaration</a><span class="delimiter">)</span> = <a href="#90055" title="(decl: scales.xml.Declaration)XmlPrinterImplicits.this.DeclarationConverter">DeclarationConverter</a><span class="delimiter">(</span><a href="#90050" title="scales.xml.Declaration">decl</a><span class="delimiter">)</span></span>
<a href="l571"></a><span id="l571"></span>
<a href="l572"></a><span id="l572">  <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>._</span>
<a href="l573"></a><span id="l573"></span>
<a href="l574"></a><span id="l574">  <span class="comment">/**</span>
<a href="l575"></a><span id="l575">   * The following implicits are essential so I'm keeping them here</span>
<a href="l576"></a><span id="l576">   */</span></span>
<a href="l577"></a><span id="l577"></span>
<a href="l578"></a><span id="l578">  <span class="comment">/**</span>
<a href="l579"></a><span id="l579">   * Serializes an XmlTree</span>
<a href="l580"></a><span id="l580">   */</span></span>
<a href="l581"></a><span id="l581">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.package.SerializeableXml[scales.xml.package.XmlTree]" id="87877">treeSerializeable</a>: <a href="#12492" title="scales.xml.package.SerializeableXml[scales.xml.package.XmlTree]">SerializeableXml</a><span class="delimiter">[</span>XmlTree<span class="delimiter">]</span> = <a href="#108079" title="java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.package.XmlTree]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.package.XmlTree]" id="108079">SerializeableXml</a><span class="delimiter">[</span>XmlTree<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l582"></a><span id="l582">    <span class="keyword">def</span> <a title="(it: scales.xml.package.XmlTree)scales.xml.Doc" id="108083">doc</a><span class="delimiter">(</span><a title="scales.xml.package.XmlTree" id="108085">it</a>: <a href="../utils/Trees.scala.html#10655" title="scales.xml.package.XmlTree">XmlTree</a><span class="delimiter">)</span> = <a href="XmlTypes.scala.html#89984" title="(rootElem: scales.xml.package.XmlTree, prolog: scales.xml.Prolog, end: scales.xml.EndMisc)scales.xml.Doc">Doc</a><span class="delimiter">(</span><a href="#108085" title="scales.xml.package.XmlTree">it</a><span class="delimiter">)</span></span>
<a href="l583"></a><span id="l583">    <span class="keyword">def</span> <a title="(it: scales.xml.package.XmlTree)(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])" id="108084">apply</a><span class="delimiter">(</span><a title="scales.xml.package.XmlTree" id="108092">it</a>: <a href="../utils/Trees.scala.html#10655" title="scales.xml.package.XmlTree">XmlTree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="108093">out</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="scales.xml.Serializer" id="108094">serializer</a>: <a href="#11913" title="scales.xml.Serializer">Serializer</a><span class="delimiter">)</span>: <span title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> =</span>
<a href="l584"></a><span id="l584"></span>
<a href="l585"></a><span id="l585">      <a href="../utils/Trees.scala.html#12194" title="[Item &lt;: scales.utils.LeftLike[Item,scales.utils.Tree[Item,Section,CC]], Section, CC[X] &lt;: scala.collection.IndexedSeqLike[X,CC[X]], A](a: A)(folder: (scales.utils.package.ItemOrSectionWalk[Item,Section], A) =&gt; A)(tree: scales.utils.Tree[Item,Section,CC])A">fold</a><span title="(a: (scales.xml.XmlOutput, Option[Throwable]))(folder: (scales.utils.package.ItemOrSectionWalk[scales.xml.XmlItem,scales.xml.Elem], (scales.xml.XmlOutput, Option[Throwable])) =&gt; (scales.xml.XmlOutput, Option[Throwable]))(tree: scales.utils.Tree[scales.xml.XmlItem,scales.xml.Elem,scales.xml.package.XCC])(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">[</span><a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a>, <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a>, <a href="../utils/ImmutableArray.scala.html#10380" title="scales.xml.package.XCC">XCC</a>, <span title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="(_1: scales.xml.XmlOutput, _2: None.type)(scales.xml.XmlOutput, None.type)" class="delimiter">(</span><a href="#108093" title="scales.xml.XmlOutput">out</a>, <span title="object None">None</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="scales.utils.package.ItemOrSectionWalk[scales.xml.XmlItem,scales.xml.Elem]" id="108111">iorsw</a>, <a title="(scales.xml.XmlOutput, Option[Throwable])" id="108112">pair</a><span class="delimiter">)</span> =&gt;</span>
<a href="l586"></a><span id="l586">        <span class="keyword">val</span> <a href="#108114" title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</a><a href="#108113" title="scales.xml.XmlOutput" id="108114">output</a>, <a href="#108113" title="Option[Throwable]" id="108115">y</a><span class="delimiter">)</span> = <a href="#108112" title="(scales.xml.XmlOutput, Option[Throwable])">pair</a></span>
<a href="l587"></a><span id="l587"></span>
<a href="l588"></a><span id="l588">        <span title="(scales.xml.XmlOutput, Option[Throwable])" class="keyword">if</span> <span class="delimiter">(</span><a href="#108115" title="Option[Throwable]">y</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#108112" title="(scales.xml.XmlOutput, Option[Throwable])">pair</a></span>
<a href="l589"></a><span id="l589">        <span class="keyword">else</span></span>
<a href="l590"></a><span id="l590">          <a href="#108111" title="scales.utils.package.ItemOrSectionWalk[scales.xml.XmlItem,scales.xml.Elem]">iorsw</a> <span title="(scales.xml.XmlOutput, Option[Throwable])" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l591"></a><span id="l591">            <span class="keyword">case</span> <span title="(scales.xml.XmlOutput, Option[Throwable])">Left</span><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="108127">item</a><span class="delimiter">)</span> =&gt; <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable])(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span><a href="#108114" title="scales.xml.XmlOutput">output</a>, <a href="#108094" title="scales.xml.Serializer">serializer</a>.<a href="#89940" title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">item</a><span class="delimiter">(</span><a href="#108127" title="scales.xml.XmlItem">item</a>, <a href="#108114" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l592"></a><span id="l592">            <span class="keyword">case</span> <span title="(scales.xml.XmlOutput, Option[Throwable])">Right</span><span class="delimiter">(</span><a title="scales.utils.SectionWalk[scales.xml.Elem]" id="108135">walk</a><span class="delimiter">)</span> =&gt;</span>
<a href="l593"></a><span id="l593">              <span class="keyword">val</span> <a title="scales.xml.Elem" id="108136">x</a> = <a href="#108135" title="scales.utils.SectionWalk[scales.xml.Elem]">walk</a>.<a href="../utils/Trees.scala.html#87375" title="=&gt; scales.xml.Elem">section</a></span>
<a href="l594"></a><span id="l594">              <span title="(scales.xml.XmlOutput, Option[Throwable])" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#108135" title="scales.utils.SectionWalk[scales.xml.Elem]">walk</a>.<a href="../utils/Trees.scala.html#87377" title="=&gt; Boolean">hasChildren</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l595"></a><span id="l595"></span>
<a href="l596"></a><span id="l596">                <span class="comment">// x.namespaces can't be used any further</span></span>
<a href="l597"></a><span id="l597">                <span class="keyword">val</span> <a href="#108138" title="(scala.collection.immutable.Map[String,String], scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String])" class="delimiter">(</a><a href="#108137" title="scala.collection.immutable.Map[String,String]" id="108138">mappings</a>, <span class="delimiter">(</span><a href="#108137" title="scales.xml.package.Attributes" id="108139">attribs</a>, <a href="#108137" title="scala.collection.immutable.Map[String,String]" id="108140">declMap</a>, <a href="#108137" title="Option[String]" id="108141">addDef</a><span class="delimiter">)</span><span class="delimiter">)</span> = <a href="#12488" title="(x: scales.xml.Elem, out: scales.xml.XmlOutput)(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String]))">doElement</a><span title="(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String])) @unchecked" class="delimiter">(</span><a href="#108136" title="scales.xml.Elem">x</a>, <a href="#108114" title="scales.xml.XmlOutput">output</a><span class="delimiter">)</span></span>
<a href="l598"></a><span id="l598">                <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable])(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span><a href="#108114" title="scales.xml.XmlOutput">output</a>, <a href="#108094" title="scales.xml.Serializer">serializer</a>.<a href="#89941" title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]">emptyElement</a><span class="delimiter">(</span><a href="#108136" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>, <a href="#108139" title="scales.xml.package.Attributes">attribs</a>, <a href="#108140" title="scala.collection.immutable.Map[String,String]">declMap</a>, <a href="#108141" title="Option[String]">addDef</a>, <a href="#108136" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a> <a href="#108677" title="(x: scales.xml.QName)List[scales.xml.QName]">::</a> <a href="#108114" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l599"></a><span id="l599">              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l600"></a><span id="l600">                <span title="(scales.xml.XmlOutput, Option[Throwable])" class="keyword">if</span> <span class="delimiter">(</span><a href="#108135" title="scales.utils.SectionWalk[scales.xml.Elem]">walk</a>.<a href="../utils/Trees.scala.html#87379" title="=&gt; Boolean">isStart</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l601"></a><span id="l601"></span>
<a href="l602"></a><span id="l602">                  <span class="keyword">val</span> <a title="List[scales.xml.QName]" id="108685">npath</a> = <a href="#108136" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a> <a href="#108691" title="(x: scales.xml.QName)List[scales.xml.QName]">::</a> <a href="#108114" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a></span>
<a href="l603"></a><span id="l603"></span>
<a href="l604"></a><span id="l604">                  <span class="keyword">val</span> <a href="#108687" title="(scala.collection.immutable.Map[String,String], scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String])" class="delimiter">(</a><a href="#108686" title="scala.collection.immutable.Map[String,String]" id="108687">mappings</a>, <span class="delimiter">(</span><a href="#108686" title="scales.xml.package.Attributes" id="108688">attribs</a>, <a href="#108686" title="scala.collection.immutable.Map[String,String]" id="108689">declMap</a>, <a href="#108686" title="Option[String]" id="108690">addDef</a><span class="delimiter">)</span><span class="delimiter">)</span> = <a href="#12488" title="(x: scales.xml.Elem, out: scales.xml.XmlOutput)(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String]))">doElement</a><span title="(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String])) @unchecked" class="delimiter">(</span><a href="#108136" title="scales.xml.Elem">x</a>, <a href="#108114" title="scales.xml.XmlOutput">output</a><span class="delimiter">)</span></span>
<a href="l605"></a><span id="l605"></span>
<a href="l606"></a><span id="l606">                  <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable])(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span><a href="#108114" title="scales.xml.XmlOutput">output</a>.<a href="#109537" title="scales.xml.SerializerData" id="108739">copy</a><a href="#87870" title="=&gt; scales.xml.LSSerializerFactory.type" class="delimiter">(</a>currentMappings = <a href="#108114" title="scales.xml.XmlOutput">output</a>.<a href="#109538" title="=&gt; scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]">currentMappings</a>.<span title="(elem: scala.collection.immutable.Map[String,String])scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]">push</span><a title="scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]" id="108737" class="delimiter">(</a><a href="#108687" title="scala.collection.immutable.Map[String,String]">mappings</a><span class="delimiter">)</span>,</span>
<a href="l607"></a><span id="l607">                    path = <a href="#108685" title="List[scales.xml.QName]" id="108738">npath</a><span class="delimiter">)</span>,</span>
<a href="l608"></a><span id="l608">                    <a href="#108094" title="scales.xml.Serializer">serializer</a>.<a href="#89942" title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]">startElement</a><span class="delimiter">(</span><a href="#108136" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>, <a href="#108688" title="scales.xml.package.Attributes">attribs</a>, <a href="#108689" title="scala.collection.immutable.Map[String,String]">declMap</a>, <a href="#108690" title="Option[String]">addDef</a>, <a href="#108685" title="List[scales.xml.QName]">npath</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l609"></a><span id="l609">                <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l610"></a><span id="l610">                  <span class="comment">// pop the last ones</span></span>
<a href="l611"></a><span id="l611">                  <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable])(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span><a href="#108114" title="scales.xml.XmlOutput">output</a>.<a href="#109537" title="scales.xml.SerializerData" id="108750">copy</a><a href="#87870" title="=&gt; scales.xml.LSSerializerFactory.type" class="delimiter">(</a>currentMappings = <a href="#108114" title="scales.xml.XmlOutput">output</a>.<a href="#109538" title="=&gt; scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]">currentMappings</a>.<a title="scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]" id="108748">pop</a>,</span>
<a href="l612"></a><span id="l612">                    path = <a href="#108114" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a>.<a title="List[scales.xml.QName]" id="108749">tail</a><span class="delimiter">)</span>, <a href="#108094" title="scales.xml.Serializer">serializer</a>.<a href="#89943" title="(qName: scales.xml.QName, path: List[scales.xml.QName])Option[Throwable]">endElement</a><span class="delimiter">(</span><a href="#108136" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>, <a href="#108114" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l613"></a><span id="l613">                <span class="delimiter">}</span></span>
<a href="l614"></a><span id="l614">              <span class="delimiter">}</span></span>
<a href="l615"></a><span id="l615">          <span class="delimiter">}</span></span>
<a href="l616"></a><span id="l616">      <span class="delimiter">}</span><span class="delimiter">(</span><a href="#108092" title="scales.xml.package.XmlTree">it</a><span class="delimiter">)</span></span>
<a href="l617"></a><span id="l617">  <span class="delimiter">}</span></span>
<a href="l618"></a><span id="l618"></span>
<a href="l619"></a><span id="l619">  <span class="comment">/**</span>
<a href="l620"></a><span id="l620">   * Serializes a DslBuilder</span>
<a href="l621"></a><span id="l621">   */</span></span>
<a href="l622"></a><span id="l622">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="builderSerializeable extends java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.DslBuilder]" id="87879">builderSerializeable</a> = <a href="#89969" title="java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.DslBuilder]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.DslBuilder]" id="89969">SerializeableXml</a><span class="delimiter">[</span>DslBuilder<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l623"></a><span id="l623">    <span class="keyword">def</span> <a title="(it: scales.xml.DslBuilder)scales.xml.Doc" id="89971">doc</a><span class="delimiter">(</span><a title="scales.xml.DslBuilder" id="89973">it</a>: <a href="XmlDSL.scala.html#11855" title="scales.xml.DslBuilder">DslBuilder</a><span class="delimiter">)</span> = <a href="XmlTypes.scala.html#89984" title="(rootElem: scales.xml.package.XmlTree, prolog: scales.xml.Prolog, end: scales.xml.EndMisc)scales.xml.Doc">Doc</a><span class="delimiter">(</span><a href="#89973" title="scales.xml.DslBuilder">it</a>.<a href="XmlDSL.scala.html#90015" title="=&gt; scales.xml.package.XmlTree">toTree</a><span class="delimiter">)</span></span>
<a href="l624"></a><span id="l624">    <span class="keyword">def</span> <a title="(it: scales.xml.DslBuilder)(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])" id="89972">apply</a><span class="delimiter">(</span><a title="scales.xml.DslBuilder" id="90019">it</a>: <a href="XmlDSL.scala.html#11855" title="scales.xml.DslBuilder">DslBuilder</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="90020">out</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="scales.xml.Serializer" id="90021">serializer</a>: <a href="#11913" title="scales.xml.Serializer">Serializer</a><span class="delimiter">)</span>: <span title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#89865" title="(it: scales.xml.package.XmlTree)(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])">treeSerializeable</a><span class="delimiter">(</span><a href="#90019" title="scales.xml.DslBuilder">it</a>.<a href="XmlDSL.scala.html#90015" title="=&gt; scales.xml.package.XmlTree">toTree</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#90020" title="scales.xml.XmlOutput">out</a>, <a href="#90021" title="scales.xml.Serializer">serializer</a><span class="delimiter">)</span></span>
<a href="l625"></a><span id="l625">  <span class="delimiter">}</span></span>
<a href="l626"></a><span id="l626"></span>
<a href="l627"></a><span id="l627">  <span class="comment">/**</span>
<a href="l628"></a><span id="l628">   * Serializes a Doc (Wrapped XmlTree)</span>
<a href="l629"></a><span id="l629">   */</span></span>
<a href="l630"></a><span id="l630">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="docSerializeable extends java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.Doc]" id="87881">docSerializeable</a> = <a href="#89906" title="java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.Doc]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.Doc]" id="89906">SerializeableXml</a><span class="delimiter">[</span>Doc<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l631"></a><span id="l631">    <span class="keyword">def</span> <a title="(it: scales.xml.Doc)scales.xml.Doc" id="89908">doc</a><span class="delimiter">(</span><a title="scales.xml.Doc" id="89910">it</a>: <a href="XmlTypes.scala.html#12027" title="scales.xml.Doc">Doc</a><span class="delimiter">)</span> = <a href="#89910" title="scales.xml.Doc">it</a></span>
<a href="l632"></a><span id="l632">    <span class="keyword">def</span> <a title="(it: scales.xml.Doc)(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])" id="89909">apply</a><span class="delimiter">(</span><a title="scales.xml.Doc" id="89915">it</a>: <a href="XmlTypes.scala.html#12027" title="scales.xml.Doc">Doc</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="89916">out</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="scales.xml.Serializer" id="89917">serializer</a>: <a href="#11913" title="scales.xml.Serializer">Serializer</a><span class="delimiter">)</span>: <span title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#89865" title="(it: scales.xml.package.XmlTree)(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])">treeSerializeable</a><span class="delimiter">(</span><a href="#89915" title="scales.xml.Doc">it</a>.<a href="XmlTypes.scala.html#89600" title="=&gt; scales.xml.package.XmlTree">rootElem</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#89916" title="scales.xml.XmlOutput">out</a>, <a href="#89917" title="scales.xml.Serializer">serializer</a><span class="delimiter">)</span></span>
<a href="l633"></a><span id="l633">  <span class="delimiter">}</span></span>
<a href="l634"></a><span id="l634"></span>
<a href="l635"></a><span id="l635">  <span class="comment">/**</span>
<a href="l636"></a><span id="l636">   * Serializes an Xml Stream</span>
<a href="l637"></a><span id="l637">   */</span></span>
<a href="l638"></a><span id="l638">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.package.SerializeableXml[Iterator[scales.xml.package.PullType]]" id="87883">streamSerializeable</a>: <a href="#12492" title="scales.xml.package.SerializeableXml[Iterator[scales.xml.package.PullType]]">SerializeableXml</a><span class="delimiter">[</span>Iterator<span class="delimiter">[</span>PullType<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#108753" title="java.lang.Object with scales.xml.package.SerializeableXml[Iterator[scales.xml.package.PullType]]{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.package.SerializeableXml[Iterator[scales.xml.package.PullType]]" id="108753">SerializeableXml</a><span class="delimiter">[</span>Iterator<span class="delimiter">[</span>PullType<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l639"></a><span id="l639"></span>
<a href="l640"></a><span id="l640">    <span class="keyword">val</span> <a title="Iterable[scales.xml.package.PullType]" id="108757">dummy</a>: <span title="Iterable[scales.xml.package.PullType]">Iterable</span><span class="delimiter">[</span>PullType<span class="delimiter">]</span> = <span title="(xs: Left[scales.xml.Elem,Nothing]*)List[Left[scales.xml.Elem,Nothing]]">List</span><span class="delimiter">(</span><span title="(a: scales.xml.Elem)Left[scales.xml.Elem,Nothing]">Left</span><span class="delimiter">(</span><a href="XmlTypes.scala.html#88402" title="(namei: scales.xml.QName, attributesi: scales.xml.package.Attributes, namespacesi: scala.collection.immutable.Map[String,String])(implicit fromParser: scales.xml.FromParser)scales.xml.Elem">Elem</a><a href="XmlTypes.scala.html#87816" title="=&gt; scales.xml.FromParser" class="delimiter">(</a><a href="QName.scala.html#87862" title="implicit scales.xml.QNameImplicits.localStringToNSBuilder : (local: String)(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)java.lang.Object{def ::(namespace: String): java.lang.Object with scales.xml.UnprefixedQName; def l(implicit ver: scales.xml.XmlVersion,implicit fromParser: scales.xml.FromParser): java.lang.Object with scales.xml.NoNamespaceQName}" class="string">&quot;dummy&quot;</a><a href="QName.scala.html#90237" title="(implicit ver: scales.xml.XmlVersion, implicit fromParser: scales.xml.FromParser)java.lang.Object with scales.xml.NoNamespaceQName">l</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l641"></a><span id="l641"></span>
<a href="l642"></a><span id="l642">    <span class="keyword">def</span> <a title="(it: Iterator[scales.xml.package.PullType])scales.xml.EmptyDoc" id="108759">doc</a><span class="delimiter">(</span><a title="Iterator[scales.xml.package.PullType]" id="108761">it</a>: <span title="Iterator[scales.xml.package.PullType]">Iterator</span><span class="delimiter">[</span>PullType<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="XmlTypes.scala.html#94491" title="(prolog: scales.xml.Prolog, end: scales.xml.EndMisc)scales.xml.EmptyDoc">EmptyDoc</a><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l643"></a><span id="l643">    <span class="keyword">def</span> <a title="(it: Iterator[scales.xml.package.PullType])(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])" id="108760">apply</a><span class="delimiter">(</span><a title="Iterator[scales.xml.package.PullType]" id="108767">it</a>: <span title="Iterator[scales.xml.package.PullType]">Iterator</span><span class="delimiter">[</span>PullType<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="108768">out</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="scales.xml.Serializer" id="108769">serializer</a>: <a href="#11913" title="scales.xml.Serializer">Serializer</a><span class="delimiter">)</span>: <span title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span></span>
<a href="l644"></a><span id="l644">      <span class="comment">// left of the sequence is our actual, </span></span>
<a href="l645"></a><span id="l645">      <span class="keyword">val</span> <a title="(scales.xml.XmlOutput, Option[Throwable], Boolean)" id="108793">r</a> = <a href="#108767" title="Iterator[scales.xml.package.PullType]">it</a>.<span title="(that: =&gt; scala.collection.GenTraversableOnce[scales.xml.package.PullType])Iterator[scales.xml.package.PullType]">++</span><a title="Iterator[scales.xml.package.PullType]" id="108804" class="delimiter">(</a><a href="#108757" title="=&gt; Iterable[scales.xml.package.PullType]">dummy</a>.<span title="=&gt; Iterator[scales.xml.package.PullType]">iterator</span><span class="delimiter">)</span>.<a href="#108804" title="Int" id="108808">sliding</a><span class="delimiter">(</span><a title="Int(2)" id="108807" class="int">2</a><span class="delimiter">)</span>.<span title="(z: (scales.xml.XmlOutput, Option[Throwable], Boolean))(op: ((scales.xml.XmlOutput, Option[Throwable], Boolean), Seq[Either[scales.xml.XmlEvent,scales.xml.EndElem]]) =&gt; (scales.xml.XmlOutput, Option[Throwable], Boolean))(scales.xml.XmlOutput, Option[Throwable], Boolean)">foldLeft</span><span class="delimiter">(</span><span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable], _3: Boolean)(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="delimiter">(</span><a href="#108768" title="scales.xml.XmlOutput">out</a>, <span title="object None">None</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="(scales.xml.XmlOutput, Option[Throwable], Boolean)" id="108834">cur</a>, <a title="Seq[Either[scales.xml.XmlEvent,scales.xml.EndElem]]" id="108835">two</a><span class="delimiter">)</span> =&gt;</span>
<a href="l646"></a><span id="l646">        <span class="keyword">val</span> <a href="#108837" title="(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="delimiter">(</a><a href="#108836" title="scales.xml.XmlOutput" id="108837">output</a>, <a href="#108836" title="Option[Throwable]" id="108838">y</a>, <a href="#108836" title="Boolean" id="108839">isEmpty</a><span class="delimiter">)</span> = <a href="#108834" title="(scales.xml.XmlOutput, Option[Throwable], Boolean)">cur</a></span>
<a href="l647"></a><span id="l647">        <span title="(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="keyword">if</span> <span class="delimiter">(</span><a href="#108838" title="Option[Throwable]">y</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#108834" title="(scales.xml.XmlOutput, Option[Throwable], Boolean)">cur</a></span>
<a href="l648"></a><span id="l648">        <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l649"></a><span id="l649">          <span class="keyword">val</span> <a href="#108860" title="(x: List[Either[scales.xml.XmlEvent,scales.xml.EndElem]])Some[List[Either[scales.xml.XmlEvent,scales.xml.EndElem]]]">List</a><a href="#108856" title="(Either[scales.xml.XmlEvent,scales.xml.EndElem], Either[scales.xml.XmlEvent,scales.xml.EndElem])" class="delimiter">(</a><a href="#108855" title="Either[scales.xml.XmlEvent,scales.xml.EndElem]" id="108856">ev</a>, <a href="#108855" title="Either[scales.xml.XmlEvent,scales.xml.EndElem]" id="108857">next</a><span class="delimiter">)</span> = <a href="#108835" title="Seq[Either[scales.xml.XmlEvent,scales.xml.EndElem]]">two</a>.<span title="=&gt; List[Either[scales.xml.XmlEvent,scales.xml.EndElem]]">toList</span></span>
<a href="l650"></a><span id="l650">          <a href="#108856" title="Either[scales.xml.XmlEvent,scales.xml.EndElem]">ev</a> <span title="(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="keyword">match</span> <span class="delimiter">{</span></span>
<a href="l651"></a><span id="l651">            <span class="keyword">case</span> <span title="(scales.xml.XmlOutput, Option[Throwable], Boolean)">Left</span><span class="delimiter">(</span><a title="scales.xml.XmlItem" id="108891">i</a>: <a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a><span class="delimiter">)</span> =&gt;</span>
<a href="l652"></a><span id="l652">              <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable], _3: Boolean)(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="delimiter">(</span><a href="#108837" title="scales.xml.XmlOutput">output</a>, <a href="#108769" title="scales.xml.Serializer">serializer</a>.<a href="#89940" title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">item</a><span class="delimiter">(</span><a href="#108891" title="scales.xml.XmlItem">i</a>, <a href="#108837" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span></span>
<a href="l653"></a><span id="l653">            <span class="keyword">case</span> <span title="(scales.xml.XmlOutput, Option[Throwable], Boolean)">Left</span><span class="delimiter">(</span><a title="scales.xml.Elem" id="108902">x</a>: <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a><span class="delimiter">)</span> =&gt;</span>
<a href="l654"></a><span id="l654">              <span class="comment">// if next is an end elem then its an empty</span></span>
<a href="l655"></a><span id="l655">              <span title="(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="keyword">if</span> <span class="delimiter">(</span><a href="#108857" title="Either[scales.xml.XmlEvent,scales.xml.EndElem]">next</a>.<span title="=&gt; Boolean">isRight</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l656"></a><span id="l656"></span>
<a href="l657"></a><span id="l657">                <span class="comment">// x.namespaces can't be used any further</span></span>
<a href="l658"></a><span id="l658">                <span class="keyword">val</span> <a href="#108904" title="(scala.collection.immutable.Map[String,String], scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String])" class="delimiter">(</a><a href="#108903" title="scala.collection.immutable.Map[String,String]" id="108904">mappings</a>, <span class="delimiter">(</span><a href="#108903" title="scales.xml.package.Attributes" id="108905">attribs</a>, <a href="#108903" title="scala.collection.immutable.Map[String,String]" id="108906">declMap</a>, <a href="#108903" title="Option[String]" id="108907">addDef</a><span class="delimiter">)</span><span class="delimiter">)</span> = <a href="#12488" title="(x: scales.xml.Elem, out: scales.xml.XmlOutput)(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String]))">doElement</a><span title="(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String])) @unchecked" class="delimiter">(</span><a href="#108902" title="scales.xml.Elem">x</a>, <a href="#108837" title="scales.xml.XmlOutput">output</a><span class="delimiter">)</span></span>
<a href="l659"></a><span id="l659">                <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable], _3: Boolean)(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="delimiter">(</span><a href="#108837" title="scales.xml.XmlOutput">output</a>, <a href="#108769" title="scales.xml.Serializer">serializer</a>.<a href="#89941" title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]">emptyElement</a><span class="delimiter">(</span><a href="#108902" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>, <a href="#108905" title="scales.xml.package.Attributes">attribs</a>, <a href="#108906" title="scala.collection.immutable.Map[String,String]">declMap</a>, <a href="#108907" title="Option[String]">addDef</a>, <a href="#108902" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a> <a href="#108935" title="(x: scales.xml.QName)List[scales.xml.QName]">::</a> <a href="#108837" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="comment">// let us know to ignore the next end</span></span>
<a href="l660"></a><span id="l660">              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l661"></a><span id="l661">                <span class="keyword">val</span> <a title="List[scales.xml.QName]" id="108944">npath</a> = <a href="#108902" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a> <a href="#108950" title="(x: scales.xml.QName)List[scales.xml.QName]">::</a> <a href="#108837" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a></span>
<a href="l662"></a><span id="l662"></span>
<a href="l663"></a><span id="l663">                <span class="keyword">val</span> <a href="#108946" title="(scala.collection.immutable.Map[String,String], scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String])" class="delimiter">(</a><a href="#108945" title="scala.collection.immutable.Map[String,String]" id="108946">mappings</a>, <span class="delimiter">(</span><a href="#108945" title="scales.xml.package.Attributes" id="108947">attribs</a>, <a href="#108945" title="scala.collection.immutable.Map[String,String]" id="108948">declMap</a>, <a href="#108945" title="Option[String]" id="108949">addDef</a><span class="delimiter">)</span><span class="delimiter">)</span> = <a href="#12488" title="(x: scales.xml.Elem, out: scales.xml.XmlOutput)(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String]))">doElement</a><span title="(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String])) @unchecked" class="delimiter">(</span><a href="#108902" title="scales.xml.Elem">x</a>, <a href="#108837" title="scales.xml.XmlOutput">output</a><span class="delimiter">)</span></span>
<a href="l664"></a><span id="l664"></span>
<a href="l665"></a><span id="l665">                <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable], _3: Boolean)(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="delimiter">(</span><a href="#108837" title="scales.xml.XmlOutput">output</a>.<a href="#109537" title="scales.xml.SerializerData" id="109000">copy</a><a href="#87870" title="=&gt; scales.xml.LSSerializerFactory.type" class="delimiter">(</a>currentMappings = <a href="#108837" title="scales.xml.XmlOutput">output</a>.<a href="#109538" title="=&gt; scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]">currentMappings</a>.<span title="(elem: scala.collection.immutable.Map[String,String])scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]">push</span><a title="scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]" id="108998" class="delimiter">(</a><a href="#108946" title="scala.collection.immutable.Map[String,String]">mappings</a><span class="delimiter">)</span>, path = <a href="#108944" title="List[scales.xml.QName]" id="108999">npath</a><span class="delimiter">)</span>,</span>
<a href="l666"></a><span id="l666">                  <a href="#108769" title="scales.xml.Serializer">serializer</a>.<a href="#89942" title="(qName: scales.xml.QName, attributes: Traversable[scales.xml.Attribute], namespaces: scala.collection.immutable.Map[String,String], declareDefaultNS: Option[String], path: List[scales.xml.QName])Option[Throwable]">startElement</a><span class="delimiter">(</span><a href="#108902" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>, <a href="#108947" title="scales.xml.package.Attributes">attribs</a>, <a href="#108948" title="scala.collection.immutable.Map[String,String]">declMap</a>, <a href="#108949" title="Option[String]">addDef</a>, <a href="#108944" title="List[scales.xml.QName]">npath</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span></span>
<a href="l667"></a><span id="l667">              <span class="delimiter">}</span></span>
<a href="l668"></a><span id="l668">            <span class="keyword">case</span> <span title="(scales.xml.XmlOutput, Option[Throwable], Boolean)">Right</span><span class="delimiter">(</span><a title="scales.xml.EndElem" id="109005">endElem</a><span class="delimiter">)</span> =&gt;</span>
<a href="l669"></a><span id="l669">              <span title="(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="keyword">if</span> <span class="delimiter">(</span><a href="#108839" title="Boolean">isEmpty</a><span class="delimiter">)</span></span>
<a href="l670"></a><span id="l670">                <span title="(_1: scales.xml.XmlOutput, _2: None.type, _3: Boolean)(scales.xml.XmlOutput, None.type, Boolean)" class="delimiter">(</span><a href="#108837" title="scales.xml.XmlOutput">output</a>, <span title="object None">None</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span></span>
<a href="l671"></a><span id="l671">              <span class="keyword">else</span></span>
<a href="l672"></a><span id="l672">                <span class="comment">// pop the last ones</span></span>
<a href="l673"></a><span id="l673">                <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable], _3: Boolean)(scales.xml.XmlOutput, Option[Throwable], Boolean)" class="delimiter">(</span><a href="#108837" title="scales.xml.XmlOutput">output</a>.<a href="#109537" title="scales.xml.SerializerData" id="109023">copy</a><a href="#87870" title="=&gt; scales.xml.LSSerializerFactory.type" class="delimiter">(</a>currentMappings = <a href="#108837" title="scales.xml.XmlOutput">output</a>.<a href="#109538" title="=&gt; scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]">currentMappings</a>.<a title="scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]" id="109021">pop</a>,</span>
<a href="l674"></a><span id="l674">                  path = <a href="#108837" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a>.<a title="List[scales.xml.QName]" id="109022">tail</a><span class="delimiter">)</span>, <a href="#108769" title="scales.xml.Serializer">serializer</a>.<a href="#89943" title="(qName: scales.xml.QName, path: List[scales.xml.QName])Option[Throwable]">endElement</a><span class="delimiter">(</span><a href="#109005" title="scales.xml.EndElem">endElem</a>.<a href="XmlPull.scala.html#88196" title="=&gt; scales.xml.QName">name</a>, <a href="#108837" title="scales.xml.XmlOutput">output</a>.<a href="#109539" title="=&gt; List[scales.xml.QName]">path</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span></span>
<a href="l675"></a><span id="l675"></span>
<a href="l676"></a><span id="l676">          <span class="delimiter">}</span></span>
<a href="l677"></a><span id="l677">        <span class="delimiter">}</span></span>
<a href="l678"></a><span id="l678">      <span class="delimiter">}</span></span>
<a href="l679"></a><span id="l679">      <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable])(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span><a href="#108793" title="(scales.xml.XmlOutput, Option[Throwable], Boolean)">r</a>.<span title="=&gt; scales.xml.XmlOutput">_1</span>, <a href="#108793" title="(scales.xml.XmlOutput, Option[Throwable], Boolean)">r</a>.<span title="=&gt; Option[Throwable]">_2</span><span class="delimiter">)</span></span>
<a href="l680"></a><span id="l680">    <span class="delimiter">}</span></span>
<a href="l681"></a><span id="l681">  <span class="delimiter">}</span></span>
<a href="l682"></a><span id="l682"></span>
<a href="l683"></a><span id="l683">  <span class="comment">/**</span>
<a href="l684"></a><span id="l684">   * Serializes an XmlPull</span>
<a href="l685"></a><span id="l685">   */</span></span>
<a href="l686"></a><span id="l686">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.package.SerializeableXml[scales.xml.package.CloseablePull]" id="87885">pullCloseableOnlySerializeable</a>: <a href="#12492" title="scales.xml.package.SerializeableXml[scales.xml.package.CloseablePull]">SerializeableXml</a><span class="delimiter">[</span>CloseablePull<span class="delimiter">]</span> = <a href="#109033" title="java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.package.CloseablePull]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.package.CloseablePull]" id="109033">SerializeableXml</a><span class="delimiter">[</span>CloseablePull<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l687"></a><span id="l687">    <span class="keyword">def</span> <a title="(it: scales.xml.package.CloseablePull)scales.xml.package.CloseablePull" id="109037">doc</a><span class="delimiter">(</span><a title="scales.xml.package.CloseablePull" id="109039">it</a>: <a href="#89866" title="scales.xml.package.CloseablePull">CloseablePull</a><span class="delimiter">)</span> = <a href="#109039" title="scales.xml.package.CloseablePull">it</a></span>
<a href="l688"></a><span id="l688">    <span class="keyword">def</span> <a title="(it: scales.xml.package.CloseablePull)(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])" id="109038">apply</a><span class="delimiter">(</span><a title="scales.xml.package.CloseablePull" id="109043">it</a>: <a href="#89866" title="scales.xml.package.CloseablePull">CloseablePull</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="109044">out</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="scales.xml.Serializer" id="109045">serializer</a>: <a href="#11913" title="scales.xml.Serializer">Serializer</a><span class="delimiter">)</span>: <span title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#89865" title="(it: Iterator[scales.xml.package.PullType])(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])">streamSerializeable</a><span class="delimiter">(</span><a href="#109043" title="scales.xml.package.CloseablePull">it</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#109044" title="scales.xml.XmlOutput">out</a>, <a href="#109045" title="scales.xml.Serializer">serializer</a><span class="delimiter">)</span></span>
<a href="l689"></a><span id="l689">  <span class="delimiter">}</span></span>
<a href="l690"></a><span id="l690"></span>
<a href="l691"></a><span id="l691">  <span class="comment">/**</span>
<a href="l692"></a><span id="l692">   * Serializes an XmlPull Resource</span>
<a href="l693"></a><span id="l693">   */</span></span>
<a href="l694"></a><span id="l694">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.package.SerializeableXml[scales.xml.XmlPull]" id="87887">pullOnlySerializeable</a>: <a href="#12492" title="scales.xml.package.SerializeableXml[scales.xml.XmlPull]">SerializeableXml</a><span class="delimiter">[</span>XmlPull<span class="delimiter">]</span> = <a href="#109052" title="java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.XmlPull]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.package.SerializeableXml[scales.xml.XmlPull]" id="109052">SerializeableXml</a><span class="delimiter">[</span>XmlPull<span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l695"></a><span id="l695">    <span class="keyword">def</span> <a title="(it: scales.xml.XmlPull)scales.xml.XmlPull" id="109056">doc</a><span class="delimiter">(</span><a title="scales.xml.XmlPull" id="109058">it</a>: <a href="XmlPull.scala.html#11969" title="scales.xml.XmlPull">XmlPull</a><span class="delimiter">)</span> = <a href="#109058" title="scales.xml.XmlPull">it</a></span>
<a href="l696"></a><span id="l696">    <span class="keyword">def</span> <a title="(it: scales.xml.XmlPull)(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])" id="109057">apply</a><span class="delimiter">(</span><a title="scales.xml.XmlPull" id="109062">it</a>: <a href="XmlPull.scala.html#11969" title="scales.xml.XmlPull">XmlPull</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="109063">out</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="scales.xml.Serializer" id="109064">serializer</a>: <a href="#11913" title="scales.xml.Serializer">Serializer</a><span class="delimiter">)</span>: <span title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#89865" title="(it: Iterator[scales.xml.package.PullType])(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])">streamSerializeable</a><span class="delimiter">(</span><a href="#109062" title="scales.xml.XmlPull">it</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#109063" title="scales.xml.XmlOutput">out</a>, <a href="#109064" title="scales.xml.Serializer">serializer</a><span class="delimiter">)</span></span>
<a href="l697"></a><span id="l697">  <span class="delimiter">}</span></span>
<a href="l698"></a><span id="l698"></span>
<a href="l699"></a><span id="l699">  <span class="comment">/**</span>
<a href="l700"></a><span id="l700">   * Serializes an Iterator and DocLike</span>
<a href="l701"></a><span id="l701">   */</span></span>
<a href="l702"></a><span id="l702">  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scales.xml.package.SerializeableXml[(Iterator[scales.xml.package.PullType], scales.xml.DocLike)]" id="87889">pullAndDocSerializeable</a>: <a href="#12492" title="scales.xml.package.SerializeableXml[(Iterator[scales.xml.package.PullType], scales.xml.DocLike)]">SerializeableXml</a><span class="delimiter">[</span><span class="delimiter">(</span>Iterator<span class="delimiter">[</span>PullType<span class="delimiter">]</span>, DocLike<span class="delimiter">)</span><span class="delimiter">]</span> = <a href="#109071" title="java.lang.Object with scales.xml.package.SerializeableXml[(Iterator[scales.xml.package.PullType], scales.xml.DocLike)]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scales.xml.package.SerializeableXml[(Iterator[scales.xml.package.PullType], scales.xml.DocLike)]" id="109071">SerializeableXml</a><span class="delimiter">[</span><span class="delimiter">(</span>Iterator<span class="delimiter">[</span>PullType<span class="delimiter">]</span>, DocLike<span class="delimiter">)</span><span class="delimiter">]</span> <span class="delimiter">{</span></span>
<a href="l703"></a><span id="l703">    <span class="keyword">def</span> <a title="(it: (Iterator[scales.xml.package.PullType], scales.xml.DocLike))scales.xml.DocLike" id="109075">doc</a><span class="delimiter">(</span><a title="(Iterator[scales.xml.package.PullType], scales.xml.DocLike)" id="109077">it</a>: <span title="(Iterator[scales.xml.package.PullType], scales.xml.DocLike)" class="delimiter">(</span>Iterator<span class="delimiter">[</span>PullType<span class="delimiter">]</span>, DocLike<span class="delimiter">)</span><span class="delimiter">)</span> = <a href="#109077" title="(Iterator[scales.xml.package.PullType], scales.xml.DocLike)">it</a>.<span title="=&gt; scales.xml.DocLike">_2</span></span>
<a href="l704"></a><span id="l704">    <span class="keyword">def</span> <a title="(it: (Iterator[scales.xml.package.PullType], scales.xml.DocLike))(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])" id="109076">apply</a><span class="delimiter">(</span><a title="(Iterator[scales.xml.package.PullType], scales.xml.DocLike)" id="109081">it</a>: <span title="(Iterator[scales.xml.package.PullType], scales.xml.DocLike)" class="delimiter">(</span>Iterator<span class="delimiter">[</span>PullType<span class="delimiter">]</span>, DocLike<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="109082">out</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="scales.xml.Serializer" id="109083">serializer</a>: <a href="#11913" title="scales.xml.Serializer">Serializer</a><span class="delimiter">)</span>: <span title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#89865" title="(it: Iterator[scales.xml.package.PullType])(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])">streamSerializeable</a><span class="delimiter">(</span><a href="#109081" title="(Iterator[scales.xml.package.PullType], scales.xml.DocLike)">it</a>.<span title="=&gt; Iterator[scales.xml.package.PullType]">_1</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#109082" title="scales.xml.XmlOutput">out</a>, <a href="#109083" title="scales.xml.Serializer">serializer</a><span class="delimiter">)</span></span>
<a href="l705"></a><span id="l705">  <span class="delimiter">}</span></span>
<a href="l706"></a><span id="l706"></span>
<a href="l707"></a><span id="l707"></span>
<a href="l708"></a><span id="l708"><span class="delimiter">}</span></span>
<a href="l709"></a><span id="l709"></span>
<a href="l710"></a><span id="l710"><span class="keyword">trait</span> <a title="trait XmlPrinter extends java.lang.Object with ScalaObject" id="11959">XmlPrinter</a> <span title="ScalaObject" class="delimiter">{</span></span>
<a href="l711"></a><span id="l711">  <span class="keyword">import</span> <a href="ScalesXml.scala.html#11813" title="object scales.xml.ScalesXml">ScalesXml</a>._</span>
<a href="l712"></a><span id="l712"></span>
<a href="l713"></a><span id="l713">  <span class="comment">/**</span>
<a href="l714"></a><span id="l714">   * a) add / replace in mappings</span>
<a href="l715"></a><span id="l715">   * b) add to declMap</span>
<a href="l716"></a><span id="l716">   */</span></span>
<a href="l717"></a><span id="l717">  <span class="keyword">def</span> <a title="(entry: (String, String), mappings: scala.collection.immutable.Map[String,String], declMap: scala.collection.immutable.Map[String,String])(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" id="12487">laddNS</a><span class="delimiter">(</span><a title="(String, String)" id="108174">entry</a>: <span title="(String, String)" class="delimiter">(</span>String, String<span class="delimiter">)</span>, <a title="scala.collection.immutable.Map[String,String]" id="108175">mappings</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="scala.collection.immutable.Map[String,String]" id="108176">declMap</a>: <span title="scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span></span>
<a href="l718"></a><span id="l718">    <span class="keyword">val</span> <a title="Option[String]" id="108179">mapping</a> = <a href="#108175" title="scala.collection.immutable.Map[String,String]">mappings</a>.<span title="(key: String)Option[String]">get</span><span class="delimiter">(</span><a href="#108174" title="(String, String)">entry</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span></span>
<a href="l719"></a><span id="l719"></span>
<a href="l720"></a><span id="l720">    <span title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="keyword">if</span> <span class="delimiter">(</span><a href="#108179" title="Option[String]">mapping</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l721"></a><span id="l721">      <span class="comment">// currently exists</span></span>
<a href="l722"></a><span id="l722">      <span title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="keyword">if</span> <span class="delimiter">(</span><a href="#108179" title="Option[String]">mapping</a>.<span title="=&gt; String">get</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#108174" title="(String, String)">entry</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l723"></a><span id="l723">        <span class="comment">// do nothing</span></span>
<a href="l724"></a><span id="l724">        <span title="(_1: scala.collection.immutable.Map[String,String], _2: scala.collection.immutable.Map[String,String])(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="delimiter">(</span><a href="#108175" title="scala.collection.immutable.Map[String,String]">mappings</a>, <a href="#108176" title="scala.collection.immutable.Map[String,String]">declMap</a><span class="delimiter">)</span></span>
<a href="l725"></a><span id="l725">      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l726"></a><span id="l726">        <span class="comment">// replace and redefine</span></span>
<a href="l727"></a><span id="l727">        <span title="(_1: scala.collection.immutable.Map[String,String], _2: scala.collection.immutable.Map[String,String])(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="delimiter">(</span><a href="#108175" title="scala.collection.immutable.Map[String,String]">mappings</a>.<span title="(key: String, value: String)scala.collection.immutable.Map[String,String]">updated</span><span class="delimiter">(</span><a href="#108174" title="(String, String)">entry</a>.<span title="=&gt; String">_1</span>, <a href="#108174" title="(String, String)">entry</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span>,</span>
<a href="l728"></a><span id="l728">          <a href="#108176" title="scala.collection.immutable.Map[String,String]">declMap</a> <span title="(kv: (String, String))scala.collection.immutable.Map[String,String]">+</span> <a href="#108174" title="(String, String)">entry</a><span class="delimiter">)</span></span>
<a href="l729"></a><span id="l729">      <span class="delimiter">}</span></span>
<a href="l730"></a><span id="l730">    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l731"></a><span id="l731">      <span class="comment">// map and define</span></span>
<a href="l732"></a><span id="l732">      <span title="(_1: scala.collection.immutable.Map[String,String], _2: scala.collection.immutable.Map[String,String])(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="delimiter">(</span><a href="#108175" title="scala.collection.immutable.Map[String,String]">mappings</a> <span title="(kv: (String, String))scala.collection.immutable.Map[String,String]">+</span> <span class="delimiter">(</span><a href="#108174" title="(String, String)">entry</a>.<span title="(x: String)ArrowAssoc[String]">_1</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#108174" title="(String, String)">entry</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span>,</span>
<a href="l733"></a><span id="l733">        <a href="#108176" title="scala.collection.immutable.Map[String,String]">declMap</a> <span title="(kv: (String, String))scala.collection.immutable.Map[String,String]">+</span> <a href="#108174" title="(String, String)">entry</a><span class="delimiter">)</span></span>
<a href="l734"></a><span id="l734">    <span class="delimiter">}</span></span>
<a href="l735"></a><span id="l735">  <span class="delimiter">}</span></span>
<a href="l736"></a><span id="l736"></span>
<a href="l737"></a><span id="l737">  <span class="keyword">def</span> <a title="(x: scales.xml.Elem, out: scales.xml.XmlOutput)(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String]))" id="12488">doElement</a><span class="delimiter">(</span><a title="scales.xml.Elem" id="108142">x</a>: <a href="XmlTypes.scala.html#11994" title="scales.xml.Elem">Elem</a>, <a title="scales.xml.XmlOutput" id="108143">out</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a><span class="delimiter">)</span> = <span class="delimiter">{</span></span>
<a href="l738"></a><span id="l738"></span>
<a href="l739"></a><span id="l739">    <span class="comment">// for each of our namespace mappings that differ (or are not there)</span></span>
<a href="l740"></a><span id="l740">    <span class="keyword">var</span> <a href="#108147" title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="delimiter">(</a><a href="#108146" title="scala.collection.immutable.Map[String,String]" id="108147">mappings</a>, <a href="#108146" title="scala.collection.immutable.Map[String,String]" id="108148">declMap</a><span class="delimiter">)</span> = <a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88396" title="=&gt; scala.collection.immutable.Map[String,String]">namespaces</a>.<span title="(z: (scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String]))(op: ((scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String]), (String, String)) =&gt; (scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String]))(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">foldLeft</span><span class="delimiter">(</span> <span class="comment">// (nsmappings start with top , what we declare)</span></span>
<a href="l741"></a><span id="l741">      <span title="(_1: scala.collection.immutable.Map[String,String], _2: scala.collection.immutable.Map[String,String])(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="delimiter">(</span><a href="#108143" title="scales.xml.XmlOutput">out</a>.<a href="#109538" title="=&gt; scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]]">currentMappings</a>.<span title="=&gt; scala.collection.immutable.Map[String,String]">top</span>, <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]" class="delimiter">[</span><span title="String">String</span>, <span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String]) @unchecked" class="delimiter">(</span><span class="delimiter">(</span><a title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" id="108172">p</a>, <a title="(String, String)" id="108173">a</a><span class="delimiter">)</span> =&gt; <a href="#12487" title="(entry: (String, String), mappings: scala.collection.immutable.Map[String,String], declMap: scala.collection.immutable.Map[String,String])(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">laddNS</a><span class="delimiter">(</span><a href="#108173" title="(String, String)">a</a>, <a href="#108172" title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">p</a>.<span title="=&gt; scala.collection.immutable.Map[String,String]">_1</span>, <a href="#108172" title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">p</a>.<span title="=&gt; scala.collection.immutable.Map[String,String]">_2</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l742"></a><span id="l742"></span>
<a href="l743"></a><span id="l743">    <span class="comment">// with our attributes</span></span>
<a href="l744"></a><span id="l744">    <span class="keyword">val</span> <a title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" id="108149">t</a> = <a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88395" title="=&gt; scales.xml.package.Attributes">attributes</a>.<span title="(z: (scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String]))(op: ((scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String]), scales.xml.Attribute) =&gt; (scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String]))(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">foldLeft</span><span class="delimiter">(</span><span title="(_1: scala.collection.immutable.Map[String,String], _2: scala.collection.immutable.Map[String,String])(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="delimiter">(</span><a href="#108147" title="scala.collection.immutable.Map[String,String]">mappings</a>, <a href="#108148" title="scala.collection.immutable.Map[String,String]">declMap</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" id="108444">p</a>, <a title="scales.xml.Attribute" id="108445">a</a><span class="delimiter">)</span> =&gt;</span>
<a href="l745"></a><span id="l745">      <span class="keyword">val</span> <a title="scales.xml.Attribute" id="108446">e</a> = <a href="#108445" title="scales.xml.Attribute">a</a></span>
<a href="l746"></a><span id="l746">      <span title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="keyword">if</span> <span class="delimiter">(</span><a href="XmlTypes.scala.html#87803" title="(v1: scales.xml.Attribute)scales.xml.QName">e</a>.<a href="QName.scala.html#87934" title="=&gt; Option[String]">prefix</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span></span>
<a href="l747"></a><span id="l747">        <a href="#12487" title="(entry: (String, String), mappings: scala.collection.immutable.Map[String,String], declMap: scala.collection.immutable.Map[String,String])(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">laddNS</a><span class="delimiter">(</span><span title="(_1: String, _2: String)(String, String)" class="delimiter">(</span><a href="XmlTypes.scala.html#87803" title="(v1: scales.xml.Attribute)scales.xml.QName">e</a>.<a href="QName.scala.html#87934" title="=&gt; Option[String]">prefix</a>.<span title="=&gt; String">get</span>, <a href="XmlTypes.scala.html#87803" title="(v1: scales.xml.Attribute)scales.xml.QName">e</a>.<a href="QName.scala.html#87933" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a><span class="delimiter">)</span>, <a href="#108444" title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">p</a>.<span title="=&gt; scala.collection.immutable.Map[String,String]">_1</span>, <a href="#108444" title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">p</a>.<span title="=&gt; scala.collection.immutable.Map[String,String]">_2</span><span class="delimiter">)</span></span>
<a href="l748"></a><span id="l748">      <span class="keyword">else</span> <a href="#108444" title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">p</a></span>
<a href="l749"></a><span id="l749">    <span class="delimiter">}</span></span>
<a href="l750"></a><span id="l750"></span>
<a href="l751"></a><span id="l751">    <a href="#108147" title="scala.collection.immutable.Map[String,String]">mappings</a> = <a href="#108149" title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">t</a>.<span title="=&gt; scala.collection.immutable.Map[String,String]">_1</span></span>
<a href="l752"></a><span id="l752">    <a href="#108148" title="scala.collection.immutable.Map[String,String]">declMap</a> = <a href="#108149" title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">t</a>.<span title="=&gt; scala.collection.immutable.Map[String,String]">_2</span></span>
<a href="l753"></a><span id="l753"></span>
<a href="l754"></a><span id="l754">    <span class="comment">// is this namespace declared?</span></span>
<a href="l755"></a><span id="l755">    <span class="keyword">val</span> <a title="Boolean" id="108150">addedDefaultNS</a> = <span class="delimiter">{</span></span>
<a href="l756"></a><span id="l756">      <span class="keyword">val</span> <a title="String" id="108478">currentDefault</a> = <a href="#108147" title="(key: String)String">mappings</a><span class="delimiter">(</span><a href="QName.scala.html#11795" title="object scales.xml.Default">Default</a>.<a href="QName.scala.html#91587" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a><span class="delimiter">)</span></span>
<a href="l757"></a><span id="l757">      <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>.<a href="QName.scala.html#87933" title="=&gt; scales.xml.Namespace">namespace</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="QName.scala.html#11795" title="object scales.xml.Default">Default</a>.<a href="QName.scala.html#91589" title="=&gt; scales.xml.Namespace">noNamespace</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l758"></a><span id="l758">        <span class="comment">// is there a prefix?</span></span>
<a href="l759"></a><span id="l759">        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>.<a href="QName.scala.html#87934" title="=&gt; Option[String]">prefix</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l760"></a><span id="l760">          <span class="comment">// then it is a normal laddNS</span></span>
<a href="l761"></a><span id="l761">          <span class="keyword">val</span> <a href="#108501" title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])" class="delimiter">(</a><a href="#108500" title="scala.collection.immutable.Map[String,String]" id="108501">imappings</a>, <a href="#108500" title="scala.collection.immutable.Map[String,String]" id="108502">ideclMap</a><span class="delimiter">)</span> = <a href="#12487" title="(entry: (String, String), mappings: scala.collection.immutable.Map[String,String], declMap: scala.collection.immutable.Map[String,String])(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String])">laddNS</a><span title="(scala.collection.immutable.Map[String,String], scala.collection.immutable.Map[String,String]) @unchecked" class="delimiter">(</span><span title="(_1: String, _2: String)(String, String)" class="delimiter">(</span><a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>.<a href="QName.scala.html#87934" title="=&gt; Option[String]">prefix</a>.<span title="=&gt; String">get</span>, <a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>.<a href="QName.scala.html#87933" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a><span class="delimiter">)</span>, <a href="#108147" title="scala.collection.immutable.Map[String,String]">mappings</a>, <a href="#108148" title="scala.collection.immutable.Map[String,String]">declMap</a><span class="delimiter">)</span></span>
<a href="l762"></a><span id="l762">          <a href="#108147" title="scala.collection.immutable.Map[String,String]">mappings</a> = <a href="#108501" title="scala.collection.immutable.Map[String,String]">imappings</a></span>
<a href="l763"></a><span id="l763">          <a href="#108148" title="scala.collection.immutable.Map[String,String]">declMap</a> = <a href="#108502" title="scala.collection.immutable.Map[String,String]">ideclMap</a></span>
<a href="l764"></a><span id="l764">          <span class="comment">// push the current on again</span></span>
<a href="l765"></a><span id="l765">          <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l766"></a><span id="l766">        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l767"></a><span id="l767">          <span class="comment">// there will always be on as we don't remove only redefine.</span></span>
<a href="l768"></a><span id="l768"></span>
<a href="l769"></a><span id="l769">          <span class="comment">// is it the current default namespace? </span></span>
<a href="l770"></a><span id="l770">          <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#108478" title="String">currentDefault</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>.<a href="QName.scala.html#87933" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l771"></a><span id="l771">            <span class="comment">// keep the current</span></span>
<a href="l772"></a><span id="l772">            <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l773"></a><span id="l773">          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l774"></a><span id="l774">            <span class="comment">// must redefine it</span></span>
<a href="l775"></a><span id="l775">            <span class="comment">// then the namespace has been badly declared as we have a conflict, but in order for at</span></span>
<a href="l776"></a><span id="l776">            <span class="comment">// least this element to be valid we must remap it, log it?</span></span>
<a href="l777"></a><span id="l777">            <a href="#108147" title="scala.collection.immutable.Map[String,String]">mappings</a> = <a href="#108147" title="scala.collection.immutable.Map[String,String]">mappings</a>.<span title="(key: String, value: String)scala.collection.immutable.Map[String,String]">updated</span><span class="delimiter">(</span><a href="QName.scala.html#11795" title="object scales.xml.Default">Default</a>.<a href="QName.scala.html#91587" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a>, <a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88394" title="=&gt; scales.xml.QName">name</a>.<a href="QName.scala.html#87933" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a><span class="delimiter">)</span></span>
<a href="l778"></a><span id="l778">            <span title="Boolean(true)" class="keyword">true</span></span>
<a href="l779"></a><span id="l779">          <span class="delimiter">}</span></span>
<a href="l780"></a><span id="l780">        <span class="delimiter">}</span></span>
<a href="l781"></a><span id="l781">      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l782"></a><span id="l782">        <span class="comment">// then if the current default is not &quot;&quot; we must redeclare it</span></span>
<a href="l783"></a><span id="l783">        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#108478" title="String">currentDefault</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="QName.scala.html#11795" title="object scales.xml.Default">Default</a>.<a href="QName.scala.html#91589" title="=&gt; scales.xml.Namespace">noNamespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l784"></a><span id="l784">          <span title="Boolean(false)" class="keyword">false</span></span>
<a href="l785"></a><span id="l785">        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span></span>
<a href="l786"></a><span id="l786">          <a href="#108147" title="scala.collection.immutable.Map[String,String]">mappings</a> = <a href="#108147" title="scala.collection.immutable.Map[String,String]">mappings</a>.<span title="(key: String, value: String)scala.collection.immutable.Map[String,String]">updated</span><span class="delimiter">(</span><a href="QName.scala.html#11795" title="object scales.xml.Default">Default</a>.<a href="QName.scala.html#91587" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a>, <a href="QName.scala.html#11795" title="object scales.xml.Default">Default</a>.<a href="QName.scala.html#91589" title="=&gt; scales.xml.Namespace">noNamespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a><span class="delimiter">)</span></span>
<a href="l787"></a><span id="l787">          <span title="Boolean(true)" class="keyword">true</span></span>
<a href="l788"></a><span id="l788">        <span class="delimiter">}</span></span>
<a href="l789"></a><span id="l789">      <span class="delimiter">}</span></span>
<a href="l790"></a><span id="l790">    <span class="delimiter">}</span></span>
<a href="l791"></a><span id="l791"></span>
<a href="l792"></a><span id="l792">    <span class="comment">// don't render it here, mappings contains it</span></span>
<a href="l793"></a><span id="l793">    <a href="#108148" title="scala.collection.immutable.Map[String,String]">declMap</a> = <a href="#108148" title="scala.collection.immutable.Map[String,String]">declMap</a> <span title="(key: String)scala.collection.immutable.Map[String,String]">-</span> <a href="QName.scala.html#11795" title="object scales.xml.Default">Default</a>.<a href="QName.scala.html#91587" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a></span>
<a href="l794"></a><span id="l794"></span>
<a href="l795"></a><span id="l795">    <span class="keyword">val</span> <a title="Option[String]" id="108151">default</a> = <a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88396" title="=&gt; scala.collection.immutable.Map[String,String]">namespaces</a>.<span title="(key: String)Option[String]">get</span><span class="delimiter">(</span><a href="QName.scala.html#11795" title="object scales.xml.Default">Default</a>.<a href="QName.scala.html#91587" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a><span class="delimiter">)</span></span>
<a href="l796"></a><span id="l796">    <span class="keyword">val</span> <a title="Option[String]" id="108152">addDef</a> =</span>
<a href="l797"></a><span id="l797">      <span title="Option[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#108150" title="Boolean">addedDefaultNS</a> <span title="(x: Boolean)Boolean">||</span> <a href="#108151" title="Option[String]">default</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span></span>
<a href="l798"></a><span id="l798">        <span class="comment">// we have a new mapping, old one doesn't work anymore</span></span>
<a href="l799"></a><span id="l799">        <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#108147" title="(key: String)String">mappings</a><span class="delimiter">(</span><a href="QName.scala.html#11795" title="object scales.xml.Default">Default</a>.<a href="QName.scala.html#91587" title="=&gt; scales.xml.Namespace">namespace</a>.<a href="QName.scala.html#88274" title="=&gt; String">uri</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l800"></a><span id="l800">      <span class="delimiter">}</span> <span class="keyword">else</span></span>
<a href="l801"></a><span id="l801">        <span title="object None">None</span></span>
<a href="l802"></a><span id="l802"></span>
<a href="l803"></a><span id="l803">    <span title="(_1: scala.collection.immutable.Map[String,String], _2: (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String]))(scala.collection.immutable.Map[String,String], (scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String]))" class="delimiter">(</span><a href="#108147" title="scala.collection.immutable.Map[String,String]">mappings</a>, <span title="(_1: scales.xml.package.Attributes, _2: scala.collection.immutable.Map[String,String], _3: Option[String])(scales.xml.package.Attributes, scala.collection.immutable.Map[String,String], Option[String])" class="delimiter">(</span><a href="#108142" title="scales.xml.Elem">x</a>.<a href="XmlTypes.scala.html#88395" title="=&gt; scales.xml.package.Attributes">attributes</a>, <a href="#108148" title="scala.collection.immutable.Map[String,String]">declMap</a>, <a href="#108152" title="Option[String]">addDef</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l804"></a><span id="l804">  <span class="delimiter">}</span></span>
<a href="l805"></a><span id="l805"></span>
<a href="l806"></a><span id="l806">  <span class="keyword">def</span> <a title="(decl: scales.xml.Declaration, out: java.io.Writer)scales.xml.SerializerData" id="12489">withWriter</a><span class="delimiter">(</span><a title="scales.xml.Declaration" id="108036">decl</a>: <a href="XmlTypes.scala.html#12011" title="scales.xml.Declaration">Declaration</a>, <a title="java.io.Writer" id="108037">out</a>: <span title="java.io.Writer">Writer</span><span class="delimiter">)</span>: <a href="#109955" title="scales.xml.SerializerData">SerializerData</a> = <a href="#109955" title="(out: java.io.Writer, version: scales.xml.XmlVersion, encoding: java.nio.charset.Charset)scales.xml.SerializerData">SerializerData</a><span class="delimiter">(</span><a href="#108037" title="java.io.Writer">out</a>, <a href="#108036" title="scales.xml.Declaration">decl</a>.<a href="XmlTypes.scala.html#93477" title="=&gt; scales.xml.XmlVersion">version</a>, <a href="#108036" title="scales.xml.Declaration">decl</a>.<a href="XmlTypes.scala.html#93479" title="=&gt; java.nio.charset.Charset">encoding</a><span class="delimiter">)</span></span>
<a href="l807"></a><span id="l807"></span>
<a href="l808"></a><span id="l808">  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(pout: scales.xml.XmlOutput, misc: Iterable[scales.xml.package.Misc], serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])" id="12490">serializeMisc</a><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="109107">pout</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="Iterable[scales.xml.package.Misc]" id="109108">misc</a>: <span title="Iterable[scales.xml.package.Misc]">Iterable</span><span class="delimiter">[</span>Misc<span class="delimiter">]</span>, <a title="scales.xml.Serializer" id="109109">serializer</a>: <a href="#11913" title="scales.xml.Serializer">Serializer</a><span class="delimiter">)</span> = <span class="delimiter">{</span></span>
<a href="l809"></a><span id="l809">    <span class="keyword">val</span> <a title="Option[Throwable]" id="109112">opt</a> = <a href="#109108" title="Iterable[scales.xml.package.Misc]">misc</a>.<span title="(z: Option[Throwable])(op: (Option[Throwable], scales.xml.package.Misc) =&gt; Option[Throwable])Option[Throwable]">foldLeft</span><span class="delimiter">(</span><span title="object None">None</span>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Option[Throwable]" id="109125">x</a>, <a title="scales.xml.package.Misc" id="109126">m</a><span class="delimiter">)</span> =&gt;</span>
<a href="l810"></a><span id="l810">      <a href="#109125" title="Option[Throwable]">x</a>.<span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l811"></a><span id="l811">        <a href="#109109" title="scales.xml.Serializer">serializer</a>.<a href="#89940" title="(item: scales.xml.XmlItem, path: List[scales.xml.QName])Option[Throwable]">item</a><span class="delimiter">(</span><a href="#109126" title="scales.xml.package.Misc">m</a>.<span title="[X](fa: scales.xml.Comment =&gt; X, fb: scales.xml.PI =&gt; X)X">fold</span><span title="(fa: scales.xml.Comment =&gt; scales.xml.XmlItem, fb: scales.xml.PI =&gt; scales.xml.XmlItem)scales.xml.XmlItem" class="delimiter">[</span><a href="XmlTypes.scala.html#11998" title="scales.xml.XmlItem">XmlItem</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.Comment" id="109136">z</a> =&gt; <a href="#109136" title="scales.xml.Comment">z</a>, <a title="scales.xml.PI" id="109138">y</a> =&gt; <a href="#109138" title="scales.xml.PI">y</a><span class="delimiter">)</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l812"></a><span id="l812">      <span class="delimiter">}</span></span>
<a href="l813"></a><span id="l813">    <span class="delimiter">}</span></span>
<a href="l814"></a><span id="l814">    <span title="(_1: scales.xml.XmlOutput, _2: Option[Throwable])(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span><a href="#109107" title="scales.xml.XmlOutput">pout</a>, <a href="#109112" title="Option[Throwable]">opt</a><span class="delimiter">)</span></span>
<a href="l815"></a><span id="l815">  <span class="delimiter">}</span></span>
<a href="l816"></a><span id="l816"></span>
<a href="l817"></a><span id="l817">  <span class="keyword">def</span> <a title="(pout: scales.xml.XmlOutput, doc: scales.xml.DocLike)(serializerf: (scales.xml.XmlOutput, scales.xml.Serializer) =&gt; (scales.xml.XmlOutput, Option[Throwable]))scales.xml.Serializer =&gt; Option[Throwable]" id="12491">headerAndFooter</a><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="109153">pout</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="scales.xml.DocLike" id="109154">doc</a>: <a href="XmlTypes.scala.html#12023" title="scales.xml.DocLike">DocLike</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="(scales.xml.XmlOutput, scales.xml.Serializer) =&gt; (scales.xml.XmlOutput, Option[Throwable])" id="109155">serializerf</a>: <span class="delimiter">(</span>XmlOutput, Serializer<span class="delimiter">)</span> =&gt; <span class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>: Serializer =&gt; Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <span class="delimiter">{</span> <a title="scales.xml.Serializer" id="109158">serializer</a> =&gt;</span>
<a href="l818"></a><span id="l818"></span>
<a href="l819"></a><span id="l819">    <span class="keyword">var</span> <a title="scales.xml.XmlOutput" id="109159">out</a> = <a href="#109153" title="scales.xml.XmlOutput">pout</a></span>
<a href="l820"></a><span id="l820">    <span class="comment">// TODO DTD and header</span></span>
<a href="l821"></a><span id="l821">    <a href="#109158" title="scales.xml.Serializer">serializer</a>.<a href="#89944" title="(encoding: java.nio.charset.Charset, version: scales.xml.XmlVersion)Option[Throwable]">xmlDeclaration</a><span class="delimiter">(</span><a href="#109153" title="scales.xml.XmlOutput">pout</a>.<a href="#109537" title="=&gt; scales.xml.SerializerData">data</a>.<a href="#109097" title="=&gt; java.nio.charset.Charset">encoding</a>, <a href="#109153" title="scales.xml.XmlOutput">pout</a>.<a href="#109537" title="=&gt; scales.xml.SerializerData">data</a>.<a href="#109096" title="=&gt; scales.xml.XmlVersion">version</a><span class="delimiter">)</span>.<span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l822"></a><span id="l822">      <span class="comment">// DTD</span></span>
<a href="l823"></a><span id="l823">      <span title="object None">None</span></span>
<a href="l824"></a><span id="l824">    <span class="delimiter">}</span>.<span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l825"></a><span id="l825">      <span class="keyword">val</span> <a href="#109168" title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</a><a href="#109167" title="scales.xml.XmlOutput" id="109168">pout</a>, <a href="#109167" title="Option[Throwable]" id="109169">opt</a><span class="delimiter">)</span> = <a href="#12490" title="(pout: scales.xml.XmlOutput, misc: Iterable[scales.xml.package.Misc], serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])">serializeMisc</a><span title="(scales.xml.XmlOutput, Option[Throwable]) @unchecked" class="delimiter">(</span><a href="#109159" title="scales.xml.XmlOutput">out</a>, <a href="#109154" title="scales.xml.DocLike">doc</a>.<a href="XmlTypes.scala.html#89595" title="=&gt; scales.xml.Prolog">prolog</a>.<a href="XmlTypes.scala.html#94370" title="=&gt; scales.xml.package.Miscs">misc</a>, <a href="#109158" title="scales.xml.Serializer">serializer</a><span class="delimiter">)</span></span>
<a href="l826"></a><span id="l826">      <a href="#109159" title="scales.xml.XmlOutput">out</a> = <a href="#109168" title="scales.xml.XmlOutput">pout</a></span>
<a href="l827"></a><span id="l827">      <a href="#109169" title="Option[Throwable]">opt</a></span>
<a href="l828"></a><span id="l828">    <span class="delimiter">}</span>.<span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l829"></a><span id="l829">      <span class="keyword">val</span> <a href="#109184" title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</a><a href="#109183" title="scales.xml.XmlOutput" id="109184">pout</a>, <a href="#109183" title="Option[Throwable]" id="109185">opt</a><span class="delimiter">)</span> = <a href="#109155" title="(v1: scales.xml.XmlOutput, v2: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])">serializerf</a><span title="(scales.xml.XmlOutput, Option[Throwable]) @unchecked" class="delimiter">(</span><a href="#109159" title="scales.xml.XmlOutput">out</a>, <a href="#109158" title="scales.xml.Serializer">serializer</a><span class="delimiter">)</span></span>
<a href="l830"></a><span id="l830">      <a href="#109159" title="scales.xml.XmlOutput">out</a> = <a href="#109184" title="scales.xml.XmlOutput">pout</a></span>
<a href="l831"></a><span id="l831">      <a href="#109185" title="Option[Throwable]">opt</a></span>
<a href="l832"></a><span id="l832">    <span class="delimiter">}</span>.<span title="(alternative: =&gt; Option[Throwable])Option[Throwable]">orElse</span> <span class="delimiter">{</span></span>
<a href="l833"></a><span id="l833">      <span class="keyword">val</span> <a href="#109202" title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</a><a href="#109201" title="scales.xml.XmlOutput" id="109202">pout</a>, <a href="#109201" title="Option[Throwable]" id="109203">opt</a><span class="delimiter">)</span> = <a href="#12490" title="(pout: scales.xml.XmlOutput, misc: Iterable[scales.xml.package.Misc], serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])">serializeMisc</a><span title="(scales.xml.XmlOutput, Option[Throwable]) @unchecked" class="delimiter">(</span><a href="#109159" title="scales.xml.XmlOutput">out</a>, <a href="#109154" title="scales.xml.DocLike">doc</a>.<a href="XmlTypes.scala.html#89596" title="=&gt; scales.xml.EndMisc">end</a>.<a href="XmlTypes.scala.html#94400" title="=&gt; scales.xml.package.Miscs">misc</a>, <a href="#109158" title="scales.xml.Serializer">serializer</a><span class="delimiter">)</span></span>
<a href="l834"></a><span id="l834">      <a href="#109159" title="scales.xml.XmlOutput">out</a> = <a href="#109202" title="scales.xml.XmlOutput">pout</a></span>
<a href="l835"></a><span id="l835">      <a href="#109203" title="Option[Throwable]">opt</a></span>
<a href="l836"></a><span id="l836">    <span class="delimiter">}</span></span>
<a href="l837"></a><span id="l837">  <span class="delimiter">}</span></span>
<a href="l838"></a><span id="l838"></span>
<a href="l839"></a><span id="l839">  <span class="comment">/**</span>
<a href="l840"></a><span id="l840">   * Type class for choosing a serializing algo</span>
<a href="l841"></a><span id="l841">   */</span></span>
<a href="l842"></a><span id="l842">  <span class="keyword">trait</span> <a title="trait SerializeableXml[T] extends java.lang.Object" id="12492">SerializeableXml</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="12493">T</a><span class="delimiter">]</span> <span title="java.lang.Object" class="delimiter">{</span></span>
<a href="l843"></a><span id="l843"></span>
<a href="l844"></a><span id="l844">    <span class="keyword">def</span> <a title="(it: T)scales.xml.DocLike" id="89864">doc</a><span class="delimiter">(</span><a title="T" id="89912">it</a>: <a href="#12493" title="T">T</a><span class="delimiter">)</span>: <a href="XmlTypes.scala.html#12023" title="scales.xml.DocLike">DocLike</a></span>
<a href="l845"></a><span id="l845"></span>
<a href="l846"></a><span id="l846">    <span class="keyword">def</span> <a title="(it: T)(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])" id="89865">apply</a><span class="delimiter">(</span><a title="T" id="89919">it</a>: <a href="#12493" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="89920">out</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a>, <a title="scales.xml.Serializer" id="89921">serializer</a>: <a href="#11913" title="scales.xml.Serializer">Serializer</a><span class="delimiter">)</span>: <span title="(scales.xml.XmlOutput, Option[Throwable])" class="delimiter">(</span>XmlOutput, Option<span class="delimiter">[</span>Throwable<span class="delimiter">]</span><span class="delimiter">)</span></span>
<a href="l847"></a><span id="l847">  <span class="delimiter">}</span></span>
<a href="l848"></a><span id="l848"></span>
<a href="l849"></a><span id="l849">  <span class="keyword">type</span> <a title="XmlPrinter extends scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed" id="12494">CloseablePull</a> = <a href="#89866" title="XmlPrinter extends scales.xml.XmlPull with java.io.Closeable with scales.utils.IsClosed">XmlPull</a> <span class="keyword">with</span> java.io.Closeable <span class="keyword">with</span> scales.utils.IsClosed</span>
<a href="l850"></a><span id="l850"></span>
<a href="l851"></a><span id="l851">  <span class="comment">/**</span>
<a href="l852"></a><span id="l852">   * Placeholder - prefer serialize instead</span>
<a href="l853"></a><span id="l853">   */</span></span>
<a href="l854"></a><span id="l854">  <span class="keyword">def</span> <a title="[T](pout: scales.xml.XmlOutput)(it: T)(implicit evidence$1: XmlPrinter.this.SerializeableXml[T])Option[Throwable]" id="109218">foldPrint</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="12497">T</a>: SerializeableXml<span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="109216">pout</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="109217">it</a>: <a href="#12497" title="T">T</a><span class="delimiter">)</span> =</span>
<a href="l855"></a><span id="l855">    <a href="#109223" title="(pout: scales.xml.XmlOutput)(it: T)(implicit evidence$2: XmlPrinter.this.SerializeableXml[T])Option[Throwable]">serialize</a><span class="delimiter">(</span><a href="#109216" title="scales.xml.XmlOutput">pout</a><span class="delimiter">)</span><a href="#109218" title="XmlPrinter.this.SerializeableXml[T]" class="delimiter">(</a><a href="#109217" title="T">it</a><span class="delimiter">)</span></span>
<a href="l856"></a><span id="l856"></span>
<a href="l857"></a><span id="l857">  <span class="comment">/**</span>
<a href="l858"></a><span id="l858">   * Serializes items which can behave like xml.</span>
<a href="l859"></a><span id="l859">   */</span></span>
<a href="l860"></a><span id="l860">  <span class="keyword">def</span> <a title="[T](pout: scales.xml.XmlOutput)(it: T)(implicit evidence$2: XmlPrinter.this.SerializeableXml[T])Option[Throwable]" id="109223">serialize</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="12500">T</a>: SerializeableXml<span class="delimiter">]</span><span class="delimiter">(</span><a title="scales.xml.XmlOutput" id="109221">pout</a>: <a href="#109923" title="scales.xml.XmlOutput">XmlOutput</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="109222">it</a>: <a href="#12500" title="T">T</a><span class="delimiter">)</span> =</span>
<a href="l861"></a><span id="l861">    <a href="#109221" title="scales.xml.XmlOutput">pout</a>.<a href="#90067" title="(thunk: scales.xml.Serializer =&gt; Option[Throwable])(data: scales.xml.SerializerData)Option[Throwable]">serializerF</a> <span class="delimiter">{</span></span>
<a href="l862"></a><span id="l862">      <span class="keyword">val</span> <a title="XmlPrinter.this.SerializeableXml[T]" id="109228">sxml</a> = <span title="[T](implicit e: T)T">implicitly</span><a href="#109223" title="(implicit e: XmlPrinter.this.SerializeableXml[T])XmlPrinter.this.SerializeableXml[T]" class="delimiter">[</a><a href="#12492" title="XmlPrinter.this.SerializeableXml[T]">SerializeableXml</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span></span>
<a href="l863"></a><span id="l863">      <a href="#12491" title="(pout: scales.xml.XmlOutput, doc: scales.xml.DocLike)(serializerf: (scales.xml.XmlOutput, scales.xml.Serializer) =&gt; (scales.xml.XmlOutput, Option[Throwable]))scales.xml.Serializer =&gt; Option[Throwable]">headerAndFooter</a><span class="delimiter">(</span><a href="#109221" title="scales.xml.XmlOutput">pout</a>, <a href="#109228" title="XmlPrinter.this.SerializeableXml[T]">sxml</a>.<a href="#89864" title="(it: T)scales.xml.DocLike">doc</a><span class="delimiter">(</span><a href="#109222" title="T">it</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span></span>
<a href="l864"></a><span id="l864">        <a href="#89865" title="(it: T)(out: scales.xml.XmlOutput, serializer: scales.xml.Serializer)(scales.xml.XmlOutput, Option[Throwable])">sxml</a><a href="#109233" title="scales.xml.XmlOutput" class="delimiter">(</a><a href="#109222" title="T">it</a><span class="delimiter">)</span><span class="delimiter">)</span></span>
<a href="l865"></a><span id="l865">    <span class="delimiter">}</span><span class="delimiter">(</span><a href="#109221" title="scales.xml.XmlOutput">pout</a>.<a href="#109537" title="=&gt; scales.xml.SerializerData">data</a><span class="delimiter">)</span></span>
<a href="l866"></a><span id="l866"></span>
<a href="l867"></a><span id="l867">  <span class="comment">/**</span>
<a href="l868"></a><span id="l868">   * Prints to stdout, useful for testing etc  Will dump an error if one is found.</span>
<a href="l869"></a><span id="l869">   *</span>
<a href="l870"></a><span id="l870">   * Note it outputs to the vmDefaultCharset so it should always be C+P able</span>
<a href="l871"></a><span id="l871">   */</span></span>
<a href="l872"></a><span id="l872">  <span class="keyword">def</span> <a title="[T](xml: T)(implicit serf: scales.xml.SerializerFactory, implicit sxml: XmlPrinter.this.SerializeableXml[T])Unit" id="12501">printTree</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="12503">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="109253">xml</a>: <a href="#12503" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.SerializerFactory" id="109254">serf</a>: <a href="#11917" title="scales.xml.SerializerFactory">SerializerFactory</a>, <a title="XmlPrinter.this.SerializeableXml[T]" id="109255">sxml</a>: <a href="#12492" title="XmlPrinter.this.SerializeableXml[T]">SerializeableXml</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span></span>
<a href="l873"></a><span id="l873">    <span class="keyword">val</span> <a title="java.io.PrintWriter" id="109260">out</a> = <span title="(x$1: java.io.OutputStream)java.io.PrintWriter" class="keyword">new</span> java.io.<span title="java.io.PrintWriter">PrintWriter</span><span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span><span class="delimiter">)</span></span>
<a href="l874"></a><span id="l874">    <a href="#109223" title="(pout: scales.xml.XmlOutput)(it: T)(implicit evidence$2: XmlPrinter.this.SerializeableXml[T])Option[Throwable]">serialize</a><span class="delimiter">(</span><a href="#109923" title="(data: scales.xml.SerializerData, currentMappings: scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]], path: List[scales.xml.QName])(implicit serializerFI: scales.xml.SerializerFactory)scales.xml.XmlOutput">XmlOutput</a><a href="#87870" title="=&gt; scales.xml.LSSerializerFactory.type" class="delimiter">(</a><a href="#109096" title="scales.xml.XmlVersion" id="109552">SerializerData</a><span class="delimiter">(</span><a href="#109260" title="java.io.PrintWriter" id="109550">out</a>, encoding = <a href="../utils/Localisation.scala.html#12397" title="java.nio.charset.Charset" id="109551">vmDefaultCharset</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><a href="#109255" title="XmlPrinter.this.SerializeableXml[T]" class="delimiter">(</a><a href="#109253" title="T">xml</a><span class="delimiter">)</span> <span title="(f: Throwable =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="Throwable" id="109566">e</a> =&gt;</span>
<a href="l875"></a><span id="l875">      <a href="#109260" title="java.io.PrintWriter">out</a>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Could not serialize got the following exception &quot;)" class="string">&quot;Could not serialize got the following exception &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#109566" title="Throwable">e</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="()java.lang.String">getName</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; - &quot;)" class="string">&quot; - &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#109566" title="Throwable">e</a>.<span title="()java.lang.String">getMessage</span><span class="delimiter">)</span></span>
<a href="l876"></a><span id="l876">      <a href="#109566" title="Throwable">e</a>.<span title="(x$1: java.io.PrintWriter)Unit">printStackTrace</span><span class="delimiter">(</span><a href="#109260" title="java.io.PrintWriter">out</a><span class="delimiter">)</span></span>
<a href="l877"></a><span id="l877">    <span class="delimiter">}</span></span>
<a href="l878"></a><span id="l878">    <a href="#109260" title="java.io.PrintWriter">out</a>.<span title="()Unit">flush</span></span>
<a href="l879"></a><span id="l879">    <span class="comment">//out.close, v bad to close stdout :-)</span></span>
<a href="l880"></a><span id="l880">    <span title="()Unit">println</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l881"></a><span id="l881">  <span class="delimiter">}</span></span>
<a href="l882"></a><span id="l882"></span>
<a href="l883"></a><span id="l883">  <span class="comment">/**</span>
<a href="l884"></a><span id="l884">   * Returns a string version of the tree or throws</span>
<a href="l885"></a><span id="l885">   */</span></span>
<a href="l886"></a><span id="l886">  <span class="keyword">def</span> <a title="[T](xml: T)(implicit serf: scales.xml.SerializerFactory, implicit sxml: XmlPrinter.this.SerializeableXml[T])String" id="12504">asString</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="12506">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="95200">xml</a>: <a href="#12506" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scales.xml.SerializerFactory" id="95201">serf</a>: <a href="#11917" title="scales.xml.SerializerFactory">SerializerFactory</a>, <a title="XmlPrinter.this.SerializeableXml[T]" id="95202">sxml</a>: <a href="#12492" title="XmlPrinter.this.SerializeableXml[T]">SerializeableXml</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span></span>
<a href="l887"></a><span id="l887">    <span class="keyword">val</span> <a title="java.io.StringWriter" id="109581">builder</a> = <span title="java.io.StringWriter" class="keyword">new</span> java.io.<span title="java.io.StringWriter">StringWriter</span><span class="delimiter">(</span><span class="delimiter">)</span></span>
<a href="l888"></a><span id="l888">    <a href="#109218" title="(pout: scales.xml.XmlOutput)(it: T)(implicit evidence$1: XmlPrinter.this.SerializeableXml[T])Option[Throwable]">foldPrint</a><span class="delimiter">(</span><a href="#109923" title="(data: scales.xml.SerializerData, currentMappings: scala.collection.immutable.Stack[scala.collection.immutable.Map[String,String]], path: List[scales.xml.QName])(implicit serializerFI: scales.xml.SerializerFactory)scales.xml.XmlOutput">XmlOutput</a><a href="#87870" title="=&gt; scales.xml.LSSerializerFactory.type" class="delimiter">(</a><a href="#109955" title="(out: java.io.Writer, version: scales.xml.XmlVersion, encoding: java.nio.charset.Charset)scales.xml.SerializerData">SerializerData</a><span class="delimiter">(</span><a href="#109581" title="java.io.StringWriter">builder</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><a href="#95202" title="XmlPrinter.this.SerializeableXml[T]" class="delimiter">(</a><a href="#95200" title="T">xml</a><span class="delimiter">)</span> <span title="(f: Throwable =&gt; Nothing)Unit">foreach</span> <span class="delimiter">{</span></span>
<a href="l889"></a><span id="l889">      <span title="Nothing" class="keyword">throw</span> <a href="#109608" title="Throwable">_</a></span>
<a href="l890"></a><span id="l890">    <span class="delimiter">}</span></span>
<a href="l891"></a><span id="l891">    <a href="#109581" title="java.io.StringWriter">builder</a>.<span title="()java.lang.String">toString</span></span>
<a href="l892"></a><span id="l892">  <span class="delimiter">}</span></span>
<a href="l893"></a><span id="l893"><span class="delimiter">}</span></span>
<a href="l894"></a><span id="l894"></span>
<a href="l895"></a><span id="l895">        </span>
</pre>
    </body>
</html>